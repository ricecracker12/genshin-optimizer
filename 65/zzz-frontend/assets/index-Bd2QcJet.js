import{N as re,bt as ce,c as s,be as ne,j as t,bN as v,bO as ie,d as f,av as le,bP as oe,bQ as he,n as M,bR as ue,h as de,u as pe,bS as ge,a2 as ye,bC as me,i as Ce,k as fe,bT as be,bU as T,l as xe,m as Se,bs as Te,af as we,e as ve,G as l,bV as Me,bW as ke,a1 as De,bX as Ie,C as Ee,A as Oe,B as Pe,S as B,bl as je,aV as Ne}from"./index-CV0u-y9G.js";import{n as Be,u as Fe,k as He,l as Ke,p as ze,m as Ae,r as Re,s as Ve,t as F,h as w}from"./tagFieldMap-BLRzih0g.js";import"./useDataEntryBase-DPcJxG4q.js";import"./discSortUtil-BZjvIwtP.js";function We({value:o,totals:a,onChange:n,...d}){const y=re(),h=!ce(y.breakpoints.up("sm")),g=s.useMemo(()=>ne([...v]),[]),b=s.useCallback(c=>()=>n(g(o,c)),[n,g,o]);return t(ue,{exclusive:!0,value:o,...d,children:v.map(c=>t(ie,{value:c,sx:{p:h?1:void 0,minWidth:h?0:"6em",display:"flex",gap:h?0:1},selectedColor:"primary",onClick:b(c),children:f(M,{sx:{display:"flex",alignItems:"center",gap:1},children:[t(le,{src:oe(c),size:1.5,sideMargin:!0}),!h&&t(he,{label:a[c],size:"small"})]})},c))})}const $e={xs:1,sm:2,md:2,lg:3,xl:4},Ge={xs:1,sm:2,md:2,lg:3,xl:12},Ue=Object.keys(F);function Xe(){const{t:o}=de("page_characters"),{database:a}=pe(),n=ge(),{params:{characterKey:d}}=ye({path:"/characters/:characterKey",end:!1})??{params:{}},[y,h]=s.useState(()=>a.displayCharacter.get());s.useEffect(()=>a.displayCharacter.follow((e,r)=>h(r)),[a,h]);const[g,b]=s.useState(""),c=s.useDeferredValue(g),[k,D]=s.useState(""),H=s.useMemo(()=>({statHighlight:k,setStatHighlight:D}),[k,D]),u=s.useMemo(()=>d?me.includes(d)?d:(n("/characters"),null):null,[d,n]),m=Be(u??void 0),I=Fe(u??void 0),K=s.useMemo(()=>({src:u,dst:u,preset:"preset0"}),[u]),[z,E]=s.useState(!1),[A,O]=Ce();s.useEffect(()=>a.chars.followAny((e,r)=>(r==="new"||r==="remove")&&O()),[O,a]);const R=s.useCallback(e=>{a.chars.get(e)||a.chars.getOrCreate(e),n(`/characters/${e}`)},[a.chars,n]),P=s.useDeferredValue(y),j=s.useDeferredValue(A),{charKeys:p,totalCharNum:x}=s.useMemo(()=>{const r=a.chars.keys.length,{attribute:i,specialtyType:C,rarity:ee,sortType:te,ascending:ae}=P,se=a.chars.keys.filter(fe({attribute:i,specialtyType:C,rarity:ee,name:c},Re(a))).sort(be(F[te]??[],ae,Ve(a),["new"]));return j&&{charKeys:se,totalCharNum:r}},[a,P,c,j]),{specialtyType:V,attribute:W,rarity:$,sortType:G,ascending:U}=y,_=s.useMemo(()=>T(je,e=>a.chars.entries.forEach(([r,i])=>{const C=w(i.key).specialty;e[C].total++,a.chars.keys.includes(r)&&e[C].current++})),[a]),Q=s.useMemo(()=>T(Ne,e=>Object.entries(a.chars.data).forEach(([r])=>{const i=w(r).attribute;e[i].total++,a.chars.keys.includes(r)&&e[i].current++})),[a]),q=s.useMemo(()=>T(v,e=>Object.entries(a.chars.data).forEach(([r])=>{const i=w(r).rarity;e[i].total++,a.chars.keys.includes(r)&&e[i].current++})),[a]),L=xe(),{numShow:N,setTriggerElement:X}=Se(Ge[L],p.length),S=s.useMemo(()=>p.slice(0,N),[p,N]),J=p.length!==x?`${p.length}/${x}`:`${x}`,Y={numShowing:S.length,total:J,t:o,namespace:"page_character"},Z={sortKeys:[...Ue],value:G,onChange:e=>a.displayCharacter.set({sortType:e}),ascending:U,onChangeAsc:e=>a.displayCharacter.set({ascending:e})};return f(M,{display:"flex",flexDirection:"column",gap:2,children:[u&&m&&I&&t(we.Provider,{value:K,children:t(Te.Provider,{value:H,children:t(He,{character:m,charOpt:I,wengineId:m.equippedWengine,discIds:m.equippedDiscs,children:t(Ke,{characterKey:u,onClose:()=>n("/characters")})})})}),t(s.Suspense,{fallback:!1,children:t(ze,{show:z,onHide:()=>E(!1),onSelect:R,newFirst:!0})}),t(Ee,{children:f(ve,{sx:{display:"flex",flexDirection:"column",gap:1},children:[f(l,{container:!0,spacing:1,children:[t(l,{item:!0,children:t(Me,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({specialtyType:e}),value:V,totals:_,size:"small"})}),t(l,{item:!0,children:t(ke,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({attribute:e}),value:W,totals:Q,size:"small"})}),t(l,{item:!0,children:t(We,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({rarity:e}),value:$,totals:q,size:"small"})}),t(l,{item:!0,flexGrow:1}),t(l,{item:!0,children:t(De,{autoFocus:!0,value:g,onChange:e=>b(e.target.value),label:o("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(M,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:t(Ie,{showingTextProps:Y,sortByButtonProps:Z})})]})}),t(Pe,{fullWidth:!0,onClick:()=>E(!0),color:"info",startIcon:t(Oe,{}),children:o("addNew")}),t(s.Suspense,{fallback:t(B,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(l,{container:!0,spacing:2,columns:$e,children:S.map(e=>t(l,{item:!0,xs:1,children:t(Ae,{characterKey:e,onClick:()=>n(`${e}`)})},e))})}),p.length!==S.length&&t(B,{ref:e=>{e&&X(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Xe as default};
