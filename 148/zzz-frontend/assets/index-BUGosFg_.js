import{P as J,bH as X,d as s,bq as Y,b$ as M,j as a,c0 as ee,e as x,ax as ae,c1 as te,c2 as se,o as k,c3 as re,i as ce,u as ne,c4 as ie,a3 as le,a as oe,bQ as he,c5 as ue,l as de,c6 as ge,c7 as w,m as pe,n as me,bG as ye,ag as Ce,f as fe,G as o,c8 as xe,c9 as be,ca as Se,cb as Te,C as we,A as ve,B as Me,S as B,bA as v,by as ke,aZ as Ie}from"./index-2U0Fl7Od.js";import{m as Oe,u as je,j as Pe,k as Be,o as De,l as Ee,p as He,r as ze,s as D}from"./tagFieldMap-BkLrUSQk.js";import"./discSortUtil-CmGufq2Q.js";function Ae({value:h,totals:t,onChange:n,...d}){const p=J(),u=!X(p.breakpoints.up("sm")),m=s.useMemo(()=>Y([...M]),[]),y=s.useCallback(r=>()=>n(m(h,r)),[n,m,h]);return a(re,{exclusive:!0,value:h,...d,children:M.map(r=>a(ee,{value:r,sx:{p:u?1:void 0,minWidth:u?0:"6em",display:"flex",gap:u?0:1},selectedColor:"primary",onClick:y(r),children:x(k,{sx:{display:"flex",alignItems:"center",gap:1},children:[a(ae,{src:te(r),size:1.5,sideMargin:!0}),!u&&a(se,{label:t[r],size:"small"})]})},r))})}const Fe={xs:1,sm:2,md:2,lg:3,xl:4},Ke={xs:1,sm:2,md:2,lg:3,xl:12},$e=Object.keys(D);function We(){const{t:h}=ce("page_characters"),{database:t}=ne(),n=ie(),{params:{characterKey:d}}=le({path:"/characters/:characterKey",end:!1})??{params:{}},p=oe(t.displayCharacter),[u,m]=s.useState(""),y=s.useDeferredValue(u),[r,I]=s.useState(""),E=s.useMemo(()=>({statHighlight:r,setStatHighlight:I}),[r,I]),i=s.useMemo(()=>d?he.includes(d)?d:(n("/characters"),null):null,[d,n]),C=Oe(i??void 0),O=je(i??void 0)??(i&&t.charOpts.getOrCreate(i)),H=s.useMemo(()=>({src:i,dst:i,preset:"preset0"}),[i]),[z,j]=s.useState(!1),A=s.useCallback(e=>{if(e===null)return;t.chars.get(e)||t.chars.getOrCreate(e),n(`/characters/${e}`)},[t.chars,n]),b=ue(t.chars),S=b.length,g=s.useMemo(()=>{const{attribute:e,specialtyType:c,rarity:l,sortType:f,ascending:Z}=p;return b.filter(de({attribute:e,specialtyType:c,rarity:l,name:y},He(t))).sort(ge(D[f]??[],Z,ze(t),["new"]))},[p,b,y,t]),{specialtyType:F,attribute:K,rarity:$,sortType:G,ascending:N}=p,R=s.useMemo(()=>w(ke,e=>t.chars.entries.forEach(([c,l])=>{const f=v(l.key).specialty;e[f].total++,t.chars.keys.includes(c)&&e[f].current++})),[t]),W=s.useMemo(()=>w(Ie,e=>Object.entries(t.chars.data).forEach(([c])=>{const l=v(c).attribute;e[l].total++,t.chars.keys.includes(c)&&e[l].current++})),[t]),q=s.useMemo(()=>w(M,e=>Object.entries(t.chars.data).forEach(([c])=>{const l=v(c).rarity;e[l].total++,t.chars.keys.includes(c)&&e[l].current++})),[t]),Q=pe(),{numShow:P,setTriggerElement:_}=me(Ke[Q],g.length),T=s.useMemo(()=>g.slice(0,P),[g,P]),L=g.length!==S?`${g.length}/${S}`:`${S}`,U={numShowing:T.length,total:L,t:h,namespace:"page_character"},V={sortKeys:[...$e],value:G,onChange:e=>{e!=="new"&&t.displayCharacter.set({sortType:e})},ascending:N,onChangeAsc:e=>t.displayCharacter.set({ascending:e})};return x(k,{display:"flex",flexDirection:"column",gap:2,children:[i&&C&&O&&a(Ce.Provider,{value:H,children:a(ye.Provider,{value:E,children:a(Pe,{character:C,charOpt:O,wengineId:C.equippedWengine,discIds:C.equippedDiscs,children:a(Be,{characterKey:i,onClose:()=>n("/characters")})})})}),a(s.Suspense,{fallback:!1,children:a(De,{show:z,onHide:()=>j(!1),onSelect:A,newFirst:!0})}),a(we,{children:x(fe,{sx:{display:"flex",flexDirection:"column",gap:1},children:[x(o,{container:!0,spacing:1,children:[a(o,{item:!0,children:a(xe,{sx:{height:"100%"},onChange:e=>t.displayCharacter.set({specialtyType:e}),value:F,totals:R,size:"small"})}),a(o,{item:!0,children:a(be,{sx:{height:"100%"},onChange:e=>t.displayCharacter.set({attribute:e}),value:K,totals:W,size:"small"})}),a(o,{item:!0,children:a(Ae,{sx:{height:"100%"},onChange:e=>t.displayCharacter.set({rarity:e}),value:$,totals:q,size:"small"})}),a(o,{item:!0,flexGrow:1}),a(o,{item:!0,children:a(Se,{autoFocus:!0,value:u,onChange:e=>m(e.target.value),label:h("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),a(k,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:a(Te,{showingTextProps:U,sortByButtonProps:V})})]})}),a(Me,{fullWidth:!0,onClick:()=>j(!0),color:"info",startIcon:a(ve,{}),children:h("addNew")}),a(s.Suspense,{fallback:a(B,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:a(o,{container:!0,spacing:2,columns:Fe,children:T.map(e=>a(o,{item:!0,xs:1,children:a(Ee,{characterKey:e,onClick:()=>n(`${e}`)})},e))})}),g.length!==T.length&&a(B,{ref:e=>{e&&_(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{We as default};
