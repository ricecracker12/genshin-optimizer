var Ot=t=>{throw TypeError(t)};var Pt=(t,e,s)=>e.has(t)||Ot("Cannot "+s);var ue=(t,e,s)=>(Pt(t,e,"read from private field"),s?s.call(t):e.get(t)),ge=(t,e,s)=>e.has(t)?Ot("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),$=(t,e,s,i)=>(Pt(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s);import{H as Ve,J as Xe,d as m,K as Qe,L as Xn,N as Qn,_ as Ye,O as A,P as an,Q as Yn,U as Jn,V as H,W as ae,X as We,Y as Je,Z as Nt,$ as Zn,a0 as es,a1 as ts,a2 as ns,i as J,a3 as ss,a4 as Ze,a5 as ie,a6 as Ge,a7 as is,a8 as cn,a9 as lt,aa as rs,u as E,e as f,j as n,ab as os,T as k,ac as T,ad as F,ae as as,af as cs,r as yt,b as Ct,c as vt,g as wt,ag as et,ah as St,ai as ln,aj as ne,q as Oe,I as fe,s as tt,f as R,C as W,ak as dt,v as V,al as Y,M as kt,am as re,an as ls,ao as ds,o as v,ap as us,aq as dn,ar as ps,as as jt,F as ce,at as zt,au as qt,av as Ue,aw as hs,ax as Mt,ay as fs,az as ms,y as _,aA as un,aB as gs,aC as nt,aD as xs,aE as bs,aF as _e,aG as $t,aH as ut,aI as Lt,aJ as ys,aK as pn,aL as Cs,aM as Ft,aN as Bt,B as P,aO as O,aP as hn,aQ as vs,aR as fn,aS as mn,aT as ws,aU as ye,aV as st,aW as Ss,aX as ks,aY as Ms,aZ as Dt,a_ as Et,a$ as gn,b0 as Ht,b1 as Kt,b2 as Ds,b3 as Gt,b4 as Ut,b5 as Es,b6 as Is,b7 as Ts,b8 as Rs,b9 as pt,ba as ht,bb as Vt,bc as ot,bd as As,be as Ws,bf as _s,bg as Os,bh as X,bi as Xt,bj as Ps,bk as ke,bl as It,G as K,bm as it,bn as Ns,bo as Qt,z as Tt,S as xn,bp as js,bq as Yt,br as zs,bs as qs,bt as $s,bu as Ls,bv as Fs,bw as Bs,k as ft,bx as Jt,by as Hs,bz as bn,bA as yn,bB as Cn,bC as Ks,bD as vn,bE as wn,bF as Gs,bG as Us,bH as se,bI as Vs,bJ as Xs,bK as Qs,bL as Ys,bM as Js,bN as Zt,bO as Zs,a as ei,bP as ti,bQ as ni,bR as en,bS as si,bT as ii,bU as ri,bV as oi,bW as ai,bX as ci,bY as li,bZ as di}from"./index-C5458NnQ.js";import{D as ui,b as pi,a as hi,c as Sn,d as kn,e as fi,w as mi,g as gi,T as L,f as mt,u as G,q as Me,A as De,C as Mn,h as Dn,i as En,j as In,k as xi,l as bi,F as Ke,m as yi,n as Ci,o as vi}from"./tagFieldMap-DbaRoV4Z.js";import{T as wi}from"./TextFieldLazy-DNaiwdd6.js";import"./discSortUtil-K6RJ6OO9.js";function Si(t){return Ve("MuiCollapse",t)}Xe("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const ki=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Mi=t=>{const{orientation:e,classes:s}=t,i={root:["root",`${e}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${e}`],wrapperInner:["wrapperInner",`${e}`]};return Je(i,Si,s)},Di=ae("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,e[s.orientation],s.state==="entered"&&e.entered,s.state==="exited"&&!s.in&&s.collapsedSize==="0px"&&e.hidden]}})(({theme:t,ownerState:e})=>A({height:0,overflow:"hidden",transition:t.transitions.create("height")},e.orientation==="horizontal"&&{height:"auto",width:0,transition:t.transitions.create("width")},e.state==="entered"&&A({height:"auto",overflow:"visible"},e.orientation==="horizontal"&&{width:"auto"}),e.state==="exited"&&!e.in&&e.collapsedSize==="0px"&&{visibility:"hidden"})),Ei=ae("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(t,e)=>e.wrapper})(({ownerState:t})=>A({display:"flex",width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),Ii=ae("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(t,e)=>e.wrapperInner})(({ownerState:t})=>A({width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),Rt=m.forwardRef(function(e,s){const i=Qe({props:e,name:"MuiCollapse"}),{addEndListener:o,children:c,className:a,collapsedSize:l="0px",component:u,easing:r,in:d,onEnter:p,onEntered:h,onEntering:g,onExit:b,onExited:x,onExiting:y,orientation:C="vertical",style:w,timeout:D=Qn.standard,TransitionComponent:B=Xn}=i,I=Ye(i,ki),N=A({},i,{orientation:C,collapsedSize:l}),M=Mi(N),z=an(),Z=Yn(),q=m.useRef(null),j=m.useRef(),Q=typeof l=="number"?`${l}px`:l,oe=C==="horizontal",de=oe?"width":"height",Ne=m.useRef(null),Ln=Jn(s,Ne),me=S=>U=>{if(S){const ee=Ne.current;U===void 0?S(ee):S(ee,U)}},rt=()=>q.current?q.current[oe?"clientWidth":"clientHeight"]:0,Fn=me((S,U)=>{q.current&&oe&&(q.current.style.position="absolute"),S.style[de]=Q,p&&p(S,U)}),Bn=me((S,U)=>{const ee=rt();q.current&&oe&&(q.current.style.position="");const{duration:Ee,easing:je}=Nt({style:w,timeout:D,easing:r},{mode:"enter"});if(D==="auto"){const _t=z.transitions.getAutoHeightDuration(ee);S.style.transitionDuration=`${_t}ms`,j.current=_t}else S.style.transitionDuration=typeof Ee=="string"?Ee:`${Ee}ms`;S.style[de]=`${ee}px`,S.style.transitionTimingFunction=je,g&&g(S,U)}),Hn=me((S,U)=>{S.style[de]="auto",h&&h(S,U)}),Kn=me(S=>{S.style[de]=`${rt()}px`,b&&b(S)}),Gn=me(x),Un=me(S=>{const U=rt(),{duration:ee,easing:Ee}=Nt({style:w,timeout:D,easing:r},{mode:"exit"});if(D==="auto"){const je=z.transitions.getAutoHeightDuration(U);S.style.transitionDuration=`${je}ms`,j.current=je}else S.style.transitionDuration=typeof ee=="string"?ee:`${ee}ms`;S.style[de]=Q,S.style.transitionTimingFunction=Ee,y&&y(S)}),Vn=S=>{D==="auto"&&Z.start(j.current||0,S),o&&o(Ne.current,S)};return H.jsx(B,A({in:d,onEnter:Fn,onEntered:Hn,onEntering:Bn,onExit:Kn,onExited:Gn,onExiting:Un,addEndListener:Vn,nodeRef:Ne,timeout:D==="auto"?null:D},I,{children:(S,U)=>H.jsx(Di,A({as:u,className:We(M.root,a,{entered:M.entered,exited:!d&&Q==="0px"&&M.hidden}[S]),style:A({[oe?"minWidth":"minHeight"]:Q},w),ref:Ln},U,{ownerState:A({},N,{state:S}),children:H.jsx(Ei,{ownerState:A({},N,{state:S}),className:M.wrapper,ref:q,children:H.jsx(Ii,{ownerState:A({},N,{state:S}),className:M.wrapperInner,children:c})})}))}))});Rt.muiSupportAuto=!0;const Tn=m.createContext({});function Ti(t){return Ve("MuiAccordion",t)}const ze=Xe("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Ri=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Ai=t=>{const{classes:e,square:s,expanded:i,disabled:o,disableGutters:c}=t;return Je({root:["root",!s&&"rounded",i&&"expanded",o&&"disabled",!c&&"gutters"],region:["region"]},Ti,e)},Wi=ae(ts,{name:"MuiAccordion",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[{[`& .${ze.region}`]:e.region},e.root,!s.square&&e.rounded,!s.disableGutters&&e.gutters]}})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],e),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],e)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${ze.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${ze.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}},({theme:t})=>({variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${ze.expanded}`]:{margin:"16px 0"}}}]})),qe=m.forwardRef(function(e,s){const i=Qe({props:e,name:"MuiAccordion"}),{children:o,className:c,defaultExpanded:a=!1,disabled:l=!1,disableGutters:u=!1,expanded:r,onChange:d,square:p=!1,slots:h={},slotProps:g={},TransitionComponent:b,TransitionProps:x}=i,y=Ye(i,Ri),[C,w]=Zn({controlled:r,default:a,name:"Accordion",state:"expanded"}),D=m.useCallback(oe=>{w(!C),d&&d(oe,!C)},[C,d,w]),[B,...I]=m.Children.toArray(o),N=m.useMemo(()=>({expanded:C,disabled:l,disableGutters:u,toggle:D}),[C,l,u,D]),M=A({},i,{square:p,disabled:l,disableGutters:u,expanded:C}),z=Ai(M),Z=A({transition:b},h),q=A({transition:x},g),[j,Q]=es("transition",{elementType:Rt,externalForwardedProps:{slots:Z,slotProps:q},ownerState:M});return H.jsxs(Wi,A({className:We(z.root,c),ref:s,ownerState:M,square:p},y,{children:[H.jsx(Tn.Provider,{value:N,children:B}),H.jsx(j,A({in:C,timeout:"auto"},Q,{children:H.jsx("div",{"aria-labelledby":B.props.id,id:B.props["aria-controls"],role:"region",className:z.region,children:I})}))]}))});function _i(t){return Ve("MuiAccordionDetails",t)}Xe("MuiAccordionDetails",["root"]);const Oi=["className"],Pi=t=>{const{classes:e}=t;return Je({root:["root"]},_i,e)},Ni=ae("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>({padding:t.spacing(1,2,2)})),$e=m.forwardRef(function(e,s){const i=Qe({props:e,name:"MuiAccordionDetails"}),{className:o}=i,c=Ye(i,Oi),a=i,l=Pi(a);return H.jsx(Ni,A({className:We(l.root,o),ref:s,ownerState:a},c))});function ji(t){return Ve("MuiAccordionSummary",t)}const be=Xe("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),zi=["children","className","expandIcon","focusVisibleClassName","onClick"],qi=t=>{const{classes:e,expanded:s,disabled:i,disableGutters:o}=t;return Je({root:["root",s&&"expanded",i&&"disabled",!o&&"gutters"],focusVisible:["focusVisible"],content:["content",s&&"expanded",!o&&"contentGutters"],expandIconWrapper:["expandIconWrapper",s&&"expanded"]},ji,e)},$i=ae(ns,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],e),[`&.${be.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${be.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${be.disabled})`]:{cursor:"pointer"},variants:[{props:s=>!s.disableGutters,style:{[`&.${be.expanded}`]:{minHeight:64}}}]}}),Li=ae("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(t,e)=>e.content})(({theme:t})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${be.expanded}`]:{margin:"20px 0"}}}]})),Fi=ae("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(t,e)=>e.expandIconWrapper})(({theme:t})=>({display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${be.expanded}`]:{transform:"rotate(180deg)"}})),Le=m.forwardRef(function(e,s){const i=Qe({props:e,name:"MuiAccordionSummary"}),{children:o,className:c,expandIcon:a,focusVisibleClassName:l,onClick:u}=i,r=Ye(i,zi),{disabled:d=!1,disableGutters:p,expanded:h,toggle:g}=m.useContext(Tn),b=C=>{g&&g(C),u&&u(C)},x=A({},i,{expanded:h,disabled:d,disableGutters:p}),y=qi(x);return H.jsxs($i,A({focusRipple:!1,disableRipple:!0,disabled:d,component:"div","aria-expanded":h,className:We(y.root,c),focusVisibleClassName:We(y.focusVisible,l),onClick:b,ref:s,ownerState:x},r,{children:[H.jsx(Li,{className:y.content,ownerState:x,children:o}),a&&H.jsx(Fi,{className:y.expandIconWrapper,ownerState:x,children:a})]}))});function Bi(){const t=m.useRef(),e=m.useCallback(()=>{var s;return(s=t.current)==null?void 0:s.scrollIntoView({behavior:"smooth"})},[t]);return[t,e]}function Hi(t){const{t:e}=J("ui"),s=ss({path:"/:page/*"}),i=e("pageTitle"),o=t??((s==null?void 0:s.params.page)&&e(`tabs.${s==null?void 0:s.params.page}`));m.useEffect(()=>{o?document.title=`${o} - ${i}`:document.title=i},[e,i,o])}class Rn{constructor(){this.internal=new At}ref(e){return e.reduce((s,i)=>s.get(i),this.internal)}*[Symbol.iterator](){for(const[e,s]of this.internal.entries([]))"value"in s&&(yield[[...e],s.value])}*values(){for(const e of this.internal.allRefs())"value"in e&&(yield e.value)}}class At{constructor(){this.map=new Map}get(e){const s=this.map.get(e);if(s)return s;const i=new At;return this.map.set(e,i),i}*allRefs(){for(const e of this.map.values())yield*e.allRefs();yield this}*entries(e){const s=e.push(void 0)-1;for(const[i,o]of this.map.entries())e[s]=i,yield*o.entries(e);e.pop(),yield[e,this]}}function Ki(t,e,s){function i(a,l){if(a.val)return a.val;const u=s(a.tag);return a.val=u?[Ge(u,l)]:e.nodes.subset(a.id).flatMap(r=>r.op!=="reread"?c(r,a):i(a.with(r.tag),l)),a.val}function o(a,l){return a.every(u=>u.op==="const")?ie(hi[l](a.map(u=>u.ex))):{op:l,x:a,br:[]}}function c(a,l){const{op:u}=a;switch(u){case"const":return a;case"read":{const r=l.with(a.tag),d=a.ex??e.defaultAccu(r.tag)??"unique",p=i(r,d);return d==="unique"?p[0]??ie(void 0):o(p,d)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const r=a.x.map(d=>c(d,l));return o(r,u)}case"thres":case"match":case"lookup":{const r=a.br.map(d=>c(d,l));if(r.every(d=>d.op==="const")){const d=r.map(h=>h.ex),p=pi[a.op](d,a.ex);return c(a.x[p],l)}return{...a,x:a.x.map(d=>c(d,l)),br:r}}case"subscript":{const r=c(a.br[0],l);return r.op==="const"?ie(a.ex[r.ex]):{...a,br:[r]}}case"vtag":return ie(l.tag[a.ex]??"");case"tag":return c(a.x[0],l.with(a.tag));case"dtag":{const r=a.br.map(p=>c(p,l));if(r.some(p=>p.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const d=l.with(Object.fromEntries(r.map((p,h)=>[a.ex[h],p.ex])));return c(a.x[0],d)}case"custom":return{...a,x:a.x.map(r=>c(r,l))};default:Ze(u)}}return t.map(a=>c(a,new ui(e.cache.keys).at({})))}function Pe(t,e){const s=new Map;function i(o){const c=s.get(o);if(c)return c;const a=o,l=at(o.x,i),u=at(o.br,i);(o.x!==l||o.br!==u)&&(o={...o,x:l,br:u});const r=e(o,a);return s.set(o,r),r}return at(t,i)}function gt(t,e){const s=new Set;function i(o){s.has(o)||(e(o,i),s.add(o))}t.forEach(i)}function at(t,e){const s=t.map(e);return t.every((i,o)=>i===s[o])?t:s}const{arithmetic:tn}=Sn;function Gi(t){return t=Ui(t),t=Vi(t),t=Xi(t),t}function Ui(t){return Pe(t,e=>{const{op:s}=e;switch(s){case"sum":case"prod":case"min":case"max":if(e.x.length===1)return e.x[0];if(e.x.some(i=>i.op===s)){const i=e.x.flatMap(o=>o.op===s?o.x:[o]);return{...e,x:i}}}return e})}function Vi(t){return Pe(t,e=>{const{op:s}=e;switch(s){case"sum":case"prod":case"min":case"max":{const i=e.x.filter(o=>o.op==="const");if(i.length>1){const o=e.x.filter(a=>a.op!=="const"),c=tn[s](i.map(a=>a.ex));return c===tn[s]([])?{...e,x:o}:{...e,x:[ie(c),...o]}}}}return e})}function Xi(t){const e=new Map,s=new Rn;return Pe(t,i=>{const{op:o}=i,c=i.x.map(r=>e.get(r)),a=i.br.map(r=>e.get(r));let l;switch(o){case"read":{const r=Object.keys(i.tag).sort();l=[o,i.ex,...r,...r.map(d=>i.tag[d])];break}case"sum":case"prod":case"min":case"max":l=[o,...c.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":l=[o,i.ex,...c,...a];break;case"match":l=[o,i.ex,...c,...a.sort()];break;default:Ze(o)}const u=s.ref(l);return"value"in u?u.value:(u.value=i,e.set(i,e.size),i)})}const{arithmetic:Qi,branching:Yi}=Sn;function Ji(t,e,s,i,o){const c=new Zi(t,i,e,s);for(;c.progress;)c.progress=!1,er(c),tr(c,1),sr(c),nr(c,o);return c.nodes=Gi(c.nodes),c}var he,Ce,ve,we,Se;class Zi{constructor(e,s,i,o){ge(this,he);ge(this,Ce);ge(this,ve);ge(this,we);ge(this,Se);this.progress=!0,$(this,he,e),this.minimum=s,$(this,Ce,i),this.cat=o}get nodes(){return ue(this,he)}set nodes(e){ue(this,he)!==e&&(this.progress=!0,$(this,he,e),$(this,we,$(this,Se,void 0)))}get candidates(){return ue(this,Ce)}set candidates(e){this.candidates!==e&&(this.progress=!0,$(this,Ce,e),$(this,ve,$(this,we,$(this,Se,void 0))))}get cndRanges(){return ue(this,ve)??$(this,ve,this.candidates.map(xt))}set cndRanges(e){$(this,ve,e)}get nodeRanges(){return ue(this,we)??$(this,we,An(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return ue(this,Se)??$(this,Se,ir(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}he=new WeakMap,Ce=new WeakMap,ve=new WeakMap,we=new WeakMap,Se=new WeakMap;function er(t){const{nodes:e,nodeRanges:s}=t,i=Pe(e,(o,c)=>{const a=s.get(c);if(a.min===a.max)return c.op==="const"?o:ie(a.min);switch(c.op){case"thres":{const[l,u]=c.br.map(r=>s.get(r));if(l.min>=u.max)return o.x[0];if(l.max<u.min)return o.x[1];break}case"min":{const l=o.x.filter((u,r)=>s.get(c.x[r]).min<=a.max);if(l.length===1)return l[0];if(l.length!==o.x.length)return rs(...l);break}case"max":{const l=o.x.filter((u,r)=>s.get(c.x[r]).max>=a.min);if(l.length===1)return l[0];if(l.length!==o.x.length)return lt(...l);break}case"match":case"lookup":if(o.br.every(l=>l.op==="const")){const l=o.br.map(u=>u.ex);return o.x[Yi[c.op](l,c.ex)]}break;case"subscript":if(o.br[0].op==="const")return ie(o.ex[o.br[0].ex]);break}return o});t.nodes=i}function tr(t,e){const{nodeRanges:s,minimum:i,cat:o}=t,c=[...t.candidates],a=[...t.cndRanges],l=[],u=[];let r=!1;if(t.nodes.forEach((p,h)=>{if(h<i.length){if(i[h]>s.get(p).min)r=!0;else if(h>=e)return;u.push(i[h])}l.push(p)}),u.length!=i.length&&(t.nodes=l,t.minimum=u),!r)return;let d=!1;c.forEach((p,h)=>{const g=a[h],b=p.filter(x=>{a[h]=xt([x]);const y=An(l,o,a);return u.every((C,w)=>y.get(l[w]).max>=C)});b.length!=p.length?(c[h]=b,a[h]=xt(b),d=!0):a[h]=g}),d&&(t.candidates=c,t.cndRanges=a)}function nr(t,e){const s=[...t.monotonicities],i=t.candidates.map(r=>r.map(d=>{const p={incomp:[],inc:{},c:d};for(const[h,g]of s)g.inc?p.inc[h]=d[h]??0:g.dec?p.inc[h]=-(d[h]??0):p.incomp.push(d[h]??0);return p})),o=i[0][0];if(o===void 0)return;const c=Object.keys(o.inc),a=[...c].reverse(),l=!!o.incomp.length,u=i.map(r=>{const d=new Rn;return l?r.forEach(p=>{const h=d.ref(p.incomp);h.value?h.value.push(p):h.value=[p]}):d.ref([]).value=r,[...d.values()].flatMap(p=>(p.sort(({inc:h},{inc:g})=>{const b=a.find(x=>h[x]!==g[x]);return b===void 0?0:g[b]-h[b]}),p.filter(({inc:h},g)=>{let b=0;for(let x=0,y=g-e;x<=y+b;x++){const C=p[x].inc;if(c.every(w=>C[w]>=h[w])&&++b>=e)return!1}return!0})))});u.some((r,d)=>r.length!=t.candidates[d].length)&&(t.candidates=u.map(r=>r.map(d=>d.c)))}const te=Symbol();function sr(t){const{nodes:e,cat:s,candidates:i}=t,o=new Map;gt(e,(r,d)=>{if(r.x.forEach(d),r.br.forEach(d),r.br.length)return;const p=r.x.map(g=>o.get(g));if(p.some(g=>!g))return;let h;switch(r.op){case"sum":{h={[te]:p.reduce((g,b)=>g+b[te],0)};for(const g of p)for(const[b,x]of Object.entries(g))h[b]=(h[b]??0)+x;break}case"prod":{const g=r.x.findIndex(x=>x.op!=="const");if(r.x.find((x,y)=>x.op!=="const"&&y!==g))return;h=g!==-1?{...p[g]}:{[te]:1};const b=p.reduce((x,y,C)=>C===g?x:x*y[te],1);b!=1&&(Object.keys(h).forEach(x=>h[x]*=b),h[te]*=b);break}case"read":h={[r.tag[s]]:1,[te]:0};break;case"const":if(typeof r.ex!="number")return;h={[te]:r.ex};break;default:return}o.set(r,h)});const c=new Map;if(gt(e,(r,d)=>{const p=o.get(r);p&&Object.keys(p).length?c.set(r,p):(r.x.forEach(d),r.br.forEach(d))}),![...c.keys()].some(r=>{if(r.op==="const"||r.op==="read")return!1;if(r.op==="sum"&&r.x.length===2){if(r.x[0].op==="const"&&r.x[1].op==="read")return!1;if(r.x[1].op==="const"&&r.x[0].op==="read")return!1}return!0}))return;let l=new Map([...c.values()].map(r=>{const d=Object.keys(r).sort();return d.length===1&&r[d[0]]===1?[r,d[0]]:[r,""+d.flatMap(p=>[p,r[p]]).join("")]}));if(!is()){const r=new Map([...l.values()].map((d,p)=>[d,`c${p}`]));l=new Map([...l].map(([d,p])=>[d,r.get(p)]))}const u=new Map;for(const[r,d]of l){const p=Ge({[s]:d});u.set(r,r[te]!==0?cn(r[te],p):p)}t.candidates=i.map(r=>r.map(d=>{const p={id:d.id};return l.forEach((h,g)=>{h in p||(p[h]=Object.entries(g).reduce((b,[x,y])=>b+(d[x]??0)*y,0))}),p})),t.nodes=Pe(e,(r,d)=>{const p=c.get(d);return p?u.get(p):r})}function xt(t){const e=t.values(),s=e.next().value;if(!s)return{};const i=Object.fromEntries(Object.entries(s).map(([o,c])=>[o,{min:c,max:c}]));for(const o of e){for(const[c,a]of Object.entries(i)){const l=o[c]??0;a.min>l&&(a.min=l),a.max<l&&(a.max=l)}for(const[c,a]of Object.entries(o))c in i||(i[c]={min:Math.min(0,a),max:Math.max(0,a)})}return i}function An(t,e,s){const i=new Map;return gt(t,(o,c)=>{o.x.forEach(c),o.br.forEach(c);const a=o.x.map(p=>i.get(p)),l=a.map(p=>p.min),u=a.map(p=>p.max);function r(p,[h,g]){const b=Qi[p],x=[b([h.min,g.min]),b([h.min,g.max]),b([h.max,g.min]),b([h.max,g.max])];return{min:Math.min(...x),max:Math.max(...x)}}let d;switch(o.op){case"const":typeof o.ex=="number"?d={min:o.ex,max:o.ex}:d={min:NaN,max:NaN};break;case"sum":d={min:l.reduce((p,h)=>p+h,0),max:u.reduce((p,h)=>p+h,0)};break;case"prod":d={min:1,max:1},d=a.reduce((p,h)=>r(o.op,[p,h]),d);break;case"min":case"max":d={min:Math[o.op](...l),max:Math[o.op](...u)};break;case"match":case"thres":d={min:Math.min(...l),max:Math.max(...u)};break;case"sumfrac":l[0]+l[1]>0||u[0]+u[1]<0?d=r(o.op,a):d={min:NaN,max:NaN};break;case"read":{d={min:0,max:0};for(const{[o.tag[e]]:p}of s)p&&(d.min+=p.min,d.max+=p.max);break}case"subscript":{if(typeof o.ex[0]!="number")d={min:NaN,max:NaN};else{d={min:1/0,max:-1/0};let{min:p,max:h}=i.get(o.br[0]);p=Math.max(0,Math.ceil(p)),h=Math.min(h,o.ex.length-1);for(let g=p;g<=h;g++){const b=o.ex[g];d.min>b&&(d.min=b),d.max<b&&(d.max=b)}d.min>d.max&&(d={min:NaN,max:NaN})}break}case"lookup":isNaN(l[0])&&isNaN(u[0])&&(l.splice(0,1),u.splice(0,1)),d={min:Math.min(...l),max:Math.max(...u)};break;case"custom":d=kn[o.ex].range(a);break;default:Ze(o)}i.set(o,d)}),i}function ir(t,e,s){const i=new Map,o=[],c=new Map;function a(l,u){i.has(l)||i.set(l,{inc:!0,dec:!0});const r=i.get(l);if(u&&r.dec)r.dec=!1;else if(!u&&r.inc)r.inc=!1;else return;o.push({node:l,inc:u})}for(t.forEach(l=>a(l,!0));o.length;){const{node:l,inc:u}=o.pop();switch(l.op){case"read":c.set(l.tag[e],i.get(l));break;case"const":break;case"sum":case"min":case"max":l.x.forEach(r=>a(r,u));break;case"thres":{l.x.forEach(p=>a(p,u));const r=s.get(l.x[0]),d=s.get(l.x[1]);r.max>d.min&&(a(l.br[0],u),a(l.br[1],!u)),r.min<d.max&&(a(l.br[0],!u),a(l.br[1],u));break}case"sumfrac":{const[r,d]=l.x.map(p=>s.get(p));d.min<0&&a(l.x[0],!u),d.max>0&&a(l.x[0],u),r.min<0&&a(l.x[1],u),r.max>0&&a(l.x[1],!u);break}case"prod":{const r=s.get(l);if(r.min<0&&r.max>0)l.x.forEach(d=>a(d,!0)),l.x.forEach(d=>a(d,!1));else{const d=u===r.max>0;l.x.forEach(p=>a(p,d===s.get(p).max>0))}break}case"match":case"lookup":l.x.forEach(r=>a(r,u)),l.br.forEach(r=>a(r,!0)),l.br.forEach(r=>a(r,!1));break;case"subscript":{const{br:[r],ex:d}=l;if(typeof d[0]=="number"){let{min:p,max:h}=s.get(r);p=Math.max(0,Math.ceil(p)),h=Math.min(h,d.length-1);for(let g=p+1;g<=h;g++)if(d[g-1]<d[g]){a(r,u);break}for(let g=p+1;g<=h;g++)if(d[g-1]>d[g]){a(r,!u);break}}else a(r,!0),a(r,!1);break}case"custom":kn[l.ex].monotonicity(l.x.map(r=>s.get(r))).forEach((r,d)=>{r.inc||a(l.x[d],!u),r.dec||a(l.x[d],u)});break;default:Ze(l)}}return c}function rr({maxBuildsToShow:t,optConfigId:e}){const{database:s}=E(),{t:i}=J("page_optimize");return f(F,{title:i("build",{count:t}),children:[n(T,{children:n(k,{variant:"caption",color:"info.main",children:i("buildDropdownDesc")})}),os.map(o=>n(T,{onClick:()=>s.optConfigs.set(e,{maxBuildsToShow:o}),children:i("build",{count:o})},o))]})}function or({numWorkers:t,setNumWorkers:e}){const{t:s}=J("page_optimize"),i=navigator.hardwareConcurrency||8;return f(F,{title:`${t} Workers`,children:[n(T,{disabled:!0,children:"Scales with available CPU cores."}),as(1,i).map(o=>n(T,{onClick:()=>e(o),children:s("worker",{count:o})},o))]})}const Wt=cs(H.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");var Ie={},nn;function ar(){if(nn)return Ie;nn=1;var t=yt();Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.default=void 0;var e=t(Ct()),s=vt(),i=(0,e.default)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");return Ie.default=i,Ie}var cr=ar();const Fe=wt(cr);function lr({formulasRead:t,buffsRead:e}){var u;const s=m.useContext(et),i=(u=m.useContext(St))==null?void 0:u.withTag(s),o=i==null?void 0:i.toDebug(),[c,a]=m.useState(!1),l=r=>(d,p)=>{a(p?r:!1)};return n(W,{bgt:"dark",children:f(R,{children:[f(qe,{expanded:c==="formulas",onChange:l("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[n(Le,{expandIcon:n(Fe,{}),children:"All target listings"}),n($e,{children:n(dt,{children:i&&o&&c==="formulas"&&i.listFormulas(t).map((r,d)=>{const p=i.compute(r),h=o.compute(r).meta,g=r.tag.name||r.tag.q;return f(re,{children:[f(k,{children:[g,": ",p.val]}),f(qe,{children:[f(Le,{expandIcon:n(Fe,{}),children:["debug for ",g]}),f($e,{children:["conds:",n(Y,{text:ne(p.meta.conds)}),"read:",n(Y,{text:ne(r)}),"formula:",n(Y,{text:ne(h)})]})]})]},`${g}${d}`)})})})]}),f(qe,{expanded:c==="buffs",onChange:l("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[n(Le,{expandIcon:n(Fe,{}),children:"All target buffs"}),n($e,{children:n(dt,{children:i&&o&&c==="buffs"&&i.listFormulas(e).map((r,d)=>{const p=i.compute(r),h=o.compute(r).meta,g=r.tag.name||r.tag.q;return f(re,{children:[f(k,{children:[g,": ",p.val]}),f(qe,{children:[f(Le,{expandIcon:n(Fe,{}),children:["debug for ",g]}),f($e,{children:["conds:",n(Y,{text:ne(p.meta.conds)}),"read:",n(Y,{text:ne(r)}),"formula:",n(Y,{text:ne(h)})]})]})]},`${g}${d}`)})})})]})]})})}function dr(){var d;const t=m.useContext(et),e=(d=m.useContext(St))==null?void 0:d.withTag(t),s=e==null?void 0:e.toDebug(),{read:i,setRead:o}=m.useContext(ln),c=i&&(e==null?void 0:e.compute(i)),a=i&&(s==null?void 0:s.compute(i)),l=(i==null?void 0:i.tag.name)||(i==null?void 0:i.tag.q),u=a==null?void 0:a.meta,r=u&&ne(u);return n(kt,{open:!!i,onClose:()=>o(void 0),children:f(W,{bgt:"dark",children:[n(Oe,{title:`Debug formula for ${l}`,action:n(fe,{onClick:()=>o(void 0),children:n(tt,{})})}),n(R,{children:n(W,{bgt:"normal",children:n(R,{children:f(dt,{gap:1,children:["Computed value: ",c==null?void 0:c.val,n(V,{}),n(k,{variant:"h6",children:"Read"}),n(Y,{text:ne(i)}),n(V,{}),n(k,{variant:"h6",children:"Calculator Tag"}),n(Y,{text:JSON.stringify(e==null?void 0:e.cache.tag)}),n(V,{}),n(k,{variant:"h6",children:"Tag Context"}),n(Y,{text:JSON.stringify(t)}),n(V,{}),n(k,{variant:"h6",children:"Conditionals"}),n(Y,{text:ne(c==null?void 0:c.meta.conds)}),n(V,{}),n(k,{variant:"h6",children:"Formula"}),n(Y,{text:r||""})]})})})})]})})}function le({document:t,bgt:e="normal",collapse:s=!1,typoVariant:i="body1"}){switch(t.type){case"fields":return n(ur,{fieldsDocument:t,bgt:e});case"text":return s?n(pr,{textDocument:t,typoVariant:i}):n(Wn,{textDocument:t,typoVariant:i});case"conditional":return n(ls,{conditional:t.conditional,bgt:e});default:return null}}function ur({fieldsDocument:t,bgt:e="normal"}){return f(W,{bgt:e,children:[t.header&&n(dn,{header:t.header,hideDivider:t.fields.length===0}),n(ps,{bgt:e,fields:t.fields})]})}function Wn({textDocument:t,typoVariant:e}){const s=m.useContext(St),i=m.useContext(et);return s?f(k,{variant:e,children:[t.header&&n(dn,{header:t.header}),us(t.text,s.withTag(i))]}):null}function pr({textDocument:t,typoVariant:e}){const[s,i]=m.useState(!1),[o,c]=m.useState(!1);return f(v,{sx:{position:"relative"},children:[!s&&n(v,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:o?"translate(0,-5px)":void 0},children:n(ds,{})}),n(Rt,{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),collapsedSize:55,onClick:()=>i(a=>!a),in:s,sx:{cursor:"pointer",position:"relative",maskImage:s?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:s?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:n(Wn,{textDocument:t,typoVariant:e})})]})}function hr({levelLow:t,levelHigh:e,setLow:s,setHigh:i,setBoth:o,dark:c=!1,disabled:a=!1,showLevelText:l=!1}){const{t:u}=J("wengine"),[r,d]=m.useState(t);jt(t)!==t&&d(t);const[p,h]=m.useState(e);jt(e)!==e&&h(e);const g=m.useCallback((b,x)=>{if(typeof x=="number")throw new TypeError;const[y,C]=x;d(y),h(C)},[d,h]);return f(v,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:c?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[f(v,{sx:{width:"max-content",height:32,display:"flex"},children:[l?f(ce,{children:[n("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:u("levelSliderTitle")}),n(V,{orientation:"vertical",flexItem:!0})]}):void 0,n(qt,{value:r,onChange:b=>s(zt(b??0,0,e)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:l?"right":"center"}},disabled:a})]}),n(hs,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[r,p],onChange:g,onChangeCommitted:(b,x)=>Array.isArray(x)&&o(x[0],x[1]),valueLabelDisplay:"auto",min:0,max:Ue,step:1,marks:!0,disabled:a}),n(qt,{value:p,onChange:b=>i(zt(b??0,t,Ue)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function _n({setKey:t,fade2:e=!1,fade4:s=!1,children:i}){const o=fi[t];return o?f(un,{bgt:"light",sx:{height:"100%"},children:[n(Oe,{title:n(ms,{setKey:t}),avatar:n(Mt,{src:fs(t),size:2})}),i,n(_,{divider:n(V,{}),children:Object.entries(o).map(([c,a])=>n(v,{sx:{opacity:(c==="2"?e:s)?.5:1},children:n(fr,{uiSheetElement:a,collapse:c!=="2"})},c))})]}):null}function fr({uiSheetElement:t,collapse:e=!1}){const{documents:s,title:i}=t;return f(R,{children:[n(k,{variant:"subtitle1",children:i}),n(_,{spacing:1,children:s.map((o,c)=>n(le,{document:o,typoVariant:"body2",collapse:e},c))})]})}function On({headerAction:t,fade:e=!1,wengine:s}){const{key:i,level:o,phase:c,modification:a}=s,l=mi[i],u=gs(i,o,c,a),r="atk_base",d=nt(i).second_statkey;return l?f(un,{bgt:"light",sx:{height:"100%"},children:[n(Oe,{title:n(bs,{wKey:i}),avatar:n(Mt,{src:xs(i,"icon"),size:2}),action:t}),f(R,{sx:{py:0},children:[f(k,{sx:{display:"flex",justifyContent:"space-between"},children:[n(_e,{statKey:"atk"}),f("span",{children:[$t(u[r],r).toFixed(Lt(r)),ut(r)]})]}),f(k,{sx:{display:"flex",justifyContent:"space-between"},children:[n(_e,{statKey:d}),f("span",{children:[$t(u[d],d).toFixed(Lt(d)),ut(d)]})]})]}),n(v,{sx:{opacity:e?.5:1},children:n(mr,{uiSheetElement:l})})]}):null}function mr({uiSheetElement:t}){const{documents:e,title:s}=t;return f(R,{children:[n(k,{variant:"subtitle1",children:s}),n(_,{spacing:1,children:e.map((i,o)=>n(le,{document:i,typoVariant:"body2",collapse:!0},o))})]})}function Pn(t,e=new Map){const s=e.get(t);if(s)return s;const{val:i,meta:{tag:o,op:c,ops:a,usedCats:l}}=t,u=o&&ys(o,(C,w)=>l.has(w)),r=pn(i,ut(gi(o))),d=new Set;function p(C,w){return C.map((D,B)=>{const I=Pn(D,e);return I.name?(d.add(I),I.name):(I.deps.forEach(N=>d.add(N)),I.prec>=w?I.formula:f("span",{children:["(",I.formula,")"]},B))})}let h,g=1/0;switch(c){case"const":h=r,g=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:C,joiner:w,end:D}=ct[c];g=ct[c].prec,h=f("span",{children:[C,p(a,g).map((B,I)=>f(m.Fragment,{children:[B,I<a.length-1&&w]},I)),D]})}break;case"sumfrac":{const[C]=p(a,2),[w,D]=p(a,1);h=f("span",{children:[C," / (",w," + ",D,")"]}),g=ct.prod.prec;break}default:Cs(c)}let b,x;u&&(b=u.q==="_"?void 0:f("span",{children:[n(L,{tag:u})," ",r]}),x=void 0);const y={name:b,formula:h,prec:g,sheet:x,deps:[...new Set(d)]};return e.set(t,y),y}const ct={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function gr(){return n(re,{children:xr.map((t,e)=>n(le,{document:t},e))})}const xr=[{type:"conditional",conditional:{label:"Frostbite",metadata:Bt.frostbite,fields:[{title:n(L,{tag:Ft.frostbite_crit_dmg_.tag}),fieldRef:Ft.frostbite_crit_dmg_.tag}]}},{type:"conditional",conditional:{label:"Anomaly Time Passed",metadata:Bt.anomTimePassed}}];function Nn({isAftershock:t,setAftershock:e}){return n(P,{onClick:()=>e(!t),color:t?"success":"secondary",children:mt.aftershock})}function jn({dmgType:t,keys:e,setDmgType:s}){return f(F,{title:f(v,{sx:{textWrap:"nowrap"},children:["Dmg Type: ",t?mt[t]:"Any"]}),children:[n(T,{selected:!t,disabled:!t,onClick:()=>s(),children:"Any"},"any"),e.map(i=>n(T,{selected:t===i,disabled:t===i,onClick:()=>s(i),children:mt[i]},i))]})}function br(){var u;const{t}=J("page_optimize"),{database:e}=E(),{key:s}=O(),{bonusStats:i}=G(s),o=(u=hn(e.charMeta,s))==null?void 0:u.description,c=m.useCallback((r,d,p,h)=>e.charOpts.setBonusStat(s,r,d,p,h),[e,s]),a=r=>e.charOpts.setBonusStat(s,Ss(r),0,!1),l=m.useCallback(r=>{e.charMeta.set(s,{description:r})},[e.charMeta,s]);return f(_,{spacing:1,children:[i.map(({tag:r,value:d,disabled:p},h)=>n(Cr,{tag:r,value:d,disabled:p,setValue:g=>c(r,g,p,h),onDelete:()=>c(r,null,p,h),setTag:g=>c(g,d,p,h),toggleDisabled:()=>c(r,d,!p,h)},JSON.stringify(r)+h)),n(yr,{onSelect:a}),n(wi,{placeholder:t("bonusStatsNotes"),value:o,disabled:!s,onChange:r=>l(r),multiline:!0,minRows:3,fullWidth:!0})]})}function yr({tag:t,onSelect:e}){return n(F,{title:(t&&n(L,{tag:t}))??"Add Bonus Stat",children:ks.map(s=>n(T,{onClick:()=>e(s),children:n(_e,{statKey:s,showPercent:!0})},s))})}function Cr({tag:t,setTag:e,value:s,disabled:i,setValue:o,onDelete:c,toggleDisabled:a}){var u;const l=(u=t.q)==null?void 0:u.endsWith("_");return n(W,{bgt:"light",sx:{opacity:i?.4:void 0},children:f(R,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[n(fe,{onClick:a,children:i?n(fn,{}):n(mn,{})}),n(k,{children:n(L,{tag:t})}),n(wr,{qt:t.qt,setQt:r=>e({...t,qt:r})}),t.q==="dmg_"&&n(vr,{tag:t,setAttribute:r=>{const{attribute:d,...p}=t;e(r?{...p,attribute:r}:p)}}),vs.includes(t.q)&&n(jn,{dmgType:t.damageType1,keys:ws,setDmgType:r=>{const{damageType1:d,...p}=t;e(r?{...p,damageType1:r}:p)}}),["dmg_","crit_dmg_"].includes(t.q)&&n(Nn,{isAftershock:t.damageType2==="aftershock",setAftershock:r=>{const{damageType2:d,...p}=t;e(r?{...p,damageType2:"aftershock"}:p)}}),n(ye,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:f(st,{position:"end",sx:{ml:0},children:[l?"%":void 0," ",n(fe,{"aria-label":"Delete Bonus Stat",onClick:c,edge:"end",children:n(Wt,{fontSize:"small"})})]})}})]})})}function vr({tag:t,setAttribute:e}){return f(F,{title:t.attribute?n(De,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(T,{onClick:()=>e(null),children:"No Attribute"}),Dt.map(s=>n(T,{onClick:()=>e(s),children:n(Et,{color:s,children:n(De,{attribute:s})})},s))]})}function wr({qt:t,setQt:e}){return n(F,{title:t&&Me[t],children:Ms.map(s=>n(T,{onClick:()=>e(s),selected:t===s,disabled:t===s,children:Me[s]},s))})}function Sr(){const{key:t}=O();return f(v,{children:[t==="Yixuan"&&n(Mr,{}),t==="Soldier0Anby"&&n(Er,{}),t==="Manato"&&n(Tr,{}),t==="Yidhari"&&n(Ar,{}),gn]})}const kr=[{type:"text",text:"We automatically convert Yixuan's HP to Sheer Force at a ratio of 1:0.1. Everything else in her kit is not factored, such as the DMG Bonus % added in her Core skill"},{type:"fields",fields:[{title:n(L,{tag:Ht.core_hpSheerForce.tag}),fieldRef:Ht.core_hpSheerForce.tag}]}];function Mr(){return n(ce,{children:kr.map((t,e)=>n(le,{document:t},e))})}const Dr=[{type:"text",text:"Enabling this checkbox will add additional CRIT DMG to Aftershock attacks, based on Soldier 0 - Anby's CRIT DMG, at a ratio matching her Core Skill level scaling. Everything else in her kit is not factored, such as the DMG Bonus % added in her Core skill for enemies marked with Silver Star."},{type:"conditional",conditional:{metadata:Ds.markedWithSilverStar,label:"Enemy marked with Silver Star",fields:[{title:n(L,{tag:Kt.core_markedWithSilverStar_crit_dmg_.tag}),fieldRef:Kt.core_markedWithSilverStar_crit_dmg_.tag}]}}];function Er(){return n(ce,{children:Dr.map((t,e)=>n(le,{document:t},e))})}const Ir=[{type:"text",text:"We automatically convert Manato's HP to Sheer Force at a ratio of 1:0.1. Everything else in his kit is not factored"},{type:"fields",fields:[{title:n(L,{tag:Gt.core_hpSheerForce.tag}),fieldRef:Gt.core_hpSheerForce.tag}]}];function Tr(){return n(ce,{children:Ir.map((t,e)=>n(le,{document:t},e))})}const Rr=[{type:"text",text:"We automatically convert Yidhari's HP to Sheer Force at a ratio of 1:0.1. Everything else in her kit is not factored"},{type:"fields",fields:[{title:n(L,{tag:Ut.core_hpSheerForce.tag}),fieldRef:Ut.core_hpSheerForce.tag}]}];function Ar(){return n(ce,{children:Rr.map((t,e)=>n(le,{document:t},e))})}function Wr(){const{database:t}=E(),{key:e}=O(),{enemyStats:s,enemyLvl:i,enemyDef:o,enemyStunMultiplier:c}=G(e),a=m.useCallback((u,r,d)=>t.charOpts.setEnemyStat(e,u,r,d),[t,e]),l=u=>t.charOpts.setEnemyStat(e,Ts(u),0);return f(_,{spacing:1,children:[f(v,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[n(ye,{label:"Enemy Lvl",value:i,inputProps:{min:0,sx:{width:"4em"}},onChange:u=>t.charOpts.set(e,{enemyLvl:u})}),n(ye,{label:"Enemy DEF",value:o,inputProps:{min:0,sx:{width:"4em"}},onChange:u=>t.charOpts.set(e,{enemyDef:u})}),n(ye,{label:"Enemy Stun Multiplier",value:c,inputProps:{min:0,sx:{width:"8em"}},onChange:u=>t.charOpts.set(e,{enemyStunMultiplier:u}),InputProps:{endAdornment:n(st,{position:"end",children:"%"})}})]}),n(le,{document:Nr}),s.map(({tag:u,value:r},d)=>n(Or,{tag:u,value:r,setValue:p=>a(u,p,d),onDelete:()=>a(u,null,d),setTag:p=>a(p,r,d)},JSON.stringify(u)+d)),n(_r,{onSelect:l})]})}function _r({tag:t,onSelect:e}){return n(F,{title:(t&&n(L,{tag:{...t,qt:"common",et:"enemy",sheet:"agg"}}))??"Add Enemy Stat",children:Rs.map(s=>n(T,{onClick:()=>e(s),children:n(L,{tag:{q:s,qt:"common",et:"enemy",sheet:"agg"},showPercent:!0})},s))})}function Or({tag:t,setTag:e,value:s,setValue:i,onDelete:o}){var a;const c=(a=t.q)==null?void 0:a.endsWith("_");return n(W,{bgt:"light",children:f(R,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[n(k,{children:n(L,{tag:t})}),Is(["res_","resRed_"],t.q)&&n(Pr,{tag:t,setAttribute:l=>{const{attribute:u,...r}=t;e(l?{...r,attribute:l}:r)}}),n(ye,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:i,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:f(st,{position:"end",sx:{ml:0},children:[c?"%":void 0," ",n(fe,{"aria-label":"Delete Enemy Stat",onClick:o,edge:"end",children:n(Wt,{fontSize:"small"})})]})}})]})})}function Pr({tag:t,setAttribute:e}){return f(F,{title:t.attribute?n(De,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(T,{onClick:()=>e(null),children:"No Attribute"}),Dt.map(s=>n(T,{onClick:()=>e(s),children:n(Et,{color:s,children:n(De,{attribute:s})})},s))]})}const Nr={type:"conditional",conditional:{label:"Enemy is Stunned",metadata:Es.isStunned}};function bt(t){return t.reduce((e,s)=>e*s.length,1)}const jr=50;class zr{constructor(e){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.nextReport=Date.now(),this.finalize=()=>{},this.terminate=()=>{};const{progress:s}=this,{topN:i,numWorkers:o,setProgress:c}=e,a=[...Array(o)].map(()=>new Worker(new URL(""+new URL("workerHandle-CSrCyUap.js",import.meta.url).href,import.meta.url),{type:"module"})),l=Ji(e.nodes,e.candidates,"q",e.minimum,i),{nodes:u,minimum:r,candidates:d}=l;if(s.remaining=bt(d),s.skipped=bt(e.candidates)-s.remaining,s.remaining>Number.MAX_SAFE_INTEGER)throw new Error("too many combinations");this.topN=i,this.optThreshold=r[0],this.info=new Map(a.map(g=>[g,{builds:[]}]));const p=d.map(g=>g.map(b=>b.id));this.state={ty:"work",works:[{ids:p,count:s.remaining}]},this.report=()=>c({...s}),this.results=new Promise((g,b)=>{this.finalize=x=>(this.report(),g(x)),this.terminate=b});const h=()=>a.forEach(g=>g.terminate());this.results.then(h,h);for(const g of a)g.onmessage=({data:b})=>{try{this.onWorkerMsg(b,g)}catch(x){this.terminate(x)}},Be(g,{ty:"init",nodes:u,minimum:r,candidates:d,topN:i})}distribute(e){const{state:s}=this;if(s.ty==="work"){s.works.push(...e);return}for(const i of s.workers)if(this.give(e,i))s.workers.delete(i);else return;this.state={ty:"work",works:e}}idle(e){const{state:s,progress:i,info:o}=this;if(s.ty==="idle")s.workers.add(e);else if(this.give(s.works,e)){const c=i.remaining/(o.size+.5);o.forEach((a,l)=>Be(l,{ty:"work?",maxKeep:c}))}else this.state={ty:"idle",workers:new Set([e])}}give(e,s){if(!e.length)return!1;let i=this.progress.remaining/(this.info.size+.5),o=e.findIndex(a=>(i-=a.count)<0)+1;o>1&&(o-=1);const c=e.splice(0,o||e.length);return Be(s,{ty:"add",works:c}),!0}onWorkerMsg(e,s){var i;switch(e.ty){case"progress":{const o=this.progress,c=this.info.get(s);o.remaining-=e.computed+e.skipped,o.computed+=e.computed,o.failed+=e.failed,o.skipped+=e.skipped,c.builds=e.builds,e.idle&&this.idle(s);const a=Date.now();if(this.nextReport<=a||!e.remaining){this.nextReport=a+jr,this.report();const l=[...this.info.values()].flatMap(r=>r.builds);l.sort((r,d)=>d.value-r.value);const u=((i=l[this.topN])==null?void 0:i.value)??-1/0;u>this.optThreshold&&(this.optThreshold=u,this.info.forEach((r,d)=>Be(d,{ty:"config",threshold:u}))),this.progress.remaining||this.finalize(l.slice(0,this.topN))}break}case"add":this.distribute(e.works);break;case"err":this.terminate(e.msg+" (Worker Error)")}}}function Be(t,e){t.postMessage(e)}const qr=1e-7;function $r(t,e,s,i,o,c,a,l,u,r,d){const p=new Set(pt),h=new Set(ht),g=[cn(...s.map((x,y)=>Vt(x.multiplier,new ot({src:t,...x.tag},void 0).with("preset",`preset${y}`)))),...i.map(({tag:x,isMax:y})=>{const C={...As(x),src:t,preset:"preset0"};return y?Vt(-1,new ot(C,void 0)):new ot(C,void 0)})],b=Ki(g,e,x=>{if(x.src===t&&x.et==="own"){if(x.sheet==="dyn"&&x.qt==="initial")return x.q==="dmg_"?{q:`${x.attribute}_dmg_`}:{q:x.q};if(x.q==="count"&&p.has(x.sheet))return{q:x.sheet};if(x.qt=="wengine"&&["lvl","phase","modification"].includes(x.q))return{q:x.q};if(x.q==="count"&&h.has(x.sheet))return{q:x.sheet}}});return b.push(o.length?lt(...o.map(x=>Ge({q:x},"sum"))):ie(1/0),c.length?lt(...c.map(x=>Ge({q:x},"sum"))):ie(1/0)),{nodes:b,candidates:[a.map(Lr),l[1].map(xe),l[2].map(xe),l[3].map(xe),l[4].map(xe),l[5].map(xe),l[6].map(xe)],minimum:[-1/0,...i.map(({value:x,isMax:y,tag:C})=>{const w=Ws(x,C.q??"");return(y?w*-1:w)-qr}),2,4],numWorkers:u,topN:r,setProgress:d}}function xe(t){const{id:e,mainStatKey:s,level:i,rarity:o,setKey:c,substats:a}=t;return{id:e,[s]:_s(o,s,i),...Object.fromEntries(a.filter(({key:l,upgrades:u})=>l&&u).map(({key:l,upgrades:u})=>[l,Os(l,o)*u])),[c]:1}}function Lr(t){const{id:e,key:s,level:i,modification:o,phase:c}=t;return{id:e,lvl:i,modification:o,phase:c,[s]:1}}var Te={},sn;function Fr(){if(sn)return Te;sn=1;var t=yt();Object.defineProperty(Te,"__esModule",{value:!0}),Te.default=void 0;var e=t(Ct()),s=vt(),i=(0,e.default)((0,s.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");return Te.default=i,Te}var Br=Fr();const Hr=wt(Br),Kr=m.memo(function({disabled:e=!1}){const{database:s}=E(),{optConfigId:i,optConfig:o}=m.useContext(X);return f(W,{bgt:"light",children:[n(R,{sx:{display:"flex",gap:1},children:n(k,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),n(V,{}),n(Ps,{levelLow:(o==null?void 0:o.levelLow)??Xt.S,levelHigh:(o==null?void 0:o.levelHigh)??Xt.S,setLow:c=>s.optConfigs.set(i,{levelLow:c}),setHigh:c=>s.optConfigs.set(i,{levelHigh:c}),setBoth:(c,a)=>s.optConfigs.set(i,{levelLow:c,levelHigh:a}),disabled:e})]})});function Gr({discBySlot:t,setFilter4:e,setFilter2:s,setSetFilter4:i,setSetFilter2:o}){const c=O(),a=G(c==null?void 0:c.key),l=m.useMemo(()=>{const u=ke(pt,()=>ke(It,()=>0));return Object.values(t).forEach(r=>r.forEach(({setKey:d,slotKey:p})=>u[d][p]++)),u},[t]);return f(ce,{children:[f(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(k,{variant:"h6",sx:{flexGrow:1},children:"Disc Set Config"}),n(P,{disabled:!e.length,onClick:()=>i([]),children:"Reset 4p filter"}),n(P,{disabled:!s.length,onClick:()=>o([]),children:"Reset 2p filter"})]}),n(v,{children:c&&a&&n(Mn,{character:c,conditionals:a.conditionals,children:n(K,{container:!0,spacing:1,children:pt.map(u=>n(K,{item:!0,xs:1,md:2,lg:3,children:n(Ur,{numSlot:l[u],setKey:u,setFilter4:e,setFilter2:s,setSetFilter4:i,setSetFilter2:o})},u))})})})]})}function Ur({numSlot:t,setKey:e,setFilter4:s,setFilter2:i,setSetFilter4:o,setSetFilter2:c}){const a=!!i.length&&!i.includes(e),l=!!s.length&&!s.includes(e);return f(_n,{setKey:e,fade2:a,fade4:l,children:[n(v,{sx:{display:"flex",justifyContent:"space-around",pb:1},children:Object.entries(t).map(([u,r])=>n(v,{children:n(it,{color:r?"primary":"secondary",children:r})},u))}),f(Ns,{fullWidth:!0,children:[n(P,{sx:{borderRadius:0},color:!s.length||s.includes(e)?"success":"secondary",onClick:()=>o(s.length?Qt([...s],e):[e]),children:"Allow 4p"}),n(P,{sx:{borderRadius:0},color:!i.length||i.includes(e)?"success":"secondary",onClick:()=>c(i.length?Qt([...i],e):[e]),children:"Allow 2p"})]})]})}function Vr({discsBySlot:t}){const[e,s,i]=Tt();return n(W,{bgt:"light",children:n(R,{children:f(_,{spacing:1,children:[n(re,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:It.map(o=>n(pe,{discsBySlot:t,slotKey:o},o))}),n(Xr,{show:e,onClose:i,discsBySlot:t}),n(P,{color:"info",fullWidth:!0,onClick:s,children:"Disc Filter Config"})]})})})}function pe({discsBySlot:t,slotKey:e}){return f(k,{children:["Disc ",e," ",n(it,{color:t[e].length?"primary":"error",children:t[e].length})]})}function Xr({discsBySlot:t,show:e,onClose:s,disabled:i}){const{database:o}=E(),{optConfigId:c,optConfig:a}=m.useContext(X);return n(kt,{open:e,onClose:s,children:f(W,{children:[n(Oe,{title:"Disc Filter",action:n(fe,{onClick:s,children:n(tt,{})})}),n(V,{}),n(R,{children:n(m.Suspense,{fallback:n(xn,{width:"100%",height:"500px"}),children:f(_,{spacing:1,children:[n(Kr,{disabled:i}),n(Qr,{discsBySlot:t,disabled:i}),n(P,{disabled:i,onClick:()=>o.optConfigs.set(c,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Discs"}),n(Yr,{discBySlot:t,disabled:i})]})})})]})})}function Qr({discsBySlot:t,disabled:e}){const{database:s}=E(),{optConfigId:i,optConfig:o}=m.useContext(X),c=a=>{const l=js([...Yt[a]]),u={4:o.slot4??[],5:o.slot5??[],6:o.slot6??[]},r={4:d=>s.optConfigs.set(i,{slot4:d}),5:d=>s.optConfigs.set(i,{slot5:d}),6:d=>s.optConfigs.set(i,{slot6:d})};return n(re,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:Yt[a].map(d=>n(P,{disabled:e,variant:u[a].includes(d)?"contained":"outlined",onClick:()=>r[a](l([...u[a]],d)),children:n(_e,{statKey:d,showPercent:!0})},d))})};return n(W,{bgt:"light",children:n(R,{children:f(_,{spacing:1,children:[f(re,{sx:{display:"flex",justifyContent:"space-between"},children:[n(pe,{slotKey:"1",discsBySlot:t}),n(pe,{slotKey:"2",discsBySlot:t}),n(pe,{slotKey:"3",discsBySlot:t})]}),n(pe,{slotKey:"4",discsBySlot:t}),c("4"),n(pe,{slotKey:"5",discsBySlot:t}),c("5"),n(pe,{slotKey:"6",discsBySlot:t}),c("6")]})})})}function Yr({discBySlot:t,disabled:e}){const{database:s}=E(),{optConfigId:i,optConfig:o}=m.useContext(X),{setFilter2:c=[],setFilter4:a=[]}=o,l=m.useCallback(r=>{s.optConfigs.set(i,{setFilter2:r})},[s,i]),u=m.useCallback(r=>{s.optConfigs.set(i,{setFilter4:r})},[s,i]);return n(Gr,{discBySlot:t,disabled:e,setFilter2:c,setFilter4:a,setSetFilter2:l,setSetFilter4:u})}function Jr({disabled:t=!1}){const{optConfigId:e,optConfig:{statFilters:s}}=m.useContext(X),{database:i}=E(),o=m.useCallback(c=>i.optConfigs.set(e,{statFilters:c}),[i,e]);return f(W,{bgt:"light",children:[n(R,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:n(v,{display:"flex",justifyContent:"space-between",children:n(k,{sx:{fontWeight:"bold"},children:"Stat Filter"})})}),n(V,{}),n(R,{children:n(Zr,{statFilters:s,setStatFilters:o,disabled:t})})]})}function Zr({statFilters:t,setStatFilters:e,disabled:s=!1}){const i=m.useCallback((r,d)=>{const p=structuredClone(t);typeof d>"u"?p.push({tag:r,value:0,isMax:!1,disabled:!1}):p[d].tag=r,e(p)},[e,t]),o=m.useCallback(r=>{const d=structuredClone(t);d.splice(r,1),e(d)},[e,t]),c=m.useCallback((r,d)=>{const p=structuredClone(t);p[r].value=d,e(p)},[e,t]),a=m.useCallback((r,d)=>{const p=structuredClone(t);p[r].isMax=d,e(p)},[e,t]),l=m.useCallback((r,d)=>{const p=structuredClone(t);p[r].disabled=d,e(p)},[e,t]),u=r=>i(qs(r));return f(v,{display:"flex",flexDirection:"column",gap:1,children:[t.map((r,d)=>n(to,{statFilter:r,delTarget:()=>o(d),setTarget:p=>i(p,d),setTargetValue:p=>c(d,p),setTargetisMax:p=>a(d,p),setDisabled:p=>l(d,p),disabled:s},d+JSON.stringify(r))),n(eo,{onSelect:u})]})}function eo({tag:t,onSelect:e}){return n(F,{title:(t&&n(L,{tag:t}))??"Add Stat Filter",children:$s.map(s=>n(T,{onClick:()=>e(s),children:n(_e,{statKey:s,showPercent:!0})},s))})}function to({statFilter:t,delTarget:e,setTarget:s,setTargetValue:i,setTargetisMax:o,setDisabled:c,disabled:a}){const{tag:l,value:u,isMax:r,disabled:d}=t,p=zs(l.q??"");return n(W,{children:f(R,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(P,{color:d?"secondary":"success",onClick:()=>c(!d),disabled:a,size:"small",children:d?n(fn,{}):n(mn,{})}),n(k,{children:n(L,{tag:l})}),n(so,{qt:l.qt,setQt:h=>s({...l,qt:h})}),l.q==="dmg_"&&n(no,{tag:l,setAttribute:h=>{const{attribute:g,...b}=l;s(h?{...b,attribute:h}:b)}}),n(P,{onClick:()=>o(!r),size:"small",children:n("strong",{children:r?"MAX":"MIN"})}),n(ye,{float:!0,value:u,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:a,onChange:i,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:f(st,{position:"end",sx:{ml:0},children:[p?"%":void 0," ",n(fe,{"aria-label":"Delete Stat Constraint",onClick:e,edge:"end",children:n(Wt,{fontSize:"small"})})]})}})]})})}function no({tag:t,setAttribute:e}){return f(F,{title:t.attribute?n(De,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(T,{onClick:()=>e(null),children:"No Attribute"}),Dt.map(s=>n(T,{onClick:()=>e(s),children:n(Et,{color:s,children:n(De,{attribute:s})})},s))]})}function so({qt:t,setQt:e}){return n(F,{title:t&&Me[t],children:Ls.map(s=>n(T,{onClick:()=>e(s),selected:t===s,disabled:t===s,children:Me[s]},s))})}const io=m.memo(function({disabled:e=!1}){const{database:s}=E(),{optConfigId:i,optConfig:o}=m.useContext(X);return f(W,{bgt:"light",children:[n(R,{sx:{display:"flex",gap:1},children:n(k,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),n(V,{}),n(hr,{levelLow:(o==null?void 0:o.wlevelLow)??Ue,levelHigh:(o==null?void 0:o.wlevelHigh)??Ue,setLow:c=>s.optConfigs.set(i,{wlevelLow:c}),setHigh:c=>s.optConfigs.set(i,{wlevelHigh:c}),setBoth:(c,a)=>s.optConfigs.set(i,{wlevelLow:c,wlevelHigh:a}),disabled:e})]})});function ro({wengines:t,disabled:e}){const{database:s}=E(),{optConfigId:i,optConfig:o}=m.useContext(X),[c,a,l]=Tt();return n(W,{bgt:"light",children:n(R,{children:f(_,{spacing:1,children:[f(re,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[f(re,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",n(it,{color:t.length?"primary":"error",children:t.length})]}),n(P,{sx:{flexGrow:1},startIcon:o.optWengine?n(Fs,{}):n(Bs,{}),color:o.optWengine?"success":"secondary",onClick:()=>s.optConfigs.set(i,{optWengine:!o.optWengine}),children:"Optimize Wengine"})]}),n(oo,{show:c,onClose:l,wengines:t}),n(P,{color:"info",fullWidth:!0,onClick:a,disabled:e||!o.optWengine,children:"Wengine Filter Config"})]})})})}function oo({wengines:t,show:e,onClose:s,disabled:i}){const{database:o}=E(),{optConfigId:c,optConfig:a}=m.useContext(X);return n(kt,{open:e,onClose:s,children:f(W,{children:[n(Oe,{title:"Wengine Filter",action:n(fe,{onClick:s,children:n(tt,{})})}),n(V,{}),n(R,{children:n(m.Suspense,{fallback:n(xn,{width:"100%",height:"500px"}),children:f(_,{spacing:1,children:[n(io,{disabled:i}),n(ao,{disabled:i}),n(P,{disabled:i,onClick:()=>o.optConfigs.set(c,{useEquippedWengine:!a.useEquippedWengine}),color:a.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"}),n(co,{wengines:t})]})})})]})})}function ao({disabled:t}){const{database:e}=E(),{optConfigId:s,optConfig:i}=m.useContext(X),{wEngineTypes:o}=i,c=ft(e.wengines),{key:a}=O(),l=m.useMemo(()=>i.optWengine?c.reduce((u,{key:r,level:d,location:p})=>{if(d<i.wlevelLow||d>i.wlevelHigh||p&&!i.useEquippedWengine&&p!==a)return u;const h=nt(r).type;return h&&u[h]++,u},ke(Jt,()=>0)):ke(Jt,()=>0),[a,c,i.wlevelLow,i.wlevelHigh,i.optWengine,i.useEquippedWengine]);return n(Hs,{onChange:u=>e.optConfigs.set(s,{wEngineTypes:u}),value:o,disabled:t,totals:l,fullWidth:!0})}function co({wengines:t}){const e=O(),s=G(e==null?void 0:e.key),{optConfig:i}=m.useContext(X),{wEngineTypes:o}=i,c=m.useMemo(()=>o.length?ht.filter(a=>o.includes(nt(a).type)):ht,[o]);return f(re,{children:[n(k,{variant:"h6",children:"Wengine Condtional Configuration"}),n(k,{children:"Wengine stats are displayed to be Lvl 60/60, P1, actual level/phase of wengine will be used in the solver."}),e&&s&&n(Mn,{character:e,conditionals:s.conditionals,children:n(K,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:c.map(a=>n(K,{item:!0,xs:1,children:n(uo,{wengineKey:a,count:t.filter(l=>l.key===a).length})},a))})})]})}function lo(t){return{key:t,level:60,modification:5,phase:1,location:"",lock:!1}}function uo({wengineKey:t,count:e}){const s=m.useMemo(()=>lo(t),[t]);return n(On,{wengine:s,headerAction:n(it,{color:e?"primary":"secondary",children:e}),fade:!e})}function po(){const{key:t}=O(),{optConfigId:e}=G(t),{database:s}=E();if(!e){const i=s.optConfigs.new({wEngineTypes:[bn(t).specialty]});return s.charOpts.set(t,{optConfigId:i}),null}return n(yn,{optConfigId:e,children:n(ho,{})})}function ho(){const{t}=J("optimize"),{database:e}=E(),s=Dn(),{key:i}=O(),{target:o}=G(i),[c,a]=m.useState(8),[l,u]=m.useState(void 0),{optConfig:r,optConfigId:d}=m.useContext(X),p=ft(e.discs),h=m.useMemo(()=>{const I={4:r.slot4,5:r.slot5,6:r.slot6},N=M=>["4","5","6"].includes(M);return p.reduce((M,z)=>{const{slotKey:Z,mainStatKey:q,level:j,location:Q}=z;return j<r.levelLow||j>r.levelHigh||Q&&!r.useEquipped&&Q!==i||N(Z)&&!I[Z].includes(q)||M[z.slotKey].push(z),M},{1:[],2:[],3:[],4:[],5:[],6:[]})},[r.slot4,r.slot5,r.slot6,r.levelLow,r.levelHigh,r.useEquipped,p,i]),g=ft(e.wengines),b=m.useMemo(()=>g.filter(({key:I,level:N,location:M})=>{if(!r.optWengine)return M===i;if(N<r.wlevelLow||N>r.wlevelHigh||M&&!r.useEquippedWengine&&M!==i)return!1;const{type:z}=nt(I);return!!r.wEngineTypes.includes(z)}),[i,g,r.wlevelLow,r.wlevelHigh,r.optWengine,r.wEngineTypes,r.useEquippedWengine]),x=m.useMemo(()=>bt(Object.values(h))*b.length,[b.length,h]),[y,C]=m.useState(!1),w=m.useRef(()=>{});m.useEffect(()=>()=>w.current(),[]);const D=m.useCallback(async I=>{if(!s||!o)return;const N=new Promise(j=>w.current=j);u(void 0),C(!0);const M=(r.statFilters??[]).filter(j=>!j.disabled),z=$r(i,s,[{tag:Cn(o),multiplier:1}],M,r.setFilter2,r.setFilter4,b,h,c,r.maxBuildsToShow,u);if(I.altKey){console.log(z),C(!1);return}const Z=new zr(z);N.then(()=>Z.terminate("user cancelled"));let q;try{q=await Z.results}catch{return}finally{w.current=()=>{},C(!1)}e.optConfigs.newOrSetGeneratedBuildList(d,{builds:q.map(({ids:j,value:Q})=>({wengineId:j[0],discIds:ke(It,(oe,de)=>j[de+1]),value:Q})),buildDate:Date.now()})},[s,o,r.statFilters,r.setFilter2,r.setFilter4,r.maxBuildsToShow,i,b,h,c,e.optConfigs,d]),B=m.useCallback(()=>{w.current(),C(!1)},[w]);return n(W,{children:n(R,{children:f(_,{spacing:1,children:[f(v,{sx:{display:"flex",gap:1,flexWrap:"wrap","& .MuiPaper-root":{flexGrow:1}},children:[n(Jr,{}),n(ro,{wengines:b}),n(Vr,{discsBySlot:h})]}),l&&n(fo,{progress:l,total:x}),f(v,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[n(rr,{maxBuildsToShow:r.maxBuildsToShow,optConfigId:d}),n(or,{numWorkers:c,setNumWorkers:a}),n(P,{disabled:!x||!o,onClick:y?B:D,color:y?"error":"primary",startIcon:y?n(tt,{}):n(Hr,{}),children:t(y?"cancel":"optimize")})]})]})})})}function He({value:t}){const e=t.toLocaleString();return n(v,{component:"span",sx:{fontFamily:"Monospace",display:"inline"},children:e})}function fo(t){const{t:e}=J("optimize"),{computed:s,remaining:i,skipped:o}=t.progress,c=s+i,a=Math.log1p(c)/Math.log1p(t.total),l=i/c*a;return f(v,{children:[f(k,{children:[e("computed"),": ",n(He,{value:s})," /"," ",n(He,{value:c})," "]}),f(k,{children:[e("computed + skipped"),": ",n(He,{value:s+o})," /"," ",n(He,{value:t.total})]}),n(Ks,{variant:"determinate",value:(1-l)*100,sx:{height:10,borderRadius:5}})]})}const mo={xs:2,sm:1,md:2,lg:3,xl:4};function go({onClick:t}){const e=m.useContext(vn);return n(wn,{discIds:e==null?void 0:e.equippedDiscs,wengineId:e==null?void 0:e.equippedWengine,onClick:t,columns:mo})}var Re={},rn;function xo(){if(rn)return Re;rn=1;var t=yt();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var e=t(Ct()),s=vt(),i=(0,e.default)((0,s.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");return Re.default=i,Re}var bo=xo();const yo=wt(bo);function Co(t){const{database:e}=E();return hn(e.generatedBuildList,t)}const vo=m.memo(function(){const{optConfig:e}=m.useContext(X),s=Co(e.generatedBuildListId??"");return n(_,{spacing:1,children:s==null?void 0:s.builds.map((i,o)=>n(So,{build:i,index:o},`${o}-${i.wengineId}-${Object.values(i.discIds).join("-")}`))})});function wo({build:{discIds:t,wengineId:e}}){const{t:s}=J("build"),{database:i}=E(),{key:o}=O()??{},c=m.useCallback(()=>{o&&(Object.entries(t).forEach(([a,l])=>l&&i.discs.set(l,{location:o})),e&&i.wengines.set(e,{location:o}))},[o,t,e,i.wengines,i.discs]);return n(P,{color:"info",size:"small",startIcon:n(yo,{}),onClick:c,children:s("buildDisplay.equipToCrr")})}function So({build:t,index:e}){const s=O(),i=G(s.key);return n(In,{character:s,charOpt:i,discIds:t.discIds,wengineId:t.wengineId,children:n(W,{children:n(R,{children:f(_,{spacing:1,children:[f(v,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[f(k,{children:["Build ",e+1,": ",pn(t.value)]}),n(wo,{build:t})]}),n(v,{children:f(K,{container:!0,spacing:1,children:[n(K,{item:!0,xs:6,md:4,lg:3,xl:3,children:n(En,{})}),n(K,{item:!0,xs:6,md:8,lg:9,xl:9,children:n(wn,{discIds:t.discIds,wengineId:t.wengineId})})]})})]})})})})}const ko=210,zn=m.createContext(ko),Mo=0,Ae=33,qn=m.createContext(0);function Do(){const[t,e]=m.useState(""),s=m.useMemo(()=>({statHighlight:t,setStatHighlight:e}),[t,e]),i=m.useMemo(()=>[["char",n(Eo,{},"char")],["opt",n(Io,{},"opt")],["builds",n(To,{},"builds")]],[]);return n(Gs.Provider,{value:s,children:n(qn.Provider,{value:i.length,children:n(_,{gap:1,children:i.map(([o,c],a)=>n($n,{title:o,index:a,zIndex:100,children:c},o))})})})}function $n({index:t,title:e,children:s,zIndex:i,top:o=0,bottom:c=0}){const{t:a}=J("page_optimize"),[l,u]=Bi(),r=m.useContext(qn),d=m.useContext(zn);return f(ce,{children:[n(W,{sx:p=>({outline:`2px solid ${p.palette.secondary.main}`,position:"sticky",top:d+t*Ae+o,bottom:Mo+(r-1-t)*Ae+c,zIndex:i}),children:n(Vs,{onClick:u,sx:{px:2},children:n(k,{variant:"h6",children:a(`${e}`)})})}),n(v,{ref:l,sx:{scrollMarginTop:d+(t+1)*Ae+o},children:s})]})}function Eo(){const t=O(),{key:e}=t,[s,i]=m.useState(void 0),o=m.useCallback(()=>{t!=null&&t.key&&i(t.key)},[t]),c=m.useMemo(()=>[["eq",n(go,{onClick:o},"eq")],["Conditionals",n(Ro,{},"conditionals")],["bonusStats",n(br,{},"bonusStats")],["enemyStats",n(Wr,{},"enemyStats")],["anomaly",n(gr,{},"anomaly")],...e==="Yixuan"||e==="Soldier0Anby"||gn?[["charSheet",n(Sr,{},"charSheet")]]:[]],[e,o]),a=an(),l=Us(a.breakpoints.up("sm"));return f(ce,{children:[n(xi,{characterKey:s,onClose:()=>i(void 0)}),f(_,{spacing:1,children:[n(W,{sx:{overflow:"visible"},children:n(R,{sx:{display:"flex",gap:1,overflow:"visible"},children:f(K,{container:!0,spacing:2,sx:{flexWrap:"wrap",overflow:"visible"},children:[n(K,{item:!0,xs:12,sm:7,md:5,lg:4,xl:3,sx:{height:l?"100%":void 0,overflow:"visible"},children:f(_,{spacing:1,sx:l?{height:"100%"}:void 0,children:[n(bi,{characterKey:e,onClick:o}),n(v,{sx:{flexGrow:1},children:n(v,{sx:l?{position:"sticky",top:"115px",bottom:"0px"}:void 0,children:n(En,{})})})]})}),n(K,{item:!0,xs:12,sm:5,md:7,lg:8,xl:9,children:n(_,{spacing:1.5,children:c.map(([u,r],d)=>n($n,{title:u,index:d,zIndex:99,top:Ae,bottom:Ae*2,children:r},u))})})]})})}),n(lr,{formulasRead:se.listing.formulas,buffsRead:se.listing.buffs})]})]})}function Io(){return n(po,{})}function To(){const{key:t}=O(),{optConfigId:e}=G(t);return e?n(yn,{optConfigId:e,children:n(vo,{})}):null}function Ro(){const{equippedDiscs:t,equippedWengine:e}=O(),s=Xs(t),i=Qs(s),o=Ys(e);return n(v,{children:f(K,{container:!0,spacing:1,columns:{xs:1,sm:1,md:2,lg:3},children:[o&&n(K,{item:!0,xs:1,children:n(On,{wengine:o})}),Object.entries(i).map(([c,a])=>n(K,{item:!0,xs:1,children:n(_n,{setKey:c,fade2:a<2,fade4:a<4})},c))]})})}const on={avg:"Average",crit:"Crit Hit",nonCrit:"Non-Crit Hit"};function Ao(){const{database:t}=E(),e=O(),s=G(e.key),{critMode:i}=s;return n(F,{title:f(v,{sx:{textWrap:"nowrap"},children:["Hit mode: ",on[i]]}),children:Js.map(o=>n(T,{selected:i===o,disabled:i===o,onClick:()=>t.charOpts.set(e.key,{critMode:o}),children:on[o]},o))})}const Wo=[se.final.atk,se.final.hp,se.final.def,se.final.enerRegen,se.final.anomProf,se.final.anomMas];function _o({character:{key:t},charOpt:{target:e}}){const s=Dn(),{database:i}=E(),o=m.useMemo(()=>{if(e)return Cn(e)},[e]);return f(F,{color:o?"success":"warning",title:o?f(v,{sx:{display:"flex",gap:1},children:[n("strong",{children:"Optimization Target: "}),n(Ke,{tag:o})]}):"Select an Optimization Target",variant:o?"outlined":void 0,sx:{height:"100%",flexGrow:1},children:[s==null?void 0:s.listFormulas(se.listing.formulas).map(({tag:c},a)=>{const{name:l,sheet:u}=c;if(!(!l||!u))return n(T,{onClick:()=>i.charOpts.set(t,{target:{sheet:u,name:l}}),children:n(Zt,{children:n(v,{sx:{display:"flex",gap:1},children:n(Ke,{tag:c})})})},`${a}_${c.sheet}_${c.name}`)}),Wo.map(({tag:c},a)=>{const{q:l,qt:u}=c;if(!(!l||!u))return n(T,{onClick:()=>i.charOpts.set(t,{target:{q:l,qt:u}}),children:n(Zt,{children:n(v,{sx:{display:"flex",gap:1},children:n(Ke,{tag:c})})})},`${a}_${l}_${u}`)})]})}function Oo(){const{database:t}=E(),e=O(),s=G(e.key),{target:i}=s,o=m.useCallback(c=>t.charOpts.set(e.key,({target:a={}})=>{const{damageType1:l,...u}=a;return c?{target:{...u,damageType1:c}}:{target:u}}),[t,e.key]);return(i==null?void 0:i.name)!=="standardDmgInst"&&(i==null?void 0:i.name)!=="sheerDmgInst"?null:n(jn,{dmgType:i==null?void 0:i.damageType1,keys:Zs,setDmgType:o})}function Po({character:t,charOpt:e}){return f(v,{display:"flex",gap:1,sx:{position:"sticky",top:36,zIndex:100,background:"#0C1020"},children:[n(_o,{character:t,charOpt:e}),n(jo,{}),n(Oo,{}),n(No,{}),n(Ao,{})]})}function No(){const{database:t}=E(),e=O(),s=G(e.key),{target:i}=s,o=m.useCallback(c=>t.charOpts.set(e.key,({target:a={}})=>{const{damageType2:l,...u}=a;return c?{target:{...u,damageType2:"aftershock"}}:{target:u}}),[t,e.key]);return(i==null?void 0:i.name)!=="standardDmgInst"&&(i==null?void 0:i.name)!=="sheerDmgInst"?null:n(Nn,{isAftershock:(i==null?void 0:i.damageType2)==="aftershock",setAftershock:o})}function jo(){const{database:t}=E(),e=O(),s=G(e.key),{target:i}=s,{q:o,qt:c}=i??{};return!o||!c?null:n(F,{title:Me[c],children:["final","initial"].map(a=>n(T,{selected:a===c,disabled:a===c,onClick:()=>t.charOpts.set(e.key,{target:{q:o,qt:a}}),children:Me[a]},a))})}function Ho(){const{database:t}=E(),{optCharKey:e}=ei(t.dbMeta),s=e??ti[0],[i,o,c]=Tt(),a=m.useCallback(y=>t.dbMeta.set({optCharKey:y}),[t.dbMeta]),{t:l}=J(["charNames_gen","page_character"]),u=yi(s);s&&!u&&t.chars.getOrCreate(s);const r=G(s);s&&!r&&t.charOpts.getOrCreate(s),Hi(m.useMemo(()=>{const y=s&&l(`charNames_gen:${s}`);return y?`Optimize - ${y}`:"Optimize"},[s,l]));const d=m.useMemo(()=>{const C=ke(s?[s]:[],w=>n(Ci,{characterKey:w}));return{srcDisplay:C,dstDisplay:C}},[s]),p=m.useCallback((y,C,w,D,B)=>{!ni(y)||!en(w)||!(D===null||en(D))||!si(y,C)||t.charOpts.setConditional(s,y,C,w,D,B)},[s,t.charOpts]),h=m.useMemo(()=>({src:s,dst:s,preset:"preset0"}),[s]),[g,b]=m.useState(),x=m.useMemo(()=>({read:g,setRead:b}),[g]);return n(zo,{children:f(v,{children:[n(m.Suspense,{fallback:!1,children:n(vi,{show:i,onHide:c,onSelect:a})}),n(v,{sx:{position:"sticky",top:0,zIndex:100,background:"#0C1020"},children:n(P,{fullWidth:!0,color:bn(s).attribute,sx:{justifyContent:"flex-start",pl:"6px"},onClick:o,children:f(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(Mt,{size:2,src:ii(s,"circle")}),l(`charNames_gen:${s}`)]})})}),u&&r&&n(vn.Provider,{value:u,children:n(et.Provider,{value:h,children:n(In,{character:u,charOpt:r,wengineId:u.equippedWengine,discIds:u.equippedDiscs,children:n(ri.Provider,{value:d,children:n(oi.Provider,{value:r.conditionals,children:n(ai.Provider,{value:p,children:f(ln.Provider,{value:x,children:[n(dr,{}),f(v,{sx:{display:"flex",gap:1,flexDirection:"column",mt:1},children:[n(Po,{character:u,charOpt:r}),n(zn.Provider,{value:74,children:n(Do,{})})]})]})})})})})})})]})})}function zo({children:t}){return n(di.Provider,{value:Pn,children:n(ci.Provider,{value:L,children:n(li.Provider,{value:Ke,children:t})})})}export{Ho as default};
