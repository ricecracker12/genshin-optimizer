import{i as A,u as H,a as O,d as c,hy as Y,j as e,C as _,e as l,f as $,G as u,T as j,B as K,h as E,R as Z,o as W,y as R,v as L,hz as G,by as ee,hA as ne,hB as te,hC as se,hD as ie,hE as le,c1 as N,bp as ae,hF as oe,hG as ce,hH as re,hI as de,aC as M,hJ as ge,bx as ue,hK as he,z as pe,hL as ye,k as me,l as fe,c5 as we,m as Te,n as xe,hM as We,cN as ke,c9 as Se,ca as Ce,hN as be,S as Ie,hO as qe,hP as ve,hQ as V}from"./index-C5458NnQ.js";const Q=["locked","unlocked"],Be=ae([...Q]);function De({numShowing:p,total:i,wengineIds:k}){const{t:r}=A(["page_wengine","ui"]),{database:a}=H(),S=O(a.displayWengine),{speciality:C,rarity:z,locked:y,showEquipped:d,showInventory:b,locations:m}=S,{lockedTotal:f,equippedTotal:w,locationTotal:I,wengineTotals:q,wengineRarityTotals:v}=c.useMemo(()=>{const s={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...he,""],wengineTotals:[...ue],wengineRarityTotals:[...ge]};return Y(s,t=>a.wengines.entries.forEach(([T,g])=>{const o=g.location,B=g.lock?"locked":"unlocked",x=o?"equipped":"unequipped",D=M(g.key).type,h=M(g.key).rarity;t.lockedTotal[B].total++,t.equippedTotal[x].total++,t.locationTotal[o].total++,t.wengineTotals[D].total++,h&&t.wengineRarityTotals[h].total++,k.includes(T)&&(t.lockedTotal[B].current++,t.equippedTotal[x].current++,t.locationTotal[o].current++,t.wengineTotals[D].current++,h&&t.wengineRarityTotals[h].current++)}))},[a.wengines.entries,k]);return e(_,{children:l($,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(u,{container:!0,children:[e(u,{item:!0,children:e(j,{variant:"h6",children:r("wengineFilterTitle")})}),e(u,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:l(j,{children:[e("strong",{children:p})," / ",i]})}),e(u,{item:!0,children:e(K,{size:"small",color:"error",onClick:()=>a.displayWengine.set({action:"reset"}),startIcon:e(Z,{}),children:e(E,{t:r,i18nKey:"ui:reset"})})})]}),e(W,{children:l(u,{container:!0,spacing:1,children:[l(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(E,{t:r,i18nKey:"subheadings.general"}),l(R,{spacing:1,children:[e(L,{sx:{bgcolor:G.palette.contentNormal.light}}),e(ee,{fullWidth:!0,onChange:s=>a.displayWengine.set({speciality:s}),value:C,totals:q,size:"small"}),e(ne,{sx:{height:"100%"},fullWidth:!0,onChange:s=>a.displayWengine.set({rarity:s}),value:z,totals:v,size:"small"})]})]}),e(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:l(W,{children:[e(E,{t:r,i18nKey:"subheadings.inventory"}),l(R,{spacing:1,children:[e(L,{sx:{bgcolor:G.palette.contentNormal.light}}),e(te,{fullWidth:!0,value:y,size:"small",children:Q.map((s,t)=>l(se,{value:s,sx:{display:"flex",gap:1},onClick:()=>a.displayWengine.set({locked:Be(y,s)}),children:[t?e(ie,{}):e(le,{}),e(E,{t:r,i18nKey:`ui:${s}`}),e(N,{label:f[t?"unlocked":"locked"],size:"small"})]},s))}),l(K,{startIcon:e(oe,{}),color:b?"success":"secondary",onClick:()=>a.displayWengine.set({showInventory:!b}),children:[r("wengineInInv")," ",e(N,{sx:{ml:1},label:w.unequipped,size:"small"})]}),l(K,{startIcon:e(ce,{}),color:d?"success":"secondary",onClick:()=>a.displayWengine.set({showEquipped:!d}),children:[r("equippedWengine")," ",e(N,{sx:{ml:1},label:w.equipped,size:"small"})]})]}),e(R,{spacing:1.5,pt:1.5,children:e(c.Suspense,{fallback:null,children:e(re,{title:d?r("locationsTooltip"):"",placement:"top",children:e("span",{children:e(de,{totals:I,locations:d?[]:m,setLocations:s=>a.displayWengine.set({locations:s}),disabled:d})})})})})]})})]})})]})})}const Ee={xs:2,sm:3,md:4,lg:4,xl:6},Ke={xs:10,sm:12,md:24,lg:24,xl:24},ze=Object.keys(V);function Re(){const{t:p}=A(["page_wengine","ui"]),{database:i}=H(),[k,r,a]=pe(!1),S=O(i.displayWengine),[C,z]=c.useState(""),y=c.useDeferredValue(C),d=c.useCallback(n=>{i.displayWengine.set({editWengineId:n})},[i]),b=c.useCallback(n=>{d(i.wengines.new(ye(n)))},[i.wengines,d]),{sortType:m,ascending:f,speciality:w,rarity:I,locked:q,showEquipped:v,showInventory:s,locations:t}=S,T=me(i.wengines),g=T.length,o=c.useMemo(()=>T.filter(fe({speciality:w,rarity:I,name:y,locked:q,showInventory:s,showEquipped:v,locations:t},qe())).sort(we(V[m]??[],f,ve())).map(n=>n.id),[T,w,I,y,q,s,v,t,m,f]),B=Te(),{numShow:x,setTriggerElement:D}=xe(Ke[B],o.length),h=c.useMemo(()=>o.slice(0,x),[o,x]),P=c.useCallback(()=>i.displayWengine.set({editWengineId:""}),[i]),{editWengineId:F}=S;F&&!i.wengines.get(F)&&P();const J=o.length!==g?`${o.length}/${g}`:`${g}`,U={numShowing:h.length,total:J,t:p,namespace:"page_wengine"},X={sortKeys:[...ze],value:m,onChange:n=>i.displayWengine.set({sortType:n}),ascending:f,onChangeAsc:n=>i.displayWengine.set({ascending:n})};return l(W,{display:"flex",flexDirection:"column",gap:1,children:[e(c.Suspense,{fallback:!1,children:e(We,{show:k,onHide:a,onSelect:b})}),e(c.Suspense,{fallback:!1,children:e(ke,{wengineId:F,footer:!0,onClose:P})}),e(De,{numShowing:o.length,total:g,wengineIds:o}),e(_,{children:e($,{sx:{display:"flex",flexDirection:"column",gap:1},children:l(W,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Se,{autoFocus:!0,size:"small",value:C,onChange:n=>z(n.target.value),label:p("wengineName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(Ce,{showingTextProps:U,sortByButtonProps:X})]})})}),e(K,{fullWidth:!0,onClick:r,color:"info",children:p("page_wengine:addWengine")}),e(W,{children:e(u,{container:!0,spacing:1,columns:Ee,children:h.map(n=>e(u,{item:!0,xs:1,children:e(be,{wengineId:n,onEdit:d},n)},n))})}),o.length!==h.length&&e(Ie,{ref:n=>{n&&D(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Re as default};
