import{u as v,r as G,a as K,b as N,g as P,c as i,j as e,C as k,d as h,e as I,G as p,T as b,t as F,B as T,f as U,R as $,D as J,S,h as j,i as V,k as Q,l as X,m as Y,n as C,A as Z,o as H,F as ee,M as se,p as te,I as ne,q as ie,s as re,v as ae,w as ce,x as q,y as oe}from"./index-DCGGyGO6.js";import{u as le}from"./useDataEntryBase-D205B4sX.js";import{d as de}from"./discSortUtil-BVEQ4qrB.js";function L(){const{database:c}=v();return le(c.displayDisc)}var x={},R;function ue(){if(R)return x;R=1;var c=G();Object.defineProperty(x,"__esModule",{value:!0}),x.default=void 0;var r=c(K()),s=N(),t=(0,r.default)((0,s.jsx)("path",{d:"M18 23H4c-1.1 0-2-.9-2-2V7h2v14h14v2zM15 1H8c-1.1 0-1.99.9-1.99 2L6 17c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V7l-6-6zm1.5 14h-6v-2h6v2zm0-6h-2v2h-2V9h-2V7h2V5h2v2h2v2z"}),"Difference");return x.default=t,x}var he=ue();const O=P(he);function fe({numShowing:c,total:r,discIds:s}){const t=v().database,{filterOption:n}=L(),g=i.useCallback(o=>t.displayDisc.set({filterOption:{...n,...o}}),[t,n]);return e(i.Suspense,{fallback:e(S,{variant:"rectangular",width:"100%",height:300}),children:e(k,{children:h(I,{children:[h(p,{container:!0,children:[e(p,{item:!0,children:e(b,{variant:"h6",children:F("discFilter")})}),e(p,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:h(b,{children:[e("strong",{children:c})," / ",r]})}),e(p,{item:!0,children:e(T,{size:"small",color:"error",onClick:()=>t.displayDisc.set({action:"reset"}),startIcon:e($,{}),children:e(U,{t:F,i18nKey:"ui:reset"})})})]}),e(i.Suspense,{fallback:e(S,{variant:"rectangular",width:"100%",height:400}),children:e(J,{filterOption:n,filterOptionDispatch:g,filteredIds:s})})]})})})}const B={xs:2,sm:3,md:4,lg:4,xl:6},pe={xs:10,sm:12,md:24,lg:24,xl:24};function ge({onAdd:c,onEdit:r,onShowDup:s}){const{t}=j("disc"),{database:n}=v(),[g,o]=V(),a=i.useDeferredValue(g),l=L(),m=i.useMemo(()=>de(),[]),D=i.useDeferredValue(l);i.useEffect(()=>n.discs.followAny(o),[n,o]);const{discIds:d,totalDiscsNum:f}=i.useMemo(()=>{const{filterOption:u}=D,y=n.discs.values;return{discIds:y.filter(Q(u,m)).map(W=>W.id),totalDiscsNum:y.length,...a}},[n.discs.values,a,D,m]),w=X(),_=d.length!==f?`${d.length}/${f}`:f,{numShow:E,setTriggerElement:z}=Y(pe[w],d.length),M=i.useMemo(()=>d.slice(0,E),[d,E]),A={numShowing:M.length,totalShowing:_};return h(ee,{children:[e(fe,{numShowing:f,total:f,discIds:d}),e(k,{bgt:"dark",children:e(I,{children:e(C,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:h(b,{color:"text.secondary",children:["Showing ",e("b",{children:A.numShowing})," out of"," ",A.totalShowing," Items"]})})})}),h(p,{container:!0,columns:B,spacing:1,children:[e(p,{item:!0,xs:!0,children:e(T,{fullWidth:!0,onClick:c,color:"info",startIcon:e(Z,{}),children:t("addNew")})}),e(p,{item:!0,xs:1,children:e(T,{fullWidth:!0,onClick:s,color:"info",startIcon:e(O,{}),children:t("showDupes")})})]}),h(i.Suspense,{fallback:e(S,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[e(C,{children:e(p,{container:!0,columns:B,spacing:1,children:M.map(u=>e(p,{item:!0,xs:1,children:e(H,{disc:n.discs.get(u),onEdit:()=>r==null?void 0:r(u),onDelete:()=>n.discs.remove(u),setLocation:y=>n.discs.set(u,{location:y}),onLockToggle:()=>n.discs.set(u,({lock:y})=>({lock:!y}))})},u))})}),d.length!==M.length&&e(S,{ref:u=>{u&&z(u)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function me({setDiscToEdit:c,show:r,onHide:s}){const{t}=j("disc");return e(se,{open:r,onClose:s,children:h(k,{children:[e(te,{title:h(b,{variant:"h6",flexGrow:1,display:"flex",alignItems:"center",children:[e(O,{sx:{verticalAlign:"text-top",mr:1}}),t("showDupes")]}),action:e(ne,{onClick:s,children:e(ie,{})})}),e(re,{}),e(I,{children:e(De,{setDiscToEdit:c})})]})})}function De({setDiscToEdit:c}){const{t:r}=j("disc"),{database:s}=v(),[t,n]=V();i.useEffect(()=>s.discs.followAny(n),[n,s]);const g=i.useMemo(()=>{const o=t&&[],a=s.discs.keys;for(;a.length!==0;){const l=a.shift();if(!l)continue;const m=s.discs.get(l);if(!m)continue;const{duplicated:D}=s.discs.findDups(m,a);if(!D.length)continue;const d=D;o.push([m,...d].sort(f=>{var w;return((w=s.discs.get(f.location))==null?void 0:w.location)??""?-1:1}))}return o},[s,t]);return h(ce,{spacing:2,children:[g.map(o=>e(k,{sx:{overflowX:"scroll"},children:e(I,{sx:{display:"flex",gap:1},children:o.map(a=>e(C,{sx:{minWidth:300},children:e(H,{disc:a,setLocation:l=>s.discs.set(a.id,{location:l}),onLockToggle:()=>s.discs.set(a.id,({lock:l})=>({lock:!l})),onDelete:()=>s.discs.remove(a.id),onEdit:()=>c(a.id)})},a.id))})},o.join())),!g.length&&e(ae,{variant:"filled",severity:"success",children:r("noDupAlert")})]})}function be(){const[c,r]=i.useState({}),[s,t,n]=q(),[g,o,a]=q(!1),{database:l}=v(),m=i.useCallback(()=>{r({}),t()},[t]),D=i.useCallback(d=>{const f=l.discs.get(d);f&&(r(f),t())},[l.discs,t]);return h(C,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(i.Suspense,{fallback:!1,children:e(oe,{disc:c,allowEmpty:!0,allowUpload:!0,show:s,onClose:n,onShow:t,cancelEdit:()=>r({})})}),e(i.Suspense,{fallback:!1,children:e(me,{show:g,onHide:a,setDiscToEdit:D})}),e(ge,{onAdd:m,onEdit:D,onShowDup:o})]})}export{be as default};
