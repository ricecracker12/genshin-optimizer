import{N as re,bu as ce,c as s,be as ne,j as a,bO as v,bP as ie,d as f,av as le,bQ as oe,bR as he,n as M,bS as ue,h as de,u as pe,bT as ge,a2 as ye,bD as me,i as Ce,k as fe,bU as be,bV as T,l as xe,m as Se,bt as Te,af as we,e as ve,G as o,bW as Me,bX as ke,a1 as De,bY as Ie,C as Oe,A as je,B as Ee,S as F,bn as w,bl as Pe,aV as Be}from"./index-RHc_2K7m.js";import{m as Fe,u as He,j as Ke,k as Ne,o as ze,l as Ae,p as Re,r as Ve,s as H}from"./tagFieldMap-HJo_XnvA.js";import"./useDataEntryBase-B5GOfKY5.js";import"./discSortUtil-Czm-Zqzp.js";function We({value:h,totals:t,onChange:n,...d}){const y=re(),u=!ce(y.breakpoints.up("sm")),g=s.useMemo(()=>ne([...v]),[]),b=s.useCallback(c=>()=>n(g(h,c)),[n,g,h]);return a(ue,{exclusive:!0,value:h,...d,children:v.map(c=>a(ie,{value:c,sx:{p:u?1:void 0,minWidth:u?0:"6em",display:"flex",gap:u?0:1},selectedColor:"primary",onClick:b(c),children:f(M,{sx:{display:"flex",alignItems:"center",gap:1},children:[a(le,{src:oe(c),size:1.5,sideMargin:!0}),!u&&a(he,{label:t[c],size:"small"})]})},c))})}const $e={xs:1,sm:2,md:2,lg:3,xl:4},Ge={xs:1,sm:2,md:2,lg:3,xl:12},Ue=Object.keys(H);function Xe(){const{t:h}=de("page_characters"),{database:t}=pe(),n=ge(),{params:{characterKey:d}}=ye({path:"/characters/:characterKey",end:!1})??{params:{}},[y,u]=s.useState(()=>t.displayCharacter.get());s.useEffect(()=>t.displayCharacter.follow((e,r)=>u(r)),[t,u]);const[g,b]=s.useState(""),c=s.useDeferredValue(g),[k,D]=s.useState(""),K=s.useMemo(()=>({statHighlight:k,setStatHighlight:D}),[k,D]),i=s.useMemo(()=>d?me.includes(d)?d:(n("/characters"),null):null,[d,n]),m=Fe(i??void 0),I=He(i??void 0)??(i&&t.charOpts.getOrCreate(i)),N=s.useMemo(()=>({src:i,dst:i,preset:"preset0"}),[i]),[z,O]=s.useState(!1),[A,j]=Ce();s.useEffect(()=>t.chars.followAny((e,r)=>(r==="new"||r==="remove")&&j()),[j,t]);const R=s.useCallback(e=>{t.chars.get(e)||t.chars.getOrCreate(e),n(`/characters/${e}`)},[t.chars,n]),E=s.useDeferredValue(y),P=s.useDeferredValue(A),{charKeys:p,totalCharNum:x}=s.useMemo(()=>{const r=t.chars.keys.length,{attribute:l,specialtyType:C,rarity:ee,sortType:te,ascending:ae}=E,se=t.chars.keys.filter(fe({attribute:l,specialtyType:C,rarity:ee,name:c},Re(t))).sort(be(H[te]??[],ae,Ve(t),["new"]));return P&&{charKeys:se,totalCharNum:r}},[t,E,c,P]),{specialtyType:V,attribute:W,rarity:$,sortType:G,ascending:U}=y,_=s.useMemo(()=>T(Pe,e=>t.chars.entries.forEach(([r,l])=>{const C=w(l.key).specialty;e[C].total++,t.chars.keys.includes(r)&&e[C].current++})),[t]),Q=s.useMemo(()=>T(Be,e=>Object.entries(t.chars.data).forEach(([r])=>{const l=w(r).attribute;e[l].total++,t.chars.keys.includes(r)&&e[l].current++})),[t]),q=s.useMemo(()=>T(v,e=>Object.entries(t.chars.data).forEach(([r])=>{const l=w(r).rarity;e[l].total++,t.chars.keys.includes(r)&&e[l].current++})),[t]),L=xe(),{numShow:B,setTriggerElement:X}=Se(Ge[L],p.length),S=s.useMemo(()=>p.slice(0,B),[p,B]),Y=p.length!==x?`${p.length}/${x}`:`${x}`,J={numShowing:S.length,total:Y,t:h,namespace:"page_character"},Z={sortKeys:[...Ue],value:G,onChange:e=>t.displayCharacter.set({sortType:e}),ascending:U,onChangeAsc:e=>t.displayCharacter.set({ascending:e})};return f(M,{display:"flex",flexDirection:"column",gap:2,children:[i&&m&&I&&a(we.Provider,{value:N,children:a(Te.Provider,{value:K,children:a(Ke,{character:m,charOpt:I,wengineId:m.equippedWengine,discIds:m.equippedDiscs,children:a(Ne,{characterKey:i,onClose:()=>n("/characters")})})})}),a(s.Suspense,{fallback:!1,children:a(ze,{show:z,onHide:()=>O(!1),onSelect:R,newFirst:!0})}),a(Oe,{children:f(ve,{sx:{display:"flex",flexDirection:"column",gap:1},children:[f(o,{container:!0,spacing:1,children:[a(o,{item:!0,children:a(Me,{sx:{height:"100%"},onChange:e=>t.displayCharacter.set({specialtyType:e}),value:V,totals:_,size:"small"})}),a(o,{item:!0,children:a(ke,{sx:{height:"100%"},onChange:e=>t.displayCharacter.set({attribute:e}),value:W,totals:Q,size:"small"})}),a(o,{item:!0,children:a(We,{sx:{height:"100%"},onChange:e=>t.displayCharacter.set({rarity:e}),value:$,totals:q,size:"small"})}),a(o,{item:!0,flexGrow:1}),a(o,{item:!0,children:a(De,{autoFocus:!0,value:g,onChange:e=>b(e.target.value),label:h("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),a(M,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:a(Ie,{showingTextProps:J,sortByButtonProps:Z})})]})}),a(Ee,{fullWidth:!0,onClick:()=>O(!0),color:"info",startIcon:a(je,{}),children:h("addNew")}),a(s.Suspense,{fallback:a(F,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:a(o,{container:!0,spacing:2,columns:$e,children:S.map(e=>a(o,{item:!0,xs:1,children:a(Ae,{characterKey:e,onClick:()=>n(`${e}`)})},e))})}),p.length!==S.length&&a(F,{ref:e=>{e&&X(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Xe as default};
