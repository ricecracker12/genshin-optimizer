import{a as Ze,g as et,r as l,_ as tt,af as Pt,ag as Dt,b as K,j as H,s as ke,d as nt,e as ne,f as st,ah as zt,ai as at,c as Me,u as _t,h as Lt,p as e,W as S,aj as ue,i as Te,k as Be,l as Re,m as Ie,a6 as Ot,ak as jt,al as ce,am as At,an as je,ao as qt,ap as Nt,a7 as Ft,aq as ot,ar as $t,as as Kt,at as Ht,q as h,B as f,au as Gt,w as ye,T as k,av as rt,z as M,n as V,ae as it,a0 as ct,a1 as lt,aw as Wt,ad as Vt,ax as Ut,a4 as he,x as Xt,a2 as U,I as W,R as dt,ay as Jt,X as Se,y as O,az as Qt,aA as Ee,aB as Yt,aC as Zt,J as en,aD as tn,aE as nn,aF as ut,aG as sn,aH as ht,a3 as an,aI as on,a9 as Q,N as Ae,aJ as pt,aK as rn,aL as cn,aM as ln,aN as dn,A as mt,aO as un,aP as hn,aQ as pn,aR as qe,aS as mn,aT as fn,aU as Ne,aV as Cn}from"./index-BD94GbJ6.js";import{r as gn,a as bn,O as ft,T as xn,C as vn,N as pe,I as we,t as yn,L as Sn,b as kn,R as Mn,c as Tn,d as be,E as me,e as Bn,f as Rn,g as In,o as En,W as wn,h as Pn,S as Dn,i as zn,j as _n,u as Ln,k as On,l as jn,m as Fe,n as $e,p as Ke,q as He,s as An,v as qn,w as Nn,x as Fn,y as $n,D as Kn,z as Hn,A as Gn,B as Wn,F as Vn,G as Un,H as Xn,J as Jn,K as Qn,M as Yn}from"./Checkroom-D07v4nRc.js";import{C as Zn,D as Ct,a as B,b as es}from"./UploadCard-CyOSbxai.js";import{T as gt,c as ts,d as bt,M as se,D as fe,b as ns,C as ss}from"./StatDisplay-D9xwF449.js";import{u as xt,b as ae,S as N,g as as,a as os,C as rs}from"./CharacterEditor-DAxj-K18.js";import{u as is,a as cs,g as ls}from"./LightConeTrans-B87lI2JS.js";import{C as oe}from"./CardActionArea-BA2PaNj4.js";import{b as X,D as ds}from"./BusinessCenter-a4fFyyWt.js";import{C as E,G as I}from"./Grid-BVKSfLtB.js";import{C as A}from"./CardHeader-B-KVhJrU.js";import{u as J}from"./useBoolState-D4pDII-P.js";import{R as us,b as vt,S as hs}from"./RelicSetAutocomplete-Bhw_TYQ9.js";import{L as ps}from"./LightConeEditorCard-ggh5jtTX.js";import{D as ms,R as fs,a as Cs}from"./RelicRarityDropdown-DnTDdD2g.js";import{D as gs}from"./Delete-CuHvoNRA.js";import"./InfoTooltip-CKBt_TUu.js";import"./LocationAutocomplete-ByuADpZz.js";function bs(n){return Ze("PrivateSwitchBase",n)}et("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const xs=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],vs=n=>{const{classes:t,checked:s,disabled:a,edge:o}=n,r={root:["root",s&&"checked",a&&"disabled",o&&`edge${ne(o)}`],input:["input"]};return st(r,bs,t)},ys=ke(zt)(({ownerState:n})=>K({padding:9,borderRadius:"50%"},n.edge==="start"&&{marginLeft:n.size==="small"?-3:-12},n.edge==="end"&&{marginRight:n.size==="small"?-3:-12})),Ss=ke("input",{shouldForwardProp:at})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),ks=l.forwardRef(function(t,s){const{autoFocus:a,checked:o,checkedIcon:r,className:i,defaultChecked:u,disabled:d,disableFocusRipple:c=!1,edge:p=!1,icon:m,id:v,inputProps:g,inputRef:b,name:w,onBlur:T,onChange:j,onFocus:P,readOnly:D,required:z=!1,tabIndex:q,type:_,value:C}=t,x=tt(t,xs),[y,F]=Pt({controlled:o,default:!!u,name:"SwitchBase",state:"checked"}),L=Dt(),_e=$=>{P&&P($),L&&L.onFocus&&L.onFocus($)},It=$=>{T&&T($),L&&L.onBlur&&L.onBlur($)},Et=$=>{if($.nativeEvent.defaultPrevented)return;const Oe=$.target.checked;F(Oe),j&&j($,Oe)};let Y=d;L&&typeof Y>"u"&&(Y=L.disabled);const wt=_==="checkbox"||_==="radio",ge=K({},t,{checked:y,disabled:Y,disableFocusRipple:c,edge:p}),Le=vs(ge);return H.jsxs(ys,K({component:"span",className:nt(Le.root,i),centerRipple:!0,focusRipple:!c,disabled:Y,tabIndex:null,role:void 0,onFocus:_e,onBlur:It,ownerState:ge,ref:s},x,{children:[H.jsx(Ss,K({autoFocus:a,checked:o,defaultChecked:u,className:Le.input,disabled:Y,id:wt?v:void 0,name:w,onChange:Et,readOnly:D,ref:b,required:z,ownerState:ge,tabIndex:q,type:_},_==="checkbox"&&C===void 0?{}:{value:C},g)),y?r:m]}))}),Ms=Me(H.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Ts=Me(H.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),Bs=Me(H.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function Rs(n){return Ze("MuiCheckbox",n)}const xe=et("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),Is=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],Es=n=>{const{classes:t,indeterminate:s,color:a,size:o}=n,r={root:["root",s&&"indeterminate",`color${ne(a)}`,`size${ne(o)}`]},i=st(r,Rs,t);return K({},t,i)},ws=ke(ks,{shouldForwardProp:n=>at(n)||n==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(n,t)=>{const{ownerState:s}=n;return[t.root,s.indeterminate&&t.indeterminate,t[`size${ne(s.size)}`],s.color!=="default"&&t[`color${ne(s.color)}`]]}})(({theme:n,ownerState:t})=>K({color:(n.vars||n).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:n.vars?`rgba(${t.color==="default"?n.vars.palette.action.activeChannel:n.vars.palette[t.color].mainChannel} / ${n.vars.palette.action.hoverOpacity})`:Lt.alpha(t.color==="default"?n.palette.action.active:n.palette[t.color].main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${xe.checked}, &.${xe.indeterminate}`]:{color:(n.vars||n).palette[t.color].main},[`&.${xe.disabled}`]:{color:(n.vars||n).palette.action.disabled}})),Ps=H.jsx(Ts,{}),Ds=H.jsx(Ms,{}),zs=H.jsx(Bs,{}),_s=l.forwardRef(function(t,s){var a,o;const r=_t({props:t,name:"MuiCheckbox"}),{checkedIcon:i=Ps,color:u="primary",icon:d=Ds,indeterminate:c=!1,indeterminateIcon:p=zs,inputProps:m,size:v="medium",className:g}=r,b=tt(r,Is),w=c?p:d,T=c?p:i,j=K({},r,{color:u,indeterminate:c,size:v}),P=Es(j);return H.jsx(ws,K({type:"checkbox",inputProps:K({"data-indeterminate":c},m),icon:l.cloneElement(w,{fontSize:(a=w.props.fontSize)!=null?a:v}),checkedIcon:l.cloneElement(T,{fontSize:(o=T.props.fontSize)!=null?o:v}),ownerState:j,ref:s,className:nt(P.root,g)},b,{classes:P}))});function Ge({value:n,onChange:t,...s}){const[a,o]=l.useState(n);l.useEffect(()=>{o(n)},[n]);const r=()=>t(a);return e(gt,{value:a,onChange:i=>o(i.target.value),onBlur:r,onKeyDown:i=>i.key==="Enter"&&!s.multiline&&r(),...s})}function yt(n){const{database:t}=S();return ue(t.builds,n??"")}function Pe(n){const{database:t}=S();return ue(t.buildTcs,n??"")}function re(n){const{database:t}=S();return ue(t.teams,n)}var Z={},We;function Ls(){if(We)return Z;We=1;var n=Te();Object.defineProperty(Z,"__esModule",{value:!0}),Z.default=void 0;var t=n(Be()),s=Re(),a=(0,t.default)((0,s.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91zM4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29zM20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24v-1.57zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"}),"Groups");return Z.default=a,Z}var Os=Ls();const Ve=Ie(Os);function js({teamId:n,children:t}){const s=re(n),a=le(s.teamMetadata,0),o=le(s.teamMetadata,1),r=le(s.teamMetadata,2),i=le(s.teamMetadata,3),u=l.useMemo(()=>Ot([...jt(s.teamMetadata.map(d=>d==null?void 0:d.characterKey).filter(d=>!!d)),...a,...o,...r,...i,ce.common.lvl.add(80),ce.common.res.add(.1),ce.common.isBroken.add(0),ce.common.maxToughness.add(100),At.common.critMode.add("avg"),...s.conditionals.flatMap(({sheet:d,src:c,dst:p,condKey:m,condValues:v})=>v.flatMap((g,b)=>g?je(`preset${b}`,qt(d,c,p)(m,g)):[])),...s.bonusStats.flatMap(({tag:d,values:c})=>c.flatMap((p,m)=>je(`preset${m}`,{tag:{...d},value:Ht(p)})))]),[s,a,o,r,i]);return e(Zn.Provider,{value:u,children:t})}function le(n,t){const s=n[t],a=xt(s==null?void 0:s.characterKey),o=Pe(s==null?void 0:s.buildTcId),r=yt(s==null?void 0:s.buildId),i=is((s==null?void 0:s.buildType)==="equipped"?a==null?void 0:a.equippedLightCone:(s==null?void 0:s.buildType)==="real"?r==null?void 0:r.lightConeId:void 0),u=Nt((s==null?void 0:s.buildType)==="equipped"?a==null?void 0:a.equippedRelics:(s==null?void 0:s.buildType)==="real"?r==null?void 0:r.relicIds:void 0),d=l.useMemo(()=>{const p=(s==null?void 0:s.buildType)==="tc"?o==null?void 0:o.lightCone:i;return p?Ft(p.key,p.level,p.ascension,p.superimpose):[]},[s==null?void 0:s.buildType,o==null?void 0:o.lightCone,i]),c=l.useMemo(()=>{const p=o==null?void 0:o.relic;return(s==null?void 0:s.buildType)==="tc"&&p?gn(p):u?bn(Object.values(u).filter(ot)):[]},[o==null?void 0:o.relic,s==null?void 0:s.buildType,u]);return l.useMemo(()=>a?$t(a.key,...Kt(a,t+1),...d,...c):[],[a,t,d,c])}const ie=l.createContext({presetIndex:0,setPresetIndex:()=>{}}),Ce=l.createContext({teamId:"",team:{}});function G(){return l.useContext(Ce)}const St=l.createContext({buildType:"equipped",buildId:""});function R(){return l.useContext(St)}function As(){const{database:n}=S(),{team:t,teamId:s}=G();return h(f,{sx:{display:"flex",gap:1,overflowX:"auto",overflowY:"visible",p:1},children:[t.frames.map((a,o)=>e(qs,{frame:a,index:o},o)),e(f,{sx:{flexShrink:0},children:e(ft,{setOptTarget:a=>n.teams.set(s,o=>{o.frames=[...o.frames,{multiplier:1,tag:{...a,preset:`preset${o.frames.length}`}}]})})})]})}function qs({frame:n,index:t}){const{presetIndex:s,setPresetIndex:a}=l.useContext(ie),o=ae(),{setRead:r}=l.useContext(Ct),i=l.useMemo(()=>new Gt(n.tag,"sum"),[n.tag]),u=l.useMemo(()=>{try{return(o==null?void 0:o.compute(i).val)??0}catch(p){return console.error("Error computing value:",p),0}},[o,i]),d=ye(n.tag.q??""),c=l.useCallback(p=>{p.altKey?r(i):a(t)},[t,i,a,r]);return e(M,{bgt:"light",sx:p=>({flexShrink:0,outline:s===t?`solid ${p.palette.success.main}`:void 0}),children:h(oe,{onClick:c,children:[h(f,{sx:{display:"flex",gap:1,alignItems:"stretch",p:1},children:[e(k,{children:t+1}),e(B,{orientation:"vertical"}),e(f,{sx:{display:"flex",alignItems:"center"},children:e(xn,{tag:n.tag})})]}),e(B,{}),e(f,{sx:{p:1,display:"flex",alignItems:"center",gap:1},children:h(k,{children:[n.multiplier," x ",rt(u,d)]})})]})})}var ee={},Ue;function Ns(){if(Ue)return ee;Ue=1;var n=Te();Object.defineProperty(ee,"__esModule",{value:!0}),ee.default=void 0;var t=n(Be()),s=Re(),a=(0,t.default)((0,s.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");return ee.default=a,ee}var Fs=Ns();const $s=Ie(Fs);function Ks({teamId:n,charKey:t}){const{t:s}=V("page_team"),a=it(),o=ct(),r=lt(o.breakpoints.down("md")),i=re(n);return i?e(Ut,{variant:"fullWidth",value:t??0,orientation:r?"vertical":"horizontal",sx:()=>({borderBottom:"1px rgb(200,200,200,0.3) solid","& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"},"& .Mui-selected":{color:"white !important"},"& .MuiTabs-indicator":{height:"4px",backgroundColor:"rgb(200,200,200,0.5)"},minHeight:"1em"}),children:i.teamMetadata.map((u,d)=>{const c=u==null?void 0:u.characterKey;return e(Wt,{icon:c?e(Vt,{size:1.5,src:ts(bt(c),"icon")}):e($s,{}),iconPosition:"start",value:c??d,disabled:!u,label:c?e(k,{children:s(`charNames_gen:${c}`)}):`Character ${d+1}`,onClick:()=>c&&a(`/teams/${n}/${c}`),sx:{p:1,minHeight:"1em"}},d)})}):null}var te={},Xe;function Hs(){if(Xe)return te;Xe=1;var n=Te();Object.defineProperty(te,"__esModule",{value:!0}),te.default=void 0;var t=n(Be()),s=Re(),a=(0,t.default)((0,s.jsx)("path",{d:"M22 24H2v-4h20v4zM13.06 5.19l3.75 3.75L7.75 18H4v-3.75l9.06-9.06zm4.82 2.68-3.75-3.75 1.83-1.83c.39-.39 1.02-.39 1.41 0l2.34 2.34c.39.39.39 1.02 0 1.41l-1.83 1.83z"}),"BorderColor");return te.default=a,te}var Gs=Hs();const Ws=Ie(Gs);function Vs({teamId:n}){const t=re(n);return e(f,{display:"flex",flexDirection:"column",gap:1,children:t.teamMetadata.map((s,a)=>e(Us,{teamMetadataIndex:a,teamId:n},`${a}_${s==null?void 0:s.characterKey}`))})}const Us=l.memo(function({teamMetadataIndex:t,teamId:s}){var i;const{database:a}=S(),o=re(s);function r(u){if(u===""){a.teams.set(s,c=>c.teamMetadata[t]=void 0);return}a.chars.getOrCreate(u);const d=o.teamMetadata.findIndex(c=>(c==null?void 0:c.characterKey)===u);if(d===-1)a.teams.set(s,c=>{c.teamMetadata[t]={characterKey:u}});else{if(d===t)return;const c=o.teamMetadata[d],p=o.teamMetadata[t];a.teams.set(s,m=>{m.teamMetadata[t]=c,m.teamMetadata[d]=p})}}return e(vn,{charKey:((i=o.teamMetadata[t])==null?void 0:i.characterKey)??"",setCharKey:r})});function Xs(){const{t:n}=V("page_team"),{teamId:t,team:s}=G(),{database:a}=S(),[o,r]=l.useState(!1),i=d=>{a.teams.set(t,{name:d})},u=d=>{a.teams.set(t,{description:d})};return h(he,{children:[e(oe,{onClick:()=>r(!0),children:e(Xt,{placement:"top",title:h(f,{children:[h(f,{sx:{display:"flex",color:"info.light",gap:1},children:[e(Ws,{}),e(k,{children:e("strong",{children:n("team.editNameDesc")})})]}),!!s.description&&e(k,{children:s.description})]}),children:e(E,{sx:{display:"flex",justifyContent:"center","&:hover":{color:"info.light"},py:1},children:h(k,{variant:"h5",sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",textShadow:"#000 0 0 10px !important"},children:[e(Ve,{}),s.name]})})})}),e(U,{open:o,onClose:()=>r(!1),children:h(M,{children:[e(A,{title:n("team.editNameDesc"),avatar:e(Ve,{}),titleTypographyProps:{variant:"h6"},action:e(W,{onClick:()=>r(!1),children:e(X,{})})}),e(B,{}),e(E,{children:h(f,{display:"flex",flexDirection:"column",gap:2,sx:{mt:2},children:[e(Ge,{label:n("team.name"),value:s.name,onChange:d=>i(d),autoFocus:!0}),e(Ge,{label:n("team.desc"),value:s.description,onChange:d=>u(d),multiline:!0,minRows:4}),e(Vs,{teamId:t})]})})]})})]})}const kt=210,Mt=2,Tt=l.createContext(kt);function Js({teamId:n,characterKey:t,headerRef:s}){return e(f,{ref:s,sx:{overflow:"visible",top:Mt,position:"sticky",zIndex:101},children:h(M,{sx:a=>({outline:`solid ${a.palette.secondary.main}`}),children:[e(Xs,{}),e(B,{}),e(As,{}),e(B,{}),e(Ks,{teamId:n,charKey:t})]})})}function Qs(){const{database:n}=S(),{presetIndex:t}=l.useContext(ie),{teamId:s,team:{bonusStats:a}}=G(),{characterKey:o}=R(),r=i=>{const u=Ys(i,o);n.teams.setBonusStat(s,u,0,t)};return t?h(M,{children:[e(A,{title:"Bonus Stats"}),e(B,{}),e(E,{children:h(N,{spacing:1,children:[a.map(({tag:i,values:u},d)=>e(ta,{tag:i,value:u[t],setValue:c=>n.teams.setBonusStat(s,i,c,t),onDelete:()=>n.teams.setBonusStat(s,i,0,t),setTag:c=>n.teams.setBonusStat(s,c,0,t)},JSON.stringify(i)+d)),e(ea,{onSelect:r})]})})]}):null}function Ys(n,t){return{src:t,dst:t,et:"own",q:n,qt:"premod",sheet:"agg"}}const Zs=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function ea({tag:n={},onSelect:t}){var s;return e(fe,{title:(n&&((s=yn.subset(n)[0])==null?void 0:s.title))??"Add Bonus Stat",children:Zs.map(a=>e(se,{onClick:()=>t(a),children:a},a))})}function ta({tag:n,setTag:t,value:s,setValue:a,onDelete:o}){var i;const r=(i=n.name||n.q)==null?void 0:i.endsWith("_");return e(M,{bgt:"light",children:h(E,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[e(dt,{sx:{m:"auto"},children:n.q}),n.q==="dmg_"&&e(na,{tag:n,setElementalType:u=>{const{elementalType:d,...c}=n;t(u?{...c,elementalType:u}:c)}}),e(pe,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:a,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:h(we,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",e(W,{"aria-label":"Delete Bonus Stat",onClick:o,edge:"end",children:e(ds,{fontSize:"small"})})]})}})]})})}function na({tag:n,setElementalType:t}){return h(fe,{title:n.elementalType??"No Element",children:[e(se,{onClick:()=>t(null),children:"No Element"}),Jt.map(s=>e(se,{onClick:()=>t(s),children:s},s))]})}function sa({onClose:n}){const{database:t}=S(),{characterKey:s}=R(),[a,o]=Se(),[r,i]=Se(),u=l.useMemo(()=>a&&t.builds.getBuildIds(s),[a,t,s]),d=l.useMemo(()=>r&&t.buildTcs.getBuildTcIds(s),[r,t,s]);return l.useEffect(()=>t.builds.followAny(o),[t.builds,o]),l.useEffect(()=>t.buildTcs.followAny(i),[t.buildTcs,i]),h(M,{bgt:"dark",children:[e(A,{title:"Builds",action:n?e(W,{onClick:n,children:e(X,{})}):null}),e(B,{}),e(E,{children:h(N,{spacing:1,children:[e(k,{variant:"h6",children:"Equipped build"}),e(aa,{}),e(k,{variant:"h6",children:"Other builds"}),u.map(c=>e(oa,{buildId:c},c)),e(k,{variant:"h6",children:"TC builds"}),e(O,{fullWidth:!0,onClick:()=>t.buildTcs.new(Qt(s)),children:"New TC Build"}),d.map(c=>e(ra,{buildTcId:c},c))]})})]})}function De(n,t=""){const{database:s}=S(),{characterKey:a,buildType:o,buildId:r,buildTcId:i}=R(),{teamId:u}=G();return l.useMemo(()=>({active:o==="equipped"?o===n:o==="real"?r===t:o==="tc"&&i===t,onActive:()=>{s.teams.set(u,d=>{const c=d.teamMetadata.find(p=>(p==null?void 0:p.characterKey)===a);if(!c){console.error(`Teammate data not found for character ${a}`);return}c.buildType=n,n==="real"&&t?c.buildId=t:n==="tc"&&t&&(c.buildTcId=t)})}}),[r,i,o,a,s.teams,t,n,u])}function aa(){const n=Ee(),{equippedRelics:t,equippedLightCone:s}=n,{active:a,onActive:o}=De("equipped");return e(ze,{name:"Equipped",onActive:o,active:a,buildGrid:e(me,{relicIds:t,lightConeId:s})})}function oa({buildId:n}){const t=yt(n),{relicIds:s,lightConeId:a,name:o,description:r}=t,{active:i,onActive:u}=De("real",n);return e(ze,{name:o,description:r,onActive:u,active:i,buildGrid:e(me,{relicIds:s,lightConeId:a})})}function ze({name:n,description:t,buildGrid:s,active:a,onActive:o}){const r=l.useCallback(()=>{},[]);return h(M,{sx:i=>({outline:a?`solid ${i.palette.success.main}`:void 0}),children:[h(f,{display:"flex",children:[e(oe,{onClick:r,children:e(A,{title:n,subheader:t})}),e(f,{display:"flex",alignContent:"center",sx:{padding:1},children:e(O,{size:"small",color:"success",onClick:o,disabled:a,children:"Set Active"})})]}),e(B,{}),e(E,{children:s})]})}function ra({buildTcId:n}){const t=Pe(n),{name:s="ERROR",description:a="ERROR"}=t??{},{active:o,onActive:r}=De("tc",n);return e(ze,{name:s,description:a,onActive:r,active:o,buildGrid:e(Bt,{buildTcId:n})})}function Bt({buildTcId:n}){const{database:t}=S(),s=Pe(n),{lightCone:a,relic:o}=s,[r,i,u]=J(),[d,c,p]=J(),[m,v,g]=J(),[b,w,T]=J(),j=l.useCallback(C=>{t.buildTcs.set(n,x=>({lightCone:{...x.lightCone,...C}}))},[n,t.buildTcs]),P=l.useCallback((C,x)=>{t.buildTcs.set(n,y=>({relic:{...y.relic,slots:{...y.relic.slots,[C]:{...y.relic.slots[C],...x}}}}))},[n,t.buildTcs]),D=l.useCallback((C,x)=>{t.buildTcs.set(n,y=>({relic:{...y.relic,substats:{...y.relic.substats,stats:{...y.relic.substats.stats,[C]:x}}}}))},[n,t.buildTcs]),z=l.useCallback(C=>{t.buildTcs.set(n,x=>({relic:{...x.relic,substats:{...x.relic.substats,type:C}}}))},[n,t.buildTcs]),q=l.useCallback((C,x)=>{t.buildTcs.set(n,y=>({relic:{...y.relic,sets:{...y.relic.sets,[C]:x}}}))},[n,t.buildTcs]),_=l.useCallback(C=>{t.buildTcs.set(n,x=>{const y={...x.relic.sets};return delete y[C],{relic:{...x.relic,sets:y}}})},[n,t.buildTcs]);return h(f,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e(ia,{show:r,onClose:u,lightCone:a,onUpdate:j}),a?e(Sn,{bgt:"light",lightCone:a,onClick:i}):e(kn,{bgt:"light",onClick:i}),e(ha,{show:b,onClose:T,sets:o.sets,setSets:q,removeSet:_}),e(Mn,{bgt:"light",sets:o.sets,onClick:w}),e(ca,{show:d,onClose:p,slots:o.slots,setSlot:P}),e(Tn,{bgt:"light",slots:o.slots,onClick:c}),e(da,{stats:o.substats.stats,show:m,onClose:g,type:o.substats.type,setType:z,setStat:D}),e(be,{onClick:v,relic:o,keys:["hp","hp_","def","def_"],bgt:"light"}),e(be,{onClick:v,relic:o,keys:["atk","atk_","crit_","crit_dmg_"],bgt:"light"}),e(be,{onClick:v,relic:o,keys:["spd","eff_","eff_res_","brEffect_"],bgt:"light"})]})}function ia({lightCone:n={},onUpdate:t,show:s,onClose:a}){return e(U,{open:s,onClose:a,children:e(ps,{onClose:a,lightCone:n,setLightCone:t,hideLocation:!0})})}function ca({slots:n,show:t,onClose:s,setSlot:a}){return e(U,{open:t,onClose:s,containerProps:{maxWidth:"sm"},children:h(M,{children:[e(A,{title:"TC Build Relic Slots Editor",action:e(W,{onClick:s,children:e(X,{})})}),e(B,{}),e(E,{children:e(N,{spacing:1,children:Object.entries(n).map(([o,{level:r,statKey:i,rarity:u}])=>e(la,{slotKey:o,level:r,statKey:i,rarity:u,setStatKey:d=>a(o,{statKey:d}),setRarity:d=>a(o,{rarity:d}),setLevel:d=>a(o,{level:d})},o))})})]})})}function la({slotKey:n,level:t,rarity:s,statKey:a,setStatKey:o,setRarity:r,setLevel:i}){return h(f,{sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"space-between"},children:[e(hs,{slotKey:n}),e(fs,{rarity:s,onRarityChange:r,showNumber:!0}),e(f,{sx:{flexGrow:1},children:e(Cs,{dropdownButtonProps:{fullWidth:!0},slotKey:n,statKey:a,setStatKey:o})}),e(pe,{value:t,inputProps:{sx:{width:"2ch"},max:tn[s],min:0},InputProps:{startAdornment:e(we,{position:"start",children:"Level"})},size:"small",onChange:i})]})}function da({show:n,onClose:t,stats:s,setStat:a}){return e(U,{open:n,onClose:t,containerProps:{maxWidth:"sm"},children:h(M,{children:[e(A,{title:"TC Build Substats Editor",action:e(W,{onClick:t,children:e(X,{})})}),e(B,{}),e(E,{children:e(N,{spacing:1,children:e(f,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",rowGap:1,columnGap:2},children:Object.entries(s).map(([o,r])=>e(ua,{statKey:o,value:r,setValue:i=>a(o,i)},o))})})})]})})}function ua({statKey:n,value:t,setValue:s}){return h(f,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"space-between"},children:[e(ns,{statKey:n}),e(pe,{value:t,onChange:s,float:ye(n)==="%",size:"small",inputProps:{sx:{width:"4em",textAlign:"right"},min:0,max:9999},InputProps:{endAdornment:ye(n)||e(f,{width:"0.8em",component:"span"})}})]})}function ha({show:n,onClose:t,sets:s,setSets:a,removeSet:o}){const[r,i]=l.useState(null),u=l.useCallback(c=>{c&&(Yt(c)?a(c,2):Zt(c)&&i(c))},[a]),d=l.useCallback(c=>{r&&(a(r,c),i(null))},[r,a]);return e(U,{open:n,onClose:t,containerProps:{maxWidth:"sm"},children:h(M,{children:[e(A,{title:"TC Build Relic Sets Editor",action:e(W,{onClick:t,children:e(X,{})})}),e(B,{}),e(E,{children:h(N,{spacing:1,children:[Object.entries(s).map(([c,p])=>h(f,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(us,{setKey:c}),e(dt,{children:p}),e(W,{size:"small",onClick:()=>o(c),children:e(ms,{})})]},c)),h(f,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(vt,{size:"small",relicSetKey:r??"",setRelicSetKey:u,sx:{flexGrow:1},label:r??""}),h(en,{children:[e(O,{disabled:!r,onClick:()=>d(2),children:"2"}),e(O,{disabled:!r,onClick:()=>d(4),children:"4"})]})]})]})})]})})}function pa(){const{team:n}=G(),t=n.conditionals,[s,a]=l.useState(""),o=l.useMemo(()=>{const r=t.map(i=>i.sheet).filter(nn);return s&&r.push(s),[...new Set(r)].sort(i=>i===s?-1:1)},[t,s]);return h(N,{spacing:1,sx:{pt:1},children:[e(cs,{lcKey:s,setLCKey:a,label:"Search Light Cone"}),e(f,{children:e(I,{container:!0,columns:3,spacing:1,children:o.map(r=>e(I,{item:!0,xs:1,children:e(Bn,{lcKey:r})},r))})})]})}function ma(n){const{database:t}=S();return ue(t.generatedBuildList,n)}const fa=l.memo(function(){const{optConfig:t}=l.useContext(ut),s=ma(t.generatedBuildListId??"");return e(N,{spacing:1,children:s==null?void 0:s.builds.map((a,o)=>e(M,{children:h(E,{children:[h(f,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[h(k,{children:["Build ",o+1,": ",rt(a.value)]}),e(Ca,{build:a})]}),e(me,{relicIds:a.relicIds,lightConeId:a.lightConeId})]})},`${o}-${a.lightConeId}-${Object.values(a.relicIds).join("-")}`))})});function Ca({build:{relicIds:n,lightConeId:t}}){const{t:s}=V("build"),[a,o]=l.useState(""),[r,i,u]=J(),[d,c]=l.useState(!1),{database:p}=S(),{teamId:m}=G(),{characterKey:v}=R(),g=b=>{b.preventDefault(),d||p.builds.new({characterKey:v,name:a,teamId:m,relicIds:n,lightConeId:t}),o(""),u()};return h(he,{children:[e(O,{color:"info",size:"small",startIcon:e(Rn,{}),onClick:i,children:s("createBuildReal.button")}),e(U,{open:r,onClose:u,disableRestoreFocus:!0,children:h(M,{children:[e(A,{title:s("createBuildReal.title"),action:e(W,{onClick:u,children:e(X,{})})}),e(B,{}),h(E,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e(k,{children:s("createBuildReal.desc")}),h(f,{display:"flex",alignItems:"center",sx:{ml:-1},children:[e(_s,{size:"small",checked:d,onChange:()=>c(!d)}),e(k,{children:"Create a new TC Build"})]}),h("form",{onSubmit:g,children:[e(gt,{value:a,onChange:b=>o(b.target.value),autoFocus:!0,margin:"dense",label:s("createBuildReal.label"),fullWidth:!0}),h(f,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e(O,{onClick:u,children:s("createBuildReal.cancel")}),e(O,{type:"submit",color:"success",disabled:!a,children:s("createBuildReal.create")})]})]})]})]})})]})}function ga(){const{database:n}=S(),{teamId:t}=l.useContext(Ce),s=R(),a=s.optConfigId,o=l.useCallback(()=>{a||n.teams.set(t,r=>{const i=r.teamMetadata.find(u=>(u==null?void 0:u.characterKey)===s.characterKey);if(i){const u=n.optConfigs.new();i.optConfigId=u}})},[t,s.characterKey,n,a]);return a?h(sn,{optConfigId:a,children:[e(ba,{}),e(fa,{})]}):e(M,{children:e(A,{title:h("span",{children:["Optimize this team for ",s.characterKey]}),action:e(O,{onClick:o,children:"Optimize"})})})}function ba(){const{t:n}=V("optimize"),{database:t}=S(),s=ae(),{team:a}=l.useContext(Ce),{characterKey:o}=R(),[r,i]=l.useState(8),[u,d]=l.useState(void 0),{optConfig:c,optConfigId:p}=l.useContext(ut),m=l.useMemo(()=>t.relics.values.reduce((D,z)=>(D[z.slotKey].push(z),D),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[t.relics.values]),v=l.useMemo(()=>{const{path:D}=as(o);return t.lightCones.values.filter(({key:z})=>{const{path:q}=ls(z);return D===q})},[o,t.lightCones.values]),g=l.useMemo(()=>In(Object.values(m))*v.length,[v.length,m]),[b,w]=l.useState(!1),T=l.useRef(()=>{});l.useEffect(()=>()=>T.current(),[]);const j=l.useCallback(async()=>{if(!s)return;const D=new Promise(C=>T.current=C);d(void 0),w(!0);const z=(c.statFilters??[]).filter(C=>!C.disabled),q=En(o,s,a.frames,10,z,[],[],[],v,m,r,d);D.then(()=>q.terminate("user cancelled"));let _;try{_=await q.results}catch{return}finally{T.current=()=>{},w(!1)}_.length&&t.optConfigs.newOrSetGeneratedBuildList(p,{builds:_.slice(0,5).map(({ids:C,value:x})=>({lightConeId:C[0],relicIds:ht(an,(y,F)=>C[F+1]),value:x})),buildDate:Date.now()})},[s,c.statFilters,o,a.frames,v,m,r,t.optConfigs,p]),P=l.useCallback(()=>{T.current(),w(!1)},[T]);return h(M,{children:[e(A,{title:n("optimize"),action:h(f,{children:[e(wn,{numWorkers:r,setNumWorkers:i}),e(O,{onClick:b?P:j,color:b?"error":"primary",startIcon:b?e(X,{}):e(Pn,{}),children:n(b?"cancel":"optimize")})]})}),e(B,{}),h(E,{children:[e(Dn,{}),u&&e(xa,{progress:u,total:g})]})]})}function de({value:n}){const t=n.toLocaleString();return e(f,{sx:{fontFamily:"Monospace",display:"inline"},children:t})}function xa(n){const{t}=V("optimize"),{computed:s,remaining:a,skipped:o}=n.progress,r=s+a,i=Math.log1p(r)/Math.log1p(n.total),u=a/r*i;return h(f,{children:[h(k,{children:[t("computed"),": ",e(de,{value:s})," /"," ",e(de,{value:r})," "]}),h(k,{children:[t("computed + skipped"),": ",e(de,{value:s+o})," /"," ",e(de,{value:n.total})]}),e(zn,{variant:"determinate",value:(1-u)*100,sx:{height:10,borderRadius:5}})]})}function va(){const{team:n}=G(),t=n.conditionals,[s,a]=l.useState(""),o=l.useMemo(()=>{const r=t.map(i=>i.sheet).filter(on);return s&&r.push(s),[...new Set(r)].sort(i=>i===s?-1:1)},[t,s]);return h(N,{spacing:1,sx:{pt:1},children:[e(vt,{relicSetKey:s,setRelicSetKey:a,label:"Search Relic Set"}),e(f,{children:e(I,{container:!0,columns:3,spacing:1,children:o.map(r=>e(I,{item:!0,xs:1,children:e(_n,{setKey:r})},r))})})]})}const ya={xs:12,sm:6,md:4};function Sa(){const{characterKey:n}=R(),t=ae(),s=["basic","skill","ult","talent","technique","overworld","bonusAbility1","bonusAbility2","bonusAbility3",...jn],a=ct(),o=lt(a.breakpoints.up("lg")),r=Ln[n],i=(t==null?void 0:t.compute(Q.char.eidolon).val)??0,u=l.useMemo(()=>r&&On.map(d=>{const c=r[d];return c?e(Je,{talentKey:d,sheetElement:c},d):null}),[r]);if(!(!r||!t))return e(he,{children:h(I,{container:!0,spacing:1,children:[o&&h(I,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[e(Qe,{eidolon:i}),u&&u.map((d,c)=>e(f,{sx:{opacity:i>=c+1?1:.5},children:d},c))]}),e(I,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:s.map(d=>{const c=r[d];return c?e(I,{item:!0,...ya,children:e(Je,{talentKey:d,sheetElement:c})},d):null})}),!o&&e(I,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:e(I,{item:!0,xs:12,children:e(Qe,{eidolon:i})})})]})})}function Je({sheetElement:n,talentKey:t}){const s=ae(),{characterKey:a}=R(),{database:o}=S(),{img:r,title:i,subtitle:u,documents:d}=n,c=l.useMemo(()=>s?Fe(t)?$e[t].disabled(s):Ke(t)?He[t].disabled(s):!1:!1,[s,t]),p=l.useMemo(()=>{if(s){if(Fe(t)&&$e[t].onClickable(s))return()=>o.chars.set(a,g=>{const b=An(t);g.statBoosts={...g.statBoosts,[b]:!g.statBoosts[b]}});if(Ke(t)&&He[t].onClickable(s))return()=>o.chars.set(a,g=>{const b=qn(t);g.bonusAbilities={...g.bonusAbilities,[b]:!g.bonusAbilities[b]}});if(Nn(t)){const g=Fn(t),b=(s==null?void 0:s.compute(Q.char.eidolon).val)??0;return()=>o.chars.set(a,{eidolon:g===b?g-1:g})}}},[t,s,o.chars,a]),m=l.useCallback(g=>e(oe,{onClick:p,children:g}),[p]);let v=null;return v=null,Hn(t)&&(v=e(ka,{talentKey:t,dropDownButtonProps:{sx:{borderRadius:0}},setTalent:g=>o.chars.set(a,b=>{b[t]=g})})),h(M,{bgt:"light",sx:{height:"100%",opacity:c?.5:1},children:[v,h(f,{sx:{p:1},children:[e($n,{condition:!!p,wrapper:m,children:h(I,{container:!0,sx:{flexWrap:"nowrap"},children:[r&&e(I,{item:!0,children:e(f,{component:Ae?Ae:"img",src:r,sx:{width:60,height:"auto"}})}),h(I,{item:!0,flexGrow:1,sx:{pl:1},children:[e(k,{variant:"subtitle1",children:i}),u&&e(k,{variant:"subtitle2",children:u})]})]})}),d.map((g,b)=>e(Kn,{document:g,collapse:!0},b))]})]})}function Qe({eidolon:n}){const{t}=V("characters_gen"),{characterKey:s}=R(),{database:a}=S();return e(fe,{fullWidth:!0,title:h("span",{children:[t("eidolonLvl")," ",n]}),color:"primary",children:pt(0,rn).map(o=>e(se,{selected:n===o,disabled:n===o,onClick:()=>a.chars.set(s,{eidolon:o}),children:h("span",{children:[t("eidolonLvl")," ",o]})},o))})}function ka({talentKey:n,setTalent:t,dropDownButtonProps:s}){const{t:a}=V("common_gen"),o=Ee(),r=ae();if(!r||!o)return null;const i=0,u=r.compute(Q.char[n]).val,d=r.compute(Q.char.ascension).val;return e(fe,{fullWidth:!0,title:h("span",{children:[a("lv")," ",u]}),color:"primary",...s,children:pt(1,cn[d]).map(c=>e(se,{selected:o[n]===c,disabled:o[n]===c,onClick:()=>t(c),children:h("span",{children:[a("lv")," ",c+i]})},c))})}const Ma=0,ve=33,Rt=l.createContext(0);function Ta(){const{presetIndex:n}=l.useContext(ie),{team:t}=G(),s=l.useMemo(()=>t.frames[n]?[["combo",`Edit Combo ${n+1}`,e(Ra,{},"combo")],["char","Character",e(Ye,{},"char")],["talent","Talent",e(Sa,{},"talent")],["relicCond","Relic Conditionals",e(va,{},"relicCond")],["lightConeCond","Light Cone Conditionals",e(pa,{},"lightConeCond")],["opt","Optimize",e(Ia,{},"opt")]]:[["char","Character",e(Ye,{})]],[t,n]);return e(Rt.Provider,{value:s.length,children:e(N,{gap:1,children:s.map(([a,o,r],i)=>e(Ba,{title:o,index:i,children:r},a))})})}function Ba({index:n,title:t,children:s}){const[a,o]=Wn(),r=l.useContext(Rt),i=l.useContext(Tt);return h(he,{children:[e(M,{sx:u=>({outline:`solid ${u.palette.secondary.main}`,position:"sticky",top:i+n*ve,bottom:Ma+(r-1-n)*ve,zIndex:100}),children:e(oe,{onClick:o,sx:{px:1},children:e(k,{variant:"h6",children:t})})}),e(f,{ref:a,sx:{scrollMarginTop:i+(n+1)*ve},children:s})]})}function Ra(){const{database:n}=S(),{presetIndex:t,setPresetIndex:s}=l.useContext(ie),{team:a,teamId:o}=G(),r=l.useMemo(()=>a.frames[t],[a,t]),i=d=>{n.teams.set(o,c=>{c.frames=[...c.frames],c.frames[t]={...c.frames[t],...d},c.frames.length?c.frames.length<=t&&s(c.frames.length-1):s(0)})},u=()=>{n.teams.set(o,d=>{d.frames=d.frames.filter((c,p)=>p!==t)})};return r?h(f,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(pe,{value:r.multiplier,onChange:d=>i({multiplier:d}),size:"small",InputProps:{startAdornment:e(we,{position:"start",children:"Multi x "})}}),e(ft,{optTarget:r.tag,setOptTarget:d=>i({tag:d})}),e(O,{size:"small",color:"error",onClick:u,startIcon:e(gs,{}),children:"Remove"})]}):null}function Ye(){const n=Ee(),{key:t}=n,[s,a]=l.useState(void 0);return h(N,{spacing:1,children:[h(f,{sx:{display:"flex",gap:1},children:[h(f,{sx:{minWidth:"350px"},children:[e(os,{character:n}),e(rs,{characterKey:s,onClose:()=>a(void 0)}),e(O,{fullWidth:!0,disabled:!t,onClick:()=>t&&a(t),children:"Edit Character"})]}),e(Ea,{})]}),e(Qs,{}),e(Gn,{formulasRead:Q.listing.formulas,buffsRead:Q.listing.buffs})]})}function Ia(){const{buildType:n}=R();return n==="tc"?null:e(ga,{})}function Ea(){const n=R(),{database:t}=S(),{buildType:s,buildId:a,buildTcId:o}=n,[r,i]=Se(),u=l.useMemo(()=>r&&t.teams.getActiveBuildName(n),[t.teams,r,n]);l.useEffect(()=>{let m=()=>{};return s==="real"&&(m=t.builds.follow(a,i)),s==="tc"&&(m=t.buildTcs.follow(o,i)),()=>m()},[a,o,s,t,i]);const[d,c,p]=J();return h(M,{sx:{width:"100%"},children:[e(Da,{show:d,onClose:p}),e(A,{title:u,action:e(O,{onClick:c,size:"small",children:"Change Build"})}),e(B,{}),e(E,{children:s==="tc"?e(Pa,{}):e(wa,{})})]})}function wa(){const n=R(),{database:t}=S(),{relicIds:s,lightConeId:a}=l.useMemo(()=>t.teams.getTeamActiveBuild(n),[t.teams,n]);return e(me,{relicIds:s,lightConeId:a})}function Pa(){const n=R();return n.buildType!=="tc"?null:e(Bt,{buildTcId:n.buildTcId})}function Da({show:n,onClose:t}){return e(U,{open:n,onClose:t,containerProps:{maxWidth:"xl"},children:e(sa,{onClose:t})})}const za=e(mt,{variant:"rectangular",width:"100%",height:1e3});function Za(){const{database:n}=S(),{teamId:t}=ln(),s=!t||!n.teams.keys.includes(t);return l.useEffect(()=>{s||n.teams.set(t,{lastEdit:Date.now()})},[t,n.teams,s]),s?e(dn,{to:"/teams"}):e(f,{display:"flex",flexDirection:"column",gap:1,children:e(l.Suspense,{fallback:za,children:t&&e(_a,{teamId:t})})})}function _a({teamId:n}){const t=it(),{database:s}=S(),[a,o]=l.useState(0),r=l.useMemo(()=>({presetIndex:a,setPresetIndex:o}),[a,o]),i=re(n),{teamMetadata:u}=i,{params:{characterKey:d}}=un({path:"/teams/:teamId/:characterKey",end:!1})??{params:{}},c=l.useMemo(()=>{const C=u.findIndex(x=>x&&x.characterKey===d);return C===-1?0:C},[u,d]),p=l.useMemo(()=>u[c],[u,c]),m=p==null?void 0:p.characterKey;l.useEffect(()=>{m&&m!==d&&t(`${m}`,{replace:!0})},[m,d,p,t]);const{t:v}=V(["charNames_gen","page_character"]);Vn(l.useMemo(()=>{const C=v(m?"charNames_gen:Character":"Team Settings");return`${i.name} - ${C}`},[m,v,i.name]));const g=l.useMemo(()=>({teamId:n,team:i}),[i,n]),b=l.useMemo(()=>{const C=i.teamMetadata.filter(ot).map(({characterKey:y})=>y);m&&hn(C,m);const x=ht(C,y=>e(ss,{genderedKey:bt(y)}));return{srcDisplay:x,dstDisplay:x}},[i.teamMetadata,m]),w=l.useMemo(()=>i.conditionals.map(({sheet:C,src:x,dst:y,condKey:F,condValues:L})=>({sheet:C,src:x,dst:y,condKey:F,condValue:L[a]})),[a,i.conditionals]),T=l.useCallback((C,x,y,F,L)=>{!pn(C)||!qe(y)||!(F===null||qe(F))||!mn(C,x)||s.teams.setConditional(n,C,x,y,F,L,a)},[s.teams,a,n]),j=l.useMemo(()=>({src:m,dst:m,preset:`preset${a}`}),[m,a]),[P,D]=l.useState(),z=l.useMemo(()=>({read:P,setRead:D}),[P]),{height:q,ref:_}=Un();return e(Ce.Provider,{value:g,children:e(es.Provider,{value:j,children:e(ie.Provider,{value:r,children:e(js,{teamId:n,children:e(Xn.Provider,{value:b,children:e(Jn.Provider,{value:w,children:e(Qn.Provider,{value:T,children:h(Ct.Provider,{value:z,children:[e(Yn,{}),h(f,{sx:{display:"flex",gap:1,flexDirection:"column",mx:1,mt:2},children:[e(Js,{headerRef:_,teamId:n,characterKey:m}),e(Tt.Provider,{value:(q||kt)+Mt,children:p&&e(St.Provider,{value:p,children:e(La,{})})})]})]})})})})})})})})}function La(){const{characterKey:n}=R(),t=xt(n);return t?e(Cn.Provider,{value:t,children:e(fn,{children:e(Ne,{path:":characterKey",children:e(Ne,{path:"*",index:!0,element:e(Ta,{})})})})}):e(mt,{variant:"rectangular",width:"100%",height:1e3})}export{Za as default};
