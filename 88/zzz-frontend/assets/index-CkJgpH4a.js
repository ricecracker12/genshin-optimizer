import{i as M,u as $,a as A,d as c,d1 as Y,j as e,C as H,e as l,f as O,G as u,T as P,B as K,h as E,R as Z,o as x,y as j,v as G,d2 as L,br as ee,d3 as ne,d4 as te,d5 as se,d6 as ie,d7 as le,bW as F,bj as ae,d8 as oe,d9 as ce,da as re,db as de,aC as _,dc as ge,bq as ue,dd as pe,z as he,de as ye,k as me,l as fe,b_ as we,m as Te,n as We,df as xe,cG as ke,c2 as Se,c3 as be,dg as Ce,S as Ie,dh as qe,di as ve,dj as V}from"./index-C9g8Eavs.js";const Q=["locked","unlocked"],Be=ae([...Q]);function De({numShowing:h,total:i,wengineIds:k}){const{t:r}=M(["page_wengine","ui"]),{database:a}=$(),S=A(a.displayWengine),{speciality:b,rarity:z,locked:y,showEquipped:d,showInventory:C,locations:m}=S,{lockedTotal:f,equippedTotal:w,locationTotal:I,wengineTotals:q,wengineRarityTotals:v}=c.useMemo(()=>{const s={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...pe,""],wengineTotals:[...ue],wengineRarityTotals:[...ge]};return Y(s,t=>a.wengines.entries.forEach(([T,g])=>{const o=g.location,B=g.lock?"locked":"unlocked",W=o?"equipped":"unequipped",D=_(g.key).type,p=_(g.key).rarity;t.lockedTotal[B].total++,t.equippedTotal[W].total++,t.locationTotal[o].total++,t.wengineTotals[D].total++,p&&t.wengineRarityTotals[p].total++,k.includes(T)&&(t.lockedTotal[B].current++,t.equippedTotal[W].current++,t.locationTotal[o].current++,t.wengineTotals[D].current++,p&&t.wengineRarityTotals[p].current++)}))},[a.wengines.entries,k]);return e(H,{children:l(O,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(u,{container:!0,children:[e(u,{item:!0,children:e(P,{variant:"h6",children:r("wengineFilterTitle")})}),e(u,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:l(P,{children:[e("strong",{children:h})," / ",i]})}),e(u,{item:!0,children:e(K,{size:"small",color:"error",onClick:()=>a.displayWengine.set({action:"reset"}),startIcon:e(Z,{}),children:e(E,{t:r,i18nKey:"ui:reset"})})})]}),e(x,{children:l(u,{container:!0,spacing:1,children:[l(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(E,{t:r,i18nKey:"subheadings.general"}),l(j,{spacing:1,children:[e(G,{sx:{bgcolor:L.palette.contentNormal.light}}),e(ee,{fullWidth:!0,onChange:s=>a.displayWengine.set({speciality:s}),value:b,totals:q,size:"small"}),e(ne,{sx:{height:"100%"},fullWidth:!0,onChange:s=>a.displayWengine.set({rarity:s}),value:z,totals:v,size:"small"})]})]}),e(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:l(x,{children:[e(E,{t:r,i18nKey:"subheadings.inventory"}),l(j,{spacing:1,children:[e(G,{sx:{bgcolor:L.palette.contentNormal.light}}),e(te,{fullWidth:!0,value:y,size:"small",children:Q.map((s,t)=>l(se,{value:s,sx:{display:"flex",gap:1},onClick:()=>a.displayWengine.set({locked:Be(y,s)}),children:[t?e(ie,{}):e(le,{}),e(E,{t:r,i18nKey:`ui:${s}`}),e(F,{label:f[t?"unlocked":"locked"],size:"small"})]},s))}),l(K,{startIcon:e(oe,{}),color:C?"success":"secondary",onClick:()=>a.displayWengine.set({showInventory:!C}),children:[r("wengineInInv")," ",e(F,{sx:{ml:1},label:w.unequipped,size:"small"})]}),l(K,{startIcon:e(ce,{}),color:d?"success":"secondary",onClick:()=>a.displayWengine.set({showEquipped:!d}),children:[r("equippedWengine")," ",e(F,{sx:{ml:1},label:w.equipped,size:"small"})]})]}),e(j,{spacing:1.5,pt:1.5,children:e(c.Suspense,{fallback:null,children:e(re,{title:d?r("locationsTooltip"):"",placement:"top",children:e("span",{children:e(de,{totals:I,locations:d?[]:m,setLocations:s=>a.displayWengine.set({locations:s}),disabled:d})})})})})]})})]})})]})})}const Ee={xs:2,sm:3,md:4,lg:4,xl:6},Ke={xs:10,sm:12,md:24,lg:24,xl:24},ze=Object.keys(V);function je(){const{t:h}=M(["page_wengine","ui"]),{database:i}=$(),[k,r,a]=he(!1),S=A(i.displayWengine),[b,z]=c.useState(""),y=c.useDeferredValue(b),d=c.useCallback(n=>{i.displayWengine.set({editWengineId:n})},[i]),C=c.useCallback(n=>{d(i.wengines.new(ye(n)))},[i.wengines,d]),{sortType:m,ascending:f,speciality:w,rarity:I,locked:q,showEquipped:v,showInventory:s,locations:t}=S,T=me(i.wengines),g=T.length,o=c.useMemo(()=>T.filter(fe({speciality:w,rarity:I,name:y,locked:q,showInventory:s,showEquipped:v,locations:t},qe())).sort(we(V[m]??[],f,ve())).map(n=>n.id),[T,w,I,y,q,s,v,t,m,f]),B=Te(),{numShow:W,setTriggerElement:D}=We(Ke[B],o.length),p=c.useMemo(()=>o.slice(0,W),[o,W]),N=c.useCallback(()=>i.displayWengine.set({editWengineId:""}),[i]),{editWengineId:R}=S;R&&!i.wengines.get(R)&&N();const U=o.length!==g?`${o.length}/${g}`:`${g}`,J={numShowing:p.length,total:U,t:h,namespace:"page_wengine"},X={sortKeys:[...ze],value:m,onChange:n=>i.displayWengine.set({sortType:n}),ascending:f,onChangeAsc:n=>i.displayWengine.set({ascending:n})};return l(x,{display:"flex",flexDirection:"column",gap:1,children:[e(c.Suspense,{fallback:!1,children:e(xe,{show:k,onHide:a,onSelect:C})}),e(c.Suspense,{fallback:!1,children:e(ke,{wengineId:R,footer:!0,onClose:N})}),e(De,{numShowing:o.length,total:g,wengineIds:o}),e(H,{children:e(O,{sx:{display:"flex",flexDirection:"column",gap:1},children:l(x,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Se,{autoFocus:!0,size:"small",value:b,onChange:n=>z(n.target.value),label:h("wengineName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(be,{showingTextProps:J,sortByButtonProps:X})]})})}),e(K,{fullWidth:!0,onClick:r,color:"info",children:h("page_wengine:addWengine")}),e(x,{children:e(u,{container:!0,spacing:1,columns:Ee,children:p.map(n=>e(u,{item:!0,xs:1,children:e(Ce,{wengineId:n,onEdit:d},n)},n))})}),o.length!==p.length&&e(Ie,{ref:n=>{n&&D(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{je as default};
