import{a6 as W,c as z,j as N,n as I,r as m,a7 as R,a8 as E,p as e,q as l,B as f,I as V,T as v,a9 as _,N as M,x as D,y as w,z as P,A as L,aa as $,W as j,ab as F,a2 as G,ac as U,ad as H,a5 as q}from"./index-Dq7K87O4.js";import{P as O}from"./UploadCard-DkhGrTPn.js";import{C as K,u as A,G as k}from"./ReadOnlyTextArea-DfiHS2Pl.js";import{g as Q,L as J,u as X}from"./LightConeTrans-DXAAkUgP.js";import{L as Y}from"./LightConeEditorCard-C_hZwKlg.js";import{D as B}from"./BusinessCenter-BsSOUp0Z.js";import{a as Z,l as ee,b as te,u as ne}from"./StatDisplay-B5Mznv4n.js";import{u as oe,a as ae}from"./useMediaQueryUp-DvO4XD0f.js";import{L as se,a as ie,b as re,E as le,A as ce}from"./Add-CA2t_iIC.js";import{L as he}from"./LocationAutocomplete-kK1h_dkG.js";import"./CardHeader-DyzaA05X.js";function de(t,i,c,h=[]){return(n,r)=>{for(const p of t){let g=0;const a=c[p],o=a(n),s=a(r);if(typeof o=="string"&&typeof s=="string"?g=o.localeCompare(s):g=s-o,g!==0)return h.includes(p)?g:1*g}return 0}}const pe=["level","name","rarity"];function ge(){return{level:t=>t.level*(t.ascension+1),name:t=>`lightConeNames_gen:${t.key}`,rarity:t=>W.lightCone[t.key].rarity}}const me={name:["name"],level:["level","rarity","name"],rarity:["rarity","level","name"]},ue=z(N.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),fe=z(N.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function xe({lightCone:t,onClick:i,onEdit:c,onDelete:h,onLockToggle:n,canEquip:r=!1,setLocation:p,extraButtons:g}){const{t:a}=I(["lightCone","lightCones_gen","common_gen"]),{key:o,level:s,ascension:x,superimpose:u,location:C="",lock:y}=t,S=m.useMemo(()=>R(E(o,s,x,u)),[x,o,s,u]),d=Q(o);return e(m.Suspense,{fallback:e(L,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:l(P,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[l(f,{className:`grad-${d.rarity}star`,sx:{position:"relative",width:"100%"},children:[!i&&!!n&&e(V,{color:"primary",onClick:n,sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:y?e(se,{}):e(ie,{})}),l(f,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[l(f,{component:"div",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e(O,{iconProps:{fontSize:"inherit"},pathKey:d.path}),e(v,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1},children:e("strong",{children:e(J,{lcKey:o})})})]}),l(v,{component:"span",variant:"h5",children:[a("common_gen:lv")," ",s]}),l(v,{component:"span",variant:"h5",color:"text.secondary",children:["/",_[x]]}),l(v,{variant:"h6",children:[a("lightCones_gen:superimpose")," ",u]}),e(Z,{stars:d.rarity,colored:!0})]}),e(f,{sx:{height:"100%",position:"absolute",right:0,top:0},children:e(f,{component:M?M:"img",alt:"Light Cone Image",src:ee(o,"icon"),sx:{width:"auto",height:"90%",float:"right",marginBottom:"5%",marginTop:"5%",marginRight:"5%"}})})]}),e(K,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:["hp","atk","def"].map(b=>e(Ce,{calc:S,stat:b},b))}),l(f,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[e(f,{sx:{flexGrow:1},children:r&&p?e(he,{locKey:C,setLocKey:p,getOptionDisabled:b=>!b.key,disableClearable:!0}):e(re,{location:C})}),l(f,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[!!c&&e(D,{title:e(v,{children:a("edit")}),placement:"top",arrow:!0,children:e(w,{color:"info",size:"small",onClick:c,children:e(le,{})})}),!!h&&e(D,{title:y?a("cantDeleteLock"):"",placement:"top",children:e("span",{children:e(w,{color:"error",size:"small",onClick:h,disabled:!!C||y,sx:{top:"1px"},children:e(B,{})})})}),g]})]})]})})}function Ce({calc:t,stat:i}){return l(v,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(te,{statKey:i}),e("span",{children:t.compute($.base[i].with("sheet","lightCone")).val.toFixed()})]},i)}function ye({lightConeIdToEdit:t="",cancelEdit:i}){const{t:c}=I(["lightCone","common"]),{database:h}=j(),n=X(t==="new"?void 0:t),[r,p]=m.useState(void 0);A(n)!==n&&n&&p(structuredClone(n)),A(t)!==t&&t==="new"&&p({level:1,ascension:0,superimpose:1});const g=m.useCallback(u=>{p(C=>({...C,...u}))},[]),a=m.useCallback(()=>{i(),p(void 0)},[i]),o=m.useCallback(u=>{if(r!=null&&r.key&&!window.confirm(c("editor.clearPrompt"))){u==null||u.preventDefault();return}a()},[c,r,a]),s=m.useMemo(()=>F(r),[r]),x=m.useMemo(()=>l(f,{display:"flex",gap:2,children:[e(w,{startIcon:e(ue,{}),onClick:()=>{s&&h.lightCones.new(s),a()},disabled:!s,color:"primary",children:c("editor.btnAdd")}),s&&n&&e(w,{startIcon:e(fe,{}),onClick:()=>{s&&h.lightCones.set(n.id,s),a()},disabled:!s,color:"success",children:c("editor.btnUpdate")}),!!(n!=null&&n.id)&&e(w,{startIcon:e(B,{}),onClick:()=>{window.confirm(c("editor.confirmDelete"))&&(h.lightCones.remove(n.id),a())},disabled:!(n!=null&&n.id),color:"error",sx:{top:"2px"},children:c("common:delete")})]}),[a,h,n,c,s]);return e(m.Suspense,{fallback:!1,children:r&&e(G,{open:!!r,onClose:o,children:e(Y,{onClose:o,lightCone:r,setLightCone:g,footer:x})})})}const T={xs:1,sm:2,md:3,lg:3,xl:4},ve={xs:10,sm:12,md:24,lg:24,xl:24};function be({onAdd:t,onEdit:i}){const{t:c}=I("lightCone"),{database:h}=j(),n=()=>({sortType:pe[0],ascending:!1,rarity:[...H],path:[...U]}),{sortType:r,ascending:p}=n(),g=ne(h.lightCones),a=g.length,o=m.useMemo(()=>[...g].sort(de(me[r]??[],p,ge())).map(d=>d.id),[g,r,p]),s=oe(),x=o.length!==a?`${o.length}/${a}`:`${a}`,{numShow:u,setTriggerElement:C}=ae(ve[s],o.length),y=m.useMemo(()=>o.slice(0,u),[o,u]),S={numShowing:y.length,total:x};return l(q,{children:[e(P,{bgt:"dark",children:e(K,{children:e(f,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:l(v,{color:"text.secondary",children:["Showing ",e("b",{children:S.numShowing})," out of"," ",S.total," Items"]})})})}),e(k,{container:!0,columns:T,spacing:1,children:e(k,{item:!0,xs:!0,children:e(w,{fullWidth:!0,onClick:t,color:"info",startIcon:e(ce,{}),children:c("addNew")})})}),l(m.Suspense,{fallback:e(L,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:[e(k,{container:!0,columns:T,spacing:1,children:y.map(d=>e(k,{item:!0,xs:1,children:e(xe,{lightCone:h.lightCones.get(d),onEdit:()=>i==null?void 0:i(d),onDelete:()=>h.lightCones.remove(d),setLocation:b=>h.lightCones.set(d,{location:b}),canEquip:!0})},d))}),o.length!==y.length&&e(L,{ref:d=>{d&&C(d)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function Pe(){const[t,i]=m.useState("");return l(f,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(ye,{lightConeIdToEdit:t,cancelEdit:()=>i("")}),e(be,{onAdd:()=>i("new"),onEdit:i})]})}export{Pe as default};
