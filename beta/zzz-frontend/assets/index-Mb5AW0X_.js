var Zs=e=>{throw TypeError(e)};var Ys=(e,t,n)=>t.has(e)||Zs("Cannot "+n);var ke=(e,t,n)=>(Ys(e,t,"read from private field"),n?n.call(e):t.get(e)),Ae=(e,t,n)=>t.has(e)?Zs("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Y=(e,t,n,o)=>(Ys(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);import{z as Cn,E as Sn,c as g,H as Dn,J as kr,K as vr,_ as Mn,L as j,N as pc,O as Cr,P as Sr,Q as te,U as we,V as Bt,W as En,X as eo,Y as Dr,Z as Mr,$ as Er,a0 as Tr,j as s,a1 as Ir,h as he,a2 as Rr,a3 as to,a4 as hc,a5 as Ar,a6 as Ht,a7 as qr,a8 as mc,a9 as fc,aa as ue,ab as $n,ac as gc,ad as xs,ae as zr,i as Pr,u as P,af as Ds,ag as yc,ah as Vr,ai as Or,aj as jr,ak as xc,al as Wt,am as Nt,an as F,ao as Br,ap as Wr,aq as z,ar as wn,as as Nr,at as Kr,au as bc,av as _n,aw as Lr,r as Ms,a as Es,b as Ts,g as Is,ax as Ft,ay as Ke,az as Rs,aA as ge,d as y,p as Gt,I as De,q as Tn,e as V,C as B,aB as bs,s as ae,T as I,aC as de,M as As,aD as $e,aE as Hr,aF as Fr,n as E,aG as $c,aH as Gr,aI as Ur,aJ as Jr,aK as O,aL as se,aM as Xr,aN as Qr,F as Ut,aO as no,aP as so,aQ as kn,aR as Zr,aS as be,aT as We,aU as yn,aV as Yr,aW as el,aX as tl,aY as Kt,aZ as Ot,a_ as ye,a$ as oo,b0 as _,b1 as W,b2 as w,b3 as qs,b4 as nl,w as G,b5 as zs,b6 as D,b7 as v,b8 as wc,b9 as sl,ba as In,bb as ol,bc as io,bd as ao,be as il,bf as Ce,bg as _c,bh as al,bi as Ps,bj as kc,bk as vc,bl as pe,bm as Cc,bn as $s,bo as cl,bp as Sc,bq as Dc,br as rl,bs as Me,B as U,bt as J,bu as ll,bv as Mc,bw as Ec,bx as dl,by as Pe,bz as Rn,bA as ul,bB as pl,bC as hl,bD as ml,bE as Tc,bF as fl,bG as gl,bH as yl,bI as xl,bJ as bl,bK as $l,bL as co,bM as wl,bN as re,bO as ro,bP as _l,bQ as Vs,G as ne,bR as kl,bS as lo,x as Os,S as Ic,bT as vl,bU as uo,bV as Cl,bW as Sl,bX as Dl,bY as Ml,bZ as El,b_ as po,b$ as Tl,c0 as Rc,c1 as Ac,c2 as Il,c3 as qc,c4 as zc,c5 as Rl,c6 as Al,c7 as ql,c8 as zl,c9 as ho,ca as Pl,cb as Vl,cc as mo,cd as Ol,ce as jl,cf as Bl,cg as Wl,ch as Nl,ci as Kl,cj as Ll,ck as Hl}from"./index-CLywPHVD.js";import{u as Fl}from"./useDataEntryBase-89FTvLas.js";import{A as Ee,g as Pc,C as Gl,a as Ul,u as Jl,b as Xl,c as Ql}from"./CharacterEditor-DLbf4S77.js";import"./discSortUtil-DGDdw8GP.js";function Zl(e){return Cn("MuiCollapse",e)}Sn("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Yl=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],ed=e=>{const{orientation:t,classes:n}=e,o={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return En(o,Zl,n)},td=we("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.orientation],n.state==="entered"&&t.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>j({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&j({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),nd=we("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>j({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),sd=we("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>j({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),js=g.forwardRef(function(t,n){const o=Dn({props:t,name:"MuiCollapse"}),{addEndListener:i,children:r,className:a,collapsedSize:l="0px",component:d,easing:c,in:u,onEnter:p,onEntered:h,onEntering:m,onExit:b,onExited:x,onExiting:C,orientation:S="vertical",style:M,timeout:A=vr.standard,TransitionComponent:X=kr}=o,q=Mn(o,Yl),N=j({},o,{orientation:S,collapsedSize:l}),R=ed(N),H=pc(),oe=Cr(),Z=g.useRef(null),Q=g.useRef(),le=typeof l=="number"?`${l}px`:l,xe=S==="horizontal",_e=xe?"width":"height",an=g.useRef(null),fr=Sr(n,an),Re=T=>ie=>{if(T){const me=an.current;ie===void 0?T(me):T(me,ie)}},Yn=()=>Z.current?Z.current[xe?"clientWidth":"clientHeight"]:0,gr=Re((T,ie)=>{Z.current&&xe&&(Z.current.style.position="absolute"),T.style[_e]=le,p&&p(T,ie)}),yr=Re((T,ie)=>{const me=Yn();Z.current&&xe&&(Z.current.style.position="");const{duration:qt,easing:cn}=eo({style:M,timeout:A,easing:c},{mode:"enter"});if(A==="auto"){const Qs=H.transitions.getAutoHeightDuration(me);T.style.transitionDuration=`${Qs}ms`,Q.current=Qs}else T.style.transitionDuration=typeof qt=="string"?qt:`${qt}ms`;T.style[_e]=`${me}px`,T.style.transitionTimingFunction=cn,m&&m(T,ie)}),xr=Re((T,ie)=>{T.style[_e]="auto",h&&h(T,ie)}),br=Re(T=>{T.style[_e]=`${Yn()}px`,b&&b(T)}),$r=Re(x),wr=Re(T=>{const ie=Yn(),{duration:me,easing:qt}=eo({style:M,timeout:A,easing:c},{mode:"exit"});if(A==="auto"){const cn=H.transitions.getAutoHeightDuration(ie);T.style.transitionDuration=`${cn}ms`,Q.current=cn}else T.style.transitionDuration=typeof me=="string"?me:`${me}ms`;T.style[_e]=le,T.style.transitionTimingFunction=qt,C&&C(T)}),_r=T=>{A==="auto"&&oe.start(Q.current||0,T),i&&i(an.current,T)};return te.jsx(X,j({in:u,onEnter:gr,onEntered:xr,onEntering:yr,onExit:br,onExited:$r,onExiting:wr,addEndListener:_r,nodeRef:an,timeout:A==="auto"?null:A},q,{children:(T,ie)=>te.jsx(td,j({as:d,className:Bt(R.root,a,{entered:R.entered,exited:!u&&le==="0px"&&R.hidden}[T]),style:j({[xe?"minWidth":"minHeight"]:le},M),ref:fr},ie,{ownerState:j({},N,{state:T}),children:te.jsx(nd,{ownerState:j({},N,{state:T}),className:R.wrapper,ref:Z,children:te.jsx(sd,{ownerState:j({},N,{state:T}),className:R.wrapperInner,children:r})})}))}))});js.muiSupportAuto=!0;const Vc=g.createContext({});function od(e){return Cn("MuiAccordion",e)}const rn=Sn("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),id=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],ad=e=>{const{classes:t,square:n,expanded:o,disabled:i,disableGutters:r}=e;return En({root:["root",!n&&"rounded",o&&"expanded",i&&"disabled",!r&&"gutters"],region:["region"]},od,t)},cd=we(Er,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${rn.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${rn.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${rn.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${rn.expanded}`]:{margin:"16px 0"}}}]})),ln=g.forwardRef(function(t,n){const o=Dn({props:t,name:"MuiAccordion"}),{children:i,className:r,defaultExpanded:a=!1,disabled:l=!1,disableGutters:d=!1,expanded:c,onChange:u,square:p=!1,slots:h={},slotProps:m={},TransitionComponent:b,TransitionProps:x}=o,C=Mn(o,id),[S,M]=Dr({controlled:c,default:a,name:"Accordion",state:"expanded"}),A=g.useCallback(xe=>{M(!S),u&&u(xe,!S)},[S,u,M]),[X,...q]=g.Children.toArray(i),N=g.useMemo(()=>({expanded:S,disabled:l,disableGutters:d,toggle:A}),[S,l,d,A]),R=j({},o,{square:p,disabled:l,disableGutters:d,expanded:S}),H=ad(R),oe=j({transition:b},h),Z=j({transition:x},m),[Q,le]=Mr("transition",{elementType:js,externalForwardedProps:{slots:oe,slotProps:Z},ownerState:R});return te.jsxs(cd,j({className:Bt(H.root,r),ref:n,ownerState:R,square:p},C,{children:[te.jsx(Vc.Provider,{value:N,children:X}),te.jsx(Q,j({in:S,timeout:"auto"},le,{children:te.jsx("div",{"aria-labelledby":X.props.id,id:X.props["aria-controls"],role:"region",className:H.region,children:q})}))]}))});function rd(e){return Cn("MuiAccordionDetails",e)}Sn("MuiAccordionDetails",["root"]);const ld=["className"],dd=e=>{const{classes:t}=e;return En({root:["root"]},rd,t)},ud=we("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),dn=g.forwardRef(function(t,n){const o=Dn({props:t,name:"MuiAccordionDetails"}),{className:i}=o,r=Mn(o,ld),a=o,l=dd(a);return te.jsx(ud,j({className:Bt(l.root,i),ref:n,ownerState:a},r))});function pd(e){return Cn("MuiAccordionSummary",e)}const ze=Sn("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),hd=["children","className","expandIcon","focusVisibleClassName","onClick"],md=e=>{const{classes:t,expanded:n,disabled:o,disableGutters:i}=e;return En({root:["root",n&&"expanded",o&&"disabled",!i&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!i&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},pd,t)},fd=we(Tr,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${ze.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${ze.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${ze.disabled})`]:{cursor:"pointer"},variants:[{props:n=>!n.disableGutters,style:{[`&.${ze.expanded}`]:{minHeight:64}}}]}}),gd=we("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${ze.expanded}`]:{margin:"20px 0"}}}]})),yd=we("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${ze.expanded}`]:{transform:"rotate(180deg)"}})),un=g.forwardRef(function(t,n){const o=Dn({props:t,name:"MuiAccordionSummary"}),{children:i,className:r,expandIcon:a,focusVisibleClassName:l,onClick:d}=o,c=Mn(o,hd),{disabled:u=!1,disableGutters:p,expanded:h,toggle:m}=g.useContext(Vc),b=S=>{m&&m(S),d&&d(S)},x=j({},o,{expanded:h,disabled:u,disableGutters:p}),C=md(x);return te.jsxs(fd,j({focusRipple:!1,disableRipple:!0,disabled:u,component:"div","aria-expanded":h,className:Bt(C.root,r),focusVisibleClassName:Bt(C.focusVisible,l),onClick:b,ref:n,ownerState:x},c,{children:[te.jsx(gd,{className:C.content,ownerState:x,children:i}),a&&te.jsx(yd,{className:C.expandIconWrapper,ownerState:x,children:a})]}))});function xd({value:e,onChange:t,...n}){const[o,i]=g.useState(e);g.useEffect(()=>{i(e)},[e]);const r=()=>t(o);return s(Ir,{value:o,onChange:a=>i(a.target.value),onBlur:r,onKeyDown:a=>a.key==="Enter"&&!n.multiline&&r(),...n})}function bd(){const e=g.useRef(),t=g.useCallback(()=>{var n;return(n=e.current)==null?void 0:n.scrollIntoView({behavior:"smooth"})},[e]);return[e,t]}function $d(e){const{t}=he("ui"),n=Rr({path:"/:page/*"}),o=t("pageTitle"),i=e??((n==null?void 0:n.params.page)&&t(`tabs.${n==null?void 0:n.params.page}`));g.useEffect(()=>{i?document.title=`${i} - ${o}`:document.title=o},[t,o,i])}const Bs={};class Oc{constructor(){this.internal=new wd}ref(t){return t.reduce((n,o)=>n.get(o),this.internal)}*[Symbol.iterator](){for(const[t,n]of this.internal.entries([]))"value"in n&&(yield[[...t],n.value])}*values(){for(const t of this.internal.allRefs())"value"in t&&(yield t.value)}}let wd=class jc{constructor(){this.map=new Map}get(t){const n=this.map.get(t);if(n)return n;const o=new jc;return this.map.set(t,o),o}*allRefs(){for(const t of this.map.values())yield*t.allRefs();yield this}*entries(t){const n=t.push(void 0)-1;for(const[o,i]of this.map.entries())t[n]=o,yield*i.entries(t);t.pop(),yield[t,this]}};class Bc{constructor(t,n){this.root=new _d(t,n)}subset(t){const n=[];return this._subset(t,o=>n.push(...o[to].map(i=>i.value))),n}entries(t){const n=[];return this._subset(t,o=>n.push(...o[to])),n}_subset(t,n){const o=t.length;function i(r,a){r<o?a.subset(t[r]).forEach(l=>i(r+1,l)):n(a.leaf)}i(0,this.root)}}let _d=class Wc{constructor(t,n){if(this.children=[],t>0)for(const[o,i]of Object.entries(n)){const r=new Map;for(const[a,l]of Object.entries(i))r.set(+a,new Wc(t-1,l));this.children.push({mask:+o,map:r})}else this.leaf=n}subset(t){return this.children.map(({mask:n,map:o})=>o.get(t&n)).filter(n=>!!n)}};class ws{constructor(t){this.root=new Ws(void 0),this.keys=t}at(t){const n=this.keys.get(t),o=n.reduce((i,r)=>i.child(r),this.root);return o.leaf||(o.leaf=new Ns(t,n,this.keys,o)),o.leaf}}class Ws{constructor(t){this.children=new Map,this.parent=t}child(t){let n=this.children.get(t);return n||(n=new Ws(this),this.children.set(t,n),n)}}class Ns{constructor(t,n,o,i){this.tag=Object.fromEntries(Object.entries(t).filter(([r,a])=>a!=null)),this.id=n,this.keys=o,this.internal=i}with(t){const{keys:n}=this,{id:o,firstReplacedByte:i}=n.combine(this.id,t);let r=this.internal;for(let a=i;a<n.tagLen;a++)r=r.parent;for(let a=i;a<n.tagLen;a++)r=r.child(o[a]);return r.leaf||(r.leaf=new Ns({...this.tag,...t},o,n,r)),r.leaf}}class kd{constructor(t,n){this.keys=new hc(t),this.values=new Bc(t.tagLen,n)}subset(t){return this.values.subset(this.keys.get(t))}}const Ne={sum:e=>e.reduce((t,n)=>t+n,0),prod:e=>e.reduce((t,n)=>t*n,1),min:e=>Math.min(...e),max:e=>Math.max(...e),sumfrac:([e,t])=>e/(e+t),unique:([e])=>e},Ks={match:([e,t])=>e===t?0:1,thres:([e,t])=>e>=t?0:1,lookup:([e],t)=>t[e]??0},pn=e=>qr(e,"val");let Nc=class{constructor(t,...n){const o=new hc(t);this.nodes=new Bc(o.tagLen,Ar(n)),this.cache=new ws(o).at({}),this.calc=new ws(o).at({}),this.calc.val=this}withTag(t){const n=this.calc.with(t);return n.val??(n.val=Object.assign(new this.constructor(this.cache.keys),this,{cache:this.cache.with(t),calc:n}))}gather(t){return this._gather(this.cache.with(t)).pre}compute(t){return this._compute(t,this.cache)}_gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre:[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){const o=(r,a,l,d)=>Object.freeze({val:r,meta:this.computeMeta(t,r,a,l,d)}),{op:i}=t;switch(i){case"const":return o(t.ex,[],[]);case"sum":case"prod":case"min":case"max":case"sumfrac":{const r=t.x.map(a=>this._compute(a,n));return o(Ne[i](pn(r)),r,[])}case"thres":case"match":case"lookup":{const r=t.br.map(c=>this._compute(c,n)),a=Ks[i](pn(r),t.ex),l=[...Array(t.x.length)],d=l[a]=this._compute(t.x[a],n);return o(d.val,l,r)}case"subscript":{const r=this._compute(t.br[0],n);return o(t.ex[r.val],[],[r])}case"vtag":return o(n.tag[t.ex]??"",[],[]);case"tag":{const r=n.with(t.tag),a=this._compute(t.x[0],r);return o(a.val,[a],[],r.tag)}case"dtag":{const r=t.br.map(d=>this._compute(d,n)),a=n.with(Object.fromEntries(r.map((d,c)=>[t.ex[c],d.val]))),l=this._compute(t.x[0],a);return o(l.val,[l],r,a.tag)}case"read":{const r=n.with(t.tag),a=this._gather(r),{pre:l}=a,d=t.ex??this.defaultAccu(r.tag)??"unique";if(d!==t.ex&&(t={...t,ex:d}),a[d])return a[d];if(mc()&&d==="unique"&&l.length!==1)throw new Error(`Ill-form read for ${fc(r.tag)}`);const c=Ne[d](pn(l));return a[d]=o(c,l,[],r.tag)}case"custom":{const r=t.x.map(a=>this._compute(a,n));return o(Bs[t.ex].calc(pn(r)),r,[])}default:Ht(i)}}defaultAccu(t){}markGathered(t,n,o,i){return i}computeMeta(t,n,o,i,r){}toDebug(){throw new Error("not implemented")}};function vd(e,t,n){function o(a,l){if(a.val)return a.val;const d=n(a.tag);return a.val=d?[$n(d,l)]:t.nodes.subset(a.id).flatMap(c=>c.op!=="reread"?r(c,a):o(a.with(c.tag),l)),a.val}function i(a,l){return a.every(d=>d.op==="const")?ue(Ne[l](a.map(d=>d.ex))):{op:l,x:a,br:[]}}function r(a,l){const{op:d}=a;switch(d){case"const":return a;case"read":{const c=l.with(a.tag),u=a.ex??t.defaultAccu(c.tag)??"unique",p=o(c,u);return u==="unique"?p[0]??ue(void 0):i(p,u)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const c=a.x.map(u=>r(u,l));return i(c,d)}case"thres":case"match":case"lookup":{const c=a.br.map(u=>r(u,l));if(c.every(u=>u.op==="const")){const u=c.map(h=>h.ex),p=Ks[a.op](u,a.ex);return r(a.x[p],l)}return{...a,x:a.x.map(u=>r(u,l)),br:c}}case"subscript":{const c=r(a.br[0],l);return c.op==="const"?ue(a.ex[c.ex]):{...a,br:[c]}}case"vtag":return ue(l.tag[a.ex]??"");case"tag":return r(a.x[0],l.with(a.tag));case"dtag":{const c=a.br.map(p=>r(p,l));if(c.some(p=>p.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const u=l.with(Object.fromEntries(c.map((p,h)=>[a.ex[h],p.ex])));return r(a.x[0],u)}case"custom":return{...a,x:a.x.map(c=>r(c,l))};default:Ht(d)}}return e.map(a=>r(a,new ws(t.cache.keys).at({})))}function Jt(e,t){const n=new Map;function o(i){const r=n.get(i);if(r)return r;const a=i,l=es(i.x,o),d=es(i.br,o);(i.x!==l||i.br!==d)&&(i={...i,x:l,br:d});const c=t(i,a);return n.set(i,c),c}return es(e,o)}function _s(e,t){const n=new Set;function o(i){n.has(i)||(t(i,o),n.add(i))}e.forEach(o)}function es(e,t){const n=e.map(t);return e.every((o,i)=>o===n[i])?e:n}const Ls={arithmetic:Ne,branching:Ks};class Cd extends Nc{constructor(t,n=fc,o=()=>!0){super(t.cache.keys),this.gathering=new Set,this.nodes=t.nodes,this.tagStr=n,this.filter=o,this.defaultAccu=i=>t.defaultAccu(i),this.cache=this.cache.with(t.cache.tag)}withTag(t){throw new Error("Unimplemented")}_gather(t){if(this.gathering.has(t))throw new Error(`Loop detected for ${this.tagStr(t.tag)}`);this.gathering.add(t);const n=this.__gather(t);return this.gathering.delete(t),n}__gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre.map(r=>{const a=`${this.tagStr(o)} <= ${this.tagStr(i.tag)} : ${r.meta.readSeq}`;return Object.freeze({...r,meta:{...r.meta,readSeq:a}})}):[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){try{return super._compute(t,n)}catch(o){return Object.freeze({val:NaN,meta:{formula:`${o}`,deps:[],omitted:[],val:NaN,x:[],br:[],comp:"ERR",pivot:!0,toJSON:go}})}}markGathered(t,n,o,i){const r=`${this.tagStr(n)} <- ${this.tagStr(t)}`;return{...i,meta:{...i.meta,readSeq:r,pivot:!0}}}computeMeta(t,n,o,i,r){let a,l;const d=o.filter(m=>m).map(m=>m.meta),c=i.map(m=>m.meta),u=[],p=t.op==="read"?t.ex:t.op,h=[];if(p in Ne){const m=Ne[p]([]);for(const b of[...c,...d])b.val!==m||this.filter(b)?u.push(b):h.push(b)}else u.push(...c,...d);switch(t.op){case"const":a=fo(t.ex);break;case"read":l=`gather ${d.length} node(s)`,l+=` matching ${this.tagStr(r,t.ex)}`,l+=` (for ${this.tagStr(t.tag)})`,h.length&&(l+=` <${h.length} omitted>`),a=`${this.tagStr(t.tag)}`;break;default:{const m=[];t.ex&&t.op!=="subscript"&&m.push(JSON.stringify(t.ex)),t.tag&&m.push(this.tagStr(t.tag)),m.push(...u.map(b=>b.comp)),h.length&&m.push(`<${h.length} omitted>`),a=`${t.op}(`+m.join(", ")+")"}}return h.push(...u.flatMap(m=>m.pivot?[]:m.omitted)),Object.freeze({formula:`[${fo(n)}] ${l??a}`,deps:[...new Set(u.flatMap(m=>m.pivot?[m]:m.deps))],omitted:[...new Set(h)],val:n,x:d,br:c,comp:a,pivot:t.op==="read",toJSON:go})}}const fo=e=>typeof e=="string"?`"${e}"`:e.toString();function go(){const{formula:e,readSeq:t,deps:n}=this,o={readSeq:t,formula:e,deps:n};return o.readSeq||delete o.readSeq,o.deps.length||delete o.deps,Object.keys(o).length===1?o.formula:o}const{arithmetic:yo}=Ls;function Sd(e){return e=Dd(e),e=Md(e),e=Ed(e),e}function Dd(e){return Jt(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":if(t.x.length===1)return t.x[0];if(t.x.some(o=>o.op===n)){const o=t.x.flatMap(i=>i.op===n?i.x:[i]);return{...t,x:o}}}return t})}function Md(e){return Jt(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":{const o=t.x.filter(i=>i.op==="const");if(o.length>1){const i=t.x.filter(a=>a.op!=="const"),r=yo[n](o.map(a=>a.ex));return r===yo[n]([])?{...t,x:i}:{...t,x:[ue(r),...i]}}}}return t})}function Ed(e){const t=new Map,n=new Oc;return Jt(e,o=>{const{op:i}=o,r=o.x.map(c=>t.get(c)),a=o.br.map(c=>t.get(c));let l;switch(i){case"read":{const c=Object.keys(o.tag).sort();l=[i,o.ex,...c,...c.map(u=>o.tag[u])];break}case"sum":case"prod":case"min":case"max":l=[i,...r.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":l=[i,o.ex,...r,...a];break;case"match":l=[i,o.ex,...r,...a.sort()];break;default:Ht(i)}const d=n.ref(l);return"value"in d?d.value:(d.value=o,t.set(o,t.size),o)})}const{arithmetic:Td,branching:Id}=Ls;function Rd(e,t,n,o,i){const r=new Ad(e,o,t,n);for(;r.progress;)r.progress=!1,qd(r),zd(r,1),Vd(r),Pd(r,i);return r.nodes=Sd(r.nodes),r}var Se,Ve,Oe,je,Be;class Ad{constructor(t,n,o,i){Ae(this,Se);Ae(this,Ve);Ae(this,Oe);Ae(this,je);Ae(this,Be);this.progress=!0,Y(this,Se,t),this.minimum=n,Y(this,Ve,o),this.cat=i}get nodes(){return ke(this,Se)}set nodes(t){ke(this,Se)!==t&&(this.progress=!0,Y(this,Se,t),Y(this,je,Y(this,Be,void 0)))}get candidates(){return ke(this,Ve)}set candidates(t){this.candidates!==t&&(this.progress=!0,Y(this,Ve,t),Y(this,Oe,Y(this,je,Y(this,Be,void 0))))}get cndRanges(){return ke(this,Oe)??Y(this,Oe,this.candidates.map(ks))}set cndRanges(t){Y(this,Oe,t)}get nodeRanges(){return ke(this,je)??Y(this,je,Kc(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return ke(this,Be)??Y(this,Be,Od(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}Se=new WeakMap,Ve=new WeakMap,Oe=new WeakMap,je=new WeakMap,Be=new WeakMap;function qd(e){const{nodes:t,nodeRanges:n}=e,o=Jt(t,(i,r)=>{const a=n.get(r);if(a.min===a.max)return r.op==="const"?i:ue(a.min);switch(r.op){case"thres":{const[l,d]=r.br.map(c=>n.get(c));if(l.min>=d.max)return i.x[0];if(l.max<d.min)return i.x[1];break}case"min":{const l=i.x.filter((d,c)=>n.get(r.x[c]).min<=a.max);if(l.length===1)return l[0];if(l.length!==i.x.length)return zr(...l);break}case"max":{const l=i.x.filter((d,c)=>n.get(r.x[c]).max>=a.min);if(l.length===1)return l[0];if(l.length!==i.x.length)return xs(...l);break}case"match":case"lookup":if(i.br.every(l=>l.op==="const")){const l=i.br.map(d=>d.ex);return i.x[Id[r.op](l,r.ex)]}break;case"subscript":if(i.br[0].op==="const")return ue(i.ex[i.br[0].ex]);break}return i});e.nodes=o}function zd(e,t){const{nodeRanges:n,minimum:o,cat:i}=e,r=[...e.candidates],a=[...e.cndRanges],l=[],d=[];let c=!1;if(e.nodes.forEach((p,h)=>{if(h<o.length){if(o[h]>n.get(p).min)c=!0;else if(h>=t)return;d.push(o[h])}l.push(p)}),d.length!=o.length&&(e.nodes=l,e.minimum=d),!c)return;let u=!1;r.forEach((p,h)=>{const m=a[h],b=p.filter(x=>{a[h]=ks([x]);const C=Kc(l,i,a);return d.every((S,M)=>C.get(l[M]).max>=S)});b.length!=p.length?(r[h]=b,a[h]=ks(b),u=!0):a[h]=m}),u&&(e.candidates=r,e.cndRanges=a)}function Pd(e,t){const n=[...e.monotonicities],o=e.candidates.map(c=>c.map(u=>{const p={incomp:[],inc:{},c:u};for(const[h,m]of n)m.inc?p.inc[h]=u[h]??0:m.dec?p.inc[h]=-(u[h]??0):p.incomp.push(u[h]??0);return p})),i=o[0][0];if(i===void 0)return;const r=Object.keys(i.inc),a=[...r].reverse(),l=!!i.incomp.length,d=o.map(c=>{const u=new Oc;return l?c.forEach(p=>{const h=u.ref(p.incomp);h.value?h.value.push(p):h.value=[p]}):u.ref([]).value=c,[...u.values()].flatMap(p=>(p.sort(({inc:h},{inc:m})=>{const b=a.find(x=>h[x]!==m[x]);return b===void 0?0:m[b]-h[b]}),p.filter(({inc:h},m)=>{let b=0;for(let x=0,C=m-t;x<=C+b;x++){const S=p[x].inc;if(r.every(M=>S[M]>=h[M])&&++b>=t)return!1}return!0})))});d.some((c,u)=>c.length!=e.candidates[u].length)&&(e.candidates=d.map(c=>c.map(u=>u.c)))}const fe=Symbol();function Vd(e){const{nodes:t,cat:n,candidates:o}=e,i=new Map;_s(t,(c,u)=>{if(c.x.forEach(u),c.br.forEach(u),c.br.length)return;const p=c.x.map(m=>i.get(m));if(p.some(m=>!m))return;let h;switch(c.op){case"sum":{h={[fe]:p.reduce((m,b)=>m+b[fe],0)};for(const m of p)for(const[b,x]of Object.entries(m))h[b]=(h[b]??0)+x;break}case"prod":{const m=c.x.findIndex(x=>x.op!=="const");if(c.x.find((x,C)=>x.op!=="const"&&C!==m))return;h=m!==-1?{...p[m]}:{[fe]:1};const b=p.reduce((x,C,S)=>S===m?x:x*C[fe],1);b!=1&&(Object.keys(h).forEach(x=>h[x]*=b),h[fe]*=b);break}case"read":h={[c.tag[n]]:1,[fe]:0};break;case"const":if(typeof c.ex!="number")return;h={[fe]:c.ex};break;default:return}i.set(c,h)});const r=new Map;if(_s(t,(c,u)=>{const p=i.get(c);p&&Object.keys(p).length?r.set(c,p):(c.x.forEach(u),c.br.forEach(u))}),![...r.keys()].some(c=>{if(c.op==="const"||c.op==="read")return!1;if(c.op==="sum"&&c.x.length===2){if(c.x[0].op==="const"&&c.x[1].op==="read")return!1;if(c.x[1].op==="const"&&c.x[0].op==="read")return!1}return!0}))return;let l=new Map([...r.values()].map(c=>{const u=Object.keys(c).sort();return u.length===1&&c[u[0]]===1?[c,u[0]]:[c,""+u.flatMap(p=>[p,c[p]]).join("")]}));if(!mc()){const c=new Map([...l.values()].map((u,p)=>[u,`c${p}`]));l=new Map([...l].map(([u,p])=>[u,c.get(p)]))}const d=new Map;for(const[c,u]of l){const p=$n({[n]:u});d.set(c,c[fe]!==0?gc(c[fe],p):p)}e.candidates=o.map(c=>c.map(u=>{const p={id:u.id};return l.forEach((h,m)=>{h in p||(p[h]=Object.entries(m).reduce((b,[x,C])=>b+(u[x]??0)*C,0))}),p})),e.nodes=Jt(t,(c,u)=>{const p=r.get(u);return p?d.get(p):c})}function ks(e){const t=e.values(),n=t.next().value;if(!n)return{};const o=Object.fromEntries(Object.entries(n).map(([i,r])=>[i,{min:r,max:r}]));for(const i of t){for(const[r,a]of Object.entries(o)){const l=i[r]??0;a.min>l&&(a.min=l),a.max<l&&(a.max=l)}for(const[r,a]of Object.entries(i))r in o||(o[r]={min:Math.min(0,a),max:Math.max(0,a)})}return o}function Kc(e,t,n){const o=new Map;return _s(e,(i,r)=>{i.x.forEach(r),i.br.forEach(r);const a=i.x.map(p=>o.get(p)),l=a.map(p=>p.min),d=a.map(p=>p.max);function c(p,[h,m]){const b=Td[p],x=[b([h.min,m.min]),b([h.min,m.max]),b([h.max,m.min]),b([h.max,m.max])];return{min:Math.min(...x),max:Math.max(...x)}}let u;switch(i.op){case"const":typeof i.ex=="number"?u={min:i.ex,max:i.ex}:u={min:NaN,max:NaN};break;case"sum":u={min:l.reduce((p,h)=>p+h,0),max:d.reduce((p,h)=>p+h,0)};break;case"prod":u={min:1,max:1},u=a.reduce((p,h)=>c(i.op,[p,h]),u);break;case"min":case"max":u={min:Math[i.op](...l),max:Math[i.op](...d)};break;case"match":case"thres":u={min:Math.min(...l),max:Math.max(...d)};break;case"sumfrac":l[0]+l[1]>0||d[0]+d[1]<0?u=c(i.op,a):u={min:NaN,max:NaN};break;case"read":{u={min:0,max:0};for(const{[i.tag[t]]:p}of n)p&&(u.min+=p.min,u.max+=p.max);break}case"subscript":{if(typeof i.ex[0]!="number")u={min:NaN,max:NaN};else{u={min:1/0,max:-1/0};let{min:p,max:h}=o.get(i.br[0]);p=Math.max(0,Math.ceil(p)),h=Math.min(h,i.ex.length-1);for(let m=p;m<=h;m++){const b=i.ex[m];u.min>b&&(u.min=b),u.max<b&&(u.max=b)}u.min>u.max&&(u={min:NaN,max:NaN})}break}case"lookup":isNaN(l[0])&&isNaN(d[0])&&(l.splice(0,1),d.splice(0,1)),u={min:Math.min(...l),max:Math.max(...d)};break;case"custom":u=Bs[i.ex].range(a);break;default:Ht(i)}o.set(i,u)}),o}function Od(e,t,n){const o=new Map,i=[],r=new Map;function a(l,d){o.has(l)||o.set(l,{inc:!0,dec:!0});const c=o.get(l);if(d&&c.dec)c.dec=!1;else if(!d&&c.inc)c.inc=!1;else return;i.push({node:l,inc:d})}for(e.forEach(l=>a(l,!0));i.length;){const{node:l,inc:d}=i.pop();switch(l.op){case"read":r.set(l.tag[t],o.get(l));break;case"const":break;case"sum":case"min":case"max":l.x.forEach(c=>a(c,d));break;case"thres":{l.x.forEach(p=>a(p,d));const c=n.get(l.x[0]),u=n.get(l.x[1]);c.max>u.min&&(a(l.br[0],d),a(l.br[1],!d)),c.min<u.max&&(a(l.br[0],!d),a(l.br[1],d));break}case"sumfrac":{const[c,u]=l.x.map(p=>n.get(p));u.min<0&&a(l.x[0],!d),u.max>0&&a(l.x[0],d),c.min<0&&a(l.x[1],d),c.max>0&&a(l.x[1],!d);break}case"prod":{const c=n.get(l);if(c.min<0&&c.max>0)l.x.forEach(u=>a(u,!0)),l.x.forEach(u=>a(u,!1));else{const u=d===c.max>0;l.x.forEach(p=>a(p,u===n.get(p).max>0))}break}case"match":case"lookup":l.x.forEach(c=>a(c,d)),l.br.forEach(c=>a(c,!0)),l.br.forEach(c=>a(c,!1));break;case"subscript":{const{br:[c],ex:u}=l;if(typeof u[0]=="number"){let{min:p,max:h}=n.get(c);p=Math.max(0,Math.ceil(p)),h=Math.min(h,u.length-1);for(let m=p+1;m<=h;m++)if(u[m-1]<u[m]){a(c,d);break}for(let m=p+1;m<=h;m++)if(u[m-1]>u[m]){a(c,!d);break}}else a(c,!0),a(c,!1);break}case"custom":Bs[l.ex].monotonicity(l.x.map(c=>n.get(c))).forEach((c,u)=>{c.inc||a(l.x[u],!d),c.dec||a(l.x[u],d)});break;default:Ht(l)}}return r}function vs(e){const[t,n]=Pr();return g.useEffect(()=>e.followAny((o,i)=>i==="update"&&n()),[e,n]),t}function ee(e){const{database:t}=P();return Ds(t.charOpts,e)}const{arithmetic:jd}=Ls;let Bd=class extends Nc{computeMeta({op:t,ex:n,tag:o},i,r,a,l){let d=r.filter(m=>!!m);const c=Wd(d,a);function u(m){return Object.freeze(l&&!m.tag?{tag:l,...m}:m)}function p(m,b){return u({op:m,ops:b,...c})}function h(m,b){let{meta:x}=m;return b!=null&&b.some(C=>!x.usedCats.has(C))&&(x={...x,usedCats:new Set([...x.usedCats,...b])}),u(x.conds===c.conds?x:{...x,...c})}if(t==="read"&&(l==null?void 0:l.qt)==="cond"){const{src:m,dst:b,sheet:x,q:C}=l;m&&x&&C&&(c.conds=vn(c.conds,{[b??"All"]:{[m]:{[x]:{[C]:i}}}}))}switch(t==="read"&&n!=="unique"&&([t,n]=[n,void 0]),t){case"sum":case"prod":case"min":case"max":case"sumfrac":if(d.length>1){const m=jd[t]([]);d=d.filter(b=>b.val!==m)}return d.length===1?h(d[0]):p(d.length?t:"const",d);case"const":case"subscript":return p("const",[]);case"vtag":return c.usedCats=new Set([n]),p("const",[]);case"match":case"thres":case"lookup":case"read":return h(d[0]);case"tag":return h(d[0],Object.keys(o));case"dtag":return h(d[0],n);case"custom":return p(n,d);default:yc(t)}}markGathered(t,n,o,i){const{val:r}=i,a={...i.meta};let l=!1;const d=new Set([...a.usedCats,...Object.keys(n)]);return a.usedCats.size!==d.size&&(a.usedCats=d,l=!0),l?{val:r,meta:Object.freeze(a)}:i}listFormulas(t){return this.gather(t.tag).filter(n=>n.val).map(({val:n,meta:o})=>Vr.withTag(o.tag)[n])}listCondFormulas(t){return this.listFormulas(t).map(n=>this.compute(n).meta.conds).reduce(vn,{})}};function Wd(e,t){var a;const n=[...e.map(l=>l.meta),...t.map(l=>l.meta)];let o={},i=new Set;for(const l of n)o=vn(o,l.conds),l.usedCats.forEach(d=>i.add(d));const r=i.size;return i=((a=n.find(l=>l.usedCats.size===r))==null?void 0:a.usedCats)??i,{usedCats:i,conds:o}}function vn(e,t){if(e===t)return e;if(typeof e!="object")throw new Error(`cannot merge ${e} and ${t}`);if(Object.keys(t).length>Object.keys(e).length&&([e,t]=[t,e]),!Object.keys(t).length)return e;let n=!1;const o={...e};for(const[i,r]of Object.entries(t)){const a=o[i],l=i in o?vn(a,r):r;a!==l&&(o[i]=l,n=!0)}return Object.freeze(n?o:e)}function Nd(e){const t=new Set(e);return n=>!Kd(n,t)}function Kd(e,t){const n=e.formula.match(/(\S+) (\S+) common.count/);if(!n)return!1;const[,o,i]=n;return i==="own"&&t.has(o)}class Ld extends Bd{toDebug(){return new Cd(this,Or,Nd([...Wt,...Nt]))}defaultAccu(t){var i,r,a,l;const{qt:n,q:o}=t;if(!(!n||!o))switch(t.et){case"own":case"target":return(r=(i=xc[n])==null?void 0:i[o])==null?void 0:r.accu;case"enemy":return(l=(a=jr[n])==null?void 0:a[o])==null?void 0:l.accu;case"team":if(n==="common"&&o==="count")return"sum";throw new Error("non-explicit team value accumulator")}}}function xn(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,preset:e},value:o}))}function Lc(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,src:e},value:o}))}function Hc(e){const{lvl:t,promotion:n,basic:o,dodge:i,special:r,chain:a,assist:l,core:d,mindscape:c}=z.char,{char:u,iso:p,[e.key]:h}=F.withAll("sheet",[]);return[u.reread(h),p.reread(h),t.add(e.level),o.add(e.basic),i.add(e.dodge),r.add(e.special),a.add(e.chain),l.add(e.assist),d.add(e.core),n.add(e.promotion),c.add(e.mindscape),wn.base.crit_.add(.05),wn.base.crit_dmg_.add(.5)]}function Hd(e,t,n,o){return[F.sheet("agg").reread(F.sheet("wengine")),z.common.count.sheet(e).add(1),z.wengine.lvl.add(t),z.wengine.modification.add(n),z.wengine.phase.add(o)]}function Fc(e,t){const{common:{count:n},initial:o}=Nr(xc,{sheet:"disc",et:"own"});return[F.sheet("agg").reread(F.sheet("disc")),F.withTag({sheet:"disc",qt:"initial"}).reread(F.sheet("dyn")),...Object.entries(e).map(([i,r])=>Kr(o,i).sheet("dyn").add(r)),...Object.entries(t).map(([i,r])=>n.sheet(i).add(r))]}function Gc(e){const t=F.with("et","team"),{own:n,enemy:o,teamBuff:i,notOwnBuff:r}=F.sheet("agg").withAll("et",[]);return[e.map(a=>F.withTag({et:"target",dst:a}).reread(F.withTag({et:"own",dst:null,src:a}))),e.flatMap(a=>{const l=n.with("src",a);return e.map(d=>l.reread(i.withTag({dst:a,src:d,name:null})))}),e.flatMap(a=>{const l=n.with("src",a);return e.filter(d=>d!==a).map(d=>l.reread(r.withTag({dst:a,src:d,name:null})))}),e.map(a=>o.reread(F.withTag({et:"enemyDeBuff",dst:null,src:a,name:null}))),e.flatMap((a,l)=>{const{stackIn:d,stackTmp:c}=F.withAll("qt",[]),u=F.withTag({src:a,et:"own"});return[u.with("qt","stackTmp").add(Br(d,0,l+1)),u.with("qt","stackOut").add(Wr(c.max.with("et","team"),l+1,d))]}),e.map(a=>t.add(F.withTag({src:a,et:"own"})))].flat()}function Uc(e){const t=bc(_n,e);return new Ld(_n,Lr,t)}function Fd(e){return new kd(_n,bc(_n,e))}var zt={},xo;function Gd(){if(xo)return zt;xo=1;var e=Ms();Object.defineProperty(zt,"__esModule",{value:!0}),zt.default=void 0;var t=e(Es()),n=Ts(),o=(0,t.default)((0,n.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");return zt.default=o,zt}var Ud=Gd();const hn=Is(Ud);function Jd({formulasRead:e,buffsRead:t}){var d;const n=g.useContext(Ft),o=(d=g.useContext(Ke))==null?void 0:d.withTag(n),i=o==null?void 0:o.toDebug(),[r,a]=g.useState(!1),l=c=>(u,p)=>{a(p?c:!1)};return s(B,{bgt:"dark",children:y(V,{children:[y(ln,{expanded:r==="formulas",onChange:l("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[s(un,{expandIcon:s(hn,{}),children:"All target listings"}),s(dn,{children:s(bs,{children:o&&i&&r==="formulas"&&o.listFormulas(e).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y($e,{children:[y(I,{children:[m,": ",p.val]}),y(ln,{children:[y(un,{expandIcon:s(hn,{}),children:["debug for ",m]}),y(dn,{children:["conds:",s(de,{text:ge(p.meta.conds)}),"read:",s(de,{text:ge(c)}),"formula:",s(de,{text:ge(h)})]})]})]},`${m}${u}`)})})})]}),y(ln,{expanded:r==="buffs",onChange:l("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[s(un,{expandIcon:s(hn,{}),children:"All target buffs"}),s(dn,{children:s(bs,{children:o&&i&&r==="buffs"&&o.listFormulas(t).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y($e,{children:[y(I,{children:[m,": ",p.val]}),y(ln,{children:[y(un,{expandIcon:s(hn,{}),children:["debug for ",m]}),y(dn,{children:["conds:",s(de,{text:ge(p.meta.conds)}),"read:",s(de,{text:ge(c)}),"formula:",s(de,{text:ge(h)})]})]})]},`${m}${u}`)})})})]})]})})}function Xd(){var u;const e=g.useContext(Ft),t=(u=g.useContext(Ke))==null?void 0:u.withTag(e),n=t==null?void 0:t.toDebug(),{read:o,setRead:i}=g.useContext(Rs),r=o&&(t==null?void 0:t.compute(o)),a=o&&(n==null?void 0:n.compute(o)),l=(o==null?void 0:o.tag.name)||(o==null?void 0:o.tag.q),d=a==null?void 0:a.meta,c=d&&ge(d);return s(As,{open:!!o,onClose:()=>i(void 0),children:y(B,{bgt:"dark",children:[s(Gt,{title:`Debug formula for ${l}`,action:s(De,{onClick:()=>i(void 0),children:s(Tn,{})})}),s(V,{children:s(B,{bgt:"normal",children:s(V,{children:y(bs,{gap:1,children:["Computed value: ",r==null?void 0:r.val,s(ae,{}),s(I,{variant:"h6",children:"Read"}),s(de,{text:ge(o)}),s(ae,{}),s(I,{variant:"h6",children:"Calculator Tag"}),s(de,{text:JSON.stringify(t==null?void 0:t.cache.tag)}),s(ae,{}),s(I,{variant:"h6",children:"Tag Context"}),s(de,{text:JSON.stringify(e)}),s(ae,{}),s(I,{variant:"h6",children:"Conditionals"}),s(de,{text:ge(r==null?void 0:r.meta.conds)}),s(ae,{}),s(I,{variant:"h6",children:"Formula"}),s(de,{text:c||""})]})})})})]})})}function Jc({document:e,bgt:t="normal",collapse:n=!1,typoVariant:o="body1"}){switch(e.type){case"fields":return s(Qd,{fieldsDocument:e,bgt:t});case"text":return n?s(Zd,{textDocument:e,typoVariant:o}):s(Xc,{textDocument:e,typoVariant:o});case"conditional":return s(Hr,{conditional:e.conditional,bgt:t});default:return null}}function Qd({fieldsDocument:e,bgt:t="normal"}){return y(B,{bgt:t,children:[e.header&&s(Gr,{header:e.header,hideDivider:e.fields.length===0}),s(Ur,{bgt:t,fields:e.fields})]})}function Xc({textDocument:e,typoVariant:t}){const n=g.useContext(Ke),o=g.useContext(Ft);return n?s(I,{variant:t,children:$c(e.text,n.withTag(o))}):null}function Zd({textDocument:e,typoVariant:t}){const[n,o]=g.useState(!1),[i,r]=g.useState(!1);return y(E,{sx:{position:"relative"},children:[!n&&s(E,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:i?"translate(0,-5px)":void 0},children:s(Fr,{})}),s(js,{onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),collapsedSize:55,onClick:()=>o(a=>!a),in:n,sx:{cursor:"pointer",position:"relative",maskImage:n?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:n?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:s(Xc,{textDocument:e,typoVariant:t})})]})}function Yd({numWorkers:e,setNumWorkers:t}){const{t:n}=he("page_optimize"),o=navigator.hardwareConcurrency||8;return y(se,{title:`${e} Workers`,children:[s(O,{disabled:!0,children:"Scales with available CPU cores."}),Jr(1,o).map(i=>s(O,{onClick:()=>t(i),children:n("worker",{count:i})},i))]})}function eu({maxBuildsToShow:e,optConfigId:t}){const{database:n}=P(),{t:o}=he("page_optimize");return y(se,{title:o("build",{count:e}),children:[s(O,{children:s(I,{variant:"caption",color:"info.main",children:o("buildDropdownDesc")})}),Xr.map(i=>s(O,{onClick:()=>n.optConfigs.set(t,{maxBuildsToShow:i}),children:o("build",{count:i})},i))]})}const Hs=Qr(te.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function tu({levelLow:e,levelHigh:t,setLow:n,setHigh:o,setBoth:i,dark:r=!1,disabled:a=!1,showLevelText:l=!1}){const{t:d}=he("wengine"),[c,u]=g.useState(e),[p,h]=g.useState(t),m=g.useCallback((b,x)=>{if(typeof x=="number")throw new TypeError;const[C,S]=x;u(C),h(S)},[u,h]);return g.useEffect(()=>u(e),[u,e]),g.useEffect(()=>h(t),[h,t]),y(E,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:r?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[y(E,{sx:{width:"max-content",height:32,display:"flex"},children:[l?y(Ut,{children:[s("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:d("levelSliderTitle")}),s(ae,{orientation:"vertical",flexItem:!0})]}):void 0,s(so,{value:c,onChange:b=>n(no(b??0,0,t)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:l?"right":"center"}},disabled:a})]}),s(Zr,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[c,p],onChange:m,onChangeCommitted:(b,x)=>Array.isArray(x)&&i(x[0],x[1]),valueLabelDisplay:"auto",min:0,max:kn,step:1,marks:!0,disabled:a}),s(so,{value:p,onChange:b=>o(no(b??0,e,kn)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function Le(){const e=g.useContext(Ke),t=g.useContext(Ft);return g.useMemo(()=>e==null?void 0:e.withTag(t),[e,t])}const Lt={initial:"Initial",combat:"Combat",final:"Final",base:"Base"};function ce({tag:e,showPercent:t}){return s(be,{color:cy(e),children:s(ou,{tag:e,showPercent:t})})}function bn({tag:e,showPercent:t}){return y(Ut,{children:[s(ce,{tag:e,showPercent:t}),ly(e).map(n=>s(We,{children:Ie[n]},n)),e.attribute&&s(We,{color:e.attribute,children:s(Ee,{attribute:e.attribute})})]})}const nu=["hp","hp_","atk","atk_","def","def_"],su=e=>nu.includes(e),bo={dmg_:"DMG",common_dmg_:"DMG",resIgn_:"Res Ignore"};function ou({tag:e,showPercent:t}){var r;const n=Le(),o=(r=dy.subset(e)[0])==null?void 0:r.title;if(o)return o;if(e.qt==="cond"&&e.q&&e.sheet&&n){const a=Cs.get(`${e.sheet}:${e.q}`);if(a)return $c(a.label,n,n==null?void 0:n.compute(new yn(e,"max")).val)}const i=Qc(e);if(su(i))return y("span",{children:[s(el,{statKey:i,iconProps:Yr})," ",y("span",{children:[(e.qt&&Lt[e.qt])??e.qt," ",tl[i],t&&Kt(i)]})]});if(bo[i]){const a=[...e.attribute?[Ot[e.attribute]]:[],...e.damageType1?[Ie[e.damageType1]]:[],...e.damageType2?[Ie[e.damageType2]]:[],bo[i]];return s("span",{children:a.join(" ")})}return s(ye,{statKey:i,showPercent:t})}function $(e,t){return[(n,o)=>s(oo,{ns:`${e}_${t}_gen`,key18:n,values:o}),(n,o)=>s(oo,{ns:`${e}_${t}`,key18:n,values:o})]}function f(e){return{title:s(ce,{tag:e}),fieldRef:e}}function Qc(e){if(!e)return"";const{et:t,q:n,qt:o,name:i}=e;return t==="own"&&o==="formula"&&n!=="base"?i??n??"":n??""}const An="AstralVoice",[$o,iu]=$("disc",An),wo=W(An),au=_[An],cu=w[An],ru={2:{title:s(K,{}),img:wo,documents:[{type:"text",text:$o("desc2")}]},4:{title:s(L,{}),img:wo,documents:[{type:"text",text:$o("desc4")},{type:"conditional",conditional:{label:iu("set4_cond"),metadata:au.astral,fields:[f(cu.set4_team_dmg_.tag)]}}]}},qn="BranchBladeSong",[_o,lu]=$("disc",qn),ko=W(qn),du=_[qn],vo=w[qn],uu={2:{title:s(K,{}),img:ko,documents:[{type:"text",text:_o("desc2")}]},4:{title:s(L,{}),img:ko,documents:[{type:"text",text:_o("desc4")},{type:"fields",fields:[f(vo.set4_passive.tag)]},{type:"conditional",conditional:{label:lu("set4_cond"),metadata:du.apply_or_trigger,fields:[f(vo.set4_cond.tag)]}}]}},zn="ChaosJazz",[Co,pu]=$("disc",zn),So=W(zn),hu=_[zn],mn=w[zn],mu={2:{title:s(K,{}),img:So,documents:[{type:"text",text:Co("desc2")}]},4:{title:s(L,{}),img:So,documents:[{type:"text",text:Co("desc4")},{type:"fields",fields:[f(mn.set4_passive_fire_dmg_.tag),f(mn.set4_passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:pu("set4_cond"),metadata:hu.while_off_field,fields:[{title:"EX Special Attack DMG",fieldRef:mn.set4_off_field_special_dmg_.tag},{title:"Assist Attack Attack DMG",fieldRef:mn.set4_off_field_assist_dmg_.tag}]}}]}},Pn="ChaoticMetal",[Do,fu]=$("disc",Pn),Mo=W(Pn),gu=_[Pn],Eo=w[Pn],yu={2:{title:s(K,{}),img:Mo,documents:[{type:"text",text:Do("desc2")}]},4:{title:s(L,{}),img:Mo,documents:[{type:"text",text:Do("desc4")},{type:"fields",fields:[f(Eo.set4_passive.tag)]},{type:"conditional",conditional:{label:fu("set4_cond"),metadata:gu.trigger_corruption,fields:[f(Eo.set4_cond_trigger_corruption.tag)]}}]}},Vn="FangedMetal",[To,xu]=$("disc",Vn),Io=W(Vn),bu=_[Vn],$u=w[Vn],wu={2:{title:s(K,{}),img:Io,documents:[{type:"text",text:To("desc2")}]},4:{title:s(L,{}),img:Io,documents:[{type:"text",text:To("desc4")},{type:"conditional",conditional:{label:xu("set4_cond"),metadata:bu.inflict_assault,fields:[f($u.set4_cond_inflict_assault.tag)]}}]}},On="FreedomBlues",[Ro,_u]=$("disc",On),Ao=W(On),ku=_[On],vu=w[On],Cu={2:{title:s(K,{}),img:Ao,documents:[{type:"text",text:Ro("desc2")}]},4:{title:s(L,{}),img:Ao,documents:[{type:"text",text:Ro("desc4")},{type:"conditional",conditional:{label:_u("set4_cond"),metadata:ku.exSpecialHit,fields:[f(vu.anomBuildupRes_.tag)]}}]}},jn="HormonePunk",[qo,Su]=$("disc",jn),zo=W(jn),Du=_[jn],Mu=w[jn],Eu={2:{title:s(K,{}),img:zo,documents:[{type:"text",text:qo("desc2")}]},4:{title:s(L,{}),img:zo,documents:[{type:"text",text:qo("desc4")},{type:"conditional",conditional:{label:Su("set4_cond"),metadata:Du.entering_combat,fields:[f(Mu.set4_cond_entering_combat.tag)]}}]}},Bn="InfernoMetal",[Po,Tu]=$("disc",Bn),Vo=W(Bn),Iu=_[Bn],Ru=w[Bn],Au={2:{title:s(K,{}),img:Vo,documents:[{type:"text",text:Po("desc2")}]},4:{title:s(L,{}),img:Vo,documents:[{type:"text",text:Po("desc4")},{type:"conditional",conditional:{label:Tu("set4_cond"),metadata:Iu.hitting_burning_enemy,fields:[f(Ru.set4_cond_hitting_burning_enemy.tag)]}}]}},Wn="PhaethonsMelody",[Oo,jo]=$("disc",Wn),Bo=W(Wn),Wo=_[Wn],No=w[Wn],qu={2:{title:s(K,{}),img:Bo,documents:[{type:"text",text:Oo("desc2")}]},4:{title:s(L,{}),img:Bo,documents:[{type:"text",text:Oo("desc4")},{type:"conditional",conditional:{label:jo("set4_cond_squad_use_ex"),metadata:Wo.squad_use_ex,fields:[f(No.set4_squad_anomProf.tag)]}},{type:"conditional",conditional:{label:jo("set4_cond_not_char_use_ex"),metadata:Wo.not_char_use_ex,fields:[f(No.set4_not_self_ether_.tag)]}}]}},Nn="PolarMetal",[Ko,zu]=$("disc",Nn),Lo=W(Nn),Pu=_[Nn],Ho=w[Nn],Vu={2:{title:s(K,{}),img:Lo,documents:[{type:"text",text:Ko("desc2")}]},4:{title:s(L,{}),img:Lo,documents:[{type:"text",text:Ko("desc4")},{type:"conditional",conditional:{label:zu("set4_cond"),metadata:Pu.freeze_shatter}},{type:"fields",fields:[{title:"Basic Attack DMG",fieldRef:Ho.set4_basic_dmg_.tag},{title:"Dash Attack DMG",fieldRef:Ho.set4_dash_dmg_.tag}]}]}},Kn="ProtoPunk",[Fo,Ou]=$("disc",Kn),Go=W(Kn),ju=_[Kn],Bu=w[Kn],Wu={2:{title:s(K,{}),img:Go,documents:[{type:"text",text:Fo("desc2")}]},4:{title:s(L,{}),img:Go,documents:[{type:"text",text:Fo("desc4")},{type:"conditional",conditional:{label:Ou("set4_cond"),metadata:ju.def_assist_or_evasive_assist,fields:[f(Bu.set4_cond_def_assist_or_evasive_assist_dmg_.tag)]}}]}},Ln="PufferElectro",[Uo,Nu]=$("disc",Ln),Jo=W(Ln),Ku=_[Ln],Xo=w[Ln],Lu={2:{title:s(K,{}),img:Jo,documents:[{type:"text",text:Uo("desc2")}]},4:{title:s(L,{}),img:Jo,documents:[{type:"text",text:Uo("desc4")},{type:"fields",fields:[{title:"Ultimate DMG",fieldRef:Xo.set4_dmg_.tag}]},{type:"conditional",conditional:{label:Nu("set4_cond"),metadata:Ku.launching_ult,fields:[f(Xo.set4_cond_launching_ult_atk_.tag)]}}]}},Hn="ShadowHarmony",[Qo,Hu]=$("disc",Hn),Zo=W(Hn),Fu=_[Hn],Yo=w[Hn],Gu={2:{title:s(K,{}),img:Zo,documents:[{type:"text",text:Qo("desc2")}]},4:{title:s(L,{}),img:Zo,documents:[{type:"text",text:Qo("desc4")},{type:"conditional",conditional:{label:Hu("set4_cond_stacks"),metadata:Fu.stacks,fields:[f(Yo.set4_stack_atk_.tag),f(Yo.set4_stack_crit_.tag)]}}]}},Fs="ShockstarDisco",[ei,Tx]=$("disc",Fs),ti=W(Fs),ts=w[Fs],Uu={2:{title:s(K,{}),img:ti,documents:[{type:"text",text:ei("desc2")}]},4:{title:s(L,{}),img:ti,documents:[{type:"text",text:ei("desc4")},{type:"fields",fields:[{title:"Basic Attack Daze",fieldRef:ts.set4_basic_daze_.tag},{title:"Dash Attack Daze",fieldRef:ts.set4_dash_daze_.tag},{title:"Dodge Counter Daze",fieldRef:ts.set4_dodgeCounter_daze_.tag}]}]}},Zc="SoulRock",[ni,Ix]=$("disc",Zc),si=W(Zc),Ju={2:{title:s(K,{}),img:si,documents:[{type:"text",text:ni("desc2")}]},4:{title:s(L,{}),img:si,documents:[{type:"text",text:ni("desc4")}]}},Fn="SwingJazz",[oi,Xu]=$("disc",Fn),ii=W(Fn),Qu=_[Fn],Zu=w[Fn],Yu={2:{title:s(K,{}),img:ii,documents:[{type:"text",text:oi("desc2")}]},4:{title:s(L,{}),img:ii,documents:[{type:"text",text:oi("desc4")},{type:"conditional",conditional:{label:Xu("set4_cond"),metadata:Qu.chain_or_ult,fields:[f(Zu.set4_cond_chain_or_ult.tag)]}}]}},Gn="ThunderMetal",[ai,ep]=$("disc",Gn),ci=W(Gn),tp=_[Gn],np=w[Gn],sp={2:{title:s(K,{}),img:ci,documents:[{type:"text",text:ai("desc2")}]},4:{title:s(L,{}),img:ci,documents:[{type:"text",text:ai("desc4")},{type:"conditional",conditional:{label:ep("set4_cond"),metadata:tp.enemy_shocked,fields:[f(np.set4_cond_enemy_shocked_atk_.tag)]}}]}},Un="WoodpeckerElectro",[ri,op]=$("disc",Un),li=W(Un),ip=_[Un],ap=w[Un],cp={2:{title:s(K,{}),img:li,documents:[{type:"text",text:ri("desc2")}]},4:{title:s(L,{}),img:li,documents:[{type:"text",text:ri("desc4")},{type:"conditional",conditional:{label:op("set4_cond"),metadata:ip.crit_basic_dodge_ex,fields:[f(ap.set4_cond_crit_basic_dodge_ex_atk_.tag)]}}]}},Yc={AstralVoice:ru,BranchBladeSong:uu,ChaosJazz:mu,ChaoticMetal:yu,FangedMetal:wu,FreedomBlues:Cu,HormonePunk:Eu,InfernoMetal:Au,PhaethonsMelody:qu,PolarMetal:Vu,ProtoPunk:Wu,PufferElectro:Lu,ShadowHarmony:Gu,ShockstarDisco:Uu,SoulRock:Ju,SwingJazz:Yu,ThunderMetal:sp,WoodpeckerElectro:cp};function er({setKey:e,fade2:t=!1,fade4:n=!1,children:o}){const i=Yc[e];return i?y(zs,{bgt:"light",sx:{height:"100%"},children:[s(Gt,{title:s(nl,{setKey:e}),avatar:s(qs,{src:W(e),size:2})}),o,s(G,{divider:s(ae,{}),children:Object.entries(i).map(([r,a])=>s(E,{sx:{opacity:(r==="2"?t:n)?.5:1},children:s(rp,{uiSheetElement:a,collapse:r!=="2"})},r))})]}):null}function rp({uiSheetElement:e,collapse:t=!1}){const{documents:n,title:o}=e;return y(V,{children:[s(I,{variant:"subtitle1",children:o}),s(G,{spacing:1,children:n.map((i,r)=>s(Jc,{document:i,typoVariant:"body2",collapse:t},r))})]})}function K(){return"2-Set"}function L(){return"4-Set"}function k({wKey:e,children:t}){const n=Le();let o=1;return n&&n.compute(z.common.count.sheet(e)).val&&(o=n.compute(z.wengine.phase).val??1),t(o)}const He="BashfulDemon",[di,lp]=$("wengine",He),dp=D.wengine[He],up=v(He,"icon"),pp=_[He],ui=w[He],hp={title:di("phase"),img:up,documents:[{type:"text",text:s(k,{wKey:He,children:e=>di(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(ui.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:lp("cond"),metadata:pp.launch_ex_attack,fields:[f(ui.team_atk_.tag),{title:"Duration",fieldValue:dp.duration}]}}]},Fe="BigCylinder",[pi,Rx]=$("wengine",Fe),mp=D.wengine[Fe],fp=v(Fe,"icon"),gp=w[Fe],yp=wc[Fe],xp={title:pi("phase"),img:fp,documents:[{type:"text",text:s(k,{wKey:Fe,children:e=>pi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(gp.passive_dmg_red_.tag)]},{type:"fields",fields:[{title:"Additional DMG",fieldRef:yp.damage.tag},{title:"Cooldown",fieldValue:mp.cooldown}]}]},Ge="BlazingLaurel",[hi,mi]=$("wengine",Ge),fi=D.wengine[Ge],bp=v(Ge,"icon"),gi=_[Ge],ns=w[Ge],$p={title:hi("phase"),img:bp,documents:[{type:"text",text:s(k,{wKey:Ge,children:e=>hi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:mi("cond1"),metadata:gi.quickOrPerfectAssistUsed,fields:[f(ns.impact_.tag),{title:"Duration",fieldValue:fi.duration}]}},{type:"conditional",conditional:{label:mi("cond2"),metadata:gi.wilt,fields:[f(ns.crit_dmg_ice_.tag),f(ns.crit_dmg_fire_.tag),{title:"Duration",fieldValue:fi.wilt_duration}]}}]},Ue="BoxCutter",[yi,wp]=$("wengine",Ue),_p=D.wengine[Ue],kp=v(Ue,"icon"),vp=_[Ue],xi=w[Ue],Cp={title:yi("phase"),img:kp,documents:[{type:"text",text:s(k,{wKey:Ue,children:e=>yi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:wp("cond"),metadata:vp.launchedAftershock,fields:[f(xi.physical_dmg_.tag),f(xi.daze_.tag),{title:"Duration",fieldValue:_p.duration}]}}]},Xt="BunnyBand",[bi,Sp]=$("wengine",Xt),Dp=v(Xt,"icon"),Mp=_[Xt],$i=w[Xt],Ep={title:bi("phase"),img:Dp,documents:[{type:"text",text:s(k,{wKey:Xt,children:e=>bi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f($i.passive_hp_.tag)]},{type:"conditional",conditional:{label:Sp("cond"),metadata:Mp.wearerShielded,fields:[f($i.atk_.tag)]}}]},Te="CannonRotor",[wi,Ax]=$("wengine",Te),Tp=D.wengine[Te],Ip=v(Te,"icon"),Rp=wc[Te],Ap=w[Te],qp={title:wi("phase"),img:Ip,documents:[{type:"text",text:s(k,{wKey:Te,children:e=>wi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Ap.passive_atk_.tag)]},{type:"fields",fields:[{title:"Additional DMG",fieldRef:Rp.damage.tag},{title:"Cooldown",fieldValue:s(k,{wKey:Te,children:e=>Tp.cooldown[e]})}]}]},Je="DeepSeaVisitor",[_i,ki]=$("wengine",Je),vi=D.wengine[Je],zp=v(Je,"icon"),Ci=_[Je],ss=w[Je],Pp={title:_i("phase"),img:zp,documents:[{type:"text",text:s(k,{wKey:Je,children:e=>_i(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(ss.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:ki("cond1"),metadata:Ci.basicHit,fields:[f(ss.crit_.tag),{title:"Duration",fieldValue:vi.duration}]}},{type:"conditional",conditional:{label:ki("cond2"),metadata:Ci.iceDashAtkHit,fields:[f(ss.extra_crit_.tag),{title:"Duration",fieldValue:vi.extra_duration}]}}]},Xe="DemaraBatteryMarkII",[Si,Vp]=$("wengine",Xe),Op=D.wengine[Xe],jp=v(Xe,"icon"),Bp=_[Xe],Di=w[Xe],Wp={title:Si("phase"),img:jp,documents:[{type:"text",text:s(k,{wKey:Xe,children:e=>Si(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Di.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:Vp("cond"),metadata:Bp.dodgeCounterOrAssistHit,fields:[f(Di.enerRegen_.tag),{title:"Duration",fieldValue:Op.duration}]}}]},Qe="DrillRigRedAxis",[Mi,Np]=$("wengine",Qe),Ei=D.wengine[Qe],Kp=v(Qe,"icon"),Lp=_[Qe],Ti=w[Qe],Hp={title:Mi("phase"),img:Kp,documents:[{type:"text",text:s(k,{wKey:Qe,children:e=>Mi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Np("cond"),metadata:Lp.exSpecialOrChainUsed,fields:[f(Ti.basic_eletric_dmg_.tag),f(Ti.dash_eletric_dmg_.tag),{title:"Duration",fieldValue:Ei.duration},{title:"Cooldown",fieldValue:Ei.cooldown}]}}]},Qt="ElectroLipGloss",[Ii,Fp]=$("wengine",Qt),Gp=v(Qt,"icon"),Up=_[Qt],Ri=w[Qt],Jp={title:Ii("phase"),img:Gp,documents:[{type:"text",text:s(k,{wKey:Qt,children:e=>Ii(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Fp("cond"),metadata:Up.anomalyOnEnemy,fields:[f(Ri.atk_.tag),f(Ri.common_dmg_.tag)]}}]},Ze="ElegantVanity",[Ai,Xp]=$("wengine",Ze),Qp=D.wengine[Ze],Zp=v(Ze,"icon"),Yp=_[Ze],eh=w[Ze],th={title:Ai("phase"),img:Zp,documents:[{type:"text",text:s(k,{wKey:Ze,children:e=>Ai(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Xp("cond"),metadata:Yp.consumed25Energy,fields:[f(eh.common_dmg_.tag),{title:"Duration",fieldValue:Qp.buffDuration}]}}]},Ye="FlamemakerShaker",[qi,zi]=$("wengine",Ye),os=D.wengine[Ye],nh=v(Ye,"icon"),Pi=_[Ye],is=w[Ye],sh={title:qi("phase"),img:nh,documents:[{type:"text",text:s(k,{wKey:Ye,children:e=>qi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:zi("cond1"),metadata:Pi.offField,fields:[f(is.enerRegen.tag)]}},{type:"conditional",conditional:{label:zi("cond2"),metadata:Pi.exSpecialAssistHits,fields:[f(is.common_dmg_.tag),{title:"Duration",fieldValue:os.duration},{title:"Cooldown",fieldValue:os.cooldown},f(is.anomProf.tag),{title:"Duration",fieldValue:os.anomProfDuration}]}}]},et="FusionCompiler",[Vi,oh]=$("wengine",et),ih=D.wengine[et],ah=v(et,"icon"),ch=_[et],Oi=w[et],rh={title:Vi("phase"),img:ah,documents:[{type:"text",text:s(k,{wKey:et,children:e=>Vi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Oi.passive_atk_.tag)]},{type:"conditional",conditional:{label:oh("cond"),metadata:ch.specialUsed,fields:[f(Oi.anomProf.tag),{title:"Duration",fieldValue:ih.duration}]}}]},Jn="GildedBlossom",[ji,qx]=$("wengine",Jn),lh=v(Jn,"icon"),Bi=w[Jn],dh={title:ji("phase"),img:lh,documents:[{type:"text",text:s(k,{wKey:Jn,children:e=>ji(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Bi.passive_atk_.tag),f(Bi.passive_exSpecial_dmg_.tag)]}]},tt="HailstormShrine",[Wi,uh]=$("wengine",tt),ph=D.wengine[tt],hh=v(tt,"icon"),mh=_[tt],Ni=w[tt],fh={title:Wi("phase"),img:hh,documents:[{type:"text",text:s(k,{wKey:tt,children:e=>Wi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Ni.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:uh("cond"),metadata:mh.exSpecialOrAnomaly,fields:[f(Ni.ice_dmg_.tag),{title:"Duration",fieldValue:ph.duration}]}}]},nt="HeartstringNocturne",[Ki,gh]=$("wengine",nt),yh=D.wengine[nt],xh=v(nt,"icon"),bh=_[nt],as=w[nt],$h={title:Ki("phase"),img:xh,documents:[{type:"text",text:s(k,{wKey:nt,children:e=>Ki(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(as.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:gh("cond"),metadata:bh.heartstring,fields:[f(as.chain_resIgn_fire_.tag),f(as.ult_resIgn_fire_.tag),{title:"Duration",fieldValue:yh.duration}]}}]},st="HellfireGears",[Li,Hi]=$("wengine",st),wh=D.wengine[st],_h=v(st,"icon"),Fi=_[st],Gi=w[st],kh={title:Li("phase"),img:_h,documents:[{type:"text",text:s(k,{wKey:st,children:e=>Li(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Hi("cond1"),metadata:Fi.offField,fields:[f(Gi.enerRegen.tag)]}},{type:"conditional",conditional:{label:Hi("cond1"),metadata:Fi.exSpecialUsed,fields:[f(Gi.impact_.tag),{title:"Duration",fieldValue:wh.duration}]}}]},ot="Housekeeper",[Ui,Ji]=$("wengine",ot),vh=D.wengine[ot],Ch=v(ot,"icon"),Xi=_[ot],Qi=w[ot],Sh={title:Ui("phase"),img:Ch,documents:[{type:"text",text:s(k,{wKey:ot,children:e=>Ui(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ji("cond1"),metadata:Xi.offField,fields:[f(Qi.enerRegen.tag)]}},{type:"conditional",conditional:{label:Ji("cond2"),metadata:Xi.exSpecialHits,fields:[f(Qi.physical_dmg_.tag),{title:"Duration",fieldValue:vh.duration}]}}]},it="IceJadeTeapot",[Zi,Dh]=$("wengine",it),Yi=D.wengine[it],Mh=v(it,"icon"),Eh=_[it],ea=w[it],Th={title:Zi("phase"),img:Mh,documents:[{type:"text",text:s(k,{wKey:it,children:e=>Zi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Dh("cond"),metadata:Eh.teariffic,fields:[f(ea.impact_.tag),{title:"Duration",fieldValue:Yi.duration},f(ea.common_dmg_.tag),{title:"Duration",fieldValue:Yi.teamBuffDuration}]}}]},at="IdentityBase",[ta,Ih]=$("wengine",at),Rh=D.wengine[at],Ah=v(at,"icon"),qh=_[at],zh=w[at],Ph={title:ta("phase"),img:Ah,documents:[{type:"text",text:s(k,{wKey:at,children:e=>ta(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ih("cond"),metadata:qh.equipperAttacked,fields:[f(zh.def_.tag),{title:"Duration",fieldValue:Rh.duration}]}}]},Gs="IdentityInflection",[na,zx]=$("wengine",Gs),Vh=v(Gs,"icon"),Oh={title:na("phase"),img:Vh,documents:[{type:"text",text:s(k,{wKey:Gs,children:e=>na(`phaseDescs.${e-1}`)})}]},ct="KaboomTheCannon",[sa,jh]=$("wengine",ct),Bh=D.wengine[ct],Wh=v(ct,"icon"),Nh=_[ct],Kh=w[ct],Lh={title:sa("phase"),img:Wh,documents:[{type:"text",text:s(k,{wKey:ct,children:e=>sa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:jh("cond"),metadata:Nh.allyHitsEnemy,fields:[f(Kh.atk_.tag),{title:"Duration",fieldValue:Bh.duration}]}}]},rt="LunarDecrescent",[oa,Hh]=$("wengine",rt),Fh=D.wengine[rt],Gh=v(rt,"icon"),Uh=_[rt],Jh=w[rt],Xh={title:oa("phase"),img:Gh,documents:[{type:"text",text:s(k,{wKey:rt,children:e=>oa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Hh("cond"),metadata:Uh.chainOrUltUsed,fields:[f(Jh.common_dmg_.tag),{title:"Duration",fieldValue:Fh.duration}]}}]},Us="LunarNoviluna",[ia,Px]=$("wengine",Us),Qh=v(Us,"icon"),Zh={title:ia("phase"),img:Qh,documents:[{type:"text",text:s(k,{wKey:Us,children:e=>ia(`phaseDescs.${e-1}`)})}]},Xn="LunarPleniluna",[aa,Vx]=$("wengine",Xn),Yh=v(Xn,"icon"),cs=w[Xn],em={title:aa("phase"),img:Yh,documents:[{type:"text",text:s(k,{wKey:Xn,children:e=>aa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(cs.basic_dmg_.tag),f(cs.dash_dmg_.tag),f(cs.dodgeCounter_dmg_.tag)]}]},lt="MagneticStormAlpha",[ca,tm]=$("wengine",lt),ra=D.wengine[lt],nm=v(lt,"icon"),sm=_[lt],om=w[lt],im={title:ca("phase"),img:nm,documents:[{type:"text",text:s(k,{wKey:lt,children:e=>ca(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:tm("cond"),metadata:sm.anomalyBuildupIncreased,fields:[f(om.anomMas.tag),{title:"Duration",fieldValue:ra.duration},{title:"Cooldown",fieldValue:ra.cooldown}]}}]},dt="MagneticStormBravo",[la,am]=$("wengine",dt),da=D.wengine[dt],cm=v(dt,"icon"),rm=_[dt],lm=w[dt],dm={title:la("phase"),img:cm,documents:[{type:"text",text:s(k,{wKey:dt,children:e=>la(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:am("cond"),metadata:rm.anomalyBuildupIncreased,fields:[f(lm.anomProf.tag),{title:"Duration",fieldValue:da.duration},{title:"Cooldown",fieldValue:da.cooldown}]}}]},Js="MagneticStormCharlie",[ua,Ox]=$("wengine",Js),um=v(Js,"icon"),pm={title:ua("phase"),img:um,documents:[{type:"text",text:s(k,{wKey:Js,children:e=>ua(`phaseDescs.${e-1}`)})}]},ut="MarcatoDesire",[pa,ha]=$("wengine",ut),hm=D.wengine[ut],mm=v(ut,"icon"),ma=_[ut],fm=w[ut],gm={title:pa("phase"),img:mm,documents:[{type:"text",text:s(k,{wKey:ut,children:e=>pa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ha("cond1"),metadata:ma.exSpecialOrChainHitsEnemy,fields:[f(fm.atk_.tag),{title:"Duration",fieldValue:hm.duration}]}},{type:"conditional",conditional:{label:ha("cond2"),metadata:ma.attributeAnomalyInflicted}}]},pt="OriginalTransmorpher",[fa,ym]=$("wengine",pt),xm=D.wengine[pt],bm=v(pt,"icon"),$m=_[pt],ga=w[pt],wm={title:fa("phase"),img:bm,documents:[{type:"text",text:s(k,{wKey:pt,children:e=>fa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(ga.passive_hp_.tag)]},{type:"conditional",conditional:{label:ym("cond"),metadata:$m.equipperHit,fields:[f(ga.impact_.tag),{title:"Duration",fieldValue:xm.duration}]}}]},Zt="PeacekeeperSpecialized",[ya,_m]=$("wengine",Zt),km=v(Zt,"icon"),vm=_[Zt],rs=w[Zt],Cm={title:ya("phase"),img:km,documents:[{type:"text",text:s(k,{wKey:Zt,children:e=>ya(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:_m("cond"),metadata:vm.shielded,fields:[f(rs.enerRegen.tag)]}},{type:"fields",fields:[f(rs.passive_exSpecial_anomBuildup_.tag),f(rs.passive_assist_anomBuildup_.tag)]}]},Yt="PreciousFossilizedCore",[xa,ba]=$("wengine",Yt),Sm=v(Yt,"icon"),$a=_[Yt],Dm=w[Yt],Mm={title:xa("phase"),img:Sm,documents:[{type:"text",text:s(k,{wKey:Yt,children:e=>xa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ba("cond1"),metadata:$a.enemyHpGE50,fields:[f(Dm.daze_.tag)]}},{type:"conditional",conditional:{label:ba("cond2"),metadata:$a.enemyHpGE75}}]},ht="RainforestGourmet",[wa,Em]=$("wengine",ht),Tm=D.wengine[ht],Im=v(ht,"icon"),Rm=_[ht],Am=w[ht],qm={title:wa("phase"),img:Im,documents:[{type:"text",text:s(k,{wKey:ht,children:e=>wa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Em("cond"),metadata:Rm.energyConsumed,fields:[f(Am.atk_.tag),{title:"Duration",fieldValue:Tm.duration}]}}]},mt="ReverbMarkI",[_a,zm]=$("wengine",mt),Pm=D.wengine[mt],Vm=v(mt,"icon"),Om=_[mt],jm=w[mt],Bm={title:_a("phase"),img:Vm,documents:[{type:"text",text:s(k,{wKey:mt,children:e=>_a(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:zm("cond"),metadata:Om.exSpecialUsed,fields:[f(jm.impact_.tag),{title:"Duration",fieldValue:Pm.duration}]}}]},ft="ReverbMarkII",[ka,Wm]=$("wengine",ft),Nm=D.wengine[ft],Km=v(ft,"icon"),Lm=_[ft],va=w[ft],Hm={title:ka("phase"),img:Km,documents:[{type:"text",text:s(k,{wKey:ft,children:e=>ka(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Wm("cond"),metadata:Lm.exSpecialOrChainUsed,fields:[f(va.anomMas.tag),f(va.anomProf.tag),{title:"Duration",fieldValue:Nm.duration}]}}]},gt="ReverbMarkIII",[Ca,Fm]=$("wengine",gt),Gm=D.wengine[gt],Um=v(gt,"icon"),Jm=_[gt],Xm=w[gt],Qm={title:Ca("phase"),img:Um,documents:[{type:"text",text:s(k,{wKey:gt,children:e=>Ca(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Fm("cond"),metadata:Jm.chainOrUltUsed,fields:[f(Xm.atk_.tag),{title:"Duration",fieldValue:Gm.duration}]}}]},en="RiotSuppressorMarkVI",[Sa,Zm]=$("wengine",en),Ym=v(en,"icon"),ef=_[en],Da=w[en],tf={title:Sa("phase"),img:Ym,documents:[{type:"text",text:s(k,{wKey:en,children:e=>Sa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Da.passive_crit_.tag)]},{type:"conditional",conditional:{label:Zm("cond"),metadata:ef.charge,fields:[f(Da.basic_ether_dmg_.tag)]}}]},yt="RoaringRide",[Ma,ls]=$("wengine",yt),ds=D.wengine[yt],nf=v(yt,"icon"),us=_[yt],ps=w[yt],sf={title:Ma("phase"),img:nf,documents:[{type:"text",text:s(k,{wKey:yt,children:e=>Ma(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ls("cond_atk_"),metadata:us.atk_,fields:[f(ps.atk_.tag),{title:"Duration",fieldValue:ds.duration}]}},{type:"conditional",conditional:{label:ls("cond_anomProf"),metadata:us.anomProf,fields:[f(ps.anomProf.tag),{title:"Duration",fieldValue:ds.duration}]}},{type:"conditional",conditional:{label:ls("cond_anomBuildup_"),metadata:us.anomBuildup_,fields:[f(ps.anomBuildup_.tag),{title:"Duration",fieldValue:ds.duration}]}}]},xt="SeveredInnocence",[Ea,of]=$("wengine",xt),af=D.wengine[xt],cf=v(xt,"icon"),rf=_[xt],hs=w[xt],lf={title:Ea("phase"),img:cf,documents:[{type:"text",text:s(k,{wKey:xt,children:e=>Ea(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(hs.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:of("cond"),metadata:rf.basicSpecialAftershockHit,fields:[f(hs.crit_dmg_.tag),f(hs.electric_dmg_.tag),{title:"Duration",fieldValue:af.duration}]}}]},bt="SharpenedStinger",[Ta,df]=$("wengine",bt),uf=D.wengine[bt],pf=v(bt,"icon"),hf=_[bt],Ia=w[bt],mf={title:Ta("phase"),img:pf,documents:[{type:"text",text:s(k,{wKey:bt,children:e=>Ta(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:df("cond"),metadata:hf.predatoryInstinct,fields:[f(Ia.physical_dmg_.tag),{title:"Duration",fieldValue:uf.duration}]}},{type:"fields",fields:[f(Ia.anomBuildup_.tag)]}]},tn="SixShooter",[Ra,ff]=$("wengine",tn),gf=v(tn,"icon"),yf=_[tn],xf=w[tn],bf={title:Ra("phase"),img:gf,documents:[{type:"text",text:s(k,{wKey:tn,children:e=>Ra(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ff("cond"),metadata:yf.charge,fields:[f(xf.exSpecial_daze_.tag)]}}]},Xs="SliceOfTime",[Aa,jx]=$("wengine",Xs),$f=v(Xs,"icon"),wf={title:Aa("phase"),img:$f,documents:[{type:"text",text:s(k,{wKey:Xs,children:e=>Aa(`phaseDescs.${e-1}`)})}]},$t="SpectralGaze",[qa,za]=$("wengine",$t),Pa=D.wengine[$t],_f=v($t,"icon"),Va=_[$t],Oa=w[$t],kf={title:qa("phase"),img:_f,documents:[{type:"text",text:s(k,{wKey:$t,children:e=>qa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:za("cond1"),metadata:Va.hit_aftershock_electric,fields:[f(Oa.cond_defRed_.tag),{title:"Duration",fieldValue:Pa.duration1}]}},{type:"conditional",conditional:{label:za("cond2"),metadata:Va.spiritLock,fields:[f(Oa.cond_impact_.tag),{title:"Duration",fieldValue:Pa.duration2}]}}]},wt="SpringEmbrace",[ja,vf]=$("wengine",wt),Cf=D.wengine[wt],Sf=v(wt,"icon"),Df=_[wt],Ba=w[wt],Mf={title:ja("phase"),img:Sf,documents:[{type:"text",text:s(k,{wKey:wt,children:e=>ja(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Ba.passive_dmg_red_.tag)]},{type:"conditional",conditional:{label:vf("cond"),metadata:Df.when_attacked,fields:[f(Ba.cond_enerRegen_.tag),{title:"Duration",fieldValue:Cf.duration}]}}]},_t="StarlightEngine",[Wa,Ef]=$("wengine",_t),Tf=D.wengine[_t],If=v(_t,"icon"),Rf=_[_t],Af=w[_t],qf={title:Wa("phase"),img:If,documents:[{type:"text",text:s(k,{wKey:_t,children:e=>Wa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ef("cond"),metadata:Rf.dodgecounter_quickassist,fields:[f(Af.cond_dmg_.tag),{title:"Duration",fieldValue:Tf.duration}]}}]},kt="StarlightEngineReplica",[Na,zf]=$("wengine",kt),Pf=D.wengine[kt],Vf=v(kt,"icon"),Of=_[kt],jf=w[kt],Bf={title:Na("phase"),img:Vf,documents:[{type:"text",text:s(k,{wKey:kt,children:e=>Na(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:zf("cond"),metadata:Of.hit_away,fields:[f(jf.cond_dmg_.tag),{title:"Duration",fieldValue:Pf.duration}]}}]},vt="SteamOven",[Ka,Wf]=$("wengine",vt),Nf=D.wengine[vt],Kf=v(vt,"icon"),Lf=_[vt],Hf=w[vt],Ff={title:Ka("phase"),img:Kf,documents:[{type:"text",text:s(k,{wKey:vt,children:e=>Ka(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Wf("cond"),metadata:Lf.stacks,fields:[f(Hf.cond_impact_.tag),{title:"Duration",fieldValue:Nf.duration}]}}]},nn="SteelCushion",[La,Gf]=$("wengine",nn),Uf=v(nn,"icon"),Jf=_[nn],Ha=w[nn],Xf={title:La("phase"),img:Uf,documents:[{type:"text",text:s(k,{wKey:nn,children:e=>La(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Ha.passive_physical_dmg_.tag)]},{type:"conditional",conditional:{label:Gf("cond"),metadata:Jf.hit_behind,fields:[f(Ha.cond_dmg_.tag)]}}]},sn="StreetSuperstar",[Fa,Qf]=$("wengine",sn),Zf=v(sn,"icon"),Yf=_[sn],eg=w[sn],tg={title:Fa("phase"),img:Zf,documents:[{type:"text",text:s(k,{wKey:sn,children:e=>Fa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Qf("cond"),metadata:Yf.charge,fields:[f(eg.cond_ult_dmg_.tag)]}}]},Ct="TheBrimstone",[Ga,ng]=$("wengine",Ct),sg=D.wengine[Ct],og=v(Ct,"icon"),ig=_[Ct],ag=w[Ct],cg={title:Ga("phase"),img:og,documents:[{type:"text",text:s(k,{wKey:Ct,children:e=>Ga(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ng("cond"),metadata:ig.hit_basic_dash_dodge,fields:[f(ag.cond_atk_.tag),{title:"Duration",fieldValue:sg.duration}]}}]},St="TheRestrained",[Ua,rg]=$("wengine",St),lg=D.wengine[St],dg=v(St,"icon"),ug=_[St],Ja=w[St],pg={title:Ua("phase"),img:dg,documents:[{type:"text",text:s(k,{wKey:St,children:e=>Ua(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:rg("cond"),metadata:ug.dmg_daze_,fields:[f(Ja.basic_dmg_.tag),f(Ja.basic_daze_.tag),{title:"Duration",fieldValue:lg.duration}]}}]},Dt="TheVault",[Xa,hg]=$("wengine",Dt),mg=D.wengine[Dt],fg=v(Dt,"icon"),gg=_[Dt],yg=w[Dt],xg={title:Xa("phase"),img:fg,documents:[{type:"text",text:s(k,{wKey:Dt,children:e=>Xa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:hg("cond"),metadata:gg.ether_hit,fields:[f(yg.cond_dmg_.tag),{title:"Duration",fieldValue:mg.duration}]}}]},Mt="Timeweaver",[Qa,bg]=$("wengine",Mt),$g=D.wengine[Mt],wg=v(Mt,"icon"),_g=_[Mt],ms=w[Mt],kg={title:Qa("phase"),img:wg,documents:[{type:"text",text:s(k,{wKey:Mt,children:e=>Qa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(ms.passive_electric_anomBuildup_.tag),f(ms.passive_disorder_dmg_.tag)]},{type:"conditional",conditional:{label:bg("cond"),metadata:_g.hit_anomaly,fields:[f(ms.cond_anomProf.tag),{title:"Duration",fieldValue:$g.duration}]}}]},Et="TusksOfFury",[Za,vg]=$("wengine",Et),Cg=D.wengine[Et],Sg=v(Et,"icon"),Dg=_[Et],fs=w[Et],Mg={title:Za("phase"),img:Sg,documents:[{type:"text",text:s(k,{wKey:Et,children:e=>Za(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(fs.passive_shield_.tag)]},{type:"conditional",conditional:{label:vg("cond"),metadata:Dg.interrupt_perfdodge,fields:[f(fs.cond_dmg_.tag),f(fs.daze_.tag),{title:"Duration",fieldValue:Cg.duration}]}}]},Tt="UnfetteredGameBall",[Ya,Eg]=$("wengine",Tt),Tg=D.wengine[Tt],Ig=v(Tt,"icon"),Rg=_[Tt],Ag=w[Tt],qg={title:Ya("phase"),img:Ig,documents:[{type:"text",text:s(k,{wKey:Tt,children:e=>Ya(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Eg("cond"),metadata:Rg.anomaly_counter,fields:[f(Ag.cond_crit_.tag),{title:"Duration",fieldValue:Tg.duration}]}}]},Qn="VortexArrow",[ec,Bx]=$("wengine",Qn),zg=v(Qn,"icon"),Pg=w[Qn],Vg={title:ec("phase"),img:zg,documents:[{type:"text",text:s(k,{wKey:Qn,children:e=>ec(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Pg.passive_daze_.tag)]}]},It="VortexHatchet",[tc,Og]=$("wengine",It),nc=D.wengine[It],jg=v(It,"icon"),Bg=_[It],Wg=w[It],Ng={title:tc("phase"),img:jg,documents:[{type:"text",text:s(k,{wKey:It,children:e=>tc(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Og("cond"),metadata:Bg.entering,fields:[f(Wg.cond_impact_.tag),{title:"Duration",fieldValue:nc.duration},{title:"Cooldown",fieldValue:nc.cooldown}]}}]},Zn="VortexRevolver",[sc,Wx]=$("wengine",Zn),Kg=v(Zn,"icon"),Lg=w[Zn],Hg={title:sc("phase"),img:Kg,documents:[{type:"text",text:s(k,{wKey:Zn,children:e=>sc(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(Lg.passive_exSpecial_daze_.tag)]}]},Rt="WeepingCradle",[oc,ic]=$("wengine",Rt),Fg=D.wengine[Rt],Gg=v(Rt,"icon"),ac=_[Rt],Ug=w[Rt],Jg={title:oc("phase"),img:Gg,documents:[{type:"text",text:s(k,{wKey:Rt,children:e=>oc(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ic("cond_atk"),metadata:ac.attack}},{type:"conditional",conditional:{label:ic("cond_stacks"),metadata:ac.stacks,fields:[f(Ug.cond_dmg_.tag),{title:"Duration",fieldValue:Fg.duration}]}}]},on="WeepingGemini",[cc,Xg]=$("wengine",on),Qg=v(on,"icon"),Zg=_[on],Yg=w[on],ey={title:cc("phase"),img:Qg,documents:[{type:"text",text:s(k,{wKey:on,children:e=>cc(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Xg("cond"),metadata:Zg.anomaly_stack,fields:[f(Yg.anomProf.tag)]}}]},At="ZanshinHerbCase",[rc,ty]=$("wengine",At),ny=D.wengine[At],sy=v(At,"icon"),oy=_[At],gs=w[At],iy={title:rc("phase"),img:sy,documents:[{type:"text",text:s(k,{wKey:At,children:e=>rc(`phaseDescs.${e-1}`)})},{type:"fields",fields:[f(gs.passive_crit_.tag),f(gs.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:ty("cond"),metadata:oy.apply_anom_stun,fields:[f(gs.cond_crit_.tag),{title:"Duration",fieldValue:ny.duration}]}}]},tr={BashfulDemon:hp,BigCylinder:xp,BlazingLaurel:$p,BoxCutter:Cp,BunnyBand:Ep,CannonRotor:qp,DeepSeaVisitor:Pp,DemaraBatteryMarkII:Wp,DrillRigRedAxis:Hp,ElectroLipGloss:Jp,ElegantVanity:th,FlamemakerShaker:sh,FusionCompiler:rh,GildedBlossom:dh,HailstormShrine:fh,HeartstringNocturne:$h,HellfireGears:kh,Housekeeper:Sh,IceJadeTeapot:Th,IdentityBase:Ph,IdentityInflection:Oh,KaboomTheCannon:Lh,LunarDecrescent:Xh,LunarNoviluna:Zh,LunarPleniluna:em,MagneticStormAlpha:im,MagneticStormBravo:dm,MagneticStormCharlie:pm,MarcatoDesire:gm,OriginalTransmorpher:wm,PeacekeeperSpecialized:Cm,PreciousFossilizedCore:Mm,RainforestGourmet:qm,ReverbMarkI:Bm,ReverbMarkII:Hm,ReverbMarkIII:Qm,RiotSuppressorMarkVI:tf,RoaringRide:sf,SeveredInnocence:lf,SharpenedStinger:mf,SixShooter:bf,SliceOfTime:wf,SpectralGaze:kf,SpringEmbrace:Mf,StarlightEngine:qf,StarlightEngineReplica:Bf,SteamOven:Ff,SteelCushion:Xf,StreetSuperstar:tg,TheBrimstone:cg,TheRestrained:pg,TheVault:xg,Timeweaver:kg,TusksOfFury:Mg,UnfetteredGameBall:qg,VortexArrow:Vg,VortexHatchet:Ng,VortexRevolver:Hg,WeepingCradle:Jg,WeepingGemini:ey,ZanshinHerbCase:iy};function nr({headerAction:e,fade:t=!1,wengine:n}){const{key:o,level:i,phase:r,modification:a}=n,l=tr[o],d=sl(o,i,r,a),c="atk_base",u=In(o).second_statkey;return l?y(zs,{bgt:"light",sx:{height:"100%"},children:[s(Gt,{title:s(ol,{wKey:o}),avatar:s(qs,{src:v(o,"icon"),size:2}),action:e}),y(V,{sx:{py:0},children:[y(I,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ye,{statKey:"atk"}),y("span",{children:[io(d[c],c).toFixed(ao(c)),Kt(c)]})]}),y(I,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ye,{statKey:u}),y("span",{children:[io(d[u],u).toFixed(ao(u)),Kt(u)]})]})]}),s(E,{sx:{opacity:t?.5:1},children:s(ay,{uiSheetElement:l})})]}):null}function ay({uiSheetElement:e}){const{documents:t,title:n}=e;return y(V,{children:[s(I,{variant:"subtitle1",children:n}),s(G,{spacing:1,children:t.map((o,i)=>s(Jc,{document:o,typoVariant:"body2",collapse:!0},i))})]})}function cy(e){const{attribute:t}=e;if(t)return t}function ry(e){const{q:t}=e;return["standardDmg","anomalyDmg"].includes(t)}function ly(e){const{damageType1:t,damageType2:n}=e,o=[];return ry(e)?(t&&o.push(t),n&&o.push(n),o):[]}const Ie={basic:"Basic",dash:"Dash",dodgeCounter:"Dodge Counter",special:"Special",exSpecial:"EX Special",chain:"Chain",ult:"Ultimate",quickAssist:"Quick Assist",defensiveAssist:"Defensive Assist",evasiveAssist:"Evasive Assist",assistFollowUp:"Assist Follow Up",anomaly:"Anomaly",disorder:"Disorder",aftershock:"Aftershock",elemental:"Elemental"},sr=["crit_","crit_dmg_","impact","pen","pen_","enerRegen","anomProf","anomMas"].map(e=>{if(il.includes(e)){const t={...z.final.dmg_.tag,attribute:e.slice(0,-5)};return{title:s(ye,{statKey:e}),fieldRef:t}}return e==="crit_"?{fieldRef:z.common.cappedCrit_.tag,title:s(ye,{statKey:e})}:{fieldRef:z.final[e].tag,title:s(ye,{statKey:e})}});sr.push(...Ce.map(e=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,name:"standardDmgInst"},title:y(be,{color:e,children:[Ot[e]," Damage"]})})),...Ce.flatMap(e=>_c.map(t=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,damageType1:t,name:"standardDmgInst"},title:y(be,{color:e,children:[Ot[e]," ",Ie[t]," Damage"]})}))),...Ce.map(e=>({fieldRef:{et:"own",qt:"formula",q:"anomalyDmg",attribute:e,damageType1:"anomaly",name:"anomalyDmgInst"},title:y(be,{color:e,children:[Ot[e]," Anomaly Damage"]})})),...Ce.map(e=>({fieldRef:{et:"own",qt:"formula",q:"anomBuildup",attribute:e,name:"anomalyBuildupInst"},title:y(be,{color:e,children:[Ot[e]," Anomaly Buildup"]})})),{fieldRef:{et:"own",qt:"formula",q:"dazeBuildup",name:"dazeInst"},title:"Daze Buildup"});const or=[];sr.forEach(e=>{or.push({tag:e.fieldRef,value:e})});const dy=Fd(or),Cs=new Map;function ir(e,t){if(Cs.get(e))throw new Error(`Duplicate conditional ${e}`);Cs.set(e,t)}Object.values(tr).forEach(({documents:e})=>{e.forEach(t=>{t.type==="conditional"&&ir(`${t.conditional.metadata.sheet}:${t.conditional.metadata.name}`,t.conditional)})});Object.values(Yc).forEach(e=>Object.values(e).forEach(({documents:t})=>{t.forEach(n=>{n.type==="conditional"&&ir(`${n.conditional.metadata.sheet}:${n.conditional.metadata.name}`,n.conditional)})}));function ar(e,t=new Map){const n=t.get(e);if(n)return n;const{val:o,meta:{tag:i,op:r,ops:a,usedCats:l}}=e,d=i&&al(i,(S,M)=>l.has(M)),c=Ps(o,Kt(Qc(i))),u=new Set;function p(S,M){return S.map((A,X)=>{const q=ar(A,t);return q.name?(u.add(q),q.name):(q.deps.forEach(N=>u.add(N)),q.prec>=M?q.formula:y("span",{children:["(",q.formula,")"]},X))})}let h,m=1/0;switch(r){case"const":h=c,m=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:S,joiner:M,end:A}=ys[r];m=ys[r].prec,h=y("span",{children:[S,p(a,m).map((X,q)=>y(g.Fragment,{children:[X,q<a.length-1&&M]},q)),A]})}break;case"sumfrac":{const[S]=p(a,2),[M,A]=p(a,1);h=y("span",{children:[S," / (",M," + ",A,")"]}),m=ys.prod.prec;break}default:yc(r)}let b,x;d&&(b=d.q==="_"?void 0:y("span",{children:[s(ce,{tag:d})," ",c]}),x=void 0);const C={name:b,formula:h,prec:m,sheet:x,deps:[...new Set(u)]};return t.set(e,C),C}const ys={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function uy(e){const t={},n={};return e.forEach(({setKey:o,mainStatKey:i,substats:r,level:a,rarity:l})=>{t[o]=(t[o]??0)+1,n[i]=(n[i]??0)+kc(l,i,a),r.forEach(({key:d,upgrades:c})=>{!d||!c||(n[d]=(n[d]??0)+vc(d,l)*c)})}),Fc(n,t)}function cr({character:e,charOpt:t,wengineId:n,discIds:o,children:i}){const r=py(e,n,o),a=g.useMemo(()=>Uc([...Gc([e.key]),...r,wn.common.critMode.add(t.critMode),pe.common.lvl.add(t.enemyLvl),pe.common.def.add(t.enemyDef),pe.common.isStunned.add(t.enemyisStunned?1:0),pe.common.stun_.add(t.enemyStunMultiplier/100),pe.common.unstun_.add(1),...t.conditionals.flatMap(({sheet:d,src:c,dst:u,condKey:p,condValue:h})=>xn("preset0",Cc(d,c,u)(p,h))),...t.bonusStats.filter(({disabled:d})=>!d).flatMap(({tag:d,value:c})=>xn("preset0",{tag:{...d,src:e.key,sheet:"agg",et:"own"},value:ue($s(c,d.q??""))})),...t.enemyStats.flatMap(({tag:d,value:c})=>xn("preset0",{tag:{...d,qt:"common",et:"enemy",sheet:"agg"},value:ue($s(c,d.q??""))}))]),[r,t,e.key]),l=g.useMemo(()=>a&&new Map,[a]);return s(cl.Provider,{value:l,children:s(Ke.Provider,{value:a,children:i})})}function py(e,t,n){const o=Sc(t),i=Dc(n),r=g.useMemo(()=>o?Hd(o.key,o.level,o.modification,o.phase):[],[o]),a=g.useMemo(()=>i?uy(Object.values(i).filter(rl)):[],[i]);return g.useMemo(()=>e?Lc(e.key,...Hc(e),...r,...a):[],[e,r,a])}function rr({character:e,conditionals:t,children:n}){const o=g.useMemo(()=>Uc([...Gc([e.key]),...Lc(e.key,...Hc(e),...Fc({},Me(Nt,()=>4)),F.sheet("agg").reread(F.sheet("wengine")),z.wengine.lvl.add(60),z.wengine.modification.add(5),z.wengine.phase.add(1),...Wt.map(i=>z.common.count.sheet(i).add(1))),wn.common.critMode.add("avg"),pe.common.lvl.add(100),pe.common.def.add(900),pe.common.isStunned.add(0),pe.common.stun_.add(1.5),pe.common.unstun_.add(1),...t.flatMap(({sheet:i,src:r,dst:a,condKey:l,condValue:d})=>xn("preset0",Cc(i,r,a)(l,d)))]),[e,t]);return s(Ke.Provider,{value:o,children:n})}function lr({isAftershock:e,setAftershock:t}){return s(U,{onClick:()=>t(!e),color:e?"success":"secondary",children:Ie.aftershock})}function dr({dmgType:e,keys:t,setDmgType:n}){return y(se,{title:y(E,{sx:{textWrap:"nowrap"},children:["Dmg Type: ",e?Ie[e]:"Any"]}),children:[s(O,{selected:!e,disabled:!e,onClick:()=>n(),children:"Any"},"any"),t.map(o=>s(O,{selected:e===o,disabled:e===o,onClick:()=>n(o),children:Ie[o]},o))]})}function hy(){var d;const{t:e}=he("page_optimize"),{database:t}=P(),{key:n}=J(),{bonusStats:o}=ee(n),i=(d=Ds(t.charMeta,n))==null?void 0:d.description,r=g.useCallback((c,u,p,h)=>t.charOpts.setBonusStat(n,c,u,p,h),[t,n]),a=c=>t.charOpts.setBonusStat(n,ul(c),0,!1),l=g.useCallback(c=>{t.charMeta.set(n,{description:c})},[t.charMeta,n]);return y(G,{spacing:1,children:[o.map(({tag:c,value:u,disabled:p},h)=>s(fy,{tag:c,value:u,disabled:p,setValue:m=>r(c,m,p,h),onDelete:()=>r(c,null,p,h),setTag:m=>r(m,u,p,h),toggleDisabled:()=>r(c,u,!p,h)},JSON.stringify(c)+h)),s(my,{onSelect:a}),s(xd,{placeholder:e("bonusStatsNotes"),value:i,disabled:!n,onChange:c=>l(c),multiline:!0,minRows:3,fullWidth:!0})]})}function my({tag:e,onSelect:t}){return s(se,{title:(e&&s(ce,{tag:e}))??"Add Bonus Stat",children:pl.map(n=>s(O,{onClick:()=>t(n),children:s(ye,{statKey:n,showPercent:!0})},n))})}function fy({tag:e,setTag:t,value:n,disabled:o,setValue:i,onDelete:r,toggleDisabled:a}){var d;const l=(d=e.q)==null?void 0:d.endsWith("_");return s(B,{bgt:"light",sx:{opacity:o?.4:void 0},children:y(V,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(De,{onClick:a,children:o?s(Mc,{}):s(Ec,{})}),s(I,{children:s(ce,{tag:e})}),s(yy,{qt:e.qt,setQt:c=>t({...e,qt:c})}),e.q==="dmg_"&&s(gy,{tag:e,setAttribute:c=>{const{attribute:u,...p}=e;t(c?{...p,attribute:c}:p)}}),ll.includes(e.q)&&s(dr,{dmgType:e.damageType1,keys:dl,setDmgType:c=>{const{damageType1:u,...p}=e;t(c?{...p,damageType1:c}:p)}}),["dmg_","crit_dmg_"].includes(e.q)&&s(lr,{isAftershock:e.damageType2==="aftershock",setAftershock:c=>{const{damageType2:u,...p}=e;t(c?{...p,damageType2:"aftershock"}:p)}}),s(Pe,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:i,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(Rn,{position:"end",sx:{ml:0},children:[l?"%":void 0," ",s(De,{"aria-label":"Delete Bonus Stat",onClick:r,edge:"end",children:s(Hs,{fontSize:"small"})})]})}})]})})}function gy({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Ee,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(O,{onClick:()=>t(null),children:"No Attribute"}),Ce.map(n=>s(O,{onClick:()=>t(n),children:s(be,{color:n,children:s(Ee,{attribute:n})})},n))]})}function yy({qt:e,setQt:t}){return s(se,{title:e&&Lt[e],children:hl.map(n=>s(O,{onClick:()=>t(n),selected:e===n,disabled:e===n,children:Lt[n]},n))})}function ur(){const e=Le();return s(zs,{children:s(V,{children:e==null?void 0:e.listFormulas(z.listing.formulas).map((t,n)=>s(xy,{read:t},n))})})}function xy({read:e}){var x,C,S,M,A,X,q;const t=Le(),{setRead:n}=g.useContext(Rs),o=J(),i=ee(o==null?void 0:o.key),r=e.tag.sheet===((x=i==null?void 0:i.target)==null?void 0:x.sheet)&&e.tag.name===((C=i==null?void 0:i.target)==null?void 0:C.name)||((S=i==null?void 0:i.target)==null?void 0:S.q)===e.tag.q,a=g.useMemo(()=>{var N,R,H,oe;return e.tag.sheet===((N=i==null?void 0:i.target)==null?void 0:N.sheet)&&e.tag.name===((R=i==null?void 0:i.target)==null?void 0:R.name)?ml(e.tag,(H=i==null?void 0:i.target)==null?void 0:H.damageType1,(oe=i==null?void 0:i.target)==null?void 0:oe.damageType2):e.tag},[e.tag,(M=i==null?void 0:i.target)==null?void 0:M.sheet,(A=i==null?void 0:i.target)==null?void 0:A.name,(X=i==null?void 0:i.target)==null?void 0:X.damageType1,(q=i==null?void 0:i.target)==null?void 0:q.damageType2]),l=g.useMemo(()=>({...e,tag:a}),[a,e]),d=t==null?void 0:t.compute(l),c=a.name||a.q,{statHighlight:u,setStatHighlight:p}=g.useContext(Tc),h=a.name?"":a.attribute?`${a.attribute}_${a.q}`:a.q==="cappedCrit_"?"crit_":a.q,m=h?fl(u,h):!1;if(!d)return null;const b=Ps(d.val,Kt(c??""));return y(E,{onMouseEnter:()=>h&&p(h),onMouseLeave:()=>p(""),sx:{display:"flex",gap:1,alignItems:"center",p:.5,borderRadius:.5,backgroundColor:r?"rgba(0,200,0,0.2)":void 0,position:"relative","::after":{content:'""',position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:.5,backgroundColor:gl(m),transition:"background-color 0.3s ease-in-out",pointerEvents:"none"}},children:[s(E,{sx:{flexGrow:1},children:s(ce,{tag:a})}),b,s(yl,{tag:a,onClick:()=>{n(l)}})]})}function by(){const{database:e}=P(),{key:t}=J(),{enemyStats:n,enemyLvl:o,enemyDef:i,enemyisStunned:r,enemyStunMultiplier:a}=ee(t),l=g.useCallback((c,u,p)=>e.charOpts.setEnemyStat(t,c,u,p),[e,t]),d=c=>e.charOpts.setEnemyStat(t,bl(c),0);return y(G,{spacing:1,children:[y(E,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s(Pe,{label:"Enemy Lvl",value:o,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyLvl:c})}),s(Pe,{label:"Enemy DEF",value:i,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyDef:c})}),s(Pe,{label:"Enemy Stun Multiplier",value:a,inputProps:{min:0,sx:{width:"8em"}},onChange:c=>e.charOpts.set(t,{enemyStunMultiplier:c}),InputProps:{endAdornment:s(Rn,{position:"end",children:"%"})}}),s(U,{onClick:()=>e.charOpts.set(t,{enemyisStunned:!r}),color:r?"success":"secondary",children:r?"Stunned":"Not Stunned"})]}),n.map(({tag:c,value:u},p)=>s(wy,{tag:c,value:u,setValue:h=>l(c,h,p),onDelete:()=>l(c,null,p),setTag:h=>l(h,u,p)},JSON.stringify(c)+p)),s($y,{onSelect:d})]})}function $y({tag:e,onSelect:t}){return s(se,{title:(e&&s(ce,{tag:{...e,qt:"common",et:"enemy",sheet:"agg"}}))??"Add Enemy Stat",children:$l.map(n=>s(O,{onClick:()=>t(n),children:s(ce,{tag:{q:n,qt:"common",et:"enemy",sheet:"agg"},showPercent:!0})},n))})}function wy({tag:e,setTag:t,value:n,setValue:o,onDelete:i}){var a;const r=(a=e.q)==null?void 0:a.endsWith("_");return s(B,{bgt:"light",children:y(V,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(I,{children:s(ce,{tag:e})}),xl(["res_","resRed_"],e.q)&&s(_y,{tag:e,setAttribute:l=>{const{attribute:d,...c}=e;t(l?{...c,attribute:l}:c)}}),s(Pe,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(Rn,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",s(De,{"aria-label":"Delete Enemy Stat",onClick:i,edge:"end",children:s(Hs,{fontSize:"small"})})]})}})]})})}function _y({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Ee,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(O,{onClick:()=>t(null),children:"No Attribute"}),Ce.map(n=>s(O,{onClick:()=>t(n),children:s(be,{color:n,children:s(Ee,{attribute:n})})},n))]})}function Ss(e){return e.reduce((t,n)=>t*n.length,1)}const ky=50;class vy{constructor(t){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.nextReport=Date.now(),this.finalize=()=>{},this.terminate=()=>{};const{progress:n}=this,{topN:o,numWorkers:i,setProgress:r}=t,a=[...Array(i)].map(()=>new Worker(new URL(""+new URL("workerHandle-CSrCyUap.js",import.meta.url).href,import.meta.url),{type:"module"})),l=Rd(t.nodes,t.candidates,"q",t.minimum,o),{nodes:d,minimum:c,candidates:u}=l;if(n.remaining=Ss(u),n.skipped=Ss(t.candidates)-n.remaining,n.remaining>Number.MAX_SAFE_INTEGER)throw new Error("too many combinations");this.topN=o,this.optThreshold=c[0],this.info=new Map(a.map(m=>[m,{builds:[]}]));const p=u.map(m=>m.map(b=>b.id));this.state={ty:"work",works:[{ids:p,count:n.remaining}]},this.report=()=>r({...n}),this.results=new Promise((m,b)=>{this.finalize=x=>(this.report(),m(x)),this.terminate=b});const h=()=>a.forEach(m=>m.terminate());this.results.then(h,h);for(const m of a)m.onmessage=({data:b})=>{try{this.onWorkerMsg(b,m)}catch(x){this.terminate(x)}},fn(m,{ty:"init",nodes:d,minimum:c,candidates:u,topN:o})}distribute(t){const{state:n}=this;if(n.ty==="work"){n.works.push(...t);return}for(const o of n.workers)if(this.give(t,o))n.workers.delete(o);else return;this.state={ty:"work",works:t}}idle(t){const{state:n,progress:o,info:i}=this;if(n.ty==="idle")n.workers.add(t);else if(this.give(n.works,t)){const r=o.remaining/(i.size+.5);i.forEach((a,l)=>fn(l,{ty:"work?",maxKeep:r}))}else this.state={ty:"idle",workers:new Set([t])}}give(t,n){if(!t.length)return!1;let o=this.progress.remaining/(this.info.size+.5),i=t.findIndex(a=>(o-=a.count)<0)+1;i>1&&(i-=1);const r=t.splice(0,i||t.length);return fn(n,{ty:"add",works:r}),!0}onWorkerMsg(t,n){var o;switch(t.ty){case"progress":{const i=this.progress,r=this.info.get(n);i.remaining-=t.computed+t.skipped,i.computed+=t.computed,i.failed+=t.failed,i.skipped+=t.skipped,r.builds=t.builds,t.idle&&this.idle(n);const a=Date.now();if(this.nextReport<=a||!t.remaining){this.nextReport=a+ky,this.report();const l=[...this.info.values()].flatMap(c=>c.builds);l.sort((c,u)=>u.value-c.value);const d=((o=l[this.topN])==null?void 0:o.value)??-1/0;d>this.optThreshold&&(this.optThreshold=d,this.info.forEach((c,u)=>fn(u,{ty:"config",threshold:d}))),this.progress.remaining||this.finalize(l.slice(0,this.topN))}break}case"add":this.distribute(t.works);break;case"err":this.terminate(t.msg+" (Worker Error)")}}}function fn(e,t){e.postMessage(t)}const Cy=1e-7;function Sy(e,t,n,o,i,r,a,l,d,c,u){const p=new Set(Nt),h=new Set(Wt),m=[gc(...n.map((x,C)=>co(x.multiplier,new yn({src:e,...x.tag},void 0).with("preset",`preset${C}`)))),...o.map(({tag:x,isMax:C})=>{const S={...wl(x),src:e,preset:"preset0"};return C?co(-1,new yn(S,void 0)):new yn(S,void 0)})],b=vd(m,t,x=>{if(x.src===e&&x.et==="own"){if(x.sheet==="dyn"&&x.qt==="initial")return x.q==="dmg_"?{q:`${x.attribute}_dmg_`}:{q:x.q};if(x.q==="count"&&p.has(x.sheet))return{q:x.sheet};if(x.qt=="wengine"&&["lvl","phase","modification"].includes(x.q))return{q:x.q};if(x.q==="count"&&h.has(x.sheet))return{q:x.sheet}}});return b.push(i.length?xs(...i.map(x=>$n({q:x},"sum"))):ue(1/0),r.length?xs(...r.map(x=>$n({q:x},"sum"))):ue(1/0)),{nodes:b,candidates:[a.map(Dy),l[1].map(qe),l[2].map(qe),l[3].map(qe),l[4].map(qe),l[5].map(qe),l[6].map(qe)],minimum:[-1/0,...o.map(({value:x,isMax:C,tag:S})=>{const M=$s(x,S.q??"");return(C?M*-1:M)-Cy}),2,4],numWorkers:d,topN:c,setProgress:u}}function qe(e){const{id:t,mainStatKey:n,level:o,rarity:i,setKey:r,substats:a}=e;return{id:t,[n]:kc(i,n,o),...Object.fromEntries(a.filter(({key:l,upgrades:d})=>l&&d).map(({key:l,upgrades:d})=>[l,vc(l,i)*d])),[r]:1}}function Dy(e){const{id:t,key:n,level:o,modification:i,phase:r}=e;return{id:t,lvl:o,modification:i,phase:r,[n]:1}}var Pt={},lc;function My(){if(lc)return Pt;lc=1;var e=Ms();Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=e(Es()),n=Ts(),o=(0,t.default)((0,n.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");return Pt.default=o,Pt}var Ey=My();const Ty=Is(Ey),Iy=g.memo(function({disabled:t=!1}){const{database:n}=P(),{optConfigId:o,optConfig:i}=g.useContext(re);return y(B,{bgt:"light",children:[s(V,{sx:{display:"flex",gap:1},children:s(I,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),s(ae,{}),s(_l,{levelLow:(i==null?void 0:i.levelLow)??ro.S,levelHigh:(i==null?void 0:i.levelHigh)??ro.S,setLow:r=>n.optConfigs.set(o,{levelLow:r}),setHigh:r=>n.optConfigs.set(o,{levelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{levelLow:r,levelHigh:a}),disabled:t})]})});function Ry({discBySlot:e,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i}){const r=J(),a=ee(r==null?void 0:r.key),l=g.useMemo(()=>{const d=Me(Nt,()=>Me(Vs,()=>0));return Object.values(e).forEach(c=>c.forEach(({setKey:u,slotKey:p})=>d[u][p]++)),d},[e]);return y(Ut,{children:[y(E,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(I,{variant:"h6",sx:{flexGrow:1},children:"Disc Set Config"}),s(U,{disabled:!t.length,onClick:()=>o([]),children:"Reset 4p filter"}),s(U,{disabled:!n.length,onClick:()=>i([]),children:"Reset 2p filter"})]}),s(E,{children:r&&a&&s(rr,{character:r,conditionals:a.conditionals,children:s(ne,{container:!0,spacing:1,children:Nt.map(d=>s(ne,{item:!0,xs:1,md:2,lg:3,children:s(Ay,{numSlot:l[d],setKey:d,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i})},d))})})})]})}function Ay({numSlot:e,setKey:t,setFilter4:n,setFilter2:o,setSetFilter4:i,setSetFilter2:r}){const a=!!o.length&&!o.includes(t),l=!!n.length&&!n.includes(t);return y(er,{setKey:t,fade2:a,fade4:l,children:[s(E,{sx:{display:"flex",justifyContent:"space-around",pb:1},children:Object.entries(e).map(([d,c])=>s(E,{children:s(We,{color:c?"primary":"secondary",children:c})},d))}),y(kl,{fullWidth:!0,children:[s(U,{sx:{borderRadius:0},color:!n.length||n.includes(t)?"success":"secondary",onClick:()=>i(n.length?lo([...n],t):[t]),children:"Allow 4p"}),s(U,{sx:{borderRadius:0},color:!o.length||o.includes(t)?"success":"secondary",onClick:()=>r(o.length?lo([...o],t):[t]),children:"Allow 2p"})]})]})}function qy({discsBySlot:e}){const[t,n,o]=Os();return s(B,{bgt:"light",children:s(V,{children:y(G,{spacing:1,children:[s($e,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:Vs.map(i=>s(ve,{discsBySlot:e,slotKey:i},i))}),s(zy,{show:t,onClose:o,discsBySlot:e}),s(U,{color:"info",fullWidth:!0,onClick:n,children:"Disc Filter Config"})]})})})}function ve({discsBySlot:e,slotKey:t}){return y(I,{children:["Disc ",t," ",s(We,{color:e[t].length?"primary":"error",children:e[t].length})]})}function zy({discsBySlot:e,show:t,onClose:n,disabled:o}){const{database:i}=P(),{optConfigId:r,optConfig:a}=g.useContext(re);return s(As,{open:t,onClose:n,children:y(B,{children:[s(Gt,{title:"Disc Filter",action:s(De,{onClick:n,children:s(Tn,{})})}),s(ae,{}),s(V,{children:s(g.Suspense,{fallback:s(Ic,{width:"100%",height:"500px"}),children:y(G,{spacing:1,children:[s(Iy,{disabled:o}),s(Py,{discsBySlot:e,disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Discs"}),s(Vy,{discBySlot:e,disabled:o})]})})})]})})}function Py({discsBySlot:e,disabled:t}){const{database:n}=P(),{optConfigId:o,optConfig:i}=g.useContext(re),r=a=>{const l=vl([...uo[a]]),d={4:i.slot4??[],5:i.slot5??[],6:i.slot6??[]},c={4:u=>n.optConfigs.set(o,{slot4:u}),5:u=>n.optConfigs.set(o,{slot5:u}),6:u=>n.optConfigs.set(o,{slot6:u})};return s($e,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:uo[a].map(u=>s(U,{disabled:t,variant:d[a].includes(u)?"contained":"outlined",onClick:()=>c[a](l([...d[a]],u)),children:s(ye,{statKey:u,showPercent:!0})},u))})};return s(B,{bgt:"light",children:s(V,{children:y(G,{spacing:1,children:[y($e,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ve,{slotKey:"1",discsBySlot:e}),s(ve,{slotKey:"2",discsBySlot:e}),s(ve,{slotKey:"3",discsBySlot:e})]}),s(ve,{slotKey:"4",discsBySlot:e}),r("4"),s(ve,{slotKey:"5",discsBySlot:e}),r("5"),s(ve,{slotKey:"6",discsBySlot:e}),r("6")]})})})}function Vy({discBySlot:e,disabled:t}){const{database:n}=P(),{optConfigId:o,optConfig:i}=g.useContext(re),{setFilter2:r=[],setFilter4:a=[]}=i,l=g.useCallback(c=>{n.optConfigs.set(o,{setFilter2:c})},[n,o]),d=g.useCallback(c=>{n.optConfigs.set(o,{setFilter4:c})},[n,o]);return s(Ry,{discBySlot:e,disabled:t,setFilter2:r,setFilter4:a,setSetFilter2:l,setSetFilter4:d})}function Oy({disabled:e=!1}){const{optConfigId:t,optConfig:{statFilters:n}}=g.useContext(re),{database:o}=P(),i=g.useCallback(r=>o.optConfigs.set(t,{statFilters:r}),[o,t]);return y(B,{bgt:"light",children:[s(V,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:s(E,{display:"flex",justifyContent:"space-between",children:s(I,{sx:{fontWeight:"bold"},children:"Stat Filter"})})}),s(ae,{}),s(V,{children:s(jy,{statFilters:n,setStatFilters:i,disabled:e})})]})}function jy({statFilters:e,setStatFilters:t,disabled:n=!1}){const o=g.useCallback((c,u)=>{const p=structuredClone(e);typeof u>"u"?p.push({tag:c,value:0,isMax:!1,disabled:!1}):p[u].tag=c,t(p)},[t,e]),i=g.useCallback(c=>{const u=structuredClone(e);u.splice(c,1),t(u)},[t,e]),r=g.useCallback((c,u)=>{const p=structuredClone(e);p[c].value=u,t(p)},[t,e]),a=g.useCallback((c,u)=>{const p=structuredClone(e);p[c].isMax=u,t(p)},[t,e]),l=g.useCallback((c,u)=>{const p=structuredClone(e);p[c].disabled=u,t(p)},[t,e]),d=c=>o(Sl(c));return y(E,{display:"flex",flexDirection:"column",gap:1,children:[e.map((c,u)=>s(Wy,{statFilter:c,delTarget:()=>i(u),setTarget:p=>o(p,u),setTargetValue:p=>r(u,p),setTargetisMax:p=>a(u,p),setDisabled:p=>l(u,p),disabled:n},u+JSON.stringify(c))),s(By,{onSelect:d})]})}function By({tag:e,onSelect:t}){return s(se,{title:(e&&s(ce,{tag:e}))??"Add Final Stat Filter",children:Dl.map(n=>s(O,{onClick:()=>t(n),children:s(ye,{statKey:n,showPercent:!0})},n))})}function Wy({statFilter:e,delTarget:t,setTarget:n,setTargetValue:o,setTargetisMax:i,setDisabled:r,disabled:a}){const{tag:l,value:d,isMax:c,disabled:u}=e,p=Cl(l.q??"");return s(B,{children:y(V,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(U,{color:u?"secondary":"success",onClick:()=>r(!u),disabled:a,size:"small",children:u?s(Mc,{}):s(Ec,{})}),s(I,{children:s(ce,{tag:l})}),l.q==="dmg_"&&s(Ny,{tag:l,setAttribute:h=>{const{attribute:m,...b}=l;n(h?{...b,attribute:h}:b)}}),s(U,{onClick:()=>i(!c),size:"small",children:s("strong",{children:c?"MAX":"MIN"})}),s(Pe,{float:!0,value:d,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:a,onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(Rn,{position:"end",sx:{ml:0},children:[p?"%":void 0," ",s(De,{"aria-label":"Delete Stat Constraint",onClick:t,edge:"end",children:s(Hs,{fontSize:"small"})})]})}})]})})}function Ny({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Ee,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(O,{onClick:()=>t(null),children:"No Attribute"}),Ce.map(n=>s(O,{onClick:()=>t(n),children:s(be,{color:n,children:s(Ee,{attribute:n})})},n))]})}const Ky=g.memo(function({disabled:t=!1}){const{database:n}=P(),{optConfigId:o,optConfig:i}=g.useContext(re);return y(B,{bgt:"light",children:[s(V,{sx:{display:"flex",gap:1},children:s(I,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),s(ae,{}),s(tu,{levelLow:(i==null?void 0:i.wlevelLow)??kn,levelHigh:(i==null?void 0:i.wlevelHigh)??kn,setLow:r=>n.optConfigs.set(o,{wlevelLow:r}),setHigh:r=>n.optConfigs.set(o,{wlevelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{wlevelLow:r,wlevelHigh:a}),disabled:t})]})});function Ly({wengines:e,disabled:t}){const{database:n}=P(),{optConfigId:o,optConfig:i}=g.useContext(re),[r,a,l]=Os();return s(B,{bgt:"light",children:s(V,{children:y(G,{spacing:1,children:[y($e,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[y($e,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",s(We,{color:e.length?"primary":"error",children:e.length})]}),s(U,{sx:{flexGrow:1},startIcon:i.optWengine?s(Ml,{}):s(El,{}),color:i.optWengine?"success":"secondary",onClick:()=>n.optConfigs.set(o,{optWengine:!i.optWengine}),children:"Optimize Wengine"})]}),s(Hy,{show:r,onClose:l,wengines:e}),s(U,{color:"info",fullWidth:!0,onClick:a,disabled:t||!i.optWengine,children:"Wengine Filter Config"})]})})})}function Hy({wengines:e,show:t,onClose:n,disabled:o}){const{database:i}=P(),{optConfigId:r,optConfig:a}=g.useContext(re);return s(As,{open:t,onClose:n,children:y(B,{children:[s(Gt,{title:"Wengine Filter",action:s(De,{onClick:n,children:s(Tn,{})})}),s(ae,{}),s(V,{children:s(g.Suspense,{fallback:s(Ic,{width:"100%",height:"500px"}),children:y(G,{spacing:1,children:[s(Ky,{disabled:o}),s(Fy,{disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquippedWengine:!a.useEquippedWengine}),color:a.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"}),s(Gy,{wengines:e})]})})})]})})}function Fy({disabled:e}){const{database:t}=P(),{optConfigId:n,optConfig:o}=g.useContext(re),{wEngineTypes:i}=o,r=vs(t.wengines),{key:a}=J(),l=g.useMemo(()=>r&&o.optWengine?t.wengines.values.reduce((d,{key:c,level:u,location:p})=>{if(u<o.wlevelLow||u>o.wlevelHigh||p&&!o.useEquippedWengine&&p!==a)return d;const h=In(c).type;return h&&d[h]++,d},Me(po,()=>0)):Me(po,()=>0),[a,r,t.wengines,o.wlevelLow,o.wlevelHigh,o.optWengine,o.useEquippedWengine]);return s(Tl,{onChange:d=>t.optConfigs.set(n,{wEngineTypes:d}),value:i,disabled:e,totals:l,fullWidth:!0})}function Gy({wengines:e}){const t=J(),n=ee(t==null?void 0:t.key),{optConfig:o}=g.useContext(re),{wEngineTypes:i}=o,r=g.useMemo(()=>i.length?Wt.filter(a=>i.includes(In(a).type)):Wt,[i]);return y($e,{children:[s(I,{variant:"h6",children:"Wengine Condtional Configuration"}),s(I,{children:"Wengine stats are displayed to be Lvl 60/60, P1, actual level/phase of wengine will be used in the solver."}),t&&n&&s(rr,{character:t,conditionals:n.conditionals,children:s(ne,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:r.map(a=>s(ne,{item:!0,xs:1,children:s(Jy,{wengineKey:a,count:e.filter(l=>l.key===a).length})},a))})})]})}function Uy(e){return{key:e,level:60,modification:5,phase:1,location:"",lock:!1}}function Jy({wengineKey:e,count:t}){const n=g.useMemo(()=>Uy(e),[e]);return s(nr,{wengine:n,headerAction:s(We,{color:t?"primary":"secondary",children:t}),fade:!t})}function Xy(){const{key:e}=J(),{optConfigId:t}=ee(e),{database:n}=P();return g.useEffect(()=>{if(t)return;const o=n.optConfigs.new({wEngineTypes:[Pc(e).specialty]});n.charOpts.set(e,{optConfigId:o})},[n,t,e]),t?s(Rc,{optConfigId:t,children:s(Qy,{})}):null}function Qy(){const{t:e}=he("optimize"),{database:t}=P(),n=Le(),{key:o}=J(),{target:i}=ee(o),[r,a]=g.useState(8),[l,d]=g.useState(void 0),{optConfig:c,optConfigId:u}=g.useContext(re),p=vs(t.discs),h=g.useMemo(()=>{const q={4:c.slot4,5:c.slot5,6:c.slot6},N=R=>["4","5","6"].includes(R);return p&&t.discs.values.reduce((R,H)=>{const{slotKey:oe,mainStatKey:Z,level:Q,location:le}=H;return Q<c.levelLow||Q>c.levelHigh||le&&!c.useEquipped&&le!==o||N(oe)&&!q[oe].includes(Z)||R[H.slotKey].push(H),R},{1:[],2:[],3:[],4:[],5:[],6:[]})},[o,p,t.discs,c.levelHigh,c.levelLow,c.slot4,c.slot5,c.slot6,c.useEquipped]),m=vs(t.wengines),b=g.useMemo(()=>m&&t.wengines.values.filter(({key:q,level:N,location:R})=>{if(!c.optWengine)return R===o;if(N<c.wlevelLow||N>c.wlevelHigh||R&&!c.useEquippedWengine&&R!==o)return!1;const{type:H}=In(q);return!!c.wEngineTypes.includes(H)}),[o,t.wengines,c.wlevelLow,c.wlevelHigh,c.optWengine,c.wEngineTypes,c.useEquippedWengine,m]),x=g.useMemo(()=>Ss(Object.values(h))*b.length,[b.length,h]),[C,S]=g.useState(!1),M=g.useRef(()=>{});g.useEffect(()=>()=>M.current(),[]);const A=g.useCallback(async q=>{if(!n||!i)return;const N=new Promise(Q=>M.current=Q);d(void 0),S(!0);const R=(c.statFilters??[]).filter(Q=>!Q.disabled),H=Sy(o,n,[{tag:Ac(i),multiplier:1}],R,c.setFilter2,c.setFilter4,b,h,r,c.maxBuildsToShow,d);if(q.altKey){console.log(H),S(!1);return}const oe=new vy(H);N.then(()=>oe.terminate("user cancelled"));let Z;try{Z=await oe.results}catch{return}finally{M.current=()=>{},S(!1)}t.optConfigs.newOrSetGeneratedBuildList(u,{builds:Z.map(({ids:Q,value:le})=>({wengineId:Q[0],discIds:Me(Vs,(xe,_e)=>Q[_e+1]),value:le})),buildDate:Date.now()})},[n,i,c.statFilters,c.setFilter2,c.setFilter4,c.maxBuildsToShow,o,b,h,r,t.optConfigs,u]),X=g.useCallback(()=>{M.current(),S(!1)},[M]);return s(B,{children:s(V,{children:y(G,{spacing:1,children:[y(E,{sx:{display:"flex",gap:1,flexWrap:"wrap","& .MuiPaper-root":{flexGrow:1}},children:[s(Oy,{}),s(Ly,{wengines:b}),s(qy,{discsBySlot:h})]}),l&&s(Zy,{progress:l,total:x}),y(E,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[s(eu,{maxBuildsToShow:c.maxBuildsToShow,optConfigId:u}),s(Yd,{numWorkers:r,setNumWorkers:a}),s(U,{disabled:!x||!i,onClick:C?X:A,color:C?"error":"primary",startIcon:C?s(Tn,{}):s(Ty,{}),children:e(C?"cancel":"optimize")})]})]})})})}function gn({value:e}){const t=e.toLocaleString();return s(E,{component:"span",sx:{fontFamily:"Monospace",display:"inline"},children:t})}function Zy(e){const{t}=he("optimize"),{computed:n,remaining:o,skipped:i}=e.progress,r=n+o,a=Math.log1p(r)/Math.log1p(e.total),l=o/r*a;return y(E,{children:[y(I,{children:[t("computed"),": ",s(gn,{value:n})," /"," ",s(gn,{value:r})," "]}),y(I,{children:[t("computed + skipped"),": ",s(gn,{value:n+i})," /"," ",s(gn,{value:e.total})]}),s(Il,{variant:"determinate",value:(1-l)*100,sx:{height:10,borderRadius:5}})]})}const Yy={xs:2,sm:1,md:2,lg:3,xl:4};function ex({onClick:e}){const t=g.useContext(qc);return s(zc,{discIds:t==null?void 0:t.equippedDiscs,wengineId:t==null?void 0:t.equippedWengine,onClick:e,columns:Yy})}var Vt={},dc;function tx(){if(dc)return Vt;dc=1;var e=Ms();Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.default=void 0;var t=e(Es()),n=Ts(),o=(0,t.default)((0,n.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");return Vt.default=o,Vt}var nx=tx();const sx=Is(nx);function ox(e){const{database:t}=P();return Ds(t.generatedBuildList,e)}const ix=g.memo(function(){const{optConfig:t}=g.useContext(re),n=ox(t.generatedBuildListId??"");return s(G,{spacing:1,children:n==null?void 0:n.builds.map((o,i)=>s(cx,{build:o,index:i},`${i}-${o.wengineId}-${Object.values(o.discIds).join("-")}`))})});function ax({build:{discIds:e,wengineId:t}}){const{t:n}=he("build"),{database:o}=P(),{key:i}=J()??{},r=g.useCallback(()=>{i&&(Object.entries(e).forEach(([a,l])=>l&&o.discs.set(l,{location:i})),t&&o.wengines.set(t,{location:i}))},[i,e,t,o.wengines,o.discs]);return s(U,{color:"info",size:"small",startIcon:s(sx,{}),onClick:r,children:n("buildDisplay.equipToCrr")})}function cx({build:e,index:t}){const n=J(),o=ee(n.key);return s(cr,{character:n,charOpt:o,discIds:e.discIds,wengineId:e.wengineId,children:s(B,{children:s(V,{children:y(G,{spacing:1,children:[y(E,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[y(I,{children:["Build ",t+1,": ",Ps(e.value)]}),s(ax,{build:e})]}),s(E,{children:y(ne,{container:!0,spacing:1,children:[s(ne,{item:!0,xs:6,md:4,lg:3,xl:3,children:s(ur,{})}),s(ne,{item:!0,xs:6,md:8,lg:9,xl:9,children:s(zc,{discIds:e.discIds,wengineId:e.wengineId})})]})})]})})})})}const rx=210,pr=g.createContext(rx),lx=0,jt=33,hr=g.createContext(0);function dx(){const[e,t]=g.useState(""),n=g.useMemo(()=>({statHighlight:e,setStatHighlight:t}),[e,t]),o=g.useMemo(()=>[["char",s(ux,{},"char")],["opt",s(px,{},"opt")],["builds",s(hx,{},"builds")]],[]);return s(Tc.Provider,{value:n,children:s(hr.Provider,{value:o.length,children:s(G,{gap:1,children:o.map(([i,r],a)=>s(mr,{title:i,index:a,zIndex:100,children:r},i))})})})}function mr({index:e,title:t,children:n,zIndex:o,top:i=0,bottom:r=0}){const{t:a}=he("page_optimize"),[l,d]=bd(),c=g.useContext(hr),u=g.useContext(pr);return y(Ut,{children:[s(B,{sx:p=>({outline:`2px solid ${p.palette.secondary.main}`,position:"sticky",top:u+e*jt+i,bottom:lx+(c-1-e)*jt+r,zIndex:o}),children:s(Al,{onClick:d,sx:{px:2},children:s(I,{variant:"h6",children:a(`${t}`)})})}),s(E,{ref:l,sx:{scrollMarginTop:u+(e+1)*jt+i},children:n})]})}function ux(){const e=J(),{key:t}=e,[n,o]=g.useState(void 0),i=g.useCallback(()=>{e!=null&&e.key&&o(e.key)},[e]),r=g.useMemo(()=>[["eq",s(ex,{onClick:i},"eq")],["Conditionals",s(mx,{},"conditionals")],["bonusStats",s(hy,{},"bonusStats")],["enemyStats",s(by,{},"enemyStats")]],[i]),a=pc(),l=Rl(a.breakpoints.up("sm"));return y(Ut,{children:[s(Gl,{characterKey:n,onClose:()=>o(void 0)}),y(G,{spacing:1,children:[s(B,{sx:{overflow:"visible"},children:s(V,{sx:{display:"flex",gap:1,overflow:"visible"},children:y(ne,{container:!0,spacing:2,sx:{flexWrap:"wrap",overflow:"visible"},children:[s(ne,{item:!0,xs:12,sm:7,md:5,lg:4,xl:3,sx:{height:l?"100%":void 0,overflow:"visible"},children:y(G,{spacing:1,sx:l?{height:"100%"}:void 0,children:[s(Ul,{characterKey:t,onClick:i}),s(E,{sx:{flexGrow:1},children:s(E,{sx:l?{position:"sticky",top:"115px",bottom:"0px"}:void 0,children:s(ur,{})})})]})}),s(ne,{item:!0,xs:12,sm:5,md:7,lg:8,xl:9,children:s(G,{spacing:1.5,children:r.map(([d,c],u)=>s(mr,{title:d,index:u,zIndex:99,top:jt,bottom:jt*2,children:c},d))})})]})})}),s(Jd,{formulasRead:z.listing.formulas,buffsRead:z.listing.buffs})]})]})}function px(){return s(Xy,{})}function hx(){const{key:e}=J(),{optConfigId:t}=ee(e);return t?s(Rc,{optConfigId:t,children:s(ix,{})}):null}function mx(){const{equippedDiscs:e,equippedWengine:t}=J(),n=Dc(e),o=ql(n),i=Sc(t);return s(E,{children:y(ne,{container:!0,spacing:1,columns:{xs:1,sm:1,md:2,lg:3},children:[i&&s(ne,{item:!0,xs:1,children:s(nr,{wengine:i})}),Object.entries(o).map(([r,a])=>s(ne,{item:!0,xs:1,children:s(er,{setKey:r,fade2:a<2,fade4:a<4})},r))]})})}const uc={avg:"Average",crit:"Crit Hit",nonCrit:"Non-Crit Hit"};function fx(){const{database:e}=P(),t=J(),n=ee(t.key),{critMode:o}=n;return s(se,{title:y(E,{sx:{textWrap:"nowrap"},children:["Hit mode: ",uc[o]]}),children:zl.map(i=>s(O,{selected:o===i,disabled:o===i,onClick:()=>e.charOpts.set(t.key,{critMode:i}),children:uc[i]},i))})}const gx=[z.final.atk,z.final.hp,z.final.def,z.final.enerRegen,z.final.anomProf,z.final.anomMas];function yx({character:{key:e},charOpt:{target:t}}){const n=Le(),{database:o}=P(),i=g.useMemo(()=>{if(t)return Ac(t)},[t]);return y(se,{color:i?"success":"warning",title:i?y(E,{sx:{display:"flex",gap:1},children:[s("strong",{children:"Optimization Target: "}),s(bn,{tag:i})]}):"Select an Optimization Target",variant:i?"outlined":void 0,sx:{height:"100%",flexGrow:1},children:[n==null?void 0:n.listFormulas(z.listing.formulas).map(({tag:r},a)=>{const{name:l,sheet:d}=r;if(!(!l||!d))return s(O,{onClick:()=>o.charOpts.set(e,{target:{sheet:d,name:l}}),children:s(ho,{children:s(E,{sx:{display:"flex",gap:1},children:s(bn,{tag:r})})})},`${a}_${r.sheet}_${r.name}`)}),gx.map(({tag:r},a)=>{const{q:l,qt:d}=r;if(!(!l||!d))return s(O,{onClick:()=>o.charOpts.set(e,{target:{q:l,qt:d}}),children:s(ho,{children:s(E,{sx:{display:"flex",gap:1},children:s(bn,{tag:r})})})},`${a}_${l}_${d}`)})]})}function xx(){const{database:e}=P(),t=J(),n=ee(t.key),{target:o}=n,i=g.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType1:l,...d}=a;return r?{target:{...d,damageType1:r}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(dr,{dmgType:o==null?void 0:o.damageType1,keys:_c,setDmgType:i})}function bx({character:e,charOpt:t}){return y(E,{display:"flex",gap:1,sx:{position:"sticky",top:36,zIndex:100,background:"#0C1020"},children:[s(yx,{character:e,charOpt:t}),s(wx,{}),s(xx,{}),s($x,{}),s(fx,{})]})}function $x(){const{database:e}=P(),t=J(),n=ee(t.key),{target:o}=n,i=g.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType2:l,...d}=a;return r?{target:{...d,damageType2:"aftershock"}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(lr,{isAftershock:(o==null?void 0:o.damageType2)==="aftershock",setAftershock:i})}function wx(){const{database:e}=P(),t=J(),n=ee(t.key),{target:o}=n,{q:i,qt:r}=o??{};return!i||!r?null:s(se,{title:Lt[r],children:["final","initial"].map(a=>s(O,{selected:a===r,disabled:a===r,onClick:()=>e.charOpts.set(t.key,{target:{q:i,qt:a}}),children:Lt[a]},a))})}function Nx(){const{database:e}=P(),{optCharKey:t}=Fl(e.dbMeta),n=t??Pl[0],[o,i,r]=Os(),a=g.useCallback(C=>e.dbMeta.set({optCharKey:C}),[e.dbMeta]),{t:l}=he(["charNames_gen","page_character"]),d=Jl(n);g.useEffect(()=>{n&&!d&&e.chars.getOrCreate(n)},[n,d,e.chars]);const c=ee(n);g.useEffect(()=>{n&&!c&&e.charOpts.getOrCreate(n)},[n,c,e.charOpts]),$d(g.useMemo(()=>{const C=n&&l(`charNames_gen:${n}`);return C?`Optimize - ${C}`:"Optimize"},[n,l]));const u=g.useMemo(()=>{const S=Me(n?[n]:[],M=>s(Xl,{characterKey:M}));return{srcDisplay:S,dstDisplay:S}},[n]),p=g.useCallback((C,S,M,A,X)=>{!Vl(C)||!mo(M)||!(A===null||mo(A))||!Ol(C,S)||e.charOpts.setConditional(n,C,S,M,A,X)},[n,e.charOpts]),h=g.useMemo(()=>({src:n,dst:n,preset:"preset0"}),[n]),[m,b]=g.useState(),x=g.useMemo(()=>({read:m,setRead:b}),[m]);return s(_x,{children:y(E,{children:[s(g.Suspense,{fallback:!1,children:s(Ql,{show:o,onHide:r,onSelect:a})}),s(E,{sx:{position:"sticky",top:0,zIndex:100,background:"#0C1020"},children:s(U,{fullWidth:!0,color:Pc(n).attribute,sx:{justifyContent:"flex-start",pl:"6px"},onClick:i,children:y(E,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(qs,{size:2,src:jl(n,"circle")}),l(`charNames_gen:${n}`)]})})}),d&&c&&s(qc.Provider,{value:d,children:s(Ft.Provider,{value:h,children:s(cr,{character:d,charOpt:c,wengineId:d.equippedWengine,discIds:d.equippedDiscs,children:s(Bl.Provider,{value:u,children:s(Wl.Provider,{value:c.conditionals,children:s(Nl.Provider,{value:p,children:y(Rs.Provider,{value:x,children:[s(Xd,{}),y(E,{sx:{display:"flex",gap:1,flexDirection:"column",mt:1},children:[s(bx,{character:d,charOpt:c}),s(pr.Provider,{value:74,children:s(dx,{})})]})]})})})})})})})]})})}function _x({children:e}){return s(Hl.Provider,{value:ar,children:s(Kl.Provider,{value:ce,children:s(Ll.Provider,{value:bn,children:e})})})}export{Nx as default};
