import{N as Y,c5 as Z,c as r,bT as ee,j as t,cl as T,cm as ae,d as m,b3 as te,cn as re,co as se,n as w,cp as ce,h as ne,u as le,cq as ie,a2 as oe,ca as he,i as ue,k as de,cr as pe,cs as b,l as ge,m as ye,e as me,G as i,ct as fe,cu as Ce,a1 as xe,cv as be,C as Se,A as Te,B as we,S as j,b_ as ke,bf as Me}from"./index-CLywPHVD.js";import{C as ve,c as De,a as Ee,d as Ie,e as je,f as B,g as S}from"./CharacterEditor-DLbf4S77.js";import"./useDataEntryBase-89FTvLas.js";import"./discSortUtil-DGDdw8GP.js";function Be({value:o,totals:a,onChange:n,...u}){const g=Y(),h=!Z(g.breakpoints.up("sm")),p=r.useMemo(()=>ee([...T]),[]),f=r.useCallback(c=>()=>n(p(o,c)),[n,p,o]);return t(ce,{exclusive:!0,value:o,...u,children:T.map(c=>t(ae,{value:c,sx:{p:h?1:void 0,minWidth:h?0:"6em",display:"flex",gap:h?0:1},selectedColor:"primary",onClick:f(c),children:m(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[t(te,{src:re(c),size:1.5,sideMargin:!0}),!h&&t(se,{label:a[c],size:"small"})]})},c))})}const Fe={xs:1,sm:2,md:2,lg:3,xl:4},Ke={xs:1,sm:2,md:2,lg:3,xl:12},Ne=Object.keys(B);function _e(){const{t:o}=ne("page_characters"),{database:a}=le(),n=ie(),{params:{characterKey:u}}=oe({path:"/characters/:characterKey",end:!1})??{params:{}},[g,h]=r.useState(()=>a.displayCharacter.get());r.useEffect(()=>a.displayCharacter.follow((e,s)=>h(s)),[a,h]);const[p,f]=r.useState(""),c=r.useDeferredValue(p),k=r.useMemo(()=>u?he.includes(u)?u:(n("/characters"),null):null,[u,n]),[F,M]=r.useState(!1),[K,v]=ue();r.useEffect(()=>a.chars.followAny((e,s)=>(s==="new"||s==="remove")&&v()),[v,a]);const N=r.useCallback(e=>{a.chars.get(e)||a.chars.getOrCreate(e),n(`/characters/${e}`)},[a.chars,n]),D=r.useDeferredValue(g),E=r.useDeferredValue(K),{charKeys:d,totalCharNum:C}=r.useMemo(()=>{const s=a.chars.keys.length,{attribute:l,specialtyType:y,rarity:q,sortType:J,ascending:L}=D,X=a.chars.keys.filter(de({attribute:l,specialtyType:y,rarity:q,name:c},Ie(a))).sort(pe(B[J]??[],L,je(a),["new"]));return E&&{charKeys:X,totalCharNum:s}},[a,D,c,E]),{specialtyType:z,attribute:A,rarity:O,sortType:P,ascending:_}=g,$=r.useMemo(()=>b(ke,e=>a.chars.entries.forEach(([s,l])=>{const y=S(l.key).specialty;e[y].total++,a.chars.keys.includes(s)&&e[y].current++})),[a]),G=r.useMemo(()=>b(Me,e=>Object.entries(a.chars.data).forEach(([s])=>{const l=S(s).attribute;e[l].total++,a.chars.keys.includes(s)&&e[l].current++})),[a]),R=r.useMemo(()=>b(T,e=>Object.entries(a.chars.data).forEach(([s])=>{const l=S(s).rarity;e[l].total++,a.chars.keys.includes(s)&&e[l].current++})),[a]),H=ge(),{numShow:I,setTriggerElement:U}=ye(Ke[H],d.length),x=r.useMemo(()=>d.slice(0,I),[d,I]),V=d.length!==C?`${d.length}/${C}`:`${C}`,W={numShowing:x.length,total:V,t:o,namespace:"page_character"},Q={sortKeys:[...Ne],value:P,onChange:e=>a.displayCharacter.set({sortType:e}),ascending:_,onChangeAsc:e=>a.displayCharacter.set({ascending:e})};return m(w,{display:"flex",flexDirection:"column",gap:2,children:[k&&t(ve,{characterKey:k,onClose:()=>n("/characters")}),t(r.Suspense,{fallback:!1,children:t(De,{show:F,onHide:()=>M(!1),onSelect:N,newFirst:!0})}),t(Se,{children:m(me,{sx:{display:"flex",flexDirection:"column",gap:1},children:[m(i,{container:!0,spacing:1,children:[t(i,{item:!0,children:t(fe,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({specialtyType:e}),value:z,totals:$,size:"small"})}),t(i,{item:!0,children:t(Ce,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({attribute:e}),value:A,totals:G,size:"small"})}),t(i,{item:!0,children:t(Be,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({rarity:e}),value:O,totals:R,size:"small"})}),t(i,{item:!0,flexGrow:1}),t(i,{item:!0,children:t(xe,{autoFocus:!0,value:p,onChange:e=>f(e.target.value),label:o("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(w,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:t(be,{showingTextProps:W,sortByButtonProps:Q})})]})}),t(we,{fullWidth:!0,onClick:()=>M(!0),color:"info",startIcon:t(Te,{}),children:o("addNew")}),t(r.Suspense,{fallback:t(j,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(i,{container:!0,spacing:2,columns:Fe,children:x.map(e=>t(i,{item:!0,xs:1,children:t(Ee,{characterKey:e,onClick:()=>n(`${e}`)})},e))})}),d.length!==x.length&&t(j,{ref:e=>{e&&U(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{_e as default};
