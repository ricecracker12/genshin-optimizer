import{u as v,a as H,r as _,b as W,c as G,g as K,d as i,j as e,C,e as l,f as b,G as p,T as w,t as T,B as I,h as L,R as P,D as N,S as y,i as M,k as V,l as U,m as $,n as J,o as S,A as Q,p as X,F as Y,M as Z,q as ee,I as te,s as se,v as ne,w as ie,x as ae,y as re,z as q,E as ce}from"./index-CUBBuIT4.js";import{d as oe}from"./discSortUtil-BDERHFB1.js";function A(){const{database:a}=v();return H(a.displayDisc)}var x={},F;function le(){if(F)return x;F=1;var a=_();Object.defineProperty(x,"__esModule",{value:!0}),x.default=void 0;var r=a(W()),t=G(),s=(0,r.default)((0,t.jsx)("path",{d:"M18 23H4c-1.1 0-2-.9-2-2V7h2v14h14v2zM15 1H8c-1.1 0-1.99.9-1.99 2L6 17c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V7l-6-6zm1.5 14h-6v-2h6v2zm0-6h-2v2h-2V9h-2V7h2V5h2v2h2v2z"}),"Difference");return x.default=s,x}var de=le();const O=K(de);function ue({numShowing:a,total:r,discIds:t}){const s=v().database,{filterOption:d}=A(),c=i.useCallback(n=>s.displayDisc.set({filterOption:{...d,...n}}),[s,d]);return e(i.Suspense,{fallback:e(y,{variant:"rectangular",width:"100%",height:300}),children:e(C,{children:l(b,{children:[l(p,{container:!0,children:[e(p,{item:!0,children:e(w,{variant:"h6",children:T("discFilter")})}),e(p,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:l(w,{children:[e("strong",{children:a})," / ",r]})}),e(p,{item:!0,children:e(I,{size:"small",color:"error",onClick:()=>s.displayDisc.set({action:"reset"}),startIcon:e(P,{}),children:e(L,{t:T,i18nKey:"ui:reset"})})})]}),e(i.Suspense,{fallback:e(y,{variant:"rectangular",width:"100%",height:400}),children:e(N,{filterOption:d,filterOptionDispatch:c,filteredIds:t})})]})})})}const R={xs:2,sm:3,md:4,lg:4,xl:6},he={xs:10,sm:12,md:24,lg:24,xl:24};function fe({onAdd:a,onEdit:r,onShowDup:t}){const{t:s}=M("disc"),{database:d}=v(),c=A(),n=i.useMemo(()=>oe(),[]),u=i.useDeferredValue(c),h=V(d.discs),f=h.length,{filterOption:m}=u,o=i.useMemo(()=>h.filter(U(m,n)).map(g=>g.id),[h,m,n]),D=$(),z=o.length!==f?`${o.length}/${f}`:f,{numShow:E,setTriggerElement:B}=J(he[D],o.length),k=i.useMemo(()=>o.slice(0,E),[o,E]),j={numShowing:k.length,totalShowing:z};return l(Y,{children:[e(ue,{numShowing:f,total:f,discIds:o}),e(C,{bgt:"dark",children:e(b,{children:e(S,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:l(w,{color:"text.secondary",children:["Showing ",e("b",{children:j.numShowing})," out of"," ",j.totalShowing," Items"]})})})}),l(p,{container:!0,columns:R,spacing:1,children:[e(p,{item:!0,xs:!0,children:e(I,{fullWidth:!0,onClick:a,color:"info",startIcon:e(Q,{}),children:s("addNew")})}),e(p,{item:!0,xs:1,children:e(I,{fullWidth:!0,onClick:t,color:"info",startIcon:e(O,{}),children:s("showDupes")})})]}),l(i.Suspense,{fallback:e(y,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[e(S,{children:e(p,{container:!0,columns:R,spacing:1,children:k.map(g=>e(p,{item:!0,xs:1,children:e(X,{discId:g,onEdit:r},g)},g))})}),o.length!==k.length&&e(y,{ref:g=>{g&&B(g)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function pe({setDiscToEdit:a,show:r,onHide:t}){const{t:s}=M("disc");return e(Z,{open:r,onClose:t,children:l(C,{children:[e(ee,{title:l(w,{variant:"h6",flexGrow:1,display:"flex",alignItems:"center",children:[e(O,{sx:{verticalAlign:"text-top",mr:1}}),s("showDupes")]}),action:e(te,{onClick:t,children:e(se,{})})}),e(ne,{}),e(b,{children:e(ge,{setDiscToEdit:a})})]})})}function ge({setDiscToEdit:a}){const{t:r}=M("disc"),{database:t}=v(),s=V(t.discs),d=i.useMemo(()=>{const c=[],n=s&&[...t.discs.keys];for(;n.length!==0;){const u=n.shift();if(!u)continue;const h=t.discs.get(u);if(!h)continue;const{duplicated:f}=t.discs.findDups(h,n);if(!f.length)continue;const m=f;c.push([h,...m].sort(o=>{var D;return((D=t.discs.get(o.location))==null?void 0:D.location)??""?-1:1}))}return c},[t.discs,s]);return l(re,{spacing:2,children:[d.map(c=>e(C,{sx:{overflowX:"scroll"},children:e(b,{sx:{display:"flex",gap:1},children:c.map(n=>e(S,{sx:{minWidth:300},children:e(ie,{disc:n,setLocation:u=>t.discs.set(n.id,{location:u}),onLockToggle:()=>t.discs.set(n.id,({lock:u})=>({lock:!u})),onDelete:()=>t.discs.remove(n.id),onEdit:()=>a(n.id)})},n.id))})},c.join())),!d.length&&e(ae,{variant:"filled",severity:"success",children:r("noDupAlert")})]})}function xe(){const[a,r]=i.useState({}),[t,s,d]=q(),[c,n,u]=q(!1),{database:h}=v(),f=i.useCallback(()=>{r({}),s()},[s]),m=i.useCallback(o=>{const D=h.discs.get(o);D&&(r(D),s())},[h.discs,s]);return l(S,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(i.Suspense,{fallback:!1,children:e(ce,{disc:a,allowEmpty:!0,allowUpload:!0,show:t,onClose:d,onShow:s,cancelEdit:()=>r({})})}),e(i.Suspense,{fallback:!1,children:e(pe,{show:c,onHide:u,setDiscToEdit:m})}),e(fe,{onAdd:f,onEdit:m,onShowDup:n})]})}export{xe as default};
