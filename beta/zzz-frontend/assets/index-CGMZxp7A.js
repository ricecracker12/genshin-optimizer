var Nt=t=>{throw TypeError(t)};var jt=(t,e,s)=>e.has(t)||Nt("Cannot "+s);var le=(t,e,s)=>(jt(t,e,"read from private field"),s?s.call(t):e.get(t)),fe=(t,e,s)=>e.has(t)?Nt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),L=(t,e,s,r)=>(jt(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);import{z as Ge,E as Ue,c as f,H as Ve,J as $n,K as Bn,_ as Xe,L as A,N as Yt,O as Fn,P as Hn,Q as B,U as ae,V as Te,W as Je,X as qt,Y as Kn,Z as Gn,$ as Un,a0 as Vn,j as n,a1 as Xn,h as Q,a2 as Jn,a3 as Qe,a4 as se,a5 as Fe,a6 as Qn,a7 as en,a8 as ct,a9 as Zn,i as Yn,u as E,d as m,aa as es,T as S,ab as R,ac as H,ad as ts,ae as ns,r as bt,a as yt,b as Ct,g as vt,af as Ze,ag as wt,ah as tn,ai as te,p as Ae,I as pe,q as Ye,e as T,C as O,aj as lt,s as U,ak as J,M as kt,al as oe,am as ss,an as rs,n as v,ao as is,ap as nn,aq as os,F as et,ar as Pt,as as zt,at as He,au as as,av as St,aw as cs,ax as ls,w as W,ay as sn,az as ds,aA as tt,aB as us,aC as ps,aD as Re,aE as _t,aF as dt,aG as Lt,aH as hs,aI as rn,aJ as fs,B as N,aK as j,aL as on,aM as ms,aN as an,aO as cn,aP as gs,aQ as xe,aR as nt,aS as xs,aT as bs,aU as ys,aV as Mt,aW as Dt,aX as Cs,aY as vs,aZ as ws,a_ as ut,a$ as pt,b0 as $t,b1 as it,b2 as ks,b3 as Ss,b4 as Ms,b5 as Ds,b6 as V,b7 as Bt,b8 as Es,b9 as we,ba as Et,G as F,bb as st,bc as Is,bd as Ft,x as It,S as ln,be as Ts,bf as Ht,bg as Rs,bh as As,bi as Os,bj as Ws,bk as Ns,bl as Kt,bm as js,bn as dn,bo as un,bp as pn,bq as qs,br as hn,bs as fn,bt as Ps,bu as zs,bv as ne,bw as _s,bx as Ls,by as $s,bz as Bs,bA as Fs,bB as Gt,bC as Hs,bD as Ks,bE as Gs,bF as Ut,bG as Us,bH as Vs,bI as Xs,bJ as Js,bK as Qs,bL as Zs,bM as Ys,bN as er}from"./index-D6jllUwH.js";import{u as tr}from"./useDataEntryBase-CmLxRlN2.js";import{D as nr,b as sr,a as rr,c as mn,d as gn,e as ir,w as or,g as ar,T as re,f as ht,u as K,q as Ke,A as ke,h as cr,C as xn,i as bn,j as yn,k as Cn,l as lr,m as dr,F as Be,n as ur,o as pr,p as hr}from"./tagFieldMap-DriByd-9.js";import"./discSortUtil-Bn_MGDB2.js";function fr(t){return Ge("MuiCollapse",t)}Ue("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const mr=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],gr=t=>{const{orientation:e,classes:s}=t,r={root:["root",`${e}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${e}`],wrapperInner:["wrapperInner",`${e}`]};return Je(r,fr,s)},xr=ae("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,e[s.orientation],s.state==="entered"&&e.entered,s.state==="exited"&&!s.in&&s.collapsedSize==="0px"&&e.hidden]}})(({theme:t,ownerState:e})=>A({height:0,overflow:"hidden",transition:t.transitions.create("height")},e.orientation==="horizontal"&&{height:"auto",width:0,transition:t.transitions.create("width")},e.state==="entered"&&A({height:"auto",overflow:"visible"},e.orientation==="horizontal"&&{width:"auto"}),e.state==="exited"&&!e.in&&e.collapsedSize==="0px"&&{visibility:"hidden"})),br=ae("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(t,e)=>e.wrapper})(({ownerState:t})=>A({display:"flex",width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),yr=ae("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(t,e)=>e.wrapperInner})(({ownerState:t})=>A({width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),Tt=f.forwardRef(function(e,s){const r=Ve({props:e,name:"MuiCollapse"}),{addEndListener:o,children:c,className:a,collapsedSize:l="0px",component:p,easing:i,in:d,onEnter:u,onEntered:h,onEntering:g,onExit:b,onExited:x,onExiting:y,orientation:C="vertical",style:w,timeout:D=Bn.standard,TransitionComponent:$=$n}=r,I=Xe(r,mr),q=A({},r,{orientation:C,collapsedSize:l}),M=gr(q),z=Yt(),Z=Fn(),_=f.useRef(null),P=f.useRef(),X=typeof l=="number"?`${l}px`:l,ie=C==="horizontal",ce=ie?"width":"height",We=f.useRef(null),Wn=Hn(s,We),he=k=>G=>{if(k){const Y=We.current;G===void 0?k(Y):k(Y,G)}},rt=()=>_.current?_.current[ie?"clientWidth":"clientHeight"]:0,Nn=he((k,G)=>{_.current&&ie&&(_.current.style.position="absolute"),k.style[ce]=X,u&&u(k,G)}),jn=he((k,G)=>{const Y=rt();_.current&&ie&&(_.current.style.position="");const{duration:Se,easing:Ne}=qt({style:w,timeout:D,easing:i},{mode:"enter"});if(D==="auto"){const Wt=z.transitions.getAutoHeightDuration(Y);k.style.transitionDuration=`${Wt}ms`,P.current=Wt}else k.style.transitionDuration=typeof Se=="string"?Se:`${Se}ms`;k.style[ce]=`${Y}px`,k.style.transitionTimingFunction=Ne,g&&g(k,G)}),qn=he((k,G)=>{k.style[ce]="auto",h&&h(k,G)}),Pn=he(k=>{k.style[ce]=`${rt()}px`,b&&b(k)}),zn=he(x),_n=he(k=>{const G=rt(),{duration:Y,easing:Se}=qt({style:w,timeout:D,easing:i},{mode:"exit"});if(D==="auto"){const Ne=z.transitions.getAutoHeightDuration(G);k.style.transitionDuration=`${Ne}ms`,P.current=Ne}else k.style.transitionDuration=typeof Y=="string"?Y:`${Y}ms`;k.style[ce]=X,k.style.transitionTimingFunction=Se,y&&y(k)}),Ln=k=>{D==="auto"&&Z.start(P.current||0,k),o&&o(We.current,k)};return B.jsx($,A({in:d,onEnter:Nn,onEntered:qn,onEntering:jn,onExit:Pn,onExited:zn,onExiting:_n,addEndListener:Ln,nodeRef:We,timeout:D==="auto"?null:D},I,{children:(k,G)=>B.jsx(xr,A({as:p,className:Te(M.root,a,{entered:M.entered,exited:!d&&X==="0px"&&M.hidden}[k]),style:A({[ie?"minWidth":"minHeight"]:X},w),ref:Wn},G,{ownerState:A({},q,{state:k}),children:B.jsx(br,{ownerState:A({},q,{state:k}),className:M.wrapper,ref:_,children:B.jsx(yr,{ownerState:A({},q,{state:k}),className:M.wrapperInner,children:c})})}))}))});Tt.muiSupportAuto=!0;const vn=f.createContext({});function Cr(t){return Ge("MuiAccordion",t)}const je=Ue("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),vr=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],wr=t=>{const{classes:e,square:s,expanded:r,disabled:o,disableGutters:c}=t;return Je({root:["root",!s&&"rounded",r&&"expanded",o&&"disabled",!c&&"gutters"],region:["region"]},Cr,e)},kr=ae(Un,{name:"MuiAccordion",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[{[`& .${je.region}`]:e.region},e.root,!s.square&&e.rounded,!s.disableGutters&&e.gutters]}})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],e),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],e)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${je.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${je.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}},({theme:t})=>({variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${je.expanded}`]:{margin:"16px 0"}}}]})),qe=f.forwardRef(function(e,s){const r=Ve({props:e,name:"MuiAccordion"}),{children:o,className:c,defaultExpanded:a=!1,disabled:l=!1,disableGutters:p=!1,expanded:i,onChange:d,square:u=!1,slots:h={},slotProps:g={},TransitionComponent:b,TransitionProps:x}=r,y=Xe(r,vr),[C,w]=Kn({controlled:i,default:a,name:"Accordion",state:"expanded"}),D=f.useCallback(ie=>{w(!C),d&&d(ie,!C)},[C,d,w]),[$,...I]=f.Children.toArray(o),q=f.useMemo(()=>({expanded:C,disabled:l,disableGutters:p,toggle:D}),[C,l,p,D]),M=A({},r,{square:u,disabled:l,disableGutters:p,expanded:C}),z=wr(M),Z=A({transition:b},h),_=A({transition:x},g),[P,X]=Gn("transition",{elementType:Tt,externalForwardedProps:{slots:Z,slotProps:_},ownerState:M});return B.jsxs(kr,A({className:Te(z.root,c),ref:s,ownerState:M,square:u},y,{children:[B.jsx(vn.Provider,{value:q,children:$}),B.jsx(P,A({in:C,timeout:"auto"},X,{children:B.jsx("div",{"aria-labelledby":$.props.id,id:$.props["aria-controls"],role:"region",className:z.region,children:I})}))]}))});function Sr(t){return Ge("MuiAccordionDetails",t)}Ue("MuiAccordionDetails",["root"]);const Mr=["className"],Dr=t=>{const{classes:e}=t;return Je({root:["root"]},Sr,e)},Er=ae("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>({padding:t.spacing(1,2,2)})),Pe=f.forwardRef(function(e,s){const r=Ve({props:e,name:"MuiAccordionDetails"}),{className:o}=r,c=Xe(r,Mr),a=r,l=Dr(a);return B.jsx(Er,A({className:Te(l.root,o),ref:s,ownerState:a},c))});function Ir(t){return Ge("MuiAccordionSummary",t)}const ge=Ue("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),Tr=["children","className","expandIcon","focusVisibleClassName","onClick"],Rr=t=>{const{classes:e,expanded:s,disabled:r,disableGutters:o}=t;return Je({root:["root",s&&"expanded",r&&"disabled",!o&&"gutters"],focusVisible:["focusVisible"],content:["content",s&&"expanded",!o&&"contentGutters"],expandIconWrapper:["expandIconWrapper",s&&"expanded"]},Ir,e)},Ar=ae(Vn,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],e),[`&.${ge.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${ge.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${ge.disabled})`]:{cursor:"pointer"},variants:[{props:s=>!s.disableGutters,style:{[`&.${ge.expanded}`]:{minHeight:64}}}]}}),Or=ae("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(t,e)=>e.content})(({theme:t})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${ge.expanded}`]:{margin:"20px 0"}}}]})),Wr=ae("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(t,e)=>e.expandIconWrapper})(({theme:t})=>({display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${ge.expanded}`]:{transform:"rotate(180deg)"}})),ze=f.forwardRef(function(e,s){const r=Ve({props:e,name:"MuiAccordionSummary"}),{children:o,className:c,expandIcon:a,focusVisibleClassName:l,onClick:p}=r,i=Xe(r,Tr),{disabled:d=!1,disableGutters:u,expanded:h,toggle:g}=f.useContext(vn),b=C=>{g&&g(C),p&&p(C)},x=A({},r,{expanded:h,disabled:d,disableGutters:u}),y=Rr(x);return B.jsxs(Ar,A({focusRipple:!1,disableRipple:!0,disabled:d,component:"div","aria-expanded":h,className:Te(y.root,c),focusVisibleClassName:Te(y.focusVisible,l),onClick:b,ref:s,ownerState:x},i,{children:[B.jsx(Or,{className:y.content,ownerState:x,children:o}),a&&B.jsx(Wr,{className:y.expandIconWrapper,ownerState:x,children:a})]}))});function Nr({value:t,onChange:e,...s}){const[r,o]=f.useState(t);f.useEffect(()=>{o(t)},[t]);const c=()=>e(r);return n(Xn,{value:r,onChange:a=>o(a.target.value),onBlur:c,onKeyDown:a=>a.key==="Enter"&&!s.multiline&&c(),...s})}function jr(){const t=f.useRef(),e=f.useCallback(()=>{var s;return(s=t.current)==null?void 0:s.scrollIntoView({behavior:"smooth"})},[t]);return[t,e]}function qr(t){const{t:e}=Q("ui"),s=Jn({path:"/:page/*"}),r=e("pageTitle"),o=t??((s==null?void 0:s.params.page)&&e(`tabs.${s==null?void 0:s.params.page}`));f.useEffect(()=>{o?document.title=`${o} - ${r}`:document.title=r},[e,r,o])}class wn{constructor(){this.internal=new Rt}ref(e){return e.reduce((s,r)=>s.get(r),this.internal)}*[Symbol.iterator](){for(const[e,s]of this.internal.entries([]))"value"in s&&(yield[[...e],s.value])}*values(){for(const e of this.internal.allRefs())"value"in e&&(yield e.value)}}class Rt{constructor(){this.map=new Map}get(e){const s=this.map.get(e);if(s)return s;const r=new Rt;return this.map.set(e,r),r}*allRefs(){for(const e of this.map.values())yield*e.allRefs();yield this}*entries(e){const s=e.push(void 0)-1;for(const[r,o]of this.map.entries())e[s]=r,yield*o.entries(e);e.pop(),yield[e,this]}}function Pr(t,e,s){function r(a,l){if(a.val)return a.val;const p=s(a.tag);return a.val=p?[Fe(p,l)]:e.nodes.subset(a.id).flatMap(i=>i.op!=="reread"?c(i,a):r(a.with(i.tag),l)),a.val}function o(a,l){return a.every(p=>p.op==="const")?se(rr[l](a.map(p=>p.ex))):{op:l,x:a,br:[]}}function c(a,l){const{op:p}=a;switch(p){case"const":return a;case"read":{const i=l.with(a.tag),d=a.ex??e.defaultAccu(i.tag)??"unique",u=r(i,d);return d==="unique"?u[0]??se(void 0):o(u,d)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const i=a.x.map(d=>c(d,l));return o(i,p)}case"thres":case"match":case"lookup":{const i=a.br.map(d=>c(d,l));if(i.every(d=>d.op==="const")){const d=i.map(h=>h.ex),u=sr[a.op](d,a.ex);return c(a.x[u],l)}return{...a,x:a.x.map(d=>c(d,l)),br:i}}case"subscript":{const i=c(a.br[0],l);return i.op==="const"?se(a.ex[i.ex]):{...a,br:[i]}}case"vtag":return se(l.tag[a.ex]??"");case"tag":return c(a.x[0],l.with(a.tag));case"dtag":{const i=a.br.map(u=>c(u,l));if(i.some(u=>u.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const d=l.with(Object.fromEntries(i.map((u,h)=>[a.ex[h],u.ex])));return c(a.x[0],d)}case"custom":return{...a,x:a.x.map(i=>c(i,l))};default:Qe(p)}}return t.map(a=>c(a,new nr(e.cache.keys).at({})))}function Oe(t,e){const s=new Map;function r(o){const c=s.get(o);if(c)return c;const a=o,l=ot(o.x,r),p=ot(o.br,r);(o.x!==l||o.br!==p)&&(o={...o,x:l,br:p});const i=e(o,a);return s.set(o,i),i}return ot(t,r)}function ft(t,e){const s=new Set;function r(o){s.has(o)||(e(o,r),s.add(o))}t.forEach(r)}function ot(t,e){const s=t.map(e);return t.every((r,o)=>r===s[o])?t:s}const{arithmetic:Vt}=mn;function zr(t){return t=_r(t),t=Lr(t),t=$r(t),t}function _r(t){return Oe(t,e=>{const{op:s}=e;switch(s){case"sum":case"prod":case"min":case"max":if(e.x.length===1)return e.x[0];if(e.x.some(r=>r.op===s)){const r=e.x.flatMap(o=>o.op===s?o.x:[o]);return{...e,x:r}}}return e})}function Lr(t){return Oe(t,e=>{const{op:s}=e;switch(s){case"sum":case"prod":case"min":case"max":{const r=e.x.filter(o=>o.op==="const");if(r.length>1){const o=e.x.filter(a=>a.op!=="const"),c=Vt[s](r.map(a=>a.ex));return c===Vt[s]([])?{...e,x:o}:{...e,x:[se(c),...o]}}}}return e})}function $r(t){const e=new Map,s=new wn;return Oe(t,r=>{const{op:o}=r,c=r.x.map(i=>e.get(i)),a=r.br.map(i=>e.get(i));let l;switch(o){case"read":{const i=Object.keys(r.tag).sort();l=[o,r.ex,...i,...i.map(d=>r.tag[d])];break}case"sum":case"prod":case"min":case"max":l=[o,...c.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":l=[o,r.ex,...c,...a];break;case"match":l=[o,r.ex,...c,...a.sort()];break;default:Qe(o)}const p=s.ref(l);return"value"in p?p.value:(p.value=r,e.set(r,e.size),r)})}const{arithmetic:Br,branching:Fr}=mn;function Hr(t,e,s,r,o){const c=new Kr(t,r,e,s);for(;c.progress;)c.progress=!1,Gr(c),Ur(c,1),Xr(c),Vr(c,o);return c.nodes=zr(c.nodes),c}var ue,be,ye,Ce,ve;class Kr{constructor(e,s,r,o){fe(this,ue);fe(this,be);fe(this,ye);fe(this,Ce);fe(this,ve);this.progress=!0,L(this,ue,e),this.minimum=s,L(this,be,r),this.cat=o}get nodes(){return le(this,ue)}set nodes(e){le(this,ue)!==e&&(this.progress=!0,L(this,ue,e),L(this,Ce,L(this,ve,void 0)))}get candidates(){return le(this,be)}set candidates(e){this.candidates!==e&&(this.progress=!0,L(this,be,e),L(this,ye,L(this,Ce,L(this,ve,void 0))))}get cndRanges(){return le(this,ye)??L(this,ye,this.candidates.map(mt))}set cndRanges(e){L(this,ye,e)}get nodeRanges(){return le(this,Ce)??L(this,Ce,kn(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return le(this,ve)??L(this,ve,Jr(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}ue=new WeakMap,be=new WeakMap,ye=new WeakMap,Ce=new WeakMap,ve=new WeakMap;function Gr(t){const{nodes:e,nodeRanges:s}=t,r=Oe(e,(o,c)=>{const a=s.get(c);if(a.min===a.max)return c.op==="const"?o:se(a.min);switch(c.op){case"thres":{const[l,p]=c.br.map(i=>s.get(i));if(l.min>=p.max)return o.x[0];if(l.max<p.min)return o.x[1];break}case"min":{const l=o.x.filter((p,i)=>s.get(c.x[i]).min<=a.max);if(l.length===1)return l[0];if(l.length!==o.x.length)return Zn(...l);break}case"max":{const l=o.x.filter((p,i)=>s.get(c.x[i]).max>=a.min);if(l.length===1)return l[0];if(l.length!==o.x.length)return ct(...l);break}case"match":case"lookup":if(o.br.every(l=>l.op==="const")){const l=o.br.map(p=>p.ex);return o.x[Fr[c.op](l,c.ex)]}break;case"subscript":if(o.br[0].op==="const")return se(o.ex[o.br[0].ex]);break}return o});t.nodes=r}function Ur(t,e){const{nodeRanges:s,minimum:r,cat:o}=t,c=[...t.candidates],a=[...t.cndRanges],l=[],p=[];let i=!1;if(t.nodes.forEach((u,h)=>{if(h<r.length){if(r[h]>s.get(u).min)i=!0;else if(h>=e)return;p.push(r[h])}l.push(u)}),p.length!=r.length&&(t.nodes=l,t.minimum=p),!i)return;let d=!1;c.forEach((u,h)=>{const g=a[h],b=u.filter(x=>{a[h]=mt([x]);const y=kn(l,o,a);return p.every((C,w)=>y.get(l[w]).max>=C)});b.length!=u.length?(c[h]=b,a[h]=mt(b),d=!0):a[h]=g}),d&&(t.candidates=c,t.cndRanges=a)}function Vr(t,e){const s=[...t.monotonicities],r=t.candidates.map(i=>i.map(d=>{const u={incomp:[],inc:{},c:d};for(const[h,g]of s)g.inc?u.inc[h]=d[h]??0:g.dec?u.inc[h]=-(d[h]??0):u.incomp.push(d[h]??0);return u})),o=r[0][0];if(o===void 0)return;const c=Object.keys(o.inc),a=[...c].reverse(),l=!!o.incomp.length,p=r.map(i=>{const d=new wn;return l?i.forEach(u=>{const h=d.ref(u.incomp);h.value?h.value.push(u):h.value=[u]}):d.ref([]).value=i,[...d.values()].flatMap(u=>(u.sort(({inc:h},{inc:g})=>{const b=a.find(x=>h[x]!==g[x]);return b===void 0?0:g[b]-h[b]}),u.filter(({inc:h},g)=>{let b=0;for(let x=0,y=g-e;x<=y+b;x++){const C=u[x].inc;if(c.every(w=>C[w]>=h[w])&&++b>=e)return!1}return!0})))});p.some((i,d)=>i.length!=t.candidates[d].length)&&(t.candidates=p.map(i=>i.map(d=>d.c)))}const ee=Symbol();function Xr(t){const{nodes:e,cat:s,candidates:r}=t,o=new Map;ft(e,(i,d)=>{if(i.x.forEach(d),i.br.forEach(d),i.br.length)return;const u=i.x.map(g=>o.get(g));if(u.some(g=>!g))return;let h;switch(i.op){case"sum":{h={[ee]:u.reduce((g,b)=>g+b[ee],0)};for(const g of u)for(const[b,x]of Object.entries(g))h[b]=(h[b]??0)+x;break}case"prod":{const g=i.x.findIndex(x=>x.op!=="const");if(i.x.find((x,y)=>x.op!=="const"&&y!==g))return;h=g!==-1?{...u[g]}:{[ee]:1};const b=u.reduce((x,y,C)=>C===g?x:x*y[ee],1);b!=1&&(Object.keys(h).forEach(x=>h[x]*=b),h[ee]*=b);break}case"read":h={[i.tag[s]]:1,[ee]:0};break;case"const":if(typeof i.ex!="number")return;h={[ee]:i.ex};break;default:return}o.set(i,h)});const c=new Map;if(ft(e,(i,d)=>{const u=o.get(i);u&&Object.keys(u).length?c.set(i,u):(i.x.forEach(d),i.br.forEach(d))}),![...c.keys()].some(i=>{if(i.op==="const"||i.op==="read")return!1;if(i.op==="sum"&&i.x.length===2){if(i.x[0].op==="const"&&i.x[1].op==="read")return!1;if(i.x[1].op==="const"&&i.x[0].op==="read")return!1}return!0}))return;let l=new Map([...c.values()].map(i=>{const d=Object.keys(i).sort();return d.length===1&&i[d[0]]===1?[i,d[0]]:[i,""+d.flatMap(u=>[u,i[u]]).join("")]}));if(!Qn()){const i=new Map([...l.values()].map((d,u)=>[d,`c${u}`]));l=new Map([...l].map(([d,u])=>[d,i.get(u)]))}const p=new Map;for(const[i,d]of l){const u=Fe({[s]:d});p.set(i,i[ee]!==0?en(i[ee],u):u)}t.candidates=r.map(i=>i.map(d=>{const u={id:d.id};return l.forEach((h,g)=>{h in u||(u[h]=Object.entries(g).reduce((b,[x,y])=>b+(d[x]??0)*y,0))}),u})),t.nodes=Oe(e,(i,d)=>{const u=c.get(d);return u?p.get(u):i})}function mt(t){const e=t.values(),s=e.next().value;if(!s)return{};const r=Object.fromEntries(Object.entries(s).map(([o,c])=>[o,{min:c,max:c}]));for(const o of e){for(const[c,a]of Object.entries(r)){const l=o[c]??0;a.min>l&&(a.min=l),a.max<l&&(a.max=l)}for(const[c,a]of Object.entries(o))c in r||(r[c]={min:Math.min(0,a),max:Math.max(0,a)})}return r}function kn(t,e,s){const r=new Map;return ft(t,(o,c)=>{o.x.forEach(c),o.br.forEach(c);const a=o.x.map(u=>r.get(u)),l=a.map(u=>u.min),p=a.map(u=>u.max);function i(u,[h,g]){const b=Br[u],x=[b([h.min,g.min]),b([h.min,g.max]),b([h.max,g.min]),b([h.max,g.max])];return{min:Math.min(...x),max:Math.max(...x)}}let d;switch(o.op){case"const":typeof o.ex=="number"?d={min:o.ex,max:o.ex}:d={min:NaN,max:NaN};break;case"sum":d={min:l.reduce((u,h)=>u+h,0),max:p.reduce((u,h)=>u+h,0)};break;case"prod":d={min:1,max:1},d=a.reduce((u,h)=>i(o.op,[u,h]),d);break;case"min":case"max":d={min:Math[o.op](...l),max:Math[o.op](...p)};break;case"match":case"thres":d={min:Math.min(...l),max:Math.max(...p)};break;case"sumfrac":l[0]+l[1]>0||p[0]+p[1]<0?d=i(o.op,a):d={min:NaN,max:NaN};break;case"read":{d={min:0,max:0};for(const{[o.tag[e]]:u}of s)u&&(d.min+=u.min,d.max+=u.max);break}case"subscript":{if(typeof o.ex[0]!="number")d={min:NaN,max:NaN};else{d={min:1/0,max:-1/0};let{min:u,max:h}=r.get(o.br[0]);u=Math.max(0,Math.ceil(u)),h=Math.min(h,o.ex.length-1);for(let g=u;g<=h;g++){const b=o.ex[g];d.min>b&&(d.min=b),d.max<b&&(d.max=b)}d.min>d.max&&(d={min:NaN,max:NaN})}break}case"lookup":isNaN(l[0])&&isNaN(p[0])&&(l.splice(0,1),p.splice(0,1)),d={min:Math.min(...l),max:Math.max(...p)};break;case"custom":d=gn[o.ex].range(a);break;default:Qe(o)}r.set(o,d)}),r}function Jr(t,e,s){const r=new Map,o=[],c=new Map;function a(l,p){r.has(l)||r.set(l,{inc:!0,dec:!0});const i=r.get(l);if(p&&i.dec)i.dec=!1;else if(!p&&i.inc)i.inc=!1;else return;o.push({node:l,inc:p})}for(t.forEach(l=>a(l,!0));o.length;){const{node:l,inc:p}=o.pop();switch(l.op){case"read":c.set(l.tag[e],r.get(l));break;case"const":break;case"sum":case"min":case"max":l.x.forEach(i=>a(i,p));break;case"thres":{l.x.forEach(u=>a(u,p));const i=s.get(l.x[0]),d=s.get(l.x[1]);i.max>d.min&&(a(l.br[0],p),a(l.br[1],!p)),i.min<d.max&&(a(l.br[0],!p),a(l.br[1],p));break}case"sumfrac":{const[i,d]=l.x.map(u=>s.get(u));d.min<0&&a(l.x[0],!p),d.max>0&&a(l.x[0],p),i.min<0&&a(l.x[1],p),i.max>0&&a(l.x[1],!p);break}case"prod":{const i=s.get(l);if(i.min<0&&i.max>0)l.x.forEach(d=>a(d,!0)),l.x.forEach(d=>a(d,!1));else{const d=p===i.max>0;l.x.forEach(u=>a(u,d===s.get(u).max>0))}break}case"match":case"lookup":l.x.forEach(i=>a(i,p)),l.br.forEach(i=>a(i,!0)),l.br.forEach(i=>a(i,!1));break;case"subscript":{const{br:[i],ex:d}=l;if(typeof d[0]=="number"){let{min:u,max:h}=s.get(i);u=Math.max(0,Math.ceil(u)),h=Math.min(h,d.length-1);for(let g=u+1;g<=h;g++)if(d[g-1]<d[g]){a(i,p);break}for(let g=u+1;g<=h;g++)if(d[g-1]>d[g]){a(i,!p);break}}else a(i,!0),a(i,!1);break}case"custom":gn[l.ex].monotonicity(l.x.map(i=>s.get(i))).forEach((i,d)=>{i.inc||a(l.x[d],!p),i.dec||a(l.x[d],p)});break;default:Qe(l)}}return c}function gt(t){const[e,s]=Yn();return f.useEffect(()=>t.followAny((r,o)=>o==="update"&&s()),[t,s]),e}function Qr({maxBuildsToShow:t,optConfigId:e}){const{database:s}=E(),{t:r}=Q("page_optimize");return m(H,{title:r("build",{count:t}),children:[n(R,{children:n(S,{variant:"caption",color:"info.main",children:r("buildDropdownDesc")})}),es.map(o=>n(R,{onClick:()=>s.optConfigs.set(e,{maxBuildsToShow:o}),children:r("build",{count:o})},o))]})}function Zr({numWorkers:t,setNumWorkers:e}){const{t:s}=Q("page_optimize"),r=navigator.hardwareConcurrency||8;return m(H,{title:`${t} Workers`,children:[n(R,{disabled:!0,children:"Scales with available CPU cores."}),ts(1,r).map(o=>n(R,{onClick:()=>e(o),children:s("worker",{count:o})},o))]})}const At=ns(B.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");var Me={},Xt;function Yr(){if(Xt)return Me;Xt=1;var t=bt();Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var e=t(yt()),s=Ct(),r=(0,e.default)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");return Me.default=r,Me}var ei=Yr();const _e=vt(ei);function ti({formulasRead:t,buffsRead:e}){var p;const s=f.useContext(Ze),r=(p=f.useContext(wt))==null?void 0:p.withTag(s),o=r==null?void 0:r.toDebug(),[c,a]=f.useState(!1),l=i=>(d,u)=>{a(u?i:!1)};return n(O,{bgt:"dark",children:m(T,{children:[m(qe,{expanded:c==="formulas",onChange:l("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[n(ze,{expandIcon:n(_e,{}),children:"All target listings"}),n(Pe,{children:n(lt,{children:r&&o&&c==="formulas"&&r.listFormulas(t).map((i,d)=>{const u=r.compute(i),h=o.compute(i).meta,g=i.tag.name||i.tag.q;return m(oe,{children:[m(S,{children:[g,": ",u.val]}),m(qe,{children:[m(ze,{expandIcon:n(_e,{}),children:["debug for ",g]}),m(Pe,{children:["conds:",n(J,{text:te(u.meta.conds)}),"read:",n(J,{text:te(i)}),"formula:",n(J,{text:te(h)})]})]})]},`${g}${d}`)})})})]}),m(qe,{expanded:c==="buffs",onChange:l("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[n(ze,{expandIcon:n(_e,{}),children:"All target buffs"}),n(Pe,{children:n(lt,{children:r&&o&&c==="buffs"&&r.listFormulas(e).map((i,d)=>{const u=r.compute(i),h=o.compute(i).meta,g=i.tag.name||i.tag.q;return m(oe,{children:[m(S,{children:[g,": ",u.val]}),m(qe,{children:[m(ze,{expandIcon:n(_e,{}),children:["debug for ",g]}),m(Pe,{children:["conds:",n(J,{text:te(u.meta.conds)}),"read:",n(J,{text:te(i)}),"formula:",n(J,{text:te(h)})]})]})]},`${g}${d}`)})})})]})]})})}function ni(){var d;const t=f.useContext(Ze),e=(d=f.useContext(wt))==null?void 0:d.withTag(t),s=e==null?void 0:e.toDebug(),{read:r,setRead:o}=f.useContext(tn),c=r&&(e==null?void 0:e.compute(r)),a=r&&(s==null?void 0:s.compute(r)),l=(r==null?void 0:r.tag.name)||(r==null?void 0:r.tag.q),p=a==null?void 0:a.meta,i=p&&te(p);return n(kt,{open:!!r,onClose:()=>o(void 0),children:m(O,{bgt:"dark",children:[n(Ae,{title:`Debug formula for ${l}`,action:n(pe,{onClick:()=>o(void 0),children:n(Ye,{})})}),n(T,{children:n(O,{bgt:"normal",children:n(T,{children:m(lt,{gap:1,children:["Computed value: ",c==null?void 0:c.val,n(U,{}),n(S,{variant:"h6",children:"Read"}),n(J,{text:te(r)}),n(U,{}),n(S,{variant:"h6",children:"Calculator Tag"}),n(J,{text:JSON.stringify(e==null?void 0:e.cache.tag)}),n(U,{}),n(S,{variant:"h6",children:"Tag Context"}),n(J,{text:JSON.stringify(t)}),n(U,{}),n(S,{variant:"h6",children:"Conditionals"}),n(J,{text:te(c==null?void 0:c.meta.conds)}),n(U,{}),n(S,{variant:"h6",children:"Formula"}),n(J,{text:i||""})]})})})})]})})}function Ot({document:t,bgt:e="normal",collapse:s=!1,typoVariant:r="body1"}){switch(t.type){case"fields":return n(si,{fieldsDocument:t,bgt:e});case"text":return s?n(ri,{textDocument:t,typoVariant:r}):n(Sn,{textDocument:t,typoVariant:r});case"conditional":return n(ss,{conditional:t.conditional,bgt:e});default:return null}}function si({fieldsDocument:t,bgt:e="normal"}){return m(O,{bgt:e,children:[t.header&&n(nn,{header:t.header,hideDivider:t.fields.length===0}),n(os,{bgt:e,fields:t.fields})]})}function Sn({textDocument:t,typoVariant:e}){const s=f.useContext(wt),r=f.useContext(Ze);return s?m(S,{variant:e,children:[t.header&&n(nn,{header:t.header}),is(t.text,s.withTag(r))]}):null}function ri({textDocument:t,typoVariant:e}){const[s,r]=f.useState(!1),[o,c]=f.useState(!1);return m(v,{sx:{position:"relative"},children:[!s&&n(v,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:o?"translate(0,-5px)":void 0},children:n(rs,{})}),n(Tt,{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),collapsedSize:55,onClick:()=>r(a=>!a),in:s,sx:{cursor:"pointer",position:"relative",maskImage:s?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:s?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:n(Sn,{textDocument:t,typoVariant:e})})]})}function ii({levelLow:t,levelHigh:e,setLow:s,setHigh:r,setBoth:o,dark:c=!1,disabled:a=!1,showLevelText:l=!1}){const{t:p}=Q("wengine"),[i,d]=f.useState(t),[u,h]=f.useState(e),g=f.useCallback((b,x)=>{if(typeof x=="number")throw new TypeError;const[y,C]=x;d(y),h(C)},[d,h]);return f.useEffect(()=>d(t),[d,t]),f.useEffect(()=>h(e),[h,e]),m(v,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:c?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[m(v,{sx:{width:"max-content",height:32,display:"flex"},children:[l?m(et,{children:[n("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:p("levelSliderTitle")}),n(U,{orientation:"vertical",flexItem:!0})]}):void 0,n(zt,{value:i,onChange:b=>s(Pt(b??0,0,e)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:l?"right":"center"}},disabled:a})]}),n(as,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[i,u],onChange:g,onChangeCommitted:(b,x)=>Array.isArray(x)&&o(x[0],x[1]),valueLabelDisplay:"auto",min:0,max:He,step:1,marks:!0,disabled:a}),n(zt,{value:u,onChange:b=>r(Pt(b??0,t,He)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function Mn({setKey:t,fade2:e=!1,fade4:s=!1,children:r}){const o=ir[t];return o?m(sn,{bgt:"light",sx:{height:"100%"},children:[n(Ae,{title:n(ls,{setKey:t}),avatar:n(St,{src:cs(t),size:2})}),r,n(W,{divider:n(U,{}),children:Object.entries(o).map(([c,a])=>n(v,{sx:{opacity:(c==="2"?e:s)?.5:1},children:n(oi,{uiSheetElement:a,collapse:c!=="2"})},c))})]}):null}function oi({uiSheetElement:t,collapse:e=!1}){const{documents:s,title:r}=t;return m(T,{children:[n(S,{variant:"subtitle1",children:r}),n(W,{spacing:1,children:s.map((o,c)=>n(Ot,{document:o,typoVariant:"body2",collapse:e},c))})]})}function Dn({headerAction:t,fade:e=!1,wengine:s}){const{key:r,level:o,phase:c,modification:a}=s,l=or[r],p=ds(r,o,c,a),i="atk_base",d=tt(r).second_statkey;return l?m(sn,{bgt:"light",sx:{height:"100%"},children:[n(Ae,{title:n(ps,{wKey:r}),avatar:n(St,{src:us(r,"icon"),size:2}),action:t}),m(T,{sx:{py:0},children:[m(S,{sx:{display:"flex",justifyContent:"space-between"},children:[n(Re,{statKey:"atk"}),m("span",{children:[_t(p[i],i).toFixed(Lt(i)),dt(i)]})]}),m(S,{sx:{display:"flex",justifyContent:"space-between"},children:[n(Re,{statKey:d}),m("span",{children:[_t(p[d],d).toFixed(Lt(d)),dt(d)]})]})]}),n(v,{sx:{opacity:e?.5:1},children:n(ai,{uiSheetElement:l})})]}):null}function ai({uiSheetElement:t}){const{documents:e,title:s}=t;return m(T,{children:[n(S,{variant:"subtitle1",children:s}),n(W,{spacing:1,children:e.map((r,o)=>n(Ot,{document:r,typoVariant:"body2",collapse:!0},o))})]})}function En(t,e=new Map){const s=e.get(t);if(s)return s;const{val:r,meta:{tag:o,op:c,ops:a,usedCats:l}}=t,p=o&&hs(o,(C,w)=>l.has(w)),i=rn(r,dt(ar(o))),d=new Set;function u(C,w){return C.map((D,$)=>{const I=En(D,e);return I.name?(d.add(I),I.name):(I.deps.forEach(q=>d.add(q)),I.prec>=w?I.formula:m("span",{children:["(",I.formula,")"]},$))})}let h,g=1/0;switch(c){case"const":h=i,g=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:C,joiner:w,end:D}=at[c];g=at[c].prec,h=m("span",{children:[C,u(a,g).map(($,I)=>m(f.Fragment,{children:[$,I<a.length-1&&w]},I)),D]})}break;case"sumfrac":{const[C]=u(a,2),[w,D]=u(a,1);h=m("span",{children:[C," / (",w," + ",D,")"]}),g=at.prod.prec;break}default:fs(c)}let b,x;p&&(b=p.q==="_"?void 0:m("span",{children:[n(re,{tag:p})," ",i]}),x=void 0);const y={name:b,formula:h,prec:g,sheet:x,deps:[...new Set(d)]};return e.set(t,y),y}const at={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function In({isAftershock:t,setAftershock:e}){return n(N,{onClick:()=>e(!t),color:t?"success":"secondary",children:ht.aftershock})}function Tn({dmgType:t,keys:e,setDmgType:s}){return m(H,{title:m(v,{sx:{textWrap:"nowrap"},children:["Dmg Type: ",t?ht[t]:"Any"]}),children:[n(R,{selected:!t,disabled:!t,onClick:()=>s(),children:"Any"},"any"),e.map(r=>n(R,{selected:t===r,disabled:t===r,onClick:()=>s(r),children:ht[r]},r))]})}function ci(){var p;const{t}=Q("page_optimize"),{database:e}=E(),{key:s}=j(),{bonusStats:r}=K(s),o=(p=on(e.charMeta,s))==null?void 0:p.description,c=f.useCallback((i,d,u,h)=>e.charOpts.setBonusStat(s,i,d,u,h),[e,s]),a=i=>e.charOpts.setBonusStat(s,xs(i),0,!1),l=f.useCallback(i=>{e.charMeta.set(s,{description:i})},[e.charMeta,s]);return m(W,{spacing:1,children:[r.map(({tag:i,value:d,disabled:u},h)=>n(di,{tag:i,value:d,disabled:u,setValue:g=>c(i,g,u,h),onDelete:()=>c(i,null,u,h),setTag:g=>c(g,d,u,h),toggleDisabled:()=>c(i,d,!u,h)},JSON.stringify(i)+h)),n(li,{onSelect:a}),n(Nr,{placeholder:t("bonusStatsNotes"),value:o,disabled:!s,onChange:i=>l(i),multiline:!0,minRows:3,fullWidth:!0})]})}function li({tag:t,onSelect:e}){return n(H,{title:(t&&n(re,{tag:t}))??"Add Bonus Stat",children:bs.map(s=>n(R,{onClick:()=>e(s),children:n(Re,{statKey:s,showPercent:!0})},s))})}function di({tag:t,setTag:e,value:s,disabled:r,setValue:o,onDelete:c,toggleDisabled:a}){var p;const l=(p=t.q)==null?void 0:p.endsWith("_");return n(O,{bgt:"light",sx:{opacity:r?.4:void 0},children:m(T,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[n(pe,{onClick:a,children:r?n(an,{}):n(cn,{})}),n(S,{children:n(re,{tag:t})}),n(pi,{qt:t.qt,setQt:i=>e({...t,qt:i})}),t.q==="dmg_"&&n(ui,{tag:t,setAttribute:i=>{const{attribute:d,...u}=t;e(i?{...u,attribute:i}:u)}}),ms.includes(t.q)&&n(Tn,{dmgType:t.damageType1,keys:gs,setDmgType:i=>{const{damageType1:d,...u}=t;e(i?{...u,damageType1:i}:u)}}),["dmg_","crit_dmg_"].includes(t.q)&&n(In,{isAftershock:t.damageType2==="aftershock",setAftershock:i=>{const{damageType2:d,...u}=t;e(i?{...u,damageType2:"aftershock"}:u)}}),n(xe,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:m(nt,{position:"end",sx:{ml:0},children:[l?"%":void 0," ",n(pe,{"aria-label":"Delete Bonus Stat",onClick:c,edge:"end",children:n(At,{fontSize:"small"})})]})}})]})})}function ui({tag:t,setAttribute:e}){return m(H,{title:t.attribute?n(ke,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(R,{onClick:()=>e(null),children:"No Attribute"}),Mt.map(s=>n(R,{onClick:()=>e(s),children:n(Dt,{color:s,children:n(ke,{attribute:s})})},s))]})}function pi({qt:t,setQt:e}){return n(H,{title:t&&Ke[t],children:ys.map(s=>n(R,{onClick:()=>e(s),selected:t===s,disabled:t===s,children:Ke[s]},s))})}function hi(){const{key:t}=j();return n(v,{children:Object.values(cr[t]).flatMap((e,s)=>e.documents.map((r,o)=>n(Ot,{document:r,collapse:!0},`${s}_${o}`)))})}function fi(){const{database:t}=E(),{key:e}=j(),{enemyStats:s,enemyLvl:r,enemyDef:o,enemyisStunned:c,enemyStunMultiplier:a}=K(e),l=f.useCallback((i,d,u)=>t.charOpts.setEnemyStat(e,i,d,u),[t,e]),p=i=>t.charOpts.setEnemyStat(e,vs(i),0);return m(W,{spacing:1,children:[m(v,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[n(xe,{label:"Enemy Lvl",value:r,inputProps:{min:0,sx:{width:"4em"}},onChange:i=>t.charOpts.set(e,{enemyLvl:i})}),n(xe,{label:"Enemy DEF",value:o,inputProps:{min:0,sx:{width:"4em"}},onChange:i=>t.charOpts.set(e,{enemyDef:i})}),n(xe,{label:"Enemy Stun Multiplier",value:a,inputProps:{min:0,sx:{width:"8em"}},onChange:i=>t.charOpts.set(e,{enemyStunMultiplier:i}),InputProps:{endAdornment:n(nt,{position:"end",children:"%"})}}),n(N,{onClick:()=>t.charOpts.set(e,{enemyisStunned:!c}),color:c?"success":"secondary",children:c?"Stunned":"Not Stunned"})]}),s.map(({tag:i,value:d},u)=>n(gi,{tag:i,value:d,setValue:h=>l(i,h,u),onDelete:()=>l(i,null,u),setTag:h=>l(h,d,u)},JSON.stringify(i)+u)),n(mi,{onSelect:p})]})}function mi({tag:t,onSelect:e}){return n(H,{title:(t&&n(re,{tag:{...t,qt:"common",et:"enemy",sheet:"agg"}}))??"Add Enemy Stat",children:ws.map(s=>n(R,{onClick:()=>e(s),children:n(re,{tag:{q:s,qt:"common",et:"enemy",sheet:"agg"},showPercent:!0})},s))})}function gi({tag:t,setTag:e,value:s,setValue:r,onDelete:o}){var a;const c=(a=t.q)==null?void 0:a.endsWith("_");return n(O,{bgt:"light",children:m(T,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[n(S,{children:n(re,{tag:t})}),Cs(["res_","resRed_"],t.q)&&n(xi,{tag:t,setAttribute:l=>{const{attribute:p,...i}=t;e(l?{...i,attribute:l}:i)}}),n(xe,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:r,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:m(nt,{position:"end",sx:{ml:0},children:[c?"%":void 0," ",n(pe,{"aria-label":"Delete Enemy Stat",onClick:o,edge:"end",children:n(At,{fontSize:"small"})})]})}})]})})}function xi({tag:t,setAttribute:e}){return m(H,{title:t.attribute?n(ke,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(R,{onClick:()=>e(null),children:"No Attribute"}),Mt.map(s=>n(R,{onClick:()=>e(s),children:n(Dt,{color:s,children:n(ke,{attribute:s})})},s))]})}function xt(t){return t.reduce((e,s)=>e*s.length,1)}const bi=50;class yi{constructor(e){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.nextReport=Date.now(),this.finalize=()=>{},this.terminate=()=>{};const{progress:s}=this,{topN:r,numWorkers:o,setProgress:c}=e,a=[...Array(o)].map(()=>new Worker(new URL(""+new URL("workerHandle-CSrCyUap.js",import.meta.url).href,import.meta.url),{type:"module"})),l=Hr(e.nodes,e.candidates,"q",e.minimum,r),{nodes:p,minimum:i,candidates:d}=l;if(s.remaining=xt(d),s.skipped=xt(e.candidates)-s.remaining,s.remaining>Number.MAX_SAFE_INTEGER)throw new Error("too many combinations");this.topN=r,this.optThreshold=i[0],this.info=new Map(a.map(g=>[g,{builds:[]}]));const u=d.map(g=>g.map(b=>b.id));this.state={ty:"work",works:[{ids:u,count:s.remaining}]},this.report=()=>c({...s}),this.results=new Promise((g,b)=>{this.finalize=x=>(this.report(),g(x)),this.terminate=b});const h=()=>a.forEach(g=>g.terminate());this.results.then(h,h);for(const g of a)g.onmessage=({data:b})=>{try{this.onWorkerMsg(b,g)}catch(x){this.terminate(x)}},Le(g,{ty:"init",nodes:p,minimum:i,candidates:d,topN:r})}distribute(e){const{state:s}=this;if(s.ty==="work"){s.works.push(...e);return}for(const r of s.workers)if(this.give(e,r))s.workers.delete(r);else return;this.state={ty:"work",works:e}}idle(e){const{state:s,progress:r,info:o}=this;if(s.ty==="idle")s.workers.add(e);else if(this.give(s.works,e)){const c=r.remaining/(o.size+.5);o.forEach((a,l)=>Le(l,{ty:"work?",maxKeep:c}))}else this.state={ty:"idle",workers:new Set([e])}}give(e,s){if(!e.length)return!1;let r=this.progress.remaining/(this.info.size+.5),o=e.findIndex(a=>(r-=a.count)<0)+1;o>1&&(o-=1);const c=e.splice(0,o||e.length);return Le(s,{ty:"add",works:c}),!0}onWorkerMsg(e,s){var r;switch(e.ty){case"progress":{const o=this.progress,c=this.info.get(s);o.remaining-=e.computed+e.skipped,o.computed+=e.computed,o.failed+=e.failed,o.skipped+=e.skipped,c.builds=e.builds,e.idle&&this.idle(s);const a=Date.now();if(this.nextReport<=a||!e.remaining){this.nextReport=a+bi,this.report();const l=[...this.info.values()].flatMap(i=>i.builds);l.sort((i,d)=>d.value-i.value);const p=((r=l[this.topN])==null?void 0:r.value)??-1/0;p>this.optThreshold&&(this.optThreshold=p,this.info.forEach((i,d)=>Le(d,{ty:"config",threshold:p}))),this.progress.remaining||this.finalize(l.slice(0,this.topN))}break}case"add":this.distribute(e.works);break;case"err":this.terminate(e.msg+" (Worker Error)")}}}function Le(t,e){t.postMessage(e)}const Ci=1e-7;function vi(t,e,s,r,o,c,a,l,p,i,d){const u=new Set(ut),h=new Set(pt),g=[en(...s.map((x,y)=>$t(x.multiplier,new it({src:t,...x.tag},void 0).with("preset",`preset${y}`)))),...r.map(({tag:x,isMax:y})=>{const C={...ks(x),src:t,preset:"preset0"};return y?$t(-1,new it(C,void 0)):new it(C,void 0)})],b=Pr(g,e,x=>{if(x.src===t&&x.et==="own"){if(x.sheet==="dyn"&&x.qt==="initial")return x.q==="dmg_"?{q:`${x.attribute}_dmg_`}:{q:x.q};if(x.q==="count"&&u.has(x.sheet))return{q:x.sheet};if(x.qt=="wengine"&&["lvl","phase","modification"].includes(x.q))return{q:x.q};if(x.q==="count"&&h.has(x.sheet))return{q:x.sheet}}});return b.push(o.length?ct(...o.map(x=>Fe({q:x},"sum"))):se(1/0),c.length?ct(...c.map(x=>Fe({q:x},"sum"))):se(1/0)),{nodes:b,candidates:[a.map(wi),l[1].map(me),l[2].map(me),l[3].map(me),l[4].map(me),l[5].map(me),l[6].map(me)],minimum:[-1/0,...r.map(({value:x,isMax:y,tag:C})=>{const w=Ss(x,C.q??"");return(y?w*-1:w)-Ci}),2,4],numWorkers:p,topN:i,setProgress:d}}function me(t){const{id:e,mainStatKey:s,level:r,rarity:o,setKey:c,substats:a}=t;return{id:e,[s]:Ms(o,s,r),...Object.fromEntries(a.filter(({key:l,upgrades:p})=>l&&p).map(({key:l,upgrades:p})=>[l,Ds(l,o)*p])),[c]:1}}function wi(t){const{id:e,key:s,level:r,modification:o,phase:c}=t;return{id:e,lvl:r,modification:o,phase:c,[s]:1}}var De={},Jt;function ki(){if(Jt)return De;Jt=1;var t=bt();Object.defineProperty(De,"__esModule",{value:!0}),De.default=void 0;var e=t(yt()),s=Ct(),r=(0,e.default)((0,s.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");return De.default=r,De}var Si=ki();const Mi=vt(Si),Di=f.memo(function({disabled:e=!1}){const{database:s}=E(),{optConfigId:r,optConfig:o}=f.useContext(V);return m(O,{bgt:"light",children:[n(T,{sx:{display:"flex",gap:1},children:n(S,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),n(U,{}),n(Es,{levelLow:(o==null?void 0:o.levelLow)??Bt.S,levelHigh:(o==null?void 0:o.levelHigh)??Bt.S,setLow:c=>s.optConfigs.set(r,{levelLow:c}),setHigh:c=>s.optConfigs.set(r,{levelHigh:c}),setBoth:(c,a)=>s.optConfigs.set(r,{levelLow:c,levelHigh:a}),disabled:e})]})});function Ei({discBySlot:t,setFilter4:e,setFilter2:s,setSetFilter4:r,setSetFilter2:o}){const c=j(),a=K(c==null?void 0:c.key),l=f.useMemo(()=>{const p=we(ut,()=>we(Et,()=>0));return Object.values(t).forEach(i=>i.forEach(({setKey:d,slotKey:u})=>p[d][u]++)),p},[t]);return m(et,{children:[m(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(S,{variant:"h6",sx:{flexGrow:1},children:"Disc Set Config"}),n(N,{disabled:!e.length,onClick:()=>r([]),children:"Reset 4p filter"}),n(N,{disabled:!s.length,onClick:()=>o([]),children:"Reset 2p filter"})]}),n(v,{children:c&&a&&n(xn,{character:c,conditionals:a.conditionals,children:n(F,{container:!0,spacing:1,children:ut.map(p=>n(F,{item:!0,xs:1,md:2,lg:3,children:n(Ii,{numSlot:l[p],setKey:p,setFilter4:e,setFilter2:s,setSetFilter4:r,setSetFilter2:o})},p))})})})]})}function Ii({numSlot:t,setKey:e,setFilter4:s,setFilter2:r,setSetFilter4:o,setSetFilter2:c}){const a=!!r.length&&!r.includes(e),l=!!s.length&&!s.includes(e);return m(Mn,{setKey:e,fade2:a,fade4:l,children:[n(v,{sx:{display:"flex",justifyContent:"space-around",pb:1},children:Object.entries(t).map(([p,i])=>n(v,{children:n(st,{color:i?"primary":"secondary",children:i})},p))}),m(Is,{fullWidth:!0,children:[n(N,{sx:{borderRadius:0},color:!s.length||s.includes(e)?"success":"secondary",onClick:()=>o(s.length?Ft([...s],e):[e]),children:"Allow 4p"}),n(N,{sx:{borderRadius:0},color:!r.length||r.includes(e)?"success":"secondary",onClick:()=>c(r.length?Ft([...r],e):[e]),children:"Allow 2p"})]})]})}function Ti({discsBySlot:t}){const[e,s,r]=It();return n(O,{bgt:"light",children:n(T,{children:m(W,{spacing:1,children:[n(oe,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:Et.map(o=>n(de,{discsBySlot:t,slotKey:o},o))}),n(Ri,{show:e,onClose:r,discsBySlot:t}),n(N,{color:"info",fullWidth:!0,onClick:s,children:"Disc Filter Config"})]})})})}function de({discsBySlot:t,slotKey:e}){return m(S,{children:["Disc ",e," ",n(st,{color:t[e].length?"primary":"error",children:t[e].length})]})}function Ri({discsBySlot:t,show:e,onClose:s,disabled:r}){const{database:o}=E(),{optConfigId:c,optConfig:a}=f.useContext(V);return n(kt,{open:e,onClose:s,children:m(O,{children:[n(Ae,{title:"Disc Filter",action:n(pe,{onClick:s,children:n(Ye,{})})}),n(U,{}),n(T,{children:n(f.Suspense,{fallback:n(ln,{width:"100%",height:"500px"}),children:m(W,{spacing:1,children:[n(Di,{disabled:r}),n(Ai,{discsBySlot:t,disabled:r}),n(N,{disabled:r,onClick:()=>o.optConfigs.set(c,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Discs"}),n(Oi,{discBySlot:t,disabled:r})]})})})]})})}function Ai({discsBySlot:t,disabled:e}){const{database:s}=E(),{optConfigId:r,optConfig:o}=f.useContext(V),c=a=>{const l=Ts([...Ht[a]]),p={4:o.slot4??[],5:o.slot5??[],6:o.slot6??[]},i={4:d=>s.optConfigs.set(r,{slot4:d}),5:d=>s.optConfigs.set(r,{slot5:d}),6:d=>s.optConfigs.set(r,{slot6:d})};return n(oe,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:Ht[a].map(d=>n(N,{disabled:e,variant:p[a].includes(d)?"contained":"outlined",onClick:()=>i[a](l([...p[a]],d)),children:n(Re,{statKey:d,showPercent:!0})},d))})};return n(O,{bgt:"light",children:n(T,{children:m(W,{spacing:1,children:[m(oe,{sx:{display:"flex",justifyContent:"space-between"},children:[n(de,{slotKey:"1",discsBySlot:t}),n(de,{slotKey:"2",discsBySlot:t}),n(de,{slotKey:"3",discsBySlot:t})]}),n(de,{slotKey:"4",discsBySlot:t}),c("4"),n(de,{slotKey:"5",discsBySlot:t}),c("5"),n(de,{slotKey:"6",discsBySlot:t}),c("6")]})})})}function Oi({discBySlot:t,disabled:e}){const{database:s}=E(),{optConfigId:r,optConfig:o}=f.useContext(V),{setFilter2:c=[],setFilter4:a=[]}=o,l=f.useCallback(i=>{s.optConfigs.set(r,{setFilter2:i})},[s,r]),p=f.useCallback(i=>{s.optConfigs.set(r,{setFilter4:i})},[s,r]);return n(Ei,{discBySlot:t,disabled:e,setFilter2:c,setFilter4:a,setSetFilter2:l,setSetFilter4:p})}function Wi({disabled:t=!1}){const{optConfigId:e,optConfig:{statFilters:s}}=f.useContext(V),{database:r}=E(),o=f.useCallback(c=>r.optConfigs.set(e,{statFilters:c}),[r,e]);return m(O,{bgt:"light",children:[n(T,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:n(v,{display:"flex",justifyContent:"space-between",children:n(S,{sx:{fontWeight:"bold"},children:"Stat Filter"})})}),n(U,{}),n(T,{children:n(Ni,{statFilters:s,setStatFilters:o,disabled:t})})]})}function Ni({statFilters:t,setStatFilters:e,disabled:s=!1}){const r=f.useCallback((i,d)=>{const u=structuredClone(t);typeof d>"u"?u.push({tag:i,value:0,isMax:!1,disabled:!1}):u[d].tag=i,e(u)},[e,t]),o=f.useCallback(i=>{const d=structuredClone(t);d.splice(i,1),e(d)},[e,t]),c=f.useCallback((i,d)=>{const u=structuredClone(t);u[i].value=d,e(u)},[e,t]),a=f.useCallback((i,d)=>{const u=structuredClone(t);u[i].isMax=d,e(u)},[e,t]),l=f.useCallback((i,d)=>{const u=structuredClone(t);u[i].disabled=d,e(u)},[e,t]),p=i=>r(As(i));return m(v,{display:"flex",flexDirection:"column",gap:1,children:[t.map((i,d)=>n(qi,{statFilter:i,delTarget:()=>o(d),setTarget:u=>r(u,d),setTargetValue:u=>c(d,u),setTargetisMax:u=>a(d,u),setDisabled:u=>l(d,u),disabled:s},d+JSON.stringify(i))),n(ji,{onSelect:p})]})}function ji({tag:t,onSelect:e}){return n(H,{title:(t&&n(re,{tag:t}))??"Add Final Stat Filter",children:Os.map(s=>n(R,{onClick:()=>e(s),children:n(Re,{statKey:s,showPercent:!0})},s))})}function qi({statFilter:t,delTarget:e,setTarget:s,setTargetValue:r,setTargetisMax:o,setDisabled:c,disabled:a}){const{tag:l,value:p,isMax:i,disabled:d}=t,u=Rs(l.q??"");return n(O,{children:m(T,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(N,{color:d?"secondary":"success",onClick:()=>c(!d),disabled:a,size:"small",children:d?n(an,{}):n(cn,{})}),n(S,{children:n(re,{tag:l})}),l.q==="dmg_"&&n(Pi,{tag:l,setAttribute:h=>{const{attribute:g,...b}=l;s(h?{...b,attribute:h}:b)}}),n(N,{onClick:()=>o(!i),size:"small",children:n("strong",{children:i?"MAX":"MIN"})}),n(xe,{float:!0,value:p,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:a,onChange:r,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:m(nt,{position:"end",sx:{ml:0},children:[u?"%":void 0," ",n(pe,{"aria-label":"Delete Stat Constraint",onClick:e,edge:"end",children:n(At,{fontSize:"small"})})]})}})]})})}function Pi({tag:t,setAttribute:e}){return m(H,{title:t.attribute?n(ke,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(R,{onClick:()=>e(null),children:"No Attribute"}),Mt.map(s=>n(R,{onClick:()=>e(s),children:n(Dt,{color:s,children:n(ke,{attribute:s})})},s))]})}const zi=f.memo(function({disabled:e=!1}){const{database:s}=E(),{optConfigId:r,optConfig:o}=f.useContext(V);return m(O,{bgt:"light",children:[n(T,{sx:{display:"flex",gap:1},children:n(S,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),n(U,{}),n(ii,{levelLow:(o==null?void 0:o.wlevelLow)??He,levelHigh:(o==null?void 0:o.wlevelHigh)??He,setLow:c=>s.optConfigs.set(r,{wlevelLow:c}),setHigh:c=>s.optConfigs.set(r,{wlevelHigh:c}),setBoth:(c,a)=>s.optConfigs.set(r,{wlevelLow:c,wlevelHigh:a}),disabled:e})]})});function _i({wengines:t,disabled:e}){const{database:s}=E(),{optConfigId:r,optConfig:o}=f.useContext(V),[c,a,l]=It();return n(O,{bgt:"light",children:n(T,{children:m(W,{spacing:1,children:[m(oe,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[m(oe,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",n(st,{color:t.length?"primary":"error",children:t.length})]}),n(N,{sx:{flexGrow:1},startIcon:o.optWengine?n(Ws,{}):n(Ns,{}),color:o.optWengine?"success":"secondary",onClick:()=>s.optConfigs.set(r,{optWengine:!o.optWengine}),children:"Optimize Wengine"})]}),n(Li,{show:c,onClose:l,wengines:t}),n(N,{color:"info",fullWidth:!0,onClick:a,disabled:e||!o.optWengine,children:"Wengine Filter Config"})]})})})}function Li({wengines:t,show:e,onClose:s,disabled:r}){const{database:o}=E(),{optConfigId:c,optConfig:a}=f.useContext(V);return n(kt,{open:e,onClose:s,children:m(O,{children:[n(Ae,{title:"Wengine Filter",action:n(pe,{onClick:s,children:n(Ye,{})})}),n(U,{}),n(T,{children:n(f.Suspense,{fallback:n(ln,{width:"100%",height:"500px"}),children:m(W,{spacing:1,children:[n(zi,{disabled:r}),n($i,{disabled:r}),n(N,{disabled:r,onClick:()=>o.optConfigs.set(c,{useEquippedWengine:!a.useEquippedWengine}),color:a.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"}),n(Bi,{wengines:t})]})})})]})})}function $i({disabled:t}){const{database:e}=E(),{optConfigId:s,optConfig:r}=f.useContext(V),{wEngineTypes:o}=r,c=gt(e.wengines),{key:a}=j(),l=f.useMemo(()=>c&&r.optWengine?e.wengines.values.reduce((p,{key:i,level:d,location:u})=>{if(d<r.wlevelLow||d>r.wlevelHigh||u&&!r.useEquippedWengine&&u!==a)return p;const h=tt(i).type;return h&&p[h]++,p},we(Kt,()=>0)):we(Kt,()=>0),[a,c,e.wengines,r.wlevelLow,r.wlevelHigh,r.optWengine,r.useEquippedWengine]);return n(js,{onChange:p=>e.optConfigs.set(s,{wEngineTypes:p}),value:o,disabled:t,totals:l,fullWidth:!0})}function Bi({wengines:t}){const e=j(),s=K(e==null?void 0:e.key),{optConfig:r}=f.useContext(V),{wEngineTypes:o}=r,c=f.useMemo(()=>o.length?pt.filter(a=>o.includes(tt(a).type)):pt,[o]);return m(oe,{children:[n(S,{variant:"h6",children:"Wengine Condtional Configuration"}),n(S,{children:"Wengine stats are displayed to be Lvl 60/60, P1, actual level/phase of wengine will be used in the solver."}),e&&s&&n(xn,{character:e,conditionals:s.conditionals,children:n(F,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:c.map(a=>n(F,{item:!0,xs:1,children:n(Hi,{wengineKey:a,count:t.filter(l=>l.key===a).length})},a))})})]})}function Fi(t){return{key:t,level:60,modification:5,phase:1,location:"",lock:!1}}function Hi({wengineKey:t,count:e}){const s=f.useMemo(()=>Fi(t),[t]);return n(Dn,{wengine:s,headerAction:n(st,{color:e?"primary":"secondary",children:e}),fade:!e})}function Ki(){const{key:t}=j(),{optConfigId:e}=K(t),{database:s}=E();return f.useEffect(()=>{if(e)return;const r=s.optConfigs.new({wEngineTypes:[dn(t).specialty]});s.charOpts.set(t,{optConfigId:r})},[s,e,t]),e?n(un,{optConfigId:e,children:n(Gi,{})}):null}function Gi(){const{t}=Q("optimize"),{database:e}=E(),s=bn(),{key:r}=j(),{target:o}=K(r),[c,a]=f.useState(8),[l,p]=f.useState(void 0),{optConfig:i,optConfigId:d}=f.useContext(V),u=gt(e.discs),h=f.useMemo(()=>{const I={4:i.slot4,5:i.slot5,6:i.slot6},q=M=>["4","5","6"].includes(M);return u&&e.discs.values.reduce((M,z)=>{const{slotKey:Z,mainStatKey:_,level:P,location:X}=z;return P<i.levelLow||P>i.levelHigh||X&&!i.useEquipped&&X!==r||q(Z)&&!I[Z].includes(_)||M[z.slotKey].push(z),M},{1:[],2:[],3:[],4:[],5:[],6:[]})},[r,u,e.discs,i.levelHigh,i.levelLow,i.slot4,i.slot5,i.slot6,i.useEquipped]),g=gt(e.wengines),b=f.useMemo(()=>g&&e.wengines.values.filter(({key:I,level:q,location:M})=>{if(!i.optWengine)return M===r;if(q<i.wlevelLow||q>i.wlevelHigh||M&&!i.useEquippedWengine&&M!==r)return!1;const{type:z}=tt(I);return!!i.wEngineTypes.includes(z)}),[r,e.wengines,i.wlevelLow,i.wlevelHigh,i.optWengine,i.wEngineTypes,i.useEquippedWengine,g]),x=f.useMemo(()=>xt(Object.values(h))*b.length,[b.length,h]),[y,C]=f.useState(!1),w=f.useRef(()=>{});f.useEffect(()=>()=>w.current(),[]);const D=f.useCallback(async I=>{if(!s||!o)return;const q=new Promise(P=>w.current=P);p(void 0),C(!0);const M=(i.statFilters??[]).filter(P=>!P.disabled),z=vi(r,s,[{tag:pn(o),multiplier:1}],M,i.setFilter2,i.setFilter4,b,h,c,i.maxBuildsToShow,p);if(I.altKey){console.log(z),C(!1);return}const Z=new yi(z);q.then(()=>Z.terminate("user cancelled"));let _;try{_=await Z.results}catch{return}finally{w.current=()=>{},C(!1)}e.optConfigs.newOrSetGeneratedBuildList(d,{builds:_.map(({ids:P,value:X})=>({wengineId:P[0],discIds:we(Et,(ie,ce)=>P[ce+1]),value:X})),buildDate:Date.now()})},[s,o,i.statFilters,i.setFilter2,i.setFilter4,i.maxBuildsToShow,r,b,h,c,e.optConfigs,d]),$=f.useCallback(()=>{w.current(),C(!1)},[w]);return n(O,{children:n(T,{children:m(W,{spacing:1,children:[m(v,{sx:{display:"flex",gap:1,flexWrap:"wrap","& .MuiPaper-root":{flexGrow:1}},children:[n(Wi,{}),n(_i,{wengines:b}),n(Ti,{discsBySlot:h})]}),l&&n(Ui,{progress:l,total:x}),m(v,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[n(Qr,{maxBuildsToShow:i.maxBuildsToShow,optConfigId:d}),n(Zr,{numWorkers:c,setNumWorkers:a}),n(N,{disabled:!x||!o,onClick:y?$:D,color:y?"error":"primary",startIcon:y?n(Ye,{}):n(Mi,{}),children:t(y?"cancel":"optimize")})]})]})})})}function $e({value:t}){const e=t.toLocaleString();return n(v,{component:"span",sx:{fontFamily:"Monospace",display:"inline"},children:e})}function Ui(t){const{t:e}=Q("optimize"),{computed:s,remaining:r,skipped:o}=t.progress,c=s+r,a=Math.log1p(c)/Math.log1p(t.total),l=r/c*a;return m(v,{children:[m(S,{children:[e("computed"),": ",n($e,{value:s})," /"," ",n($e,{value:c})," "]}),m(S,{children:[e("computed + skipped"),": ",n($e,{value:s+o})," /"," ",n($e,{value:t.total})]}),n(qs,{variant:"determinate",value:(1-l)*100,sx:{height:10,borderRadius:5}})]})}const Vi={xs:2,sm:1,md:2,lg:3,xl:4};function Xi({onClick:t}){const e=f.useContext(hn);return n(fn,{discIds:e==null?void 0:e.equippedDiscs,wengineId:e==null?void 0:e.equippedWengine,onClick:t,columns:Vi})}var Ee={},Qt;function Ji(){if(Qt)return Ee;Qt=1;var t=bt();Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.default=void 0;var e=t(yt()),s=Ct(),r=(0,e.default)((0,s.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");return Ee.default=r,Ee}var Qi=Ji();const Zi=vt(Qi);function Yi(t){const{database:e}=E();return on(e.generatedBuildList,t)}const eo=f.memo(function(){const{optConfig:e}=f.useContext(V),s=Yi(e.generatedBuildListId??"");return n(W,{spacing:1,children:s==null?void 0:s.builds.map((r,o)=>n(no,{build:r,index:o},`${o}-${r.wengineId}-${Object.values(r.discIds).join("-")}`))})});function to({build:{discIds:t,wengineId:e}}){const{t:s}=Q("build"),{database:r}=E(),{key:o}=j()??{},c=f.useCallback(()=>{o&&(Object.entries(t).forEach(([a,l])=>l&&r.discs.set(l,{location:o})),e&&r.wengines.set(e,{location:o}))},[o,t,e,r.wengines,r.discs]);return n(N,{color:"info",size:"small",startIcon:n(Zi,{}),onClick:c,children:s("buildDisplay.equipToCrr")})}function no({build:t,index:e}){const s=j(),r=K(s.key);return n(Cn,{character:s,charOpt:r,discIds:t.discIds,wengineId:t.wengineId,children:n(O,{children:n(T,{children:m(W,{spacing:1,children:[m(v,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[m(S,{children:["Build ",e+1,": ",rn(t.value)]}),n(to,{build:t})]}),n(v,{children:m(F,{container:!0,spacing:1,children:[n(F,{item:!0,xs:6,md:4,lg:3,xl:3,children:n(yn,{})}),n(F,{item:!0,xs:6,md:8,lg:9,xl:9,children:n(fn,{discIds:t.discIds,wengineId:t.wengineId})})]})})]})})})})}const so=210,Rn=f.createContext(so),ro=0,Ie=33,An=f.createContext(0);function io(){const[t,e]=f.useState(""),s=f.useMemo(()=>({statHighlight:t,setStatHighlight:e}),[t,e]),r=f.useMemo(()=>[["char",n(oo,{},"char")],["opt",n(ao,{},"opt")],["builds",n(co,{},"builds")]],[]);return n(Ps.Provider,{value:s,children:n(An.Provider,{value:r.length,children:n(W,{gap:1,children:r.map(([o,c],a)=>n(On,{title:o,index:a,zIndex:100,children:c},o))})})})}function On({index:t,title:e,children:s,zIndex:r,top:o=0,bottom:c=0}){const{t:a}=Q("page_optimize"),[l,p]=jr(),i=f.useContext(An),d=f.useContext(Rn);return m(et,{children:[n(O,{sx:u=>({outline:`2px solid ${u.palette.secondary.main}`,position:"sticky",top:d+t*Ie+o,bottom:ro+(i-1-t)*Ie+c,zIndex:r}),children:n(_s,{onClick:p,sx:{px:2},children:n(S,{variant:"h6",children:a(`${e}`)})})}),n(v,{ref:l,sx:{scrollMarginTop:d+(t+1)*Ie+o},children:s})]})}function oo(){const t=j(),{key:e}=t,[s,r]=f.useState(void 0),o=f.useCallback(()=>{t!=null&&t.key&&r(t.key)},[t]),c=f.useMemo(()=>[["eq",n(Xi,{onClick:o},"eq")],["Conditionals",n(lo,{},"conditionals")],["bonusStats",n(ci,{},"bonusStats")],["enemyStats",n(fi,{},"enemyStats")],["charSheet",n(hi,{},"charSheet")]],[o]),a=Yt(),l=zs(a.breakpoints.up("sm"));return m(et,{children:[n(lr,{characterKey:s,onClose:()=>r(void 0)}),m(W,{spacing:1,children:[n(O,{sx:{overflow:"visible"},children:n(T,{sx:{display:"flex",gap:1,overflow:"visible"},children:m(F,{container:!0,spacing:2,sx:{flexWrap:"wrap",overflow:"visible"},children:[n(F,{item:!0,xs:12,sm:7,md:5,lg:4,xl:3,sx:{height:l?"100%":void 0,overflow:"visible"},children:m(W,{spacing:1,sx:l?{height:"100%"}:void 0,children:[n(dr,{characterKey:e,onClick:o}),n(v,{sx:{flexGrow:1},children:n(v,{sx:l?{position:"sticky",top:"115px",bottom:"0px"}:void 0,children:n(yn,{})})})]})}),n(F,{item:!0,xs:12,sm:5,md:7,lg:8,xl:9,children:n(W,{spacing:1.5,children:c.map(([p,i],d)=>n(On,{title:p,index:d,zIndex:99,top:Ie,bottom:Ie*2,children:i},p))})})]})})}),n(ti,{formulasRead:ne.listing.formulas,buffsRead:ne.listing.buffs})]})]})}function ao(){return n(Ki,{})}function co(){const{key:t}=j(),{optConfigId:e}=K(t);return e?n(un,{optConfigId:e,children:n(eo,{})}):null}function lo(){const{equippedDiscs:t,equippedWengine:e}=j(),s=Ls(t),r=$s(s),o=Bs(e);return n(v,{children:m(F,{container:!0,spacing:1,columns:{xs:1,sm:1,md:2,lg:3},children:[o&&n(F,{item:!0,xs:1,children:n(Dn,{wengine:o})}),Object.entries(r).map(([c,a])=>n(F,{item:!0,xs:1,children:n(Mn,{setKey:c,fade2:a<2,fade4:a<4})},c))]})})}const Zt={avg:"Average",crit:"Crit Hit",nonCrit:"Non-Crit Hit"};function uo(){const{database:t}=E(),e=j(),s=K(e.key),{critMode:r}=s;return n(H,{title:m(v,{sx:{textWrap:"nowrap"},children:["Hit mode: ",Zt[r]]}),children:Fs.map(o=>n(R,{selected:r===o,disabled:r===o,onClick:()=>t.charOpts.set(e.key,{critMode:o}),children:Zt[o]},o))})}const po=[ne.final.atk,ne.final.hp,ne.final.def,ne.final.enerRegen,ne.final.anomProf,ne.final.anomMas];function ho({character:{key:t},charOpt:{target:e}}){const s=bn(),{database:r}=E(),o=f.useMemo(()=>{if(e)return pn(e)},[e]);return m(H,{color:o?"success":"warning",title:o?m(v,{sx:{display:"flex",gap:1},children:[n("strong",{children:"Optimization Target: "}),n(Be,{tag:o})]}):"Select an Optimization Target",variant:o?"outlined":void 0,sx:{height:"100%",flexGrow:1},children:[s==null?void 0:s.listFormulas(ne.listing.formulas).map(({tag:c},a)=>{const{name:l,sheet:p}=c;if(!(!l||!p))return n(R,{onClick:()=>r.charOpts.set(t,{target:{sheet:p,name:l}}),children:n(Gt,{children:n(v,{sx:{display:"flex",gap:1},children:n(Be,{tag:c})})})},`${a}_${c.sheet}_${c.name}`)}),po.map(({tag:c},a)=>{const{q:l,qt:p}=c;if(!(!l||!p))return n(R,{onClick:()=>r.charOpts.set(t,{target:{q:l,qt:p}}),children:n(Gt,{children:n(v,{sx:{display:"flex",gap:1},children:n(Be,{tag:c})})})},`${a}_${l}_${p}`)})]})}function fo(){const{database:t}=E(),e=j(),s=K(e.key),{target:r}=s,o=f.useCallback(c=>t.charOpts.set(e.key,({target:a={}})=>{const{damageType1:l,...p}=a;return c?{target:{...p,damageType1:c}}:{target:p}}),[t,e.key]);return(r==null?void 0:r.name)!=="standardDmgInst"?null:n(Tn,{dmgType:r==null?void 0:r.damageType1,keys:Hs,setDmgType:o})}function mo({character:t,charOpt:e}){return m(v,{display:"flex",gap:1,sx:{position:"sticky",top:36,zIndex:100,background:"#0C1020"},children:[n(ho,{character:t,charOpt:e}),n(xo,{}),n(fo,{}),n(go,{}),n(uo,{})]})}function go(){const{database:t}=E(),e=j(),s=K(e.key),{target:r}=s,o=f.useCallback(c=>t.charOpts.set(e.key,({target:a={}})=>{const{damageType2:l,...p}=a;return c?{target:{...p,damageType2:"aftershock"}}:{target:p}}),[t,e.key]);return(r==null?void 0:r.name)!=="standardDmgInst"?null:n(In,{isAftershock:(r==null?void 0:r.damageType2)==="aftershock",setAftershock:o})}function xo(){const{database:t}=E(),e=j(),s=K(e.key),{target:r}=s,{q:o,qt:c}=r??{};return!o||!c?null:n(H,{title:Ke[c],children:["final","initial"].map(a=>n(R,{selected:a===c,disabled:a===c,onClick:()=>t.charOpts.set(e.key,{target:{q:o,qt:a}}),children:Ke[a]},a))})}function So(){const{database:t}=E(),{optCharKey:e}=tr(t.dbMeta),s=e??Ks[0],[r,o,c]=It(),a=f.useCallback(y=>t.dbMeta.set({optCharKey:y}),[t.dbMeta]),{t:l}=Q(["charNames_gen","page_character"]),p=ur(s);f.useEffect(()=>{s&&!p&&t.chars.getOrCreate(s)},[s,p,t.chars]);const i=K(s);f.useEffect(()=>{s&&!i&&t.charOpts.getOrCreate(s)},[s,i,t.charOpts]),qr(f.useMemo(()=>{const y=s&&l(`charNames_gen:${s}`);return y?`Optimize - ${y}`:"Optimize"},[s,l]));const d=f.useMemo(()=>{const C=we(s?[s]:[],w=>n(pr,{characterKey:w}));return{srcDisplay:C,dstDisplay:C}},[s]),u=f.useCallback((y,C,w,D,$)=>{!Gs(y)||!Ut(w)||!(D===null||Ut(D))||!Us(y,C)||t.charOpts.setConditional(s,y,C,w,D,$)},[s,t.charOpts]),h=f.useMemo(()=>({src:s,dst:s,preset:"preset0"}),[s]),[g,b]=f.useState(),x=f.useMemo(()=>({read:g,setRead:b}),[g]);return n(bo,{children:m(v,{children:[n(f.Suspense,{fallback:!1,children:n(hr,{show:r,onHide:c,onSelect:a})}),n(v,{sx:{position:"sticky",top:0,zIndex:100,background:"#0C1020"},children:n(N,{fullWidth:!0,color:dn(s).attribute,sx:{justifyContent:"flex-start",pl:"6px"},onClick:o,children:m(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(St,{size:2,src:Vs(s,"circle")}),l(`charNames_gen:${s}`)]})})}),p&&i&&n(hn.Provider,{value:p,children:n(Ze.Provider,{value:h,children:n(Cn,{character:p,charOpt:i,wengineId:p.equippedWengine,discIds:p.equippedDiscs,children:n(Xs.Provider,{value:d,children:n(Js.Provider,{value:i.conditionals,children:n(Qs.Provider,{value:u,children:m(tn.Provider,{value:x,children:[n(ni,{}),m(v,{sx:{display:"flex",gap:1,flexDirection:"column",mt:1},children:[n(mo,{character:p,charOpt:i}),n(Rn.Provider,{value:74,children:n(io,{})})]})]})})})})})})})]})})}function bo({children:t}){return n(er.Provider,{value:En,children:n(Zs.Provider,{value:re,children:n(Ys.Provider,{value:Be,children:t})})})}export{So as default};
