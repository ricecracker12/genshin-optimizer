import{P as Y,bz as Z,d as s,bi as J,j as t,bT as M,bU as ee,e as b,ax as te,bV as ae,bW as se,o as k,bX as re,i as ce,u as ne,bY as ie,a3 as le,a as oe,bI as he,bZ as ue,l as de,b_ as ge,b$ as w,m as pe,n as ye,by as me,ag as Ce,f as fe,G as o,c0 as be,c1 as xe,c2 as Se,c3 as Te,C as we,A as ve,B as Me,S as B,bs as v,bq as ke,aX as Ie}from"./index-CQt5LsCr.js";import{n as Oe,u as Pe,k as je,l as Be,p as De,m as Ee,r as ze,s as He,t as D}from"./tagFieldMap-XdIYkWIA.js";import"./discSortUtil-BGQNJekn.js";function Ke({value:h,totals:a,onChange:n,...d}){const p=Y(),u=!Z(p.breakpoints.up("sm")),y=s.useMemo(()=>J([...M]),[]),m=s.useCallback(r=>()=>n(y(h,r)),[n,y,h]);return t(re,{exclusive:!0,value:h,...d,children:M.map(r=>t(ee,{value:r,sx:{p:u?1:void 0,minWidth:u?0:"6em",display:"flex",gap:u?0:1},selectedColor:"primary",onClick:m(r),children:b(k,{sx:{display:"flex",alignItems:"center",gap:1},children:[t(te,{src:ae(r),size:1.5,sideMargin:!0}),!u&&t(se,{label:a[r],size:"small"})]})},r))})}const Fe={xs:1,sm:2,md:2,lg:3,xl:4},$e={xs:1,sm:2,md:2,lg:3,xl:12},Ae=Object.keys(D);function Re(){const{t:h}=ce("page_characters"),{database:a}=ne(),n=ie(),{params:{characterKey:d}}=le({path:"/characters/:characterKey",end:!1})??{params:{}},p=oe(a.displayCharacter),[u,y]=s.useState(""),m=s.useDeferredValue(u),[r,I]=s.useState(""),E=s.useMemo(()=>({statHighlight:r,setStatHighlight:I}),[r,I]),i=s.useMemo(()=>d?he.includes(d)?d:(n("/characters"),null):null,[d,n]),C=Oe(i??void 0),O=Pe(i??void 0)??(i&&a.charOpts.getOrCreate(i)),z=s.useMemo(()=>({src:i,dst:i,preset:"preset0"}),[i]),[H,P]=s.useState(!1),K=s.useCallback(e=>{a.chars.get(e)||a.chars.getOrCreate(e),n(`/characters/${e}`)},[a.chars,n]),x=ue(a.chars),S=x.length,g=s.useMemo(()=>{const{attribute:e,specialtyType:c,rarity:l,sortType:f,ascending:L}=p;return x.filter(de({attribute:e,specialtyType:c,rarity:l,name:m},ze(a))).sort(ge(D[f]??[],L,He(a),["new"]))},[p,x,m,a]),{specialtyType:F,attribute:$,rarity:A,sortType:W,ascending:G}=p,N=s.useMemo(()=>w(ke,e=>a.chars.entries.forEach(([c,l])=>{const f=v(l.key).specialty;e[f].total++,a.chars.keys.includes(c)&&e[f].current++})),[a]),R=s.useMemo(()=>w(Ie,e=>Object.entries(a.chars.data).forEach(([c])=>{const l=v(c).attribute;e[l].total++,a.chars.keys.includes(c)&&e[l].current++})),[a]),q=s.useMemo(()=>w(M,e=>Object.entries(a.chars.data).forEach(([c])=>{const l=v(c).rarity;e[l].total++,a.chars.keys.includes(c)&&e[l].current++})),[a]),_=pe(),{numShow:j,setTriggerElement:Q}=ye($e[_],g.length),T=s.useMemo(()=>g.slice(0,j),[g,j]),U=g.length!==S?`${g.length}/${S}`:`${S}`,V={numShowing:T.length,total:U,t:h,namespace:"page_character"},X={sortKeys:[...Ae],value:W,onChange:e=>a.displayCharacter.set({sortType:e}),ascending:G,onChangeAsc:e=>a.displayCharacter.set({ascending:e})};return b(k,{display:"flex",flexDirection:"column",gap:2,children:[i&&C&&O&&t(Ce.Provider,{value:z,children:t(me.Provider,{value:E,children:t(je,{character:C,charOpt:O,wengineId:C.equippedWengine,discIds:C.equippedDiscs,children:t(Be,{characterKey:i,onClose:()=>n("/characters")})})})}),t(s.Suspense,{fallback:!1,children:t(De,{show:H,onHide:()=>P(!1),onSelect:K,newFirst:!0})}),t(we,{children:b(fe,{sx:{display:"flex",flexDirection:"column",gap:1},children:[b(o,{container:!0,spacing:1,children:[t(o,{item:!0,children:t(be,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({specialtyType:e}),value:F,totals:N,size:"small"})}),t(o,{item:!0,children:t(xe,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({attribute:e}),value:$,totals:R,size:"small"})}),t(o,{item:!0,children:t(Ke,{sx:{height:"100%"},onChange:e=>a.displayCharacter.set({rarity:e}),value:A,totals:q,size:"small"})}),t(o,{item:!0,flexGrow:1}),t(o,{item:!0,children:t(Se,{autoFocus:!0,value:u,onChange:e=>y(e.target.value),label:h("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(k,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:t(Te,{showingTextProps:V,sortByButtonProps:X})})]})}),t(Me,{fullWidth:!0,onClick:()=>P(!0),color:"info",startIcon:t(ve,{}),children:h("addNew")}),t(s.Suspense,{fallback:t(B,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(o,{container:!0,spacing:2,columns:Fe,children:T.map(e=>t(o,{item:!0,xs:1,children:t(Ee,{characterKey:e,onClick:()=>n(`${e}`)})},e))})}),g.length!==T.length&&t(B,{ref:e=>{e&&Q(e)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Re as default};
