import{i as G,u as M,a as A,d as c,hY as J,bx as X,hZ as ee,h_ as ne,j as e,C as H,e as l,f as O,G as u,T as N,B as K,h as E,R as te,o as W,y as F,v as L,h$ as _,by as ie,i0 as se,i1 as le,i2 as ae,i3 as oe,i4 as ce,c5 as P,bp as re,i5 as de,i6 as ge,i7 as ue,i8 as pe,aC as $,z as he,i9 as ye,k as me,l as fe,c9 as we,m as Te,n as xe,ia as We,cP as ke,cd as Se,ce as Ce,ib as be,S as Ie,ic as qe,id as ve,ie as V}from"./index-Co1ItRlk.js";const Q=["locked","unlocked"],Be=re([...Q]);function De({numShowing:h,total:s,wengineIds:k}){const{t:r}=G(["page_wengine","ui"]),{database:a}=M(),S=A(a.displayWengine),{speciality:C,rarity:z,locked:y,showEquipped:d,showInventory:b,locations:m}=S,{lockedTotal:f,equippedTotal:w,locationTotal:I,wengineTotals:q,wengineRarityTotals:v}=c.useMemo(()=>{const i={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...ee,""],wengineTotals:[...X],wengineRarityTotals:[...J]};return ne(i,t=>a.wengines.entries.forEach(([T,g])=>{const o=g.location,B=g.lock?"locked":"unlocked",x=o?"equipped":"unequipped",D=$(g.key).type,p=$(g.key).rarity;t.lockedTotal[B].total++,t.equippedTotal[x].total++,t.locationTotal[o].total++,t.wengineTotals[D].total++,p&&t.wengineRarityTotals[p].total++,k.includes(T)&&(t.lockedTotal[B].current++,t.equippedTotal[x].current++,t.locationTotal[o].current++,t.wengineTotals[D].current++,p&&t.wengineRarityTotals[p].current++)}))},[a.wengines.entries,k]);return e(H,{children:l(O,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(u,{container:!0,children:[e(u,{item:!0,children:e(N,{variant:"h6",children:r("wengineFilterTitle")})}),e(u,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:l(N,{children:[e("strong",{children:h})," / ",s]})}),e(u,{item:!0,children:e(K,{size:"small",color:"error",onClick:()=>a.displayWengine.set({action:"reset"}),startIcon:e(te,{}),children:e(E,{t:r,i18nKey:"ui:reset"})})})]}),e(W,{children:l(u,{container:!0,spacing:1,children:[l(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(E,{t:r,i18nKey:"subheadings.general"}),l(F,{spacing:1,children:[e(L,{sx:{bgcolor:_.palette.contentNormal.light}}),e(ie,{fullWidth:!0,onChange:i=>a.displayWengine.set({speciality:i}),value:C,totals:q,size:"small"}),e(se,{sx:{height:"100%"},fullWidth:!0,onChange:i=>a.displayWengine.set({rarity:i}),value:z,totals:v,size:"small"})]})]}),e(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:l(W,{children:[e(E,{t:r,i18nKey:"subheadings.inventory"}),l(F,{spacing:1,children:[e(L,{sx:{bgcolor:_.palette.contentNormal.light}}),e(le,{fullWidth:!0,value:y,size:"small",children:Q.map((i,t)=>l(ae,{value:i,sx:{display:"flex",gap:1},onClick:()=>a.displayWengine.set({locked:Be(y,i)}),children:[t?e(oe,{}):e(ce,{}),e(E,{t:r,i18nKey:`ui:${i}`}),e(P,{label:f[t?"unlocked":"locked"],size:"small"})]},i))}),l(K,{startIcon:e(de,{}),color:b?"success":"secondary",onClick:()=>a.displayWengine.set({showInventory:!b}),children:[r("wengineInInv")," ",e(P,{sx:{ml:1},label:w.unequipped,size:"small"})]}),l(K,{startIcon:e(ge,{}),color:d?"success":"secondary",onClick:()=>a.displayWengine.set({showEquipped:!d}),children:[r("equippedWengine")," ",e(P,{sx:{ml:1},label:w.equipped,size:"small"})]})]}),e(F,{spacing:1.5,pt:1.5,children:e(c.Suspense,{fallback:null,children:e(ue,{title:d?r("locationsTooltip"):"",placement:"top",children:e("span",{children:e(pe,{totals:I,locations:d?[]:m,setLocations:i=>a.displayWengine.set({locations:i}),disabled:d})})})})})]})})]})})]})})}const Ee={xs:2,sm:3,md:4,lg:4,xl:6},Ke={xs:10,sm:12,md:24,lg:24,xl:24},ze=Object.keys(V);function Fe(){const{t:h}=G(["page_wengine","ui"]),{database:s}=M(),[k,r,a]=he(!1),S=A(s.displayWengine),[C,z]=c.useState(""),y=c.useDeferredValue(C),d=c.useCallback(n=>{s.displayWengine.set({editWengineId:n})},[s]),b=c.useCallback(n=>{d(s.wengines.new(ye(n)))},[s.wengines,d]),{sortType:m,ascending:f,speciality:w,rarity:I,locked:q,showEquipped:v,showInventory:i,locations:t}=S,T=me(s.wengines),g=T.length,o=c.useMemo(()=>T.filter(fe({speciality:w,rarity:I,name:y,locked:q,showInventory:i,showEquipped:v,locations:t},qe())).sort(we(V[m]??[],f,ve())).map(n=>n.id),[T,w,I,y,q,i,v,t,m,f]),B=Te(),{numShow:x,setTriggerElement:D}=xe(Ke[B],o.length),p=c.useMemo(()=>o.slice(0,x),[o,x]),j=c.useCallback(()=>s.displayWengine.set({editWengineId:""}),[s]),{editWengineId:R}=S;R&&!s.wengines.get(R)&&j();const U=o.length!==g?`${o.length}/${g}`:`${g}`,Y={numShowing:p.length,total:U,t:h,namespace:"page_wengine"},Z={sortKeys:[...ze],value:m,onChange:n=>s.displayWengine.set({sortType:n}),ascending:f,onChangeAsc:n=>s.displayWengine.set({ascending:n})};return l(W,{display:"flex",flexDirection:"column",gap:1,children:[e(c.Suspense,{fallback:!1,children:e(We,{show:k,onHide:a,onSelect:b})}),e(c.Suspense,{fallback:!1,children:e(ke,{wengineId:R,footer:!0,onClose:j})}),e(De,{numShowing:o.length,total:g,wengineIds:o}),e(H,{children:e(O,{sx:{display:"flex",flexDirection:"column",gap:1},children:l(W,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Se,{autoFocus:!0,size:"small",value:C,onChange:n=>z(n.target.value),label:h("wengineName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(Ce,{showingTextProps:Y,sortByButtonProps:Z})]})})}),e(K,{fullWidth:!0,onClick:r,color:"info",children:h("page_wengine:addWengine")}),e(W,{children:e(u,{container:!0,spacing:1,columns:Ee,children:p.map(n=>e(u,{item:!0,xs:1,children:e(be,{wengineId:n,onEdit:d},n)},n))})}),o.length!==p.length&&e(Ie,{ref:n=>{n&&D(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Fe as default};
