var jt=t=>{throw TypeError(t)};var zt=(t,e,s)=>e.has(t)||jt("Cannot "+s);var ue=(t,e,s)=>(zt(t,e,"read from private field"),s?s.call(t):e.get(t)),ge=(t,e,s)=>e.has(t)?jt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),F=(t,e,s,i)=>(zt(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s);import{H as Xe,J as Qe,d as m,K as Je,L as ts,N as ns,_ as Ye,O as W,P as hn,Q as ss,U as is,V as K,W as le,X as We,Y as Ze,Z as qt,$ as rs,a0 as as,a1 as os,a2 as cs,i as Z,a3 as ls,a4 as et,a5 as ae,a6 as Ke,a7 as ds,a8 as fn,a9 as pt,aa as us,u as D,e as f,j as n,ab as ps,T as k,ac as T,ad as B,ae as ht,af as hs,r as St,b as kt,c as Mt,g as Dt,ag as tt,ah as Et,ai as mn,aj as ie,q as Oe,I as fe,s as nt,f as R,C as A,ak as ft,v as V,al as J,M as It,am as Y,an as fs,ao as ms,o as v,ap as gs,aq as gn,ar as xs,as as $t,F as oe,at as Lt,au as Ft,av as Ue,aw as bs,ax as st,ay as ys,az as Cs,y as O,aA as Tt,aB as vs,aC as it,aD as ws,aE as Ss,aF as _e,aG as Bt,aH as mt,aI as Ht,aJ as ks,aK as xn,aL as Ms,aM as Gt,aN as Kt,B as N,aO as P,aP as bn,aQ as Ds,aR as yn,aS as Cn,aT as Es,aU as ye,aV as rt,aW as Is,aX as Ts,aY as Rs,aZ as Rt,a_ as At,a$ as Ut,b0 as Vt,b1 as As,b2 as Xt,b3 as Qt,b4 as Jt,b5 as Ws,b6 as _s,b7 as Os,b8 as Ps,b9 as gt,ba as xt,bb as Yt,bc as lt,bd as Ns,be as js,bf as zs,bg as qs,bh as X,bi as Zt,bj as $s,bk as ke,bl as Wt,G as _,bm as at,bn as Ls,bo as en,z as ot,S as vn,bp as Fs,bq as tn,br as Bs,bs as Hs,bt as Gs,bu as Ks,bv as Us,bw as Vs,k as bt,bx as nn,by as Xs,bz as Ve,bA as wn,bB as Sn,bC as Qs,bD as kn,bE as Mn,bF as Dn,bG as Js,bH as Ys,bI as sn,bJ as Zs,bK as ei,bL as ti,bM as re,bN as ni,bO as si,bP as ii,bQ as ri,bR as ai,bS as rn,bT as oi,a as ci,bU as li,bV as di,bW as an,bX as ui,bY as pi,bZ as hi,b_ as fi,b$ as mi,c0 as gi,c1 as xi}from"./index-DSIfSNet.js";import{D as bi,b as yi,a as Ci,c as En,d as In,e as vi,w as wi,g as Si,T as q,f as yt,u as H,q as Me,A as De,h as ki,C as Tn,i as Rn,j as An,k as Wn,l as _n,m as On,n as Mi,o as Di,F as Ge,p as Ei}from"./tagFieldMap-BE6p0wNb.js";import{T as Ii}from"./TextFieldLazy-ukmwc0DY.js";import"./discSortUtil-C4t0oYE3.js";function Ti(t){return Xe("MuiCollapse",t)}Qe("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Ri=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Ai=t=>{const{orientation:e,classes:s}=t,i={root:["root",`${e}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${e}`],wrapperInner:["wrapperInner",`${e}`]};return Ze(i,Ti,s)},Wi=le("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,e[s.orientation],s.state==="entered"&&e.entered,s.state==="exited"&&!s.in&&s.collapsedSize==="0px"&&e.hidden]}})(({theme:t,ownerState:e})=>W({height:0,overflow:"hidden",transition:t.transitions.create("height")},e.orientation==="horizontal"&&{height:"auto",width:0,transition:t.transitions.create("width")},e.state==="entered"&&W({height:"auto",overflow:"visible"},e.orientation==="horizontal"&&{width:"auto"}),e.state==="exited"&&!e.in&&e.collapsedSize==="0px"&&{visibility:"hidden"})),_i=le("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(t,e)=>e.wrapper})(({ownerState:t})=>W({display:"flex",width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),Oi=le("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(t,e)=>e.wrapperInner})(({ownerState:t})=>W({width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),_t=m.forwardRef(function(e,s){const i=Je({props:e,name:"MuiCollapse"}),{addEndListener:a,children:l,className:c,collapsedSize:d="0px",component:p,easing:r,in:o,onEnter:u,onEntered:h,onEntering:g,onExit:b,onExited:x,onExiting:y,orientation:C="vertical",style:w,timeout:E=ns.standard,TransitionComponent:G=ts}=i,I=Ye(i,Ri),j=W({},i,{orientation:C,collapsedSize:d}),M=Ai(j),$=hn(),te=ss(),L=m.useRef(null),z=m.useRef(),Q=typeof d=="number"?`${d}px`:d,ce=C==="horizontal",de=ce?"width":"height",Ne=m.useRef(null),Un=is(s,Ne),me=S=>U=>{if(S){const ne=Ne.current;U===void 0?S(ne):S(ne,U)}},ct=()=>L.current?L.current[ce?"clientWidth":"clientHeight"]:0,Vn=me((S,U)=>{L.current&&ce&&(L.current.style.position="absolute"),S.style[de]=Q,u&&u(S,U)}),Xn=me((S,U)=>{const ne=ct();L.current&&ce&&(L.current.style.position="");const{duration:Ee,easing:je}=qt({style:w,timeout:E,easing:r},{mode:"enter"});if(E==="auto"){const Nt=$.transitions.getAutoHeightDuration(ne);S.style.transitionDuration=`${Nt}ms`,z.current=Nt}else S.style.transitionDuration=typeof Ee=="string"?Ee:`${Ee}ms`;S.style[de]=`${ne}px`,S.style.transitionTimingFunction=je,g&&g(S,U)}),Qn=me((S,U)=>{S.style[de]="auto",h&&h(S,U)}),Jn=me(S=>{S.style[de]=`${ct()}px`,b&&b(S)}),Yn=me(x),Zn=me(S=>{const U=ct(),{duration:ne,easing:Ee}=qt({style:w,timeout:E,easing:r},{mode:"exit"});if(E==="auto"){const je=$.transitions.getAutoHeightDuration(U);S.style.transitionDuration=`${je}ms`,z.current=je}else S.style.transitionDuration=typeof ne=="string"?ne:`${ne}ms`;S.style[de]=Q,S.style.transitionTimingFunction=Ee,y&&y(S)}),es=S=>{E==="auto"&&te.start(z.current||0,S),a&&a(Ne.current,S)};return K.jsx(G,W({in:o,onEnter:Vn,onEntered:Qn,onEntering:Xn,onExit:Jn,onExited:Yn,onExiting:Zn,addEndListener:es,nodeRef:Ne,timeout:E==="auto"?null:E},I,{children:(S,U)=>K.jsx(Wi,W({as:p,className:We(M.root,c,{entered:M.entered,exited:!o&&Q==="0px"&&M.hidden}[S]),style:W({[ce?"minWidth":"minHeight"]:Q},w),ref:Un},U,{ownerState:W({},j,{state:S}),children:K.jsx(_i,{ownerState:W({},j,{state:S}),className:M.wrapper,ref:L,children:K.jsx(Oi,{ownerState:W({},j,{state:S}),className:M.wrapperInner,children:l})})}))}))});_t.muiSupportAuto=!0;const Pn=m.createContext({});function Pi(t){return Xe("MuiAccordion",t)}const ze=Qe("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Ni=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],ji=t=>{const{classes:e,square:s,expanded:i,disabled:a,disableGutters:l}=t;return Ze({root:["root",!s&&"rounded",i&&"expanded",a&&"disabled",!l&&"gutters"],region:["region"]},Pi,e)},zi=le(os,{name:"MuiAccordion",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[{[`& .${ze.region}`]:e.region},e.root,!s.square&&e.rounded,!s.disableGutters&&e.gutters]}})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],e),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],e)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${ze.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${ze.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}},({theme:t})=>({variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${ze.expanded}`]:{margin:"16px 0"}}}]})),qe=m.forwardRef(function(e,s){const i=Je({props:e,name:"MuiAccordion"}),{children:a,className:l,defaultExpanded:c=!1,disabled:d=!1,disableGutters:p=!1,expanded:r,onChange:o,square:u=!1,slots:h={},slotProps:g={},TransitionComponent:b,TransitionProps:x}=i,y=Ye(i,Ni),[C,w]=rs({controlled:r,default:c,name:"Accordion",state:"expanded"}),E=m.useCallback(ce=>{w(!C),o&&o(ce,!C)},[C,o,w]),[G,...I]=m.Children.toArray(a),j=m.useMemo(()=>({expanded:C,disabled:d,disableGutters:p,toggle:E}),[C,d,p,E]),M=W({},i,{square:u,disabled:d,disableGutters:p,expanded:C}),$=ji(M),te=W({transition:b},h),L=W({transition:x},g),[z,Q]=as("transition",{elementType:_t,externalForwardedProps:{slots:te,slotProps:L},ownerState:M});return K.jsxs(zi,W({className:We($.root,l),ref:s,ownerState:M,square:u},y,{children:[K.jsx(Pn.Provider,{value:j,children:G}),K.jsx(z,W({in:C,timeout:"auto"},Q,{children:K.jsx("div",{"aria-labelledby":G.props.id,id:G.props["aria-controls"],role:"region",className:$.region,children:I})}))]}))});function qi(t){return Xe("MuiAccordionDetails",t)}Qe("MuiAccordionDetails",["root"]);const $i=["className"],Li=t=>{const{classes:e}=t;return Ze({root:["root"]},qi,e)},Fi=le("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>({padding:t.spacing(1,2,2)})),$e=m.forwardRef(function(e,s){const i=Je({props:e,name:"MuiAccordionDetails"}),{className:a}=i,l=Ye(i,$i),c=i,d=Li(c);return K.jsx(Fi,W({className:We(d.root,a),ref:s,ownerState:c},l))});function Bi(t){return Xe("MuiAccordionSummary",t)}const be=Qe("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),Hi=["children","className","expandIcon","focusVisibleClassName","onClick"],Gi=t=>{const{classes:e,expanded:s,disabled:i,disableGutters:a}=t;return Ze({root:["root",s&&"expanded",i&&"disabled",!a&&"gutters"],focusVisible:["focusVisible"],content:["content",s&&"expanded",!a&&"contentGutters"],expandIconWrapper:["expandIconWrapper",s&&"expanded"]},Bi,e)},Ki=le(cs,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],e),[`&.${be.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${be.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${be.disabled})`]:{cursor:"pointer"},variants:[{props:s=>!s.disableGutters,style:{[`&.${be.expanded}`]:{minHeight:64}}}]}}),Ui=le("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(t,e)=>e.content})(({theme:t})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${be.expanded}`]:{margin:"20px 0"}}}]})),Vi=le("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(t,e)=>e.expandIconWrapper})(({theme:t})=>({display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${be.expanded}`]:{transform:"rotate(180deg)"}})),Le=m.forwardRef(function(e,s){const i=Je({props:e,name:"MuiAccordionSummary"}),{children:a,className:l,expandIcon:c,focusVisibleClassName:d,onClick:p}=i,r=Ye(i,Hi),{disabled:o=!1,disableGutters:u,expanded:h,toggle:g}=m.useContext(Pn),b=C=>{g&&g(C),p&&p(C)},x=W({},i,{expanded:h,disabled:o,disableGutters:u}),y=Gi(x);return K.jsxs(Ki,W({focusRipple:!1,disableRipple:!0,disabled:o,component:"div","aria-expanded":h,className:We(y.root,l),focusVisibleClassName:We(y.focusVisible,d),onClick:b,ref:s,ownerState:x},r,{children:[K.jsx(Ui,{className:y.content,ownerState:x,children:a}),c&&K.jsx(Vi,{className:y.expandIconWrapper,ownerState:x,children:c})]}))});function Xi(){const t=m.useRef(),e=m.useCallback(()=>{var s;return(s=t.current)==null?void 0:s.scrollIntoView({behavior:"smooth"})},[t]);return[t,e]}function Qi(t){const{t:e}=Z("ui"),s=ls({path:"/:page/*"}),i=e("pageTitle"),a=t??((s==null?void 0:s.params.page)&&e(`tabs.${s==null?void 0:s.params.page}`));m.useEffect(()=>{a?document.title=`${a} - ${i}`:document.title=i},[e,i,a])}class Nn{constructor(){this.internal=new Ot}ref(e){return e.reduce((s,i)=>s.get(i),this.internal)}*[Symbol.iterator](){for(const[e,s]of this.internal.entries([]))"value"in s&&(yield[[...e],s.value])}*values(){for(const e of this.internal.allRefs())"value"in e&&(yield e.value)}}class Ot{constructor(){this.map=new Map}get(e){const s=this.map.get(e);if(s)return s;const i=new Ot;return this.map.set(e,i),i}*allRefs(){for(const e of this.map.values())yield*e.allRefs();yield this}*entries(e){const s=e.push(void 0)-1;for(const[i,a]of this.map.entries())e[s]=i,yield*a.entries(e);e.pop(),yield[e,this]}}function Ji(t,e,s){function i(c,d){if(c.val)return c.val;const p=s(c.tag);return c.val=p?[Ke(p,d)]:e.nodes.subset(c.id).flatMap(r=>r.op!=="reread"?l(r,c):i(c.with(r.tag),d)),c.val}function a(c,d){return c.every(p=>p.op==="const")?ae(Ci[d](c.map(p=>p.ex))):{op:d,x:c,br:[]}}function l(c,d){const{op:p}=c;switch(p){case"const":return c;case"read":{const r=d.with(c.tag),o=c.ex??e.defaultAccu(r.tag)??"unique",u=i(r,o);return o==="unique"?u[0]??ae(void 0):a(u,o)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const r=c.x.map(o=>l(o,d));return a(r,p)}case"thres":case"match":case"lookup":{const r=c.br.map(o=>l(o,d));if(r.every(o=>o.op==="const")){const o=r.map(h=>h.ex),u=yi[c.op](o,c.ex);return l(c.x[u],d)}return{...c,x:c.x.map(o=>l(o,d)),br:r}}case"subscript":{const r=l(c.br[0],d);return r.op==="const"?ae(c.ex[r.ex]):{...c,br:[r]}}case"vtag":return ae(d.tag[c.ex]??"");case"tag":return l(c.x[0],d.with(c.tag));case"dtag":{const r=c.br.map(u=>l(u,d));if(r.some(u=>u.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const o=d.with(Object.fromEntries(r.map((u,h)=>[c.ex[h],u.ex])));return l(c.x[0],o)}case"custom":return{...c,x:c.x.map(r=>l(r,d))};default:et(p)}}return t.map(c=>l(c,new bi(e.cache.keys).at({})))}function Pe(t,e){const s=new Map;function i(a){const l=s.get(a);if(l)return l;const c=a,d=dt(a.x,i),p=dt(a.br,i);(a.x!==d||a.br!==p)&&(a={...a,x:d,br:p});const r=e(a,c);return s.set(a,r),r}return dt(t,i)}function Ct(t,e){const s=new Set;function i(a){s.has(a)||(e(a,i),s.add(a))}t.forEach(i)}function dt(t,e){const s=t.map(e);return t.every((i,a)=>i===s[a])?t:s}const{arithmetic:on}=En;function Yi(t){return t=Zi(t),t=er(t),t=tr(t),t}function Zi(t){return Pe(t,e=>{const{op:s}=e;switch(s){case"sum":case"prod":case"min":case"max":if(e.x.length===1)return e.x[0];if(e.x.some(i=>i.op===s)){const i=e.x.flatMap(a=>a.op===s?a.x:[a]);return{...e,x:i}}}return e})}function er(t){return Pe(t,e=>{const{op:s}=e;switch(s){case"sum":case"prod":case"min":case"max":{const i=e.x.filter(a=>a.op==="const");if(i.length>1){const a=e.x.filter(c=>c.op!=="const"),l=on[s](i.map(c=>c.ex));return l===on[s]([])?{...e,x:a}:{...e,x:[ae(l),...a]}}}}return e})}function tr(t){const e=new Map,s=new Nn;return Pe(t,i=>{const{op:a}=i,l=i.x.map(r=>e.get(r)),c=i.br.map(r=>e.get(r));let d;switch(a){case"read":{const r=Object.keys(i.tag).sort();d=[a,i.ex,...r,...r.map(o=>i.tag[o])];break}case"sum":case"prod":case"min":case"max":d=[a,...l.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":d=[a,i.ex,...l,...c];break;case"match":d=[a,i.ex,...l,...c.sort()];break;default:et(a)}const p=s.ref(d);return"value"in p?p.value:(p.value=i,e.set(i,e.size),i)})}const{arithmetic:nr,branching:sr}=En;function ir(t,e,s,i,a){const l=new rr(t,i,e,s);for(;l.progress;)l.progress=!1,ar(l),or(l,1),lr(l),cr(l,a);return l.nodes=Yi(l.nodes),l}var he,Ce,ve,we,Se;class rr{constructor(e,s,i,a){ge(this,he);ge(this,Ce);ge(this,ve);ge(this,we);ge(this,Se);this.progress=!0,F(this,he,e),this.minimum=s,F(this,Ce,i),this.cat=a}get nodes(){return ue(this,he)}set nodes(e){ue(this,he)!==e&&(this.progress=!0,F(this,he,e),F(this,we,F(this,Se,void 0)))}get candidates(){return ue(this,Ce)}set candidates(e){this.candidates!==e&&(this.progress=!0,F(this,Ce,e),F(this,ve,F(this,we,F(this,Se,void 0))))}get cndRanges(){return ue(this,ve)??F(this,ve,this.candidates.map(vt))}set cndRanges(e){F(this,ve,e)}get nodeRanges(){return ue(this,we)??F(this,we,jn(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return ue(this,Se)??F(this,Se,dr(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}he=new WeakMap,Ce=new WeakMap,ve=new WeakMap,we=new WeakMap,Se=new WeakMap;function ar(t){const{nodes:e,nodeRanges:s}=t,i=Pe(e,(a,l)=>{const c=s.get(l);if(c.min===c.max)return l.op==="const"?a:ae(c.min);switch(l.op){case"thres":{const[d,p]=l.br.map(r=>s.get(r));if(d.min>=p.max)return a.x[0];if(d.max<p.min)return a.x[1];break}case"min":{const d=a.x.filter((p,r)=>s.get(l.x[r]).min<=c.max);if(d.length===1)return d[0];if(d.length!==a.x.length)return us(...d);break}case"max":{const d=a.x.filter((p,r)=>s.get(l.x[r]).max>=c.min);if(d.length===1)return d[0];if(d.length!==a.x.length)return pt(...d);break}case"match":case"lookup":if(a.br.every(d=>d.op==="const")){const d=a.br.map(p=>p.ex);return a.x[sr[l.op](d,l.ex)]}break;case"subscript":if(a.br[0].op==="const")return ae(a.ex[a.br[0].ex]);break}return a});t.nodes=i}function or(t,e){const{nodeRanges:s,minimum:i,cat:a}=t,l=[...t.candidates],c=[...t.cndRanges],d=[],p=[];let r=!1;if(t.nodes.forEach((u,h)=>{if(h<i.length){if(i[h]>s.get(u).min)r=!0;else if(h>=e)return;p.push(i[h])}d.push(u)}),p.length!=i.length&&(t.nodes=d,t.minimum=p),!r)return;let o=!1;l.forEach((u,h)=>{const g=c[h],b=u.filter(x=>{c[h]=vt([x]);const y=jn(d,a,c);return p.every((C,w)=>y.get(d[w]).max>=C)});b.length!=u.length?(l[h]=b,c[h]=vt(b),o=!0):c[h]=g}),o&&(t.candidates=l,t.cndRanges=c)}function cr(t,e){const s=[...t.monotonicities],i=t.candidates.map(r=>r.map(o=>{const u={incomp:[],inc:{},c:o};for(const[h,g]of s)g.inc?u.inc[h]=o[h]??0:g.dec?u.inc[h]=-(o[h]??0):u.incomp.push(o[h]??0);return u})),a=i[0][0];if(a===void 0)return;const l=Object.keys(a.inc),c=[...l].reverse(),d=!!a.incomp.length,p=i.map(r=>{const o=new Nn;return d?r.forEach(u=>{const h=o.ref(u.incomp);h.value?h.value.push(u):h.value=[u]}):o.ref([]).value=r,[...o.values()].flatMap(u=>(u.sort(({inc:h},{inc:g})=>{const b=c.find(x=>h[x]!==g[x]);return b===void 0?0:g[b]-h[b]}),u.filter(({inc:h},g)=>{let b=0;for(let x=0,y=g-e;x<=y+b;x++){const C=u[x].inc;if(l.every(w=>C[w]>=h[w])&&++b>=e)return!1}return!0})))});p.some((r,o)=>r.length!=t.candidates[o].length)&&(t.candidates=p.map(r=>r.map(o=>o.c)))}const se=Symbol();function lr(t){const{nodes:e,cat:s,candidates:i}=t,a=new Map;Ct(e,(r,o)=>{if(r.x.forEach(o),r.br.forEach(o),r.br.length)return;const u=r.x.map(g=>a.get(g));if(u.some(g=>!g))return;let h;switch(r.op){case"sum":{h={[se]:u.reduce((g,b)=>g+b[se],0)};for(const g of u)for(const[b,x]of Object.entries(g))h[b]=(h[b]??0)+x;break}case"prod":{const g=r.x.findIndex(x=>x.op!=="const");if(r.x.find((x,y)=>x.op!=="const"&&y!==g))return;h=g!==-1?{...u[g]}:{[se]:1};const b=u.reduce((x,y,C)=>C===g?x:x*y[se],1);b!=1&&(Object.keys(h).forEach(x=>h[x]*=b),h[se]*=b);break}case"read":h={[r.tag[s]]:1,[se]:0};break;case"const":if(typeof r.ex!="number")return;h={[se]:r.ex};break;default:return}a.set(r,h)});const l=new Map;if(Ct(e,(r,o)=>{const u=a.get(r);u&&Object.keys(u).length?l.set(r,u):(r.x.forEach(o),r.br.forEach(o))}),![...l.keys()].some(r=>{if(r.op==="const"||r.op==="read")return!1;if(r.op==="sum"&&r.x.length===2){if(r.x[0].op==="const"&&r.x[1].op==="read")return!1;if(r.x[1].op==="const"&&r.x[0].op==="read")return!1}return!0}))return;let d=new Map([...l.values()].map(r=>{const o=Object.keys(r).sort();return o.length===1&&r[o[0]]===1?[r,o[0]]:[r,""+o.flatMap(u=>[u,r[u]]).join("")]}));if(!ds()){const r=new Map([...d.values()].map((o,u)=>[o,`c${u}`]));d=new Map([...d].map(([o,u])=>[o,r.get(u)]))}const p=new Map;for(const[r,o]of d){const u=Ke({[s]:o});p.set(r,r[se]!==0?fn(r[se],u):u)}t.candidates=i.map(r=>r.map(o=>{const u={id:o.id};return d.forEach((h,g)=>{h in u||(u[h]=Object.entries(g).reduce((b,[x,y])=>b+(o[x]??0)*y,0))}),u})),t.nodes=Pe(e,(r,o)=>{const u=l.get(o);return u?p.get(u):r})}function vt(t){const e=t.values(),s=e.next().value;if(!s)return{};const i=Object.fromEntries(Object.entries(s).map(([a,l])=>[a,{min:l,max:l}]));for(const a of e){for(const[l,c]of Object.entries(i)){const d=a[l]??0;c.min>d&&(c.min=d),c.max<d&&(c.max=d)}for(const[l,c]of Object.entries(a))l in i||(i[l]={min:Math.min(0,c),max:Math.max(0,c)})}return i}function jn(t,e,s){const i=new Map;return Ct(t,(a,l)=>{a.x.forEach(l),a.br.forEach(l);const c=a.x.map(u=>i.get(u)),d=c.map(u=>u.min),p=c.map(u=>u.max);function r(u,[h,g]){const b=nr[u],x=[b([h.min,g.min]),b([h.min,g.max]),b([h.max,g.min]),b([h.max,g.max])];return{min:Math.min(...x),max:Math.max(...x)}}let o;switch(a.op){case"const":typeof a.ex=="number"?o={min:a.ex,max:a.ex}:o={min:NaN,max:NaN};break;case"sum":o={min:d.reduce((u,h)=>u+h,0),max:p.reduce((u,h)=>u+h,0)};break;case"prod":o={min:1,max:1},o=c.reduce((u,h)=>r(a.op,[u,h]),o);break;case"min":case"max":o={min:Math[a.op](...d),max:Math[a.op](...p)};break;case"match":case"thres":o={min:Math.min(...d),max:Math.max(...p)};break;case"sumfrac":d[0]+d[1]>0||p[0]+p[1]<0?o=r(a.op,c):o={min:NaN,max:NaN};break;case"read":{o={min:0,max:0};for(const{[a.tag[e]]:u}of s)u&&(o.min+=u.min,o.max+=u.max);break}case"subscript":{if(typeof a.ex[0]!="number")o={min:NaN,max:NaN};else{o={min:1/0,max:-1/0};let{min:u,max:h}=i.get(a.br[0]);u=Math.max(0,Math.ceil(u)),h=Math.min(h,a.ex.length-1);for(let g=u;g<=h;g++){const b=a.ex[g];o.min>b&&(o.min=b),o.max<b&&(o.max=b)}o.min>o.max&&(o={min:NaN,max:NaN})}break}case"lookup":isNaN(d[0])&&isNaN(p[0])&&(d.splice(0,1),p.splice(0,1)),o={min:Math.min(...d),max:Math.max(...p)};break;case"custom":o=In[a.ex].range(c);break;default:et(a)}i.set(a,o)}),i}function dr(t,e,s){const i=new Map,a=[],l=new Map;function c(d,p){i.has(d)||i.set(d,{inc:!0,dec:!0});const r=i.get(d);if(p&&r.dec)r.dec=!1;else if(!p&&r.inc)r.inc=!1;else return;a.push({node:d,inc:p})}for(t.forEach(d=>c(d,!0));a.length;){const{node:d,inc:p}=a.pop();switch(d.op){case"read":l.set(d.tag[e],i.get(d));break;case"const":break;case"sum":case"min":case"max":d.x.forEach(r=>c(r,p));break;case"thres":{d.x.forEach(u=>c(u,p));const r=s.get(d.x[0]),o=s.get(d.x[1]);r.max>o.min&&(c(d.br[0],p),c(d.br[1],!p)),r.min<o.max&&(c(d.br[0],!p),c(d.br[1],p));break}case"sumfrac":{const[r,o]=d.x.map(u=>s.get(u));o.min<0&&c(d.x[0],!p),o.max>0&&c(d.x[0],p),r.min<0&&c(d.x[1],p),r.max>0&&c(d.x[1],!p);break}case"prod":{const r=s.get(d);if(r.min<0&&r.max>0)d.x.forEach(o=>c(o,!0)),d.x.forEach(o=>c(o,!1));else{const o=p===r.max>0;d.x.forEach(u=>c(u,o===s.get(u).max>0))}break}case"match":case"lookup":d.x.forEach(r=>c(r,p)),d.br.forEach(r=>c(r,!0)),d.br.forEach(r=>c(r,!1));break;case"subscript":{const{br:[r],ex:o}=d;if(typeof o[0]=="number"){let{min:u,max:h}=s.get(r);u=Math.max(0,Math.ceil(u)),h=Math.min(h,o.length-1);for(let g=u+1;g<=h;g++)if(o[g-1]<o[g]){c(r,p);break}for(let g=u+1;g<=h;g++)if(o[g-1]>o[g]){c(r,!p);break}}else c(r,!0),c(r,!1);break}case"custom":In[d.ex].monotonicity(d.x.map(r=>s.get(r))).forEach((r,o)=>{r.inc||c(d.x[o],!p),r.dec||c(d.x[o],p)});break;default:et(d)}}return l}function ur({maxBuildsToShow:t,optConfigId:e}){const{database:s}=D(),{t:i}=Z("page_optimize");return f(B,{title:i("build",{count:t}),children:[n(T,{children:n(k,{variant:"caption",color:"info.main",children:i("buildDropdownDesc")})}),ps.map(a=>n(T,{onClick:()=>s.optConfigs.set(e,{maxBuildsToShow:a}),children:i("build",{count:a})},a))]})}function pr({numWorkers:t,setNumWorkers:e}){const{t:s}=Z("page_optimize"),i=navigator.hardwareConcurrency||8;return f(B,{title:`${t} Workers`,children:[n(T,{disabled:!0,children:"Scales with available CPU cores."}),ht(1,i).map(a=>n(T,{onClick:()=>e(a),children:s("worker",{count:a})},a))]})}const Pt=hs(K.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");var Ie={},cn;function hr(){if(cn)return Ie;cn=1;var t=St();Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.default=void 0;var e=t(kt()),s=Mt(),i=(0,e.default)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");return Ie.default=i,Ie}var fr=hr();const Fe=Dt(fr);function mr({formulasRead:t,buffsRead:e}){var p;const s=m.useContext(tt),i=(p=m.useContext(Et))==null?void 0:p.withTag(s),a=i==null?void 0:i.toDebug(),[l,c]=m.useState(!1),d=r=>(o,u)=>{c(u?r:!1)};return n(A,{bgt:"dark",children:f(R,{children:[f(qe,{expanded:l==="formulas",onChange:d("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[n(Le,{expandIcon:n(Fe,{}),children:"All target listings"}),n($e,{children:n(ft,{children:i&&a&&l==="formulas"&&i.listFormulas(t).map((r,o)=>{const u=i.compute(r),h=a.compute(r).meta,g=r.tag.name||r.tag.q;return f(Y,{children:[f(k,{children:[g,": ",u.val]}),f(qe,{children:[f(Le,{expandIcon:n(Fe,{}),children:["debug for ",g]}),f($e,{children:["conds:",n(J,{text:ie(u.meta.conds)}),"read:",n(J,{text:ie(r)}),"formula:",n(J,{text:ie(h)})]})]})]},`${g}${o}`)})})})]}),f(qe,{expanded:l==="buffs",onChange:d("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[n(Le,{expandIcon:n(Fe,{}),children:"All target buffs"}),n($e,{children:n(ft,{children:i&&a&&l==="buffs"&&i.listFormulas(e).map((r,o)=>{const u=i.compute(r),h=a.compute(r).meta,g=r.tag.name||r.tag.q;return f(Y,{children:[f(k,{children:[g,": ",u.val]}),f(qe,{children:[f(Le,{expandIcon:n(Fe,{}),children:["debug for ",g]}),f($e,{children:["conds:",n(J,{text:ie(u.meta.conds)}),"read:",n(J,{text:ie(r)}),"formula:",n(J,{text:ie(h)})]})]})]},`${g}${o}`)})})})]})]})})}function gr(){var o;const t=m.useContext(tt),e=(o=m.useContext(Et))==null?void 0:o.withTag(t),s=e==null?void 0:e.toDebug(),{read:i,setRead:a}=m.useContext(mn),l=i&&(e==null?void 0:e.compute(i)),c=i&&(s==null?void 0:s.compute(i)),d=(i==null?void 0:i.tag.name)||(i==null?void 0:i.tag.q),p=c==null?void 0:c.meta,r=p&&ie(p);return n(It,{open:!!i,onClose:()=>a(void 0),children:f(A,{bgt:"dark",children:[n(Oe,{title:`Debug formula for ${d}`,action:n(fe,{onClick:()=>a(void 0),children:n(nt,{})})}),n(R,{children:n(A,{bgt:"normal",children:n(R,{children:f(ft,{gap:1,children:["Computed value: ",l==null?void 0:l.val,n(V,{}),n(k,{variant:"h6",children:"Read"}),n(J,{text:ie(i)}),n(V,{}),n(k,{variant:"h6",children:"Calculator Tag"}),n(J,{text:JSON.stringify(e==null?void 0:e.cache.tag)}),n(V,{}),n(k,{variant:"h6",children:"Tag Context"}),n(J,{text:JSON.stringify(t)}),n(V,{}),n(k,{variant:"h6",children:"Conditionals"}),n(J,{text:ie(l==null?void 0:l.meta.conds)}),n(V,{}),n(k,{variant:"h6",children:"Formula"}),n(J,{text:r||""})]})})})})]})})}function ee({document:t,bgt:e="normal",collapse:s=!1,typoVariant:i="body1"}){switch(t.type){case"fields":return n(xr,{fieldsDocument:t,bgt:e});case"text":return s?n(br,{textDocument:t,typoVariant:i}):n(zn,{textDocument:t,typoVariant:i});case"conditional":return n(fs,{conditional:t.conditional,bgt:e});default:return null}}function xr({fieldsDocument:t,bgt:e="normal"}){return f(A,{bgt:e,children:[t.header&&n(gn,{header:t.header,hideDivider:t.fields.length===0}),n(xs,{bgt:e,fields:t.fields})]})}function zn({textDocument:t,typoVariant:e}){const s=m.useContext(Et),i=m.useContext(tt);return s?f(k,{variant:e,children:[t.header&&n(gn,{header:t.header}),gs(t.text,s.withTag(i))]}):null}function br({textDocument:t,typoVariant:e}){const[s,i]=m.useState(!1),[a,l]=m.useState(!1);return f(v,{sx:{position:"relative"},children:[!s&&n(v,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:a?"translate(0,-5px)":void 0},children:n(ms,{})}),n(_t,{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),collapsedSize:55,onClick:()=>i(c=>!c),in:s,sx:{cursor:"pointer",position:"relative",maskImage:s?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:s?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:n(zn,{textDocument:t,typoVariant:e})})]})}function yr({levelLow:t,levelHigh:e,setLow:s,setHigh:i,setBoth:a,dark:l=!1,disabled:c=!1,showLevelText:d=!1}){const{t:p}=Z("wengine"),[r,o]=m.useState(t);$t(t)!==t&&o(t);const[u,h]=m.useState(e);$t(e)!==e&&h(e);const g=m.useCallback((b,x)=>{if(typeof x=="number")throw new TypeError;const[y,C]=x;o(y),h(C)},[o,h]);return f(v,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:l?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[f(v,{sx:{width:"max-content",height:32,display:"flex"},children:[d?f(oe,{children:[n("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:p("levelSliderTitle")}),n(V,{orientation:"vertical",flexItem:!0})]}):void 0,n(Ft,{value:r,onChange:b=>s(Lt(b??0,0,e)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:d?"right":"center"}},disabled:c})]}),n(bs,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[r,u],onChange:g,onChangeCommitted:(b,x)=>Array.isArray(x)&&a(x[0],x[1]),valueLabelDisplay:"auto",min:0,max:Ue,step:1,marks:!0,disabled:c}),n(Ft,{value:u,onChange:b=>i(Lt(b??0,t,Ue)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:c})]})}function qn({setKey:t,fade2:e=!1,fade4:s=!1,children:i}){const a=vi[t];return a?f(Tt,{bgt:"light",sx:{height:"100%"},children:[n(Oe,{title:n(Cs,{setKey:t}),avatar:n(st,{src:ys(t),size:2})}),i,n(O,{divider:n(V,{}),children:Object.entries(a).map(([l,c])=>n(v,{sx:{opacity:(l==="2"?e:s)?.5:1},children:n(Cr,{uiSheetElement:c,collapse:l!=="2"})},l))})]}):null}function Cr({uiSheetElement:t,collapse:e=!1}){const{documents:s,title:i}=t;return f(R,{children:[n(k,{variant:"subtitle1",children:i}),n(O,{spacing:1,children:s.map((a,l)=>n(ee,{document:a,typoVariant:"body2",collapse:e},l))})]})}function $n({headerAction:t,fade:e=!1,wengine:s}){const{key:i,level:a,phase:l,modification:c}=s,d=wi[i],p=vs(i,a,l,c),r="atk_base",o=it(i).second_statkey;return d?f(Tt,{bgt:"light",sx:{height:"100%"},children:[n(Oe,{title:n(Ss,{wKey:i}),avatar:n(st,{src:ws(i,"icon"),size:2}),action:t}),f(R,{sx:{py:0},children:[f(k,{sx:{display:"flex",justifyContent:"space-between"},children:[n(_e,{statKey:"atk"}),f("span",{children:[Bt(p[r],r).toFixed(Ht(r)),mt(r)]})]}),f(k,{sx:{display:"flex",justifyContent:"space-between"},children:[n(_e,{statKey:o}),f("span",{children:[Bt(p[o],o).toFixed(Ht(o)),mt(o)]})]})]}),n(v,{sx:{opacity:e?.5:1},children:n(vr,{uiSheetElement:d})})]}):null}function vr({uiSheetElement:t}){const{documents:e,title:s}=t;return f(R,{children:[n(k,{variant:"subtitle1",children:s}),n(O,{spacing:1,children:e.map((i,a)=>n(ee,{document:i,typoVariant:"body2",collapse:!0},a))})]})}function Ln(t,e=new Map){const s=e.get(t);if(s)return s;const{val:i,meta:{tag:a,op:l,ops:c,usedCats:d}}=t,p=a&&ks(a,(C,w)=>d.has(w)),r=xn(i,mt(Si(a))),o=new Set;function u(C,w){return C.map((E,G)=>{const I=Ln(E,e);return I.name?(o.add(I),I.name):(I.deps.forEach(j=>o.add(j)),I.prec>=w?I.formula:f("span",{children:["(",I.formula,")"]},G))})}let h,g=1/0;switch(l){case"const":h=r,g=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:C,joiner:w,end:E}=ut[l];g=ut[l].prec,h=f("span",{children:[C,u(c,g).map((G,I)=>f(m.Fragment,{children:[G,I<c.length-1&&w]},I)),E]})}break;case"sumfrac":{const[C]=u(c,2),[w,E]=u(c,1);h=f("span",{children:[C," / (",w," + ",E,")"]}),g=ut.prod.prec;break}default:Ms(l)}let b,x;p&&(b=p.q==="_"?void 0:f("span",{children:[n(q,{tag:p})," ",r]}),x=void 0);const y={name:b,formula:h,prec:g,sheet:x,deps:[...new Set(o)]};return e.set(t,y),y}const ut={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function wr(){return n(Y,{children:Sr.map((t,e)=>n(ee,{document:t},e))})}const Sr=[{type:"conditional",conditional:{label:"Frostbite",metadata:Kt.frostbite,fields:[{title:n(q,{tag:Gt.frostbite_crit_dmg_.tag}),fieldRef:Gt.frostbite_crit_dmg_.tag}]}},{type:"conditional",conditional:{label:"Anomaly Time Passed",metadata:Kt.anomTimePassed}}];function Fn({isAftershock:t,setAftershock:e}){return n(N,{onClick:()=>e(!t),color:t?"success":"secondary",children:yt.aftershock})}function Bn({dmgType:t,keys:e,setDmgType:s}){return f(B,{title:f(v,{sx:{textWrap:"nowrap"},children:["Dmg Type: ",t?yt[t]:"Any"]}),children:[n(T,{selected:!t,disabled:!t,onClick:()=>s(),children:"Any"},"any"),e.map(i=>n(T,{selected:t===i,disabled:t===i,onClick:()=>s(i),children:yt[i]},i))]})}function kr(){var p;const{t}=Z("page_optimize"),{database:e}=D(),{key:s}=P(),{bonusStats:i}=H(s),a=(p=bn(e.charMeta,s))==null?void 0:p.description,l=m.useCallback((r,o,u,h)=>e.charOpts.setBonusStat(s,r,o,u,h),[e,s]),c=r=>e.charOpts.setBonusStat(s,Is(r),0,!1),d=m.useCallback(r=>{e.charMeta.set(s,{description:r})},[e.charMeta,s]);return f(O,{spacing:1,children:[i.map(({tag:r,value:o,disabled:u},h)=>n(Dr,{tag:r,value:o,disabled:u,setValue:g=>l(r,g,u,h),onDelete:()=>l(r,null,u,h),setTag:g=>l(g,o,u,h),toggleDisabled:()=>l(r,o,!u,h)},JSON.stringify(r)+h)),n(Mr,{onSelect:c}),n(Ii,{placeholder:t("bonusStatsNotes"),value:a,disabled:!s,onChange:r=>d(r),multiline:!0,minRows:3,fullWidth:!0})]})}function Mr({tag:t,onSelect:e}){return n(B,{title:(t&&n(q,{tag:t}))??"Add Bonus Stat",children:Ts.map(s=>n(T,{onClick:()=>e(s),children:n(_e,{statKey:s,showPercent:!0})},s))})}function Dr({tag:t,setTag:e,value:s,disabled:i,setValue:a,onDelete:l,toggleDisabled:c}){var p;const d=(p=t.q)==null?void 0:p.endsWith("_");return n(A,{bgt:"light",sx:{opacity:i?.4:void 0},children:f(R,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[n(fe,{onClick:c,children:i?n(yn,{}):n(Cn,{})}),n(k,{children:n(q,{tag:t})}),n(Ir,{qt:t.qt,setQt:r=>e({...t,qt:r})}),["dmg_","sheer_dmg_","resIgn_"].includes(t.q)&&n(Er,{tag:t,setAttribute:r=>{const{attribute:o,...u}=t;e(r?{...u,attribute:r}:u)}}),Ds.includes(t.q)&&n(Bn,{dmgType:t.damageType1,keys:Es,setDmgType:r=>{const{damageType1:o,...u}=t;e(r?{...u,damageType1:r}:u)}}),["dmg_","crit_dmg_"].includes(t.q)&&n(Fn,{isAftershock:t.damageType2==="aftershock",setAftershock:r=>{const{damageType2:o,...u}=t;e(r?{...u,damageType2:"aftershock"}:u)}}),n(ye,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:a,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:f(rt,{position:"end",sx:{ml:0},children:[d?"%":void 0," ",n(fe,{"aria-label":"Delete Bonus Stat",onClick:l,edge:"end",children:n(Pt,{fontSize:"small"})})]})}})]})})}function Er({tag:t,setAttribute:e}){return f(B,{title:t.attribute?n(De,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(T,{onClick:()=>e(null),children:"No Attribute"}),Rt.map(s=>n(T,{onClick:()=>e(s),children:n(At,{color:s,children:n(De,{attribute:s})})},s))]})}function Ir({qt:t,setQt:e}){return n(B,{title:t&&Me[t],children:Rs.map(s=>n(T,{onClick:()=>e(s),selected:t===s,disabled:t===s,children:Me[s]},s))})}function Tr(){const{key:t}=P();return f(v,{children:[t==="Yixuan"&&n(Ar,{}),t==="Soldier0Anby"&&n(_r,{}),t==="Manato"&&n(Pr,{}),t==="Yidhari"&&n(jr,{}),t==="Banyue"&&n(qr,{}),Object.values(ki[t]).flatMap((e,s)=>e.documents.map((i,a)=>n(ee,{document:i,collapse:!0},`${s}_${a}`)))]})}const Rr=[{type:"text",text:"We automatically convert Yixuan's HP to Sheer Force at a ratio of 1:0.1. Everything else in her kit is not factored, such as the DMG Bonus % added in her Core skill"},{type:"fields",fields:[{title:n(q,{tag:Ut.core_hpSheerForce.tag}),fieldRef:Ut.core_hpSheerForce.tag}]}];function Ar(){return n(oe,{children:Rr.map((t,e)=>n(ee,{document:t},e))})}const Wr=[{type:"text",text:"Enabling this checkbox will add additional CRIT DMG to Aftershock attacks, based on Soldier 0 - Anby's CRIT DMG, at a ratio matching her Core Skill level scaling. Everything else in her kit is not factored, such as the DMG Bonus % added in her Core skill for enemies marked with Silver Star."},{type:"conditional",conditional:{metadata:As.markedWithSilverStar,label:"Enemy marked with Silver Star",fields:[{title:n(q,{tag:Vt.core_markedWithSilverStar_crit_dmg_.tag}),fieldRef:Vt.core_markedWithSilverStar_crit_dmg_.tag}]}}];function _r(){return n(oe,{children:Wr.map((t,e)=>n(ee,{document:t},e))})}const Or=[{type:"text",text:"We automatically convert Manato's HP to Sheer Force at a ratio of 1:0.1. Everything else in his kit is not factored"},{type:"fields",fields:[{title:n(q,{tag:Xt.core_hpSheerForce.tag}),fieldRef:Xt.core_hpSheerForce.tag}]}];function Pr(){return n(oe,{children:Or.map((t,e)=>n(ee,{document:t},e))})}const Nr=[{type:"text",text:"We automatically convert Yidhari's HP to Sheer Force at a ratio of 1:0.1. Everything else in her kit is not factored"},{type:"fields",fields:[{title:n(q,{tag:Qt.core_hpSheerForce.tag}),fieldRef:Qt.core_hpSheerForce.tag}]}];function jr(){return n(oe,{children:Nr.map((t,e)=>n(ee,{document:t},e))})}const zr=[{type:"text",text:"We automatically convert Banyue's HP to Sheer Force at a ratio of 1:0.1. Everything else in his kit is not factored"},{type:"fields",fields:[{title:n(q,{tag:Jt.core_hpSheerForce.tag}),fieldRef:Jt.core_hpSheerForce.tag}]}];function qr(){return n(oe,{children:zr.map((t,e)=>n(ee,{document:t},e))})}function $r(){const{database:t}=D(),{key:e}=P(),{enemyStats:s,enemyLvl:i,enemyDef:a,enemyStunMultiplier:l}=H(e),c=m.useCallback((p,r,o)=>t.charOpts.setEnemyStat(e,p,r,o),[t,e]),d=p=>t.charOpts.setEnemyStat(e,Os(p),0);return f(O,{spacing:1,children:[f(v,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[n(ye,{label:"Enemy Lvl",value:i,inputProps:{min:0,sx:{width:"4em"}},onChange:p=>t.charOpts.set(e,{enemyLvl:p})}),n(ye,{label:"Enemy DEF",value:a,inputProps:{min:0,sx:{width:"4em"}},onChange:p=>t.charOpts.set(e,{enemyDef:p})}),n(ye,{label:"Enemy Stun Multiplier",value:l,inputProps:{min:0,sx:{width:"8em"}},onChange:p=>t.charOpts.set(e,{enemyStunMultiplier:p}),InputProps:{endAdornment:n(rt,{position:"end",children:"%"})}})]}),n(ee,{document:Hr}),s.map(({tag:p,value:r},o)=>n(Fr,{tag:p,value:r,setValue:u=>c(p,u,o),onDelete:()=>c(p,null,o),setTag:u=>c(u,r,o)},JSON.stringify(p)+o)),n(Lr,{onSelect:d})]})}function Lr({tag:t,onSelect:e}){return n(B,{title:(t&&n(q,{tag:{...t,qt:"common",et:"enemy",sheet:"agg"}}))??"Add Enemy Stat",children:Ps.map(s=>n(T,{onClick:()=>e(s),children:n(q,{tag:{q:s,qt:"common",et:"enemy",sheet:"agg"},showPercent:!0})},s))})}function Fr({tag:t,setTag:e,value:s,setValue:i,onDelete:a}){var c;const l=(c=t.q)==null?void 0:c.endsWith("_");return n(A,{bgt:"light",children:f(R,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[n(k,{children:n(q,{tag:t})}),_s(["res_","resRed_"],t.q)&&n(Br,{tag:t,setAttribute:d=>{const{attribute:p,...r}=t;e(d?{...r,attribute:d}:r)}}),n(ye,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:i,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:f(rt,{position:"end",sx:{ml:0},children:[l?"%":void 0," ",n(fe,{"aria-label":"Delete Enemy Stat",onClick:a,edge:"end",children:n(Pt,{fontSize:"small"})})]})}})]})})}function Br({tag:t,setAttribute:e}){return f(B,{title:t.attribute?n(De,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(T,{onClick:()=>e(null),children:"No Attribute"}),Rt.map(s=>n(T,{onClick:()=>e(s),children:n(At,{color:s,children:n(De,{attribute:s})})},s))]})}const Hr={type:"conditional",conditional:{label:"Enemy is Stunned",metadata:Ws.isStunned}};function wt(t){return t.reduce((e,s)=>e*s.length,1)}const Gr=50;class Kr{constructor(e){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.nextReport=Date.now(),this.finalize=()=>{},this.terminate=()=>{};const{progress:s}=this,{topN:i,numWorkers:a,setProgress:l}=e,c=[...Array(a)].map(()=>new Worker(new URL(""+new URL("workerHandle-CSrCyUap.js",import.meta.url).href,import.meta.url),{type:"module"})),d=ir(e.nodes,e.candidates,"q",e.minimum,i),{nodes:p,minimum:r,candidates:o}=d;if(s.remaining=wt(o),s.skipped=wt(e.candidates)-s.remaining,s.remaining>Number.MAX_SAFE_INTEGER)throw new Error("too many combinations");this.topN=i,this.optThreshold=r[0],this.info=new Map(c.map(g=>[g,{builds:[]}]));const u=o.map(g=>g.map(b=>b.id));this.state={ty:"work",works:[{ids:u,count:s.remaining}]},this.report=()=>l({...s}),this.results=new Promise((g,b)=>{this.finalize=x=>(this.report(),g(x)),this.terminate=b});const h=()=>c.forEach(g=>g.terminate());this.results.then(h,h);for(const g of c)g.onmessage=({data:b})=>{try{this.onWorkerMsg(b,g)}catch(x){this.terminate(x)}},Be(g,{ty:"init",nodes:p,minimum:r,candidates:o,topN:i})}distribute(e){const{state:s}=this;if(s.ty==="work"){s.works.push(...e);return}for(const i of s.workers)if(this.give(e,i))s.workers.delete(i);else return;this.state={ty:"work",works:e}}idle(e){const{state:s,progress:i,info:a}=this;if(s.ty==="idle")s.workers.add(e);else if(this.give(s.works,e)){const l=i.remaining/(a.size+.5);a.forEach((c,d)=>Be(d,{ty:"work?",maxKeep:l}))}else this.state={ty:"idle",workers:new Set([e])}}give(e,s){if(!e.length)return!1;let i=this.progress.remaining/(this.info.size+.5),a=e.findIndex(c=>(i-=c.count)<0)+1;a>1&&(a-=1);const l=e.splice(0,a||e.length);return Be(s,{ty:"add",works:l}),!0}onWorkerMsg(e,s){var i;switch(e.ty){case"progress":{const a=this.progress,l=this.info.get(s);a.remaining-=e.computed+e.skipped,a.computed+=e.computed,a.failed+=e.failed,a.skipped+=e.skipped,l.builds=e.builds,e.idle&&this.idle(s);const c=Date.now();if(this.nextReport<=c||!e.remaining){this.nextReport=c+Gr,this.report();const d=[...this.info.values()].flatMap(r=>r.builds);d.sort((r,o)=>o.value-r.value);const p=((i=d[this.topN])==null?void 0:i.value)??-1/0;p>this.optThreshold&&(this.optThreshold=p,this.info.forEach((r,o)=>Be(o,{ty:"config",threshold:p}))),this.progress.remaining||this.finalize(d.slice(0,this.topN))}break}case"add":this.distribute(e.works);break;case"err":this.terminate(e.msg+" (Worker Error)")}}}function Be(t,e){t.postMessage(e)}const Ur=1e-7;function Vr(t,e,s,i,a,l,c,d,p,r,o){const u=new Set(gt),h=new Set(xt),g=[fn(...s.map((x,y)=>Yt(x.multiplier,new lt({src:t,...x.tag},void 0).with("preset",`preset${y}`)))),...i.map(({tag:x,isMax:y})=>{const C={...Ns(x),src:t,preset:"preset0"};return y?Yt(-1,new lt(C,void 0)):new lt(C,void 0)})],b=Ji(g,e,x=>{if(x.src===t&&x.et==="own"){if(x.sheet==="dyn"&&x.qt==="initial")return x.q==="dmg_"?{q:`${x.attribute}_dmg_`}:{q:x.q};if(x.q==="count"&&u.has(x.sheet))return{q:x.sheet};if(x.qt=="wengine"&&["lvl","phase","modification"].includes(x.q))return{q:x.q};if(x.q==="count"&&h.has(x.sheet))return{q:x.sheet}}});return b.push(a.length?pt(...a.map(x=>Ke({q:x},"sum"))):ae(1/0),l.length?pt(...l.map(x=>Ke({q:x},"sum"))):ae(1/0)),{nodes:b,candidates:[c.map(Xr),d[1].map(xe),d[2].map(xe),d[3].map(xe),d[4].map(xe),d[5].map(xe),d[6].map(xe)],minimum:[-1/0,...i.map(({value:x,isMax:y,tag:C})=>{const w=js(x,C.q??"");return(y?w*-1:w)-Ur}),2,4],numWorkers:p,topN:r,setProgress:o}}function xe(t){const{id:e,mainStatKey:s,level:i,rarity:a,setKey:l,substats:c}=t;return{id:e,[s]:zs(a,s,i),...Object.fromEntries(c.filter(d=>!!d.key&&!!d.upgrades).map(({key:d,upgrades:p})=>[d,qs(d,a)*p])),[l]:1}}function Xr(t){const{id:e,key:s,level:i,modification:a,phase:l}=t;return{id:e,lvl:i,modification:a,phase:l,[s]:1}}var Te={},ln;function Qr(){if(ln)return Te;ln=1;var t=St();Object.defineProperty(Te,"__esModule",{value:!0}),Te.default=void 0;var e=t(kt()),s=Mt(),i=(0,e.default)((0,s.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");return Te.default=i,Te}var Jr=Qr();const Yr=Dt(Jr),Zr=m.memo(function({disabled:e=!1}){const{database:s}=D(),{optConfigId:i,optConfig:a}=m.useContext(X);return f(A,{bgt:"light",children:[n(R,{sx:{display:"flex",gap:1},children:n(k,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),n(V,{}),n($s,{levelLow:(a==null?void 0:a.levelLow)??Zt.S,levelHigh:(a==null?void 0:a.levelHigh)??Zt.S,setLow:l=>s.optConfigs.set(i,{levelLow:l}),setHigh:l=>s.optConfigs.set(i,{levelHigh:l}),setBoth:(l,c)=>s.optConfigs.set(i,{levelLow:l,levelHigh:c}),disabled:e})]})});function ea({discBySlot:t,setFilter4:e,setFilter2:s,setSetFilter4:i,setSetFilter2:a}){const l=P(),c=H(l==null?void 0:l.key),d=m.useMemo(()=>{const p=ke(gt,()=>ke(Wt,()=>0));return Object.values(t).forEach(r=>r.forEach(({setKey:o,slotKey:u})=>p[o][u]++)),p},[t]);return f(oe,{children:[f(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(k,{variant:"h6",sx:{flexGrow:1},children:"Disc Set Config"}),n(N,{disabled:!e.length,onClick:()=>i([]),children:"Reset 4p filter"}),n(N,{disabled:!s.length,onClick:()=>a([]),children:"Reset 2p filter"})]}),n(v,{children:l&&c&&n(Tn,{character:l,conditionals:c.conditionals,children:n(_,{container:!0,spacing:1,children:gt.map(p=>n(_,{item:!0,xs:1,md:2,lg:3,children:n(ta,{numSlot:d[p],setKey:p,setFilter4:e,setFilter2:s,setSetFilter4:i,setSetFilter2:a})},p))})})})]})}function ta({numSlot:t,setKey:e,setFilter4:s,setFilter2:i,setSetFilter4:a,setSetFilter2:l}){const c=!!i.length&&!i.includes(e),d=!!s.length&&!s.includes(e);return f(qn,{setKey:e,fade2:c,fade4:d,children:[n(v,{sx:{display:"flex",justifyContent:"space-around",pb:1},children:Object.entries(t).map(([p,r])=>n(v,{children:n(at,{color:r?"primary":"secondary",children:r})},p))}),f(Ls,{fullWidth:!0,children:[n(N,{sx:{borderRadius:0},color:!s.length||s.includes(e)?"success":"secondary",onClick:()=>a(s.length?en([...s],e):[e]),children:"Allow 4p"}),n(N,{sx:{borderRadius:0},color:!i.length||i.includes(e)?"success":"secondary",onClick:()=>l(i.length?en([...i],e):[e]),children:"Allow 2p"})]})]})}function na({discsBySlot:t}){const[e,s,i]=ot();return n(A,{bgt:"light",children:n(R,{children:f(O,{spacing:1,children:[n(Y,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:Wt.map(a=>n(pe,{discsBySlot:t,slotKey:a},a))}),n(sa,{show:e,onClose:i,discsBySlot:t}),n(N,{color:"info",fullWidth:!0,onClick:s,children:"Disc Filter Config"})]})})})}function pe({discsBySlot:t,slotKey:e}){return f(k,{children:["Disc ",e," ",n(at,{color:t[e].length?"primary":"error",children:t[e].length})]})}function sa({discsBySlot:t,show:e,onClose:s,disabled:i}){const{database:a}=D(),{optConfigId:l,optConfig:c}=m.useContext(X);return n(It,{open:e,onClose:s,children:f(A,{children:[n(Oe,{title:"Disc Filter",action:n(fe,{onClick:s,children:n(nt,{})})}),n(V,{}),n(R,{children:n(m.Suspense,{fallback:n(vn,{width:"100%",height:"500px"}),children:f(O,{spacing:1,children:[n(Zr,{disabled:i}),n(ia,{discsBySlot:t,disabled:i}),n(N,{disabled:i,onClick:()=>a.optConfigs.set(l,{useEquipped:!c.useEquipped}),color:c.useEquipped?"success":"secondary",children:"Use equipped Discs"}),n(ra,{discBySlot:t,disabled:i})]})})})]})})}function ia({discsBySlot:t,disabled:e}){const{database:s}=D(),{optConfigId:i,optConfig:a}=m.useContext(X),l=c=>{const d=Fs([...tn[c]]),p={4:a.slot4??[],5:a.slot5??[],6:a.slot6??[]},r={4:o=>s.optConfigs.set(i,{slot4:o}),5:o=>s.optConfigs.set(i,{slot5:o}),6:o=>s.optConfigs.set(i,{slot6:o})};return n(Y,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:tn[c].map(o=>n(N,{disabled:e,variant:p[c].includes(o)?"contained":"outlined",onClick:()=>r[c](d([...p[c]],o)),children:n(_e,{statKey:o,showPercent:!0})},o))})};return n(A,{bgt:"light",children:n(R,{children:f(O,{spacing:1,children:[f(Y,{sx:{display:"flex",justifyContent:"space-between"},children:[n(pe,{slotKey:"1",discsBySlot:t}),n(pe,{slotKey:"2",discsBySlot:t}),n(pe,{slotKey:"3",discsBySlot:t})]}),n(pe,{slotKey:"4",discsBySlot:t}),l("4"),n(pe,{slotKey:"5",discsBySlot:t}),l("5"),n(pe,{slotKey:"6",discsBySlot:t}),l("6")]})})})}function ra({discBySlot:t,disabled:e}){const{database:s}=D(),{optConfigId:i,optConfig:a}=m.useContext(X),{setFilter2:l=[],setFilter4:c=[]}=a,d=m.useCallback(r=>{s.optConfigs.set(i,{setFilter2:r})},[s,i]),p=m.useCallback(r=>{s.optConfigs.set(i,{setFilter4:r})},[s,i]);return n(ea,{discBySlot:t,disabled:e,setFilter2:l,setFilter4:c,setSetFilter2:d,setSetFilter4:p})}function aa({disabled:t=!1}){const{optConfigId:e,optConfig:{statFilters:s}}=m.useContext(X),{database:i}=D(),a=m.useCallback(l=>i.optConfigs.set(e,{statFilters:l}),[i,e]);return f(A,{bgt:"light",children:[n(R,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:n(v,{display:"flex",justifyContent:"space-between",children:n(k,{sx:{fontWeight:"bold"},children:"Stat Filter"})})}),n(V,{}),n(R,{children:n(oa,{statFilters:s,setStatFilters:a,disabled:t})})]})}function oa({statFilters:t,setStatFilters:e,disabled:s=!1}){const i=m.useCallback((r,o)=>{const u=structuredClone(t);typeof o>"u"?u.push({tag:r,value:0,isMax:!1,disabled:!1}):u[o].tag=r,e(u)},[e,t]),a=m.useCallback(r=>{const o=structuredClone(t);o.splice(r,1),e(o)},[e,t]),l=m.useCallback((r,o)=>{const u=structuredClone(t);u[r].value=o,e(u)},[e,t]),c=m.useCallback((r,o)=>{const u=structuredClone(t);u[r].isMax=o,e(u)},[e,t]),d=m.useCallback((r,o)=>{const u=structuredClone(t);u[r].disabled=o,e(u)},[e,t]),p=r=>i(Hs(r));return f(v,{display:"flex",flexDirection:"column",gap:1,children:[t.map((r,o)=>n(la,{statFilter:r,delTarget:()=>a(o),setTarget:u=>i(u,o),setTargetValue:u=>l(o,u),setTargetisMax:u=>c(o,u),setDisabled:u=>d(o,u),disabled:s},o+JSON.stringify(r))),n(ca,{onSelect:p})]})}function ca({tag:t,onSelect:e}){return n(B,{title:(t&&n(q,{tag:t}))??"Add Stat Filter",children:Gs.map(s=>n(T,{onClick:()=>e(s),children:n(_e,{statKey:s,showPercent:!0})},s))})}function la({statFilter:t,delTarget:e,setTarget:s,setTargetValue:i,setTargetisMax:a,setDisabled:l,disabled:c}){const{tag:d,value:p,isMax:r,disabled:o}=t,u=Bs(d.q??"");return n(A,{children:f(R,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(N,{color:o?"secondary":"success",onClick:()=>l(!o),disabled:c,size:"small",children:o?n(yn,{}):n(Cn,{})}),n(k,{children:n(q,{tag:d})}),n(ua,{qt:d.qt,setQt:h=>s({...d,qt:h})}),d.q==="dmg_"&&n(da,{tag:d,setAttribute:h=>{const{attribute:g,...b}=d;s(h?{...b,attribute:h}:b)}}),n(N,{onClick:()=>a(!r),size:"small",children:n("strong",{children:r?"MAX":"MIN"})}),n(ye,{float:!0,value:p,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:c,onChange:i,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:f(rt,{position:"end",sx:{ml:0},children:[u?"%":void 0," ",n(fe,{"aria-label":"Delete Stat Constraint",onClick:e,edge:"end",children:n(Pt,{fontSize:"small"})})]})}})]})})}function da({tag:t,setAttribute:e}){return f(B,{title:t.attribute?n(De,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[n(T,{onClick:()=>e(null),children:"No Attribute"}),Rt.map(s=>n(T,{onClick:()=>e(s),children:n(At,{color:s,children:n(De,{attribute:s})})},s))]})}function ua({qt:t,setQt:e}){return n(B,{title:t&&Me[t],children:Ks.map(s=>n(T,{onClick:()=>e(s),selected:t===s,disabled:t===s,children:Me[s]},s))})}const pa=m.memo(function({disabled:e=!1}){const{database:s}=D(),{optConfigId:i,optConfig:a}=m.useContext(X);return f(A,{bgt:"light",children:[n(R,{sx:{display:"flex",gap:1},children:n(k,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),n(V,{}),n(yr,{levelLow:(a==null?void 0:a.wlevelLow)??Ue,levelHigh:(a==null?void 0:a.wlevelHigh)??Ue,setLow:l=>s.optConfigs.set(i,{wlevelLow:l}),setHigh:l=>s.optConfigs.set(i,{wlevelHigh:l}),setBoth:(l,c)=>s.optConfigs.set(i,{wlevelLow:l,wlevelHigh:c}),disabled:e})]})});function ha({wengines:t,disabled:e}){const{database:s}=D(),{optConfigId:i,optConfig:a}=m.useContext(X),[l,c,d]=ot();return n(A,{bgt:"light",children:n(R,{children:f(O,{spacing:1,children:[f(Y,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[f(Y,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",n(at,{color:t.length?"primary":"error",children:t.length})]}),n(N,{sx:{flexGrow:1},startIcon:a.optWengine?n(Us,{}):n(Vs,{}),color:a.optWengine?"success":"secondary",onClick:()=>s.optConfigs.set(i,{optWengine:!a.optWengine}),children:"Optimize Wengine"})]}),n(fa,{show:l,onClose:d,wengines:t}),n(N,{color:"info",fullWidth:!0,onClick:c,disabled:e||!a.optWengine,children:"Wengine Filter Config"})]})})})}function fa({wengines:t,show:e,onClose:s,disabled:i}){const{database:a}=D(),{optConfigId:l,optConfig:c}=m.useContext(X);return n(It,{open:e,onClose:s,children:f(A,{children:[n(Oe,{title:"Wengine Filter",action:n(fe,{onClick:s,children:n(nt,{})})}),n(V,{}),n(R,{children:n(m.Suspense,{fallback:n(vn,{width:"100%",height:"500px"}),children:f(O,{spacing:1,children:[n(pa,{disabled:i}),n(ma,{disabled:i}),n(N,{disabled:i,onClick:()=>a.optConfigs.set(l,{useEquippedWengine:!c.useEquippedWengine}),color:c.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"}),n(ga,{wengines:t})]})})})]})})}function ma({disabled:t}){const{database:e}=D(),{optConfigId:s,optConfig:i}=m.useContext(X),{wEngineTypes:a}=i,l=bt(e.wengines),{key:c}=P(),d=m.useMemo(()=>i.optWengine?l.reduce((p,{key:r,level:o,location:u})=>{if(o<i.wlevelLow||o>i.wlevelHigh||u&&!i.useEquippedWengine&&u!==c)return p;const h=it(r).type;return h&&p[h]++,p},ke(nn,()=>0)):ke(nn,()=>0),[c,l,i.wlevelLow,i.wlevelHigh,i.optWengine,i.useEquippedWengine]);return n(Xs,{onChange:p=>e.optConfigs.set(s,{wEngineTypes:p}),value:a,disabled:t,totals:d,fullWidth:!0})}function ga({wengines:t}){const e=P(),s=H(e==null?void 0:e.key),{optConfig:i}=m.useContext(X),{wEngineTypes:a}=i,l=m.useMemo(()=>a.length?xt.filter(c=>a.includes(it(c).type)):xt,[a]);return f(Y,{children:[n(k,{variant:"h6",children:"Wengine Condtional Configuration"}),n(k,{children:"Wengine stats are displayed to be Lvl 60/60, P1, actual level/phase of wengine will be used in the solver."}),e&&s&&n(Tn,{character:e,conditionals:s.conditionals,children:n(_,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:l.map(c=>n(_,{item:!0,xs:1,children:n(ba,{wengineKey:c,count:t.filter(d=>d.key===c).length})},c))})})]})}function xa(t){return{key:t,level:60,modification:5,phase:1,location:"",lock:!1}}function ba({wengineKey:t,count:e}){const s=m.useMemo(()=>xa(t),[t]);return n($n,{wengine:s,headerAction:n(at,{color:e?"primary":"secondary",children:e}),fade:!e})}function ya(){const{key:t}=P(),{optConfigId:e}=H(t),{database:s}=D();if(!e){const i=s.optConfigs.new({wEngineTypes:[Ve(t).specialty]});return s.charOpts.set(t,{optConfigId:i}),null}return n(wn,{optConfigId:e,children:n(Ca,{})})}function Ca(){const{t}=Z("optimize"),{database:e}=D(),s=Rn(),{key:i}=P(),{target:a}=H(i),[l,c]=m.useState(8),[d,p]=m.useState(void 0),{optConfig:r,optConfigId:o}=m.useContext(X),u=bt(e.discs),h=m.useMemo(()=>{const I={4:r.slot4,5:r.slot5,6:r.slot6},j=M=>["4","5","6"].includes(M);return u.reduce((M,$)=>{const{slotKey:te,mainStatKey:L,level:z,location:Q}=$;return z<r.levelLow||z>r.levelHigh||Q&&!r.useEquipped&&Q!==i||j(te)&&!I[te].includes(L)||M[$.slotKey].push($),M},{1:[],2:[],3:[],4:[],5:[],6:[]})},[r.slot4,r.slot5,r.slot6,r.levelLow,r.levelHigh,r.useEquipped,u,i]),g=bt(e.wengines),b=m.useMemo(()=>g.filter(({key:I,level:j,location:M})=>{if(!r.optWengine)return M===i;if(j<r.wlevelLow||j>r.wlevelHigh||M&&!r.useEquippedWengine&&M!==i)return!1;const{type:$}=it(I);return!!r.wEngineTypes.includes($)}),[i,g,r.wlevelLow,r.wlevelHigh,r.optWengine,r.wEngineTypes,r.useEquippedWengine]),x=m.useMemo(()=>wt(Object.values(h))*b.length,[b.length,h]),[y,C]=m.useState(!1),w=m.useRef(()=>{});m.useEffect(()=>()=>w.current(),[]);const E=m.useCallback(async I=>{if(!s||!a)return;const j=new Promise(z=>w.current=z);p(void 0),C(!0);const M=(r.statFilters??[]).filter(z=>!z.disabled),$=Vr(i,s,[{tag:Sn(a),multiplier:1}],M,r.setFilter2,r.setFilter4,b,h,l,r.maxBuildsToShow,p);if(I.altKey){console.log($),C(!1);return}const te=new Kr($);j.then(()=>te.terminate("user cancelled"));let L;try{L=await te.results}catch{return}finally{w.current=()=>{},C(!1)}e.optConfigs.newOrSetGeneratedBuildList(o,{builds:L.map(({ids:z,value:Q})=>({wengineId:z[0],discIds:ke(Wt,(ce,de)=>z[de+1]),value:Q})),buildDate:Date.now()})},[s,a,r.statFilters,r.setFilter2,r.setFilter4,r.maxBuildsToShow,i,b,h,l,e.optConfigs,o]),G=m.useCallback(()=>{w.current(),C(!1)},[w]);return n(A,{children:n(R,{children:f(O,{spacing:1,children:[f(v,{sx:{display:"flex",gap:1,flexWrap:"wrap","& .MuiPaper-root":{flexGrow:1}},children:[n(aa,{}),n(ha,{wengines:b}),n(na,{discsBySlot:h})]}),d&&n(va,{progress:d,total:x}),f(v,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[n(ur,{maxBuildsToShow:r.maxBuildsToShow,optConfigId:o}),n(pr,{numWorkers:l,setNumWorkers:c}),n(N,{disabled:!x||!a,onClick:y?G:E,color:y?"error":"primary",startIcon:y?n(nt,{}):n(Yr,{}),children:t(y?"cancel":"optimize")})]})]})})})}function He({value:t}){const e=t.toLocaleString();return n(v,{component:"span",sx:{fontFamily:"Monospace",display:"inline"},children:e})}function va(t){const{t:e}=Z("optimize"),{computed:s,remaining:i,skipped:a}=t.progress,l=s+i,c=Math.log1p(l)/Math.log1p(t.total),d=i/l*c;return f(v,{children:[f(k,{children:[e("computed"),": ",n(He,{value:s})," /"," ",n(He,{value:l})," "]}),f(k,{children:[e("computed + skipped"),": ",n(He,{value:s+a})," /"," ",n(He,{value:t.total})]}),n(Qs,{variant:"determinate",value:(1-d)*100,sx:{height:10,borderRadius:5}})]})}const wa={xs:2,sm:1,md:2,lg:3,xl:4};function Sa({onClick:t}){const e=m.useContext(kn);return n(Mn,{discIds:e==null?void 0:e.equippedDiscs,wengineId:e==null?void 0:e.equippedWengine,onClick:t,columns:wa})}var Re={},dn;function ka(){if(dn)return Re;dn=1;var t=St();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var e=t(kt()),s=Mt(),i=(0,e.default)((0,s.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");return Re.default=i,Re}var Ma=ka();const Da=Dt(Ma);function Ea(t){const{database:e}=D();return bn(e.generatedBuildList,t)}const Ia=m.memo(function(){const{optConfig:e}=m.useContext(X),s=Ea(e.generatedBuildListId??"");return n(O,{spacing:1,children:s==null?void 0:s.builds.map((i,a)=>n(Ra,{build:i,index:a},`${a}-${i.wengineId}-${Object.values(i.discIds).join("-")}`))})});function Ta({build:{discIds:t,wengineId:e}}){const{t:s}=Z("build"),{database:i}=D(),{key:a}=P()??{},l=m.useCallback(()=>{a&&(Object.entries(t).forEach(([c,d])=>d&&i.discs.set(d,{location:a})),e&&i.wengines.set(e,{location:a}))},[a,t,e,i.wengines,i.discs]);return n(N,{color:"info",size:"small",startIcon:n(Da,{}),onClick:l,children:s("buildDisplay.equipToCrr")})}function Ra({build:t,index:e}){const s=P(),i=H(s.key);return n(Wn,{character:s,charOpt:i,discIds:t.discIds,wengineId:t.wengineId,children:n(A,{children:n(R,{children:f(O,{spacing:1,children:[f(v,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[f(k,{children:["Build ",e+1,": ",xn(t.value)]}),n(Ta,{build:t})]}),n(v,{children:f(_,{container:!0,spacing:1,children:[n(_,{item:!0,xs:6,md:4,lg:3,xl:3,children:n(An,{})}),n(_,{item:!0,xs:6,md:8,lg:9,xl:9,children:n(Mn,{discIds:t.discIds,wengineId:t.wengineId})})]})})]})})})})}function Aa(){const{database:t}=D(),{key:e}=P(),{teammates:s}=H(e),[i,a,l]=ot(),[c,d]=m.useState(),p=m.useCallback((o,u)=>{t.charOpts.setTeammate(e,o,u)},[e,t]),r=m.useCallback(o=>{var u,h;return o?[Dn(o,"interknot"),Js((u=sn.char[o])==null?void 0:u.specialty),Ys((h=sn.char[o])==null?void 0:h.faction)]:[]},[]);return f(_,{container:!0,spacing:1,columns:{xs:1,md:2},children:[n(m.Suspense,{fallback:!1,children:n(_n,{show:i,onHide:l,onSelect:o=>p(o,c),showNone:!0})}),ht(0,1).map(o=>{var u;return n(_,{item:!0,xs:1,children:f(O,{gap:1,children:[n(N,{fullWidth:!0,color:!!s[o]&&Ve(s[o]).attribute||void 0,onClick:()=>{d(o),a()},children:!!s[o]&&n(On,{characterKey:s[o]})||`Add ${o===0?"First":"Second"} Teammate`}),!!s[o]&&n(Tt,{bgt:"dark",children:f(_,{container:!0,sx:{display:"flex",padding:.5},columns:{xs:2,lg:4},spacing:.5,children:[ht(0,2).map(h=>{var g;return n(_,{item:!0,xs:1,height:"90px",children:n(un,{children:n(st,{size:5,src:(g=r(s[o]))==null?void 0:g[h]})})},h)}),n(_,{item:!0,xs:1,children:n(un,{children:n(Zs,{ele:(u=Ve(s[o]))==null?void 0:u.attribute,iconProps:{sx:{width:"2.5em",height:"2.5em"}}})})})]})})]})},o)})]})}function un({children:t}){return n(A,{bgt:"light",sx:{height:"100%",borderRadius:"12px",display:"flex",justifyContent:"center"},children:n(Y,{sx:{padding:.5,display:"flex",justifyContent:"center",height:"100%",alignItems:"center"},children:t})})}const Wa=210,Hn=m.createContext(Wa),_a=0,Ae=33,Gn=m.createContext(0);function Oa(){const[t,e]=m.useState(""),s=m.useMemo(()=>({statHighlight:t,setStatHighlight:e}),[t,e]),i=m.useMemo(()=>[["char",n(Pa,{},"char")],["opt",n(Na,{},"opt")],["builds",n(ja,{},"builds")]],[]);return n(ei.Provider,{value:s,children:n(Gn.Provider,{value:i.length,children:n(O,{gap:1,children:i.map(([a,l],c)=>n(Kn,{title:a,index:c,zIndex:100,children:l},a))})})})}function Kn({index:t,title:e,children:s,zIndex:i,top:a=0,bottom:l=0}){const{t:c}=Z("page_optimize"),[d,p]=Xi(),r=m.useContext(Gn),o=m.useContext(Hn);return f(oe,{children:[n(A,{sx:u=>({outline:`2px solid ${u.palette.secondary.main}`,position:"sticky",top:o+t*Ae+a,bottom:_a+(r-1-t)*Ae+l,zIndex:i}),children:n(ni,{onClick:p,sx:{px:2},children:n(k,{variant:"h6",children:c(`${e}`)})})}),n(v,{ref:d,sx:{scrollMarginTop:o+(t+1)*Ae+a},children:s})]})}function Pa(){const t=P(),{key:e}=t,[s,i]=m.useState(void 0),a=m.useCallback(()=>{t!=null&&t.key&&i(t.key)},[t]),l=m.useMemo(()=>[["eq",n(Sa,{onClick:a},"eq")],["Conditionals",n(za,{},"conditionals")],["bonusStats",n(kr,{},"bonusStats")],["teammates",n(Aa,{},"teammates")],["enemyStats",n($r,{},"enemyStats")],["anomaly",n(wr,{},"anomaly")],["charSheet",n(Tr,{},"charSheet")]],[e,a]),c=hn(),d=ti(c.breakpoints.up("sm"));return f(oe,{children:[n(Mi,{characterKey:s,onClose:()=>i(void 0)}),f(O,{spacing:1,children:[n(A,{sx:{overflow:"visible"},children:n(R,{sx:{display:"flex",gap:1,overflow:"visible"},children:f(_,{container:!0,spacing:2,sx:{flexWrap:"wrap",overflow:"visible"},children:[n(_,{item:!0,xs:12,sm:7,md:5,lg:4,xl:3,sx:{height:d?"100%":void 0,overflow:"visible"},children:f(O,{spacing:1,sx:d?{height:"100%"}:void 0,children:[n(Di,{characterKey:e,onClick:a}),n(v,{sx:{flexGrow:1},children:n(v,{sx:d?{position:"sticky",top:"115px",bottom:"0px"}:void 0,children:n(An,{})})})]})}),n(_,{item:!0,xs:12,sm:5,md:7,lg:8,xl:9,children:n(O,{spacing:1.5,children:l.map(([p,r],o)=>n(Kn,{title:p,index:o,zIndex:99,top:Ae,bottom:Ae*2,children:r},p))})})]})})}),n(mr,{formulasRead:re.listing.formulas,buffsRead:re.listing.buffs})]})]})}function Na(){return n(ya,{})}function ja(){const{key:t}=P(),{optConfigId:e}=H(t);return e?n(wn,{optConfigId:e,children:n(Ia,{})}):null}function za(){const{equippedDiscs:t,equippedWengine:e}=P(),s=si(t),i=ii(s),a=ri(e);return n(v,{children:f(_,{container:!0,spacing:1,columns:{xs:1,sm:1,md:2,lg:3},children:[a&&n(_,{item:!0,xs:1,children:n($n,{wengine:a})}),Object.entries(i).map(([l,c])=>n(_,{item:!0,xs:1,children:n(qn,{setKey:l,fade2:c<2,fade4:c<4})},l))]})})}const pn={avg:"Average",crit:"Crit Hit",nonCrit:"Non-Crit Hit"};function qa(){const{database:t}=D(),e=P(),s=H(e.key),{critMode:i}=s;return n(B,{title:f(v,{sx:{textWrap:"nowrap"},children:["Hit mode: ",pn[i]]}),children:ai.map(a=>n(T,{selected:i===a,disabled:i===a,onClick:()=>t.charOpts.set(e.key,{critMode:a}),children:pn[a]},a))})}const $a=[re.final.atk,re.final.hp,re.final.def,re.final.enerRegen,re.final.anomProf,re.final.anomMas];function La({character:{key:t},charOpt:{target:e}}){const s=Rn(),{database:i}=D(),a=m.useMemo(()=>{if(e)return Sn(e)},[e]);return f(B,{color:a?"success":"warning",title:a?f(v,{sx:{display:"flex",gap:1},children:[n("strong",{children:"Optimization Target: "}),n(Ge,{tag:a})]}):"Select an Optimization Target",variant:a?"outlined":void 0,sx:{height:"100%",flexGrow:1},children:[s==null?void 0:s.listFormulas(re.listing.formulas).map(({tag:l},c)=>{const{name:d,sheet:p}=l;if(!(!d||!p))return n(T,{onClick:()=>i.charOpts.set(t,{target:{sheet:p,name:d}}),children:n(rn,{children:n(v,{sx:{display:"flex",gap:1},children:n(Ge,{tag:l})})})},`${c}_${l.sheet}_${l.name}`)}),$a.map(({tag:l},c)=>{const{q:d,qt:p}=l;if(!(!d||!p))return n(T,{onClick:()=>i.charOpts.set(t,{target:{q:d,qt:p}}),children:n(rn,{children:n(v,{sx:{display:"flex",gap:1},children:n(Ge,{tag:l})})})},`${c}_${d}_${p}`)})]})}function Fa(){const{database:t}=D(),e=P(),s=H(e.key),{target:i}=s,a=m.useCallback(l=>t.charOpts.set(e.key,({target:c={}})=>{const{damageType1:d,...p}=c;return l?{target:{...p,damageType1:l}}:{target:p}}),[t,e.key]);return(i==null?void 0:i.name)!=="standardDmgInst"&&(i==null?void 0:i.name)!=="sheerDmgInst"?null:n(Bn,{dmgType:i==null?void 0:i.damageType1,keys:oi,setDmgType:a})}function Ba({character:t,charOpt:e}){return f(v,{display:"flex",gap:1,sx:{position:"sticky",top:36,zIndex:100,background:"#0C1020"},children:[n(La,{character:t,charOpt:e}),n(Ga,{}),n(Fa,{}),n(Ha,{}),n(qa,{})]})}function Ha(){const{database:t}=D(),e=P(),s=H(e.key),{target:i}=s,a=m.useCallback(l=>t.charOpts.set(e.key,({target:c={}})=>{const{damageType2:d,...p}=c;return l?{target:{...p,damageType2:"aftershock"}}:{target:p}}),[t,e.key]);return(i==null?void 0:i.name)!=="standardDmgInst"&&(i==null?void 0:i.name)!=="sheerDmgInst"?null:n(Fn,{isAftershock:(i==null?void 0:i.damageType2)==="aftershock",setAftershock:a})}function Ga(){const{database:t}=D(),e=P(),s=H(e.key),{target:i}=s,{q:a,qt:l}=i??{};return!a||!l?null:n(B,{title:Me[l],children:["final","initial"].map(c=>n(T,{selected:c===l,disabled:c===l,onClick:()=>t.charOpts.set(e.key,{target:{q:a,qt:c}}),children:Me[c]},c))})}function Ya(){const{database:t}=D(),{optCharKey:e}=ci(t.dbMeta),s=e??li[0],[i,a,l]=ot(),c=m.useCallback(y=>t.dbMeta.set({optCharKey:y===null?void 0:y}),[t.dbMeta]),{t:d}=Z(["charNames_gen","page_character"]),p=Ei(s);s&&!p&&t.chars.getOrCreate(s);const r=H(s);s&&!r&&t.charOpts.getOrCreate(s),Qi(m.useMemo(()=>{const y=s&&d(`charNames_gen:${s}`);return y?`Optimize - ${y}`:"Optimize"},[s,d]));const o=m.useMemo(()=>{const C=ke(s?[s]:[],w=>n(On,{characterKey:w}));return{srcDisplay:C,dstDisplay:C}},[s]),u=m.useCallback((y,C,w,E,G)=>{!di(y)||!an(w)||!(E===null||an(E))||!ui(y,C)||t.charOpts.setConditional(s,y,C,w,E,G)},[s,t.charOpts]),h=m.useMemo(()=>({src:s,dst:s,preset:"preset0"}),[s]),[g,b]=m.useState(),x=m.useMemo(()=>({read:g,setRead:b}),[g]);return n(Ka,{children:f(v,{children:[n(m.Suspense,{fallback:!1,children:n(_n,{show:i,onHide:l,onSelect:c})}),n(v,{sx:{position:"sticky",top:0,zIndex:100,background:"#0C1020"},children:n(N,{fullWidth:!0,color:Ve(s).attribute,sx:{justifyContent:"flex-start",pl:"6px"},onClick:a,children:f(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n(st,{size:2,src:Dn(s,"circle")}),d(`charNames_gen:${s}`)]})})}),p&&r&&n(kn.Provider,{value:p,children:n(tt.Provider,{value:h,children:n(Wn,{character:p,charOpt:r,wengineId:p.equippedWengine,discIds:p.equippedDiscs,children:n(pi.Provider,{value:o,children:n(hi.Provider,{value:r.conditionals,children:n(fi.Provider,{value:u,children:f(mn.Provider,{value:x,children:[n(gr,{}),f(v,{sx:{display:"flex",gap:1,flexDirection:"column",mt:1},children:[n(Ba,{character:p,charOpt:r}),n(Hn.Provider,{value:74,children:n(Oa,{},p.key)})]})]})})})})})})})]})})}function Ka({children:t}){return n(xi.Provider,{value:Ln,children:n(mi.Provider,{value:q,children:n(gi.Provider,{value:Ge,children:t})})})}export{Ya as default};
