import{V as L,aj as ve,n as N,q as l,p as e,a_ as je,T as E,r as c,B as f,a4 as he,R as X,M as Z,a$ as Y,aD as ee,b0 as ze,av as pe,w as ke,b1 as Fe,a6 as Ne,ak as He,al as J,am as We,an as xe,ao as Ge,ap as Ve,a7 as $e,aq as Ue,ar as Je,as as Qe,at as Xe,aA as B,z as b,Q as ge,I as ne,ay as Ze,a9 as le,x as Ye,aE as et,aF as P,y,A as we,a1 as fe,aH as te,ab as ye,b2 as ce,b3 as Ie,ad as Re,b4 as De,J as Me,b5 as de,a2 as Te,b6 as tt,Z as be,aG as nt,aI as st,aZ as it,aQ as ot,aR as Se,aS as rt,aV as at}from"./index-DF8y5oEQ.js";import{P as lt,T as Ee,a as ct,N as dt,I as ut,t as ht,Q as pt,e as gt,E as Ke,f as ft,U as $,g as mt,o as Ct,S as xt,W as yt,h as bt,i as St,j as Lt,A as vt,B as kt,O as wt,F as It,C as Rt,H as Dt,J as Mt,K as Tt,M as Et}from"./Checkroom-DQELBHSe.js";import{b as O,C as Kt,L as Ot,c as Pt,D as At}from"./UploadCard-BRCVAPuV.js";import{M as T,D as H,u as ue,r as Oe,b as Bt,d as qt,C as _t}from"./StatDisplay-U6PtscJG.js";import{S as M,b as me,c as jt,d as zt,a as Ft,C as Nt,u as Ht}from"./CharacterEditor-Dks4bcqR.js";import{u as Le,C as w,G as j}from"./ReadOnlyTextArea-CP9a0vqS.js";import{u as Wt,a as Gt,g as Pe}from"./LightConeTrans-CK3FB__m.js";import{C as W}from"./CardHeader-D1j2uNKs.js";import{D as Vt,b as se}from"./BusinessCenter-BpDWnwEi.js";import{u as Ce}from"./useBoolState-DfoxhQn0.js";import{a as Ae,R as _,b as $t}from"./RelicSetAutocomplete-BaU5Z21r.js";import{C as Ut}from"./CardActionArea-CL33vbE7.js";import"./InfoTooltip-3GakGKQw.js";function G(t){const{database:n}=L();return ve(n.charOpts,t)}function Jt({maxBuildsToShow:t,optConfigId:n}){const{database:s}=L(),{t:i}=N("page_optimize");return l(H,{title:i("build",{count:t}),children:[e(T,{children:e(E,{variant:"caption",color:"info.main",children:i("buildDropdownDesc")})}),je.map(r=>e(T,{onClick:()=>s.optConfigs.set(n,{maxBuildsToShow:r}),children:i("build",{count:r})},r))]})}function Qt({levelLow:t,levelHigh:n,setLow:s,setHigh:i,setBoth:r,dark:o=!1,disabled:a=!1,showLevelText:h=!1}){const{t:p}=N("lightcone"),[d,u]=c.useState(t),[S,g]=c.useState(n),x=c.useCallback((m,C)=>{if(typeof C=="number")throw new TypeError;const[R,k]=C;u(R),g(k)},[u,g]);return c.useEffect(()=>u(t),[u,t]),c.useEffect(()=>g(n),[g,n]),l(f,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:o?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[l(f,{sx:{width:"max-content",height:32,display:"flex"},children:[h?l(he,{children:[e("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:p("levelSliderTitle")}),e(O,{orientation:"vertical",flexItem:!0})]}):void 0,e(Z,{value:d,onChange:m=>s(X(m??0,0,n)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:h?"right":"center"}},disabled:a})]}),e(Ae,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"LightCone Level Range",value:[d,S],onChange:x,onChangeCommitted:(m,C)=>Array.isArray(C)&&r(C[0],C[1]),valueLabelDisplay:"auto",min:0,max:Y,step:1,marks:!0,disabled:a}),e(Z,{value:S,onChange:m=>i(X(m??0,t,Y)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function Xt({levelLow:t,levelHigh:n,setLow:s,setHigh:i,setBoth:r,dark:o=!1,disabled:a=!1,showLevelText:h=!1}){const{t:p}=N("artifact"),[d,u]=c.useState(t);Le(t)!==t&&u(t);const[S,g]=c.useState(n);Le(n)!==n&&g(n);const x=c.useCallback((m,C)=>{if(typeof C=="number")throw new TypeError;const[R,k]=C;u(R),g(k)},[u,g]);return l(f,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:o?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[l(f,{sx:{width:"max-content",height:32,display:"flex"},children:[h?l(he,{children:[e("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:p("levelSliderTitle")}),e(O,{orientation:"vertical",flexItem:!0})]}):void 0,e(Z,{value:d,onChange:m=>s(X(m??0,0,n)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:h?"right":"center"}},disabled:a})]}),e(Ae,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Arifact Level Range",value:[d,S],onChange:x,onChangeCommitted:(m,C)=>Array.isArray(C)&&r(C[0],C[1]),valueLabelDisplay:"auto",min:0,max:ee[5],step:1,marks:!0,disabled:a}),e(Z,{value:S,onChange:m=>i(X(m??0,t,ee[5])),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function Be(t,n=new Map){const s=n.get(t);if(s)return s;const{val:i,meta:{tag:r,op:o,ops:a,usedCats:h}}=t,p=r&&ze(r,(k,D)=>h.has(D)),d=pe(i,ke(lt(r))),u=new Set;function S(k,D){return k.map((z,V)=>{const v=Be(z,n);return v.name?(u.add(v),v.name):(v.deps.forEach(q=>u.add(q)),v.prec>=D?v.formula:l("span",{children:["(",v.formula,")"]},V))})}let g,x=1/0;switch(o){case"const":g=d,x=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:k,joiner:D,end:z}=re[o];x=re[o].prec,g=l("span",{children:[k,S(a,x).map((V,v)=>l(c.Fragment,{children:[V,v<a.length-1&&D]},v)),z]})}break;case"sumfrac":{const[k]=S(a,2),[D,z]=S(a,1);g=l("span",{children:[k," / (",D," + ",z,")"]}),x=re.prod.prec;break}case"floor":g=`⌊${a[0].val}⌋`,x=1/0;break;default:Fe(o)}let m,C;p&&(m=l("span",{children:[e(Ee,{tag:p})," ",d]}),C=void 0);const R={name:m,formula:g,prec:x,sheet:C,deps:[...new Set(u)]};return n.set(t,R),R}const re={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function Zt({character:t,charOpt:n,children:s}){const i=Yt(t),r=c.useMemo(()=>Ne([...He([t.key]),...i,J.common.lvl.add(80),J.common.res.add(.1),J.common.isBroken.add(0),J.common.maxToughness.add(100),We.common.critMode.add("avg"),...n.conditionals.flatMap(({sheet:o,src:a,dst:h,condKey:p,condValue:d})=>xe("preset0",Ge(o,a,h)(p,d))),...n.bonusStats.flatMap(({tag:o,value:a})=>xe("preset0",{tag:{...o},value:Xe(a)}))]),[t.key,i,n.conditionals,n.bonusStats]);return e(Kt.Provider,{value:r,children:s})}function Yt(t){const n=Wt(t==null?void 0:t.equippedLightCone),s=Ve(t==null?void 0:t.equippedRelics),i=c.useMemo(()=>{const o=n;return o?$e(o.key,o.level,o.ascension,o.superimpose):[]},[n]),r=c.useMemo(()=>s?ct(Object.values(s).filter(Ue)):[],[s]);return c.useMemo(()=>t?Je(t.key,...Qe(t,1),...i,...r):[],[t,i,r])}function en(){const{database:t}=L(),{key:n}=B(),{bonusStats:s}=G(n),i=c.useCallback((o,a,h)=>t.charOpts.setBonusStat(n,o,a,h),[t,n]),r=o=>{const a=tn(o,n);t.charOpts.setBonusStat(n,a,0)};return l(b,{children:[e(W,{title:"Bonus Stats"}),e(O,{}),e(w,{children:l(M,{spacing:1,children:[s.map(({tag:o,value:a},h)=>e(on,{tag:o,value:a,setValue:p=>i(o,p),onDelete:()=>i(o,null),setTag:p=>i(p,0)},JSON.stringify(o)+h)),e(sn,{onSelect:r})]})})]})}function tn(t,n){return{src:n,dst:n,et:"own",q:t,qt:"premod",sheet:"agg"}}const nn=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function sn({tag:t={},onSelect:n}){var s;return e(H,{title:(t&&((s=ht.subset(t)[0])==null?void 0:s.title))??"Add Bonus Stat",children:nn.map(i=>e(T,{onClick:()=>n(i),children:i},i))})}function on({tag:t,setTag:n,value:s,setValue:i,onDelete:r}){var a;const o=(a=t.name||t.q)==null?void 0:a.endsWith("_");return e(b,{bgt:"light",children:l(w,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[e(ge,{sx:{m:"auto"},children:t.q}),t.q==="dmg_"&&e(rn,{tag:t,setElementalType:h=>{const{elementalType:p,...d}=t;n(h?{...d,elementalType:h}:d)}}),e(dt,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:i,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:l(ut,{position:"end",sx:{ml:0},children:[o?"%":void 0," ",e(ne,{"aria-label":"Delete Bonus Stat",onClick:r,edge:"end",children:e(Vt,{fontSize:"small"})})]})}})]})})}function rn({tag:t,setElementalType:n}){return l(H,{title:t.elementalType??"No Element",children:[e(T,{onClick:()=>n(null),children:"No Element"}),Ze.map(s=>e(T,{onClick:()=>n(s),children:s},s))]})}function an(){const t=me();return e(b,{children:e(w,{children:t==null?void 0:t.listFormulas(le.listing.formulas).map((n,s)=>e(ln,{read:n},s))})})}function ln({read:t}){const n=me();if(!n)return null;const s=n.compute(t),i=t.tag.name||t.tag.q,r=Be(s);return l(f,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(f,{sx:{flexGrow:1},children:e(Ee,{tag:t.tag})}),pe(s.val,ke(i??"")),e(Ye,{title:l(E,{component:"div",children:[e(f,{children:r.name}),e(O,{}),e(f,{children:r.formula}),e(M,{spacing:1,sx:{pl:1,pt:1},children:r.deps.map((o,a)=>l(f,{children:[e(f,{children:o.name}),e(O,{}),l(f,{children:[" ",o.formula]})]},a))})]}),children:e(pt,{})})]})}function cn(){const{key:t}=B(),{conditionals:n}=G(t),[s,i]=c.useState(""),r=c.useMemo(()=>{const o=n.map(a=>a.sheet).filter(et);return s&&o.push(s),[...new Set(o)].sort(a=>a===s?-1:1)},[n,s]);return l(M,{spacing:1,sx:{pt:1},children:[e(Gt,{lcKey:s,setLCKey:i,label:"Search Light Cone"}),e(f,{children:e(j,{container:!0,columns:3,spacing:1,children:r.map(o=>e(j,{item:!0,xs:1,children:e(gt,{lcKey:o})},o))})})]})}function dn(t){const{database:n}=L();return ve(n.generatedBuildList,t)}const un=c.memo(function(){const{optConfig:n}=c.useContext(P),s=dn(n.generatedBuildListId??"");return e(M,{spacing:1,children:s==null?void 0:s.builds.map((i,r)=>e(b,{children:l(w,{children:[l(f,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[l(E,{children:["Build ",r+1,": ",pe(i.value)]}),e(hn,{build:i})]}),e(Ke,{relicIds:i.relicIds,lightConeId:i.lightConeId})]})},`${r}-${i.lightConeId}-${Object.values(i.relicIds).join("-")}`))})});function hn({build:{relicIds:t,lightConeId:n}}){const{t:s}=N("build"),{database:i}=L(),{key:r}=B(),o=c.useCallback(()=>{Object.entries(t).forEach(([a,h])=>i.chars.setEquippedRelic(r,a,h)),i.chars.setEquippedLightCone(r,n)},[r,i.chars,n,t]);return e(y,{color:"info",size:"small",startIcon:e(ft,{}),onClick:o,children:s("buildDisplay.equipToCrr")})}const pn=c.memo(function({disabled:n=!1}){const{database:s}=L(),{optConfigId:i,optConfig:r}=c.useContext(P);return l(b,{bgt:"light",children:[e(w,{sx:{display:"flex",gap:1},children:e(E,{sx:{fontWeight:"bold"},children:"LightCone Level Filter"})}),e(O,{}),e(Qt,{levelLow:(r==null?void 0:r.lcLevelLow)??Y,levelHigh:(r==null?void 0:r.lcLevelHigh)??Y,setLow:o=>s.optConfigs.set(i,{lcLevelLow:o}),setHigh:o=>s.optConfigs.set(i,{lcLevelHigh:o}),setBoth:(o,a)=>s.optConfigs.set(i,{lcLevelLow:o,lcLevelHigh:a}),disabled:n})]})});function gn({numLightCone:t,disabled:n}){const{database:s}=L(),{optConfigId:i,optConfig:r}=c.useContext(P),[o,a,h]=Ce();return e(b,{bgt:"light",children:e(w,{children:l(M,{spacing:1,children:[l($,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[l($,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["LightCones:"," ",e(ge,{color:t?"primary":"error",children:t})]}),e(y,{sx:{flexGrow:1},startIcon:r.optLightCone?e(jt,{}):e(zt,{}),color:r.optLightCone?"success":"secondary",onClick:()=>s.optConfigs.set(i,{optLightCone:!r.optLightCone}),children:"Optimize LightCone"})]}),e(fn,{show:o,onClose:h}),e(y,{color:"info",fullWidth:!0,onClick:a,disabled:n||!r.optLightCone,children:"LightCone Filter Config"})]})})})}function fn({show:t,onClose:n,disabled:s}){const{database:i}=L(),{optConfigId:r,optConfig:o}=c.useContext(P);return e(fe,{open:t,onClose:n,children:l(b,{children:[e(W,{title:"LightCone Filter",action:e(ne,{onClick:n,children:e(se,{})})}),e(O,{}),e(w,{children:e(c.Suspense,{fallback:e(we,{width:"100%",height:"500px"}),children:l(M,{spacing:1,children:[e(pn,{disabled:s}),e(mn,{disabled:s}),e(y,{disabled:s,onClick:()=>i.optConfigs.set(r,{useEquippedLightCone:!o.useEquippedLightCone}),color:o.useEquippedLightCone?"success":"secondary",children:"Use equipped LightCone"})]})})})]})})}function mn({disabled:t}){const{database:n}=L(),{optConfigId:s,optConfig:i}=c.useContext(P),{lightConePaths:r}=i,o=ue(n.lightCones),{key:a}=B(),h=c.useMemo(()=>i.optLightCone?o.reduce((p,{key:d,level:u,location:S})=>{if(u<i.lcLevelLow||u>i.lcLevelHigh||S&&!i.useEquippedLightCone&&S!==a)return p;const g=Pe(d).path;return g&&p[g]++,p},te(ye,()=>0)):te(ye,()=>0),[a,o,i.lcLevelLow,i.lcLevelHigh,i.optLightCone,i.useEquippedLightCone]);return e(Ot,{onChange:p=>n.optConfigs.set(s,{lightConePaths:p}),value:r,disabled:t,totals:h,fullWidth:!0})}const Cn=c.memo(function({disabled:n=!1}){const{database:s}=L(),{optConfigId:i,optConfig:r}=c.useContext(P);return l(b,{bgt:"light",children:[e(w,{sx:{display:"flex",gap:1},children:e(E,{sx:{fontWeight:"bold"},children:"Relic Level Filter"})}),e(O,{}),e(Xt,{levelLow:(r==null?void 0:r.levelLow)??ee[5],levelHigh:(r==null?void 0:r.levelHigh)??ee[5],setLow:o=>s.optConfigs.set(i,{levelLow:o}),setHigh:o=>s.optConfigs.set(i,{levelHigh:o}),setBoth:(o,a)=>s.optConfigs.set(i,{levelLow:o,levelHigh:a}),disabled:n})]})});function xn({disabled:t=!1,setFilter4Cavern:n,setFilter2Cavern:s,setFilter2Planar:i,setSetFilter4Cavern:r,setSetFilter2Cavern:o,setSetFilter2Planar:a}){const[h,p,d]=Ce();return l(b,{bgt:"light",children:[e(fe,{open:h,onClose:d,children:e(yn,{onClose:d,setFilter2Cavern:s,setFilter4Cavern:n,setFilter2Planar:i,setSetFilter2Cavern:o,setSetFilter4Cavern:r,setSetFilter2Planar:a})}),l(w,{sx:{display:"flex",gap:1},children:[l(f,{sx:{flexGrow:1,display:"flex",gap:1,flexDirection:"column"},children:[n.length<=1?l(H,{disabled:t,title:n[0]?l("span",{children:["Force 4-Set:"," ",e("strong",{children:e(_,{setKey:n[0]})})]}):"Select to force 4-Set",sx:{flexGrow:1},children:[e(T,{onClick:()=>r([]),children:"No 4-Set"}),ce.map(u=>e(T,{onClick:()=>r([u]),children:e(_,{setKey:u})},u))]}):e(y,{disabled:!0,children:l("span",{children:[e("strong",{children:n.length})," Relic 4p-set Selected"]})}),s.length<=1?l(H,{disabled:t,title:s[0]?l("span",{children:["Force 2-Set:"," ",e("strong",{children:e(_,{setKey:s[0]})})]}):"Select to force 2-Set",sx:{flexGrow:1},children:[e(T,{onClick:()=>o([]),children:"No 2-Set"}),ce.map(u=>e(T,{onClick:()=>o([u]),children:e(_,{setKey:u})},u))]}):e(y,{disabled:!0,children:l("span",{children:[e("strong",{children:s.length})," Relic Cavern 2p-set Selected"]})}),i.length<=1?l(H,{disabled:t,title:i[0]?l("span",{children:["Force 2-Set:"," ",e("strong",{children:e(_,{setKey:i[0]})})]}):"Select to force 2-Set",sx:{flexGrow:1},children:[e(T,{onClick:()=>a([]),children:"No 2-Set"}),Ie.map(u=>e(T,{onClick:()=>a([u]),children:e(_,{setKey:u})},u))]}):e(y,{disabled:!0,children:l("span",{children:[e("strong",{children:i.length})," Relic Planar 2p-set Selected"]})})]}),e(f,{sx:{display:"flex",alignItems:"stretch"},children:e(y,{disabled:t,onClick:p,color:"info",children:"Advanced Set-Filter Config"})})]})]})}function yn({onClose:t,setFilter4Cavern:n,setFilter2Cavern:s,setFilter2Planar:i,setSetFilter4Cavern:r,setSetFilter2Cavern:o,setSetFilter2Planar:a}){return l(b,{children:[e(W,{title:"Advanced Set-Filter Config",action:e(ne,{onClick:t,children:e(se,{})})}),e(O,{}),l(w,{children:[e(E,{variant:"h6",children:"Cavern"}),l(f,{sx:{display:"flex",gap:1,mb:1},children:[e(y,{disabled:!n.length,onClick:()=>r([]),children:"Reset 4p filter"}),e(y,{disabled:!s.length,onClick:()=>o([]),children:"Reset 2p filter"})]}),e(j,{container:!0,spacing:1,children:ce.map(h=>e(j,{item:!0,xs:1,md:2,lg:3,children:e(bn,{setKey:h,setFilter4Cavern:n,setFilter2Cavern:s,setSetFilter4Cavern:r,setSetFilter2Cavern:o})},h))}),e(E,{variant:"h6",children:"Planar"}),e(f,{sx:{display:"flex",gap:1,mb:1},children:e(y,{disabled:!s.length,onClick:()=>a([]),children:"Reset 2p filter"})}),e(j,{container:!0,spacing:1,children:Ie.map(h=>e(j,{item:!0,xs:1,md:2,lg:3,children:e(Sn,{setKey:h,setFilter2Planar:i,setSetFilter2Planar:a})},h))})]})]})}function bn({setKey:t,setFilter4Cavern:n,setFilter2Cavern:s,setSetFilter4Cavern:i,setSetFilter2Cavern:r}){return l(b,{bgt:"light",children:[e(W,{title:e(_,{setKey:t}),avatar:e(Re,{src:Oe(t,De(t)),size:2})}),l(Me,{fullWidth:!0,children:[e(y,{color:!n.length||n.includes(t)?"success":"secondary",onClick:()=>i(n.length?de([...n],t):[t]),children:"Allow 4p"}),e(y,{color:!s.length||s.includes(t)?"success":"secondary",onClick:()=>r(s.length?de([...s],t):[t]),children:"Allow 2p"})]})]})}function Sn({setKey:t,setFilter2Planar:n,setSetFilter2Planar:s}){return l(b,{bgt:"light",children:[e(W,{title:e(_,{setKey:t}),avatar:e(Re,{src:Oe(t,De(t)),size:2})}),e(Me,{fullWidth:!0,children:e(y,{color:!n.length||n.includes(t)?"success":"secondary",onClick:()=>s(n.length?de([...n],t):[t]),children:"Allow 2p"})})]})}function Ln({relicsBySlot:t}){const[n,s,i]=Ce();return e(b,{bgt:"light",children:e(w,{children:l(M,{spacing:1,children:[e($,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:Te.map(r=>e(F,{relicsBySlot:t,slotKey:r},r))}),e(vn,{show:n,onClose:i,relicsBySlot:t}),e(y,{color:"info",fullWidth:!0,onClick:s,children:"Relic Filter Config"})]})})})}function F({relicsBySlot:t,slotKey:n}){return l(E,{children:["Relic ",n," ",e(ge,{color:t[n].length?"primary":"error",children:t[n].length})]})}function vn({relicsBySlot:t,show:n,onClose:s,disabled:i}){const{database:r}=L(),{optConfigId:o,optConfig:a}=c.useContext(P);return e(fe,{open:n,onClose:s,children:l(b,{children:[e(W,{title:"Relic Filter",action:e(ne,{onClick:s,children:e(se,{})})}),e(O,{}),e(w,{children:e(c.Suspense,{fallback:e(we,{width:"100%",height:"500px"}),children:l(M,{spacing:1,children:[e(Cn,{disabled:i}),e(kn,{relicsBySlot:t,disabled:i}),e(wn,{disabled:i}),e(y,{disabled:i,onClick:()=>r.optConfigs.set(o,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Relics"})]})})})]})})}function kn({relicsBySlot:t,disabled:n}){const{database:s}=L(),{optConfigId:i,optConfig:r}=c.useContext(P),o=a=>{const h=tt([...be[a]]),p={body:r.slotBodyKeys??[],feet:r.slotFeetKeys??[],sphere:r.slotSphereKeys??[],rope:r.slotRopeKeys??[]},d={body:u=>s.optConfigs.set(i,{slotBodyKeys:u}),feet:u=>s.optConfigs.set(i,{slotFeetKeys:u}),sphere:u=>s.optConfigs.set(i,{slotSphereKeys:u}),rope:u=>s.optConfigs.set(i,{slotRopeKeys:u})};return e($,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:be[a].map(u=>e(y,{disabled:n,variant:p[a].includes(u)?"contained":"outlined",onClick:()=>d[a](h([...p[a]],u)),children:e(Bt,{statKey:u,showPercent:!0})},u))})};return e(b,{bgt:"light",children:e(w,{children:l(M,{spacing:1,children:[l($,{sx:{display:"flex",justifyContent:"space-between"},children:[e(F,{slotKey:"head",relicsBySlot:t}),e(F,{slotKey:"hands",relicsBySlot:t})]}),e(F,{slotKey:"body",relicsBySlot:t}),o("body"),e(F,{slotKey:"feet",relicsBySlot:t}),o("feet"),e(F,{slotKey:"sphere",relicsBySlot:t}),o("sphere"),e(F,{slotKey:"rope",relicsBySlot:t}),o("rope")]})})})}function wn({disabled:t}){const{database:n}=L(),{optConfigId:s,optConfig:i}=c.useContext(P),{setFilter4Cavern:r,setFilter2Cavern:o,setFilter2Planar:a}=i,h=c.useCallback(u=>{n.optConfigs.set(s,{setFilter2Cavern:u})},[n,s]),p=c.useCallback(u=>{n.optConfigs.set(s,{setFilter4Cavern:u})},[n,s]),d=c.useCallback(u=>{n.optConfigs.set(s,{setFilter2Planar:u})},[n,s]);return e(xn,{disabled:t,setFilter2Cavern:o,setFilter4Cavern:r,setFilter2Planar:a,setSetFilter2Cavern:h,setSetFilter4Cavern:p,setSetFilter2Planar:d})}function In(){const{key:t}=B(),{optConfigId:n}=G(t),{database:s}=L();if(!n){const i=s.optConfigs.new();return s.charOpts.set(t,{optConfigId:i}),null}return l(nt,{optConfigId:n,children:[e(Rn,{}),e(un,{})]})}function Rn(){const{t}=N("optimize"),{database:n}=L(),s=me(),{key:i}=B(),{target:r}=G(i),[o,a]=c.useState(8),[h,p]=c.useState(void 0),{optConfig:d,optConfigId:u}=c.useContext(P),S=ue(n.relics),g=c.useMemo(()=>{const v={body:d.slotBodyKeys,feet:d.slotFeetKeys,sphere:d.slotSphereKeys,rope:d.slotRopeKeys},q=I=>["body","feet","sphere","rope"].includes(I);return S.reduce((I,A)=>{const{slotKey:K,mainStatKey:ie,level:oe,location:U}=A;return oe<d.levelLow||oe>d.levelHigh||U&&!d.useEquipped&&U!==i||q(K)&&!v[K].includes(ie)||I[A.slotKey].push(A),I},{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]})},[i,d.levelHigh,d.levelLow,d.slotBodyKeys,d.slotFeetKeys,d.slotRopeKeys,d.slotSphereKeys,d.useEquipped,S]),x=ue(n.lightCones),m=c.useMemo(()=>x.filter(({key:v,level:q,location:I})=>{if(!d.optLightCone)return I===i;if(q<d.lcLevelLow||q>d.lcLevelHigh||I&&!d.useEquippedLightCone&&I!==i)return!1;const{path:A}=Pe(v);return!!d.lightConePaths.includes(A)}),[x,d.optLightCone,d.lcLevelLow,d.lcLevelHigh,d.useEquippedLightCone,d.lightConePaths,i]),C=c.useMemo(()=>mt(Object.values(g))*m.length,[m.length,g]),[R,k]=c.useState(!1),D=c.useRef(()=>{});c.useEffect(()=>()=>D.current(),[]);const z=c.useCallback(async()=>{if(!s)return;const v=new Promise(K=>D.current=K);p(void 0),k(!0);const q=(d.statFilters??[]).filter(K=>!K.disabled),I=Ct(i,s,[{tag:r,multiplier:1}],d.maxBuildsToShow,q,d.setFilter2Cavern,d.setFilter4Cavern,d.setFilter2Planar,m,g,o,p);v.then(()=>I.terminate("user cancelled"));let A;try{A=await I.results}catch{return}finally{D.current=()=>{},k(!1)}A.length&&n.optConfigs.newOrSetGeneratedBuildList(u,{builds:A.map(({ids:K,value:ie})=>({lightConeId:K[0],relicIds:te(Te,(oe,U)=>K[U+1]),value:ie})),buildDate:Date.now()})},[s,d.statFilters,d.maxBuildsToShow,d.setFilter2Cavern,d.setFilter4Cavern,d.setFilter2Planar,i,r,m,g,o,n.optConfigs,u]),V=c.useCallback(()=>{D.current(),k(!1)},[D]);return e(b,{children:e(w,{children:l(M,{spacing:1,children:[e(xt,{}),e(gn,{numLightCone:m.length}),e(Ln,{relicsBySlot:g}),h&&e(Dn,{progress:h,total:C}),l(f,{sx:{display:"flex",justifyContent:"space-between"},children:[e(Jt,{maxBuildsToShow:d.maxBuildsToShow,optConfigId:u}),e(yt,{numWorkers:o,setNumWorkers:a}),e(y,{disabled:!C,onClick:R?V:z,color:R?"error":"primary",startIcon:R?e(se,{}):e(bt,{}),children:t(R?"cancel":"optimize")})]})]})})})}function Q({value:t}){const n=t.toLocaleString();return e(f,{sx:{fontFamily:"Monospace",display:"inline"},children:n})}function Dn(t){const{t:n}=N("optimize"),{computed:s,remaining:i,skipped:r}=t.progress,o=s+i,a=Math.log1p(o)/Math.log1p(t.total),h=i/o*a;return l(f,{children:[l(E,{children:[n("computed"),": ",e(Q,{value:s})," /"," ",e(Q,{value:o})," "]}),l(E,{children:[n("computed + skipped"),": ",e(Q,{value:s+r})," /"," ",e(Q,{value:t.total})]}),e(St,{variant:"determinate",value:(1-h)*100,sx:{height:10,borderRadius:5}})]})}function Mn(){const{key:t}=B(),{conditionals:n}=G(t),[s,i]=c.useState(""),r=c.useMemo(()=>{const o=n.map(a=>a.sheet).filter(st);return s&&o.push(s),[...new Set(o)].sort(a=>a===s?-1:1)},[n,s]);return l(M,{spacing:1,sx:{pt:1},children:[e($t,{relicSetKey:s,setRelicSetKey:i,label:"Search Relic Set"}),e(f,{children:e(j,{container:!0,columns:3,spacing:1,children:r.map(o=>e(j,{item:!0,xs:1,children:e(Lt,{setKey:o})},o))})})]})}const Tn=210,qe=c.createContext(Tn),En=0,ae=33,_e=c.createContext(0);function Kn(){const t=c.useMemo(()=>[["char","Character",e(Pn,{},"char")],["relicCond","Relic Conditionals",e(Mn,{},"relicCond")],["lightConeCond","Light Cone Conditionals",e(cn,{},"lightConeCond")],["opt","Optimize",e(An,{},"opt")]],[]);return e(_e.Provider,{value:t.length,children:e(M,{gap:1,children:t.map(([n,s,i],r)=>e(On,{title:s,index:r,children:i},n))})})}function On({index:t,title:n,children:s}){const[i,r]=kt(),o=c.useContext(_e),a=c.useContext(qe);return l(he,{children:[e(b,{sx:h=>({outline:`solid ${h.palette.secondary.main}`,position:"sticky",top:a+t*ae,bottom:En+(o-1-t)*ae,zIndex:100}),children:e(Ut,{onClick:r,sx:{px:1},children:e(E,{variant:"h6",children:n})})}),e(f,{ref:i,sx:{scrollMarginTop:a+(t+1)*ae},children:s})]})}function Pn(){const t=B(),{key:n}=t,[s,i]=c.useState(void 0);return l(M,{spacing:1,children:[l(f,{sx:{display:"flex",gap:1},children:[l(f,{sx:{minWidth:"350px"},children:[e(Ft,{character:t,hideStats:!0}),e(Nt,{characterKey:s,onClose:()=>i(void 0)}),e(y,{fullWidth:!0,disabled:!n,onClick:()=>n&&i(n),children:"Edit Character"}),e(an,{})]}),e(Bn,{})]}),e(en,{}),e(vt,{formulasRead:le.listing.formulas,buffsRead:le.listing.buffs})]})}function An(){return e(In,{})}function Bn(){const{equippedRelics:t,equippedLightCone:n}=B();return e(b,{sx:{width:"100%"},children:e(w,{children:e(Ke,{relicIds:t,lightConeId:n})})})}function qn({character:{key:t},charOpt:{target:n}}){const{database:s}=L();return e(wt,{optTarget:n,setOptTarget:i=>s.charOpts.set(t,{target:i}),buttonProps:{fullWidth:!0,sx:{height:"100%"}}})}function Xn(){const{database:t}=L(),[n,s]=c.useState(it[0]),{t:i}=N(["charNames_gen","page_character"]),r=Ht(n);c.useEffect(()=>{n&&!r&&t.chars.getOrCreate(n)},[n,r,t.chars]);const o=G(n);c.useEffect(()=>{n&&!o&&t.charOpts.getOrCreate(n)},[n,o,t.charOpts]),It(c.useMemo(()=>`Optimize - ${i(n?"charNames_gen:Character":"Optimize")}`,[n,i]));const a=c.useMemo(()=>{const x=te(n?[n]:[],m=>e(_t,{genderedKey:qt(m)}));return{srcDisplay:x,dstDisplay:x}},[n]),h=c.useCallback((g,x,m,C,R)=>{!ot(g)||!Se(m)||!(C===null||Se(C))||!rt(g,x)||t.charOpts.setConditional(n,g,x,m,C,R)},[n,t.charOpts]),p=c.useMemo(()=>({src:n,dst:n,preset:"preset0"}),[n]),[d,u]=c.useState(),S=c.useMemo(()=>({read:d,setRead:u}),[d]);return l(f,{children:[e(Rt,{charKey:n,setCharKey:g=>g&&s(g)}),r&&o&&e(at.Provider,{value:r,children:e(Pt.Provider,{value:p,children:e(Zt,{character:r,charOpt:o,children:e(Dt.Provider,{value:a,children:e(Mt.Provider,{value:o.conditionals,children:e(Tt.Provider,{value:h,children:l(At.Provider,{value:S,children:[e(Et,{}),l(f,{sx:{display:"flex",gap:1,flexDirection:"column",mt:2},children:[e(qn,{character:r,charOpt:o}),e(qe.Provider,{value:0,children:e(Kn,{})})]})]})})})})})})})]})}export{Xn as default};
