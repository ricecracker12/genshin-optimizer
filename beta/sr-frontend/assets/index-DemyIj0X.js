import{g as Te,a as We,c as E,j as I,r as f,u as Ue,_ as Ge,b as O,I as de,s as ee,d as He,e as re,f as Fe,P as Ee,h as X,i as V,k as Q,l as Z,m as J,n as q,o as Ve,p as e,q as d,B as b,S as Qe,C as Ze,T as A,t as Je,v as Ke,w as F,N as me,x as ge,y as j,z,A as Y,D as se,E as Xe,F as Ye,G as et,H as tt,J as Le,K as rt,L as st,M as at,O as ve,Q as ot,R as nt,U as je,V as lt,W as De,X as _e,Y as it,Z as ct,$ as dt,a0 as ut,a1 as pt,a2 as ht,a3 as ft,a4 as mt}from"./index-DiaH1NYg.js";import{T as gt}from"./UploadCard-CxXXPbAh.js";import{S as ae,a as vt,r as yt,b as oe,D as ze,M as ne,T as xt}from"./StatDisplay-BZosCiqp.js";import{u as ye,R as bt,S as le,a as St,b as Ct}from"./RelicSetAutocomplete-DlxjEfPN.js";import{L as Rt,a as kt,b as It,E as Mt,A as ie}from"./Add-tdDiB5zo.js";import{C as wt,D as At,L as Pe,a as Kt,b as Lt}from"./BusinessCenter-Bvfx8EjL.js";import{R as jt,a as Dt,D as _t}from"./RelicRarityDropdown-CudwXCZE.js";import{L as $e}from"./LocationAutocomplete-BS3VSakB.js";import{C as ue,G as w}from"./Grid-C60ACQe4.js";import{C as zt}from"./CardHeader-Byk1gng3.js";import{u as Pt,a as $t}from"./useInfScroll-D5m25SlW.js";function Ot(t){return We("MuiAlert",t)}const xe=Te("MuiAlert",["root","action","icon","message","filled","colorSuccess","colorInfo","colorWarning","colorError","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),Nt=E(I.jsx("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),Bt=E(I.jsx("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),qt=E(I.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),Tt=E(I.jsx("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),Wt=["action","children","className","closeText","color","components","componentsProps","icon","iconMapping","onClose","role","severity","slotProps","slots","variant"],Ut=t=>{const{variant:a,color:l,severity:s,classes:m}=t,c={root:["root",`color${re(l||s)}`,`${a}${re(l||s)}`,`${a}`],icon:["icon"],message:["message"],action:["action"]};return Fe(c,Ot,m)},Gt=ee(Ee,{name:"MuiAlert",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:l}=t;return[a.root,a[l.variant],a[`${l.variant}${re(l.color||l.severity)}`]]}})(({theme:t})=>{const a=t.palette.mode==="light"?X.darken:X.lighten,l=t.palette.mode==="light"?X.lighten:X.darken;return O({},t.typography.body2,{backgroundColor:"transparent",display:"flex",padding:"6px 16px",variants:[...Object.entries(t.palette).filter(([,s])=>s.main&&s.light).map(([s])=>({props:{colorSeverity:s,variant:"standard"},style:{color:t.vars?t.vars.palette.Alert[`${s}Color`]:a(t.palette[s].light,.6),backgroundColor:t.vars?t.vars.palette.Alert[`${s}StandardBg`]:l(t.palette[s].light,.9),[`& .${xe.icon}`]:t.vars?{color:t.vars.palette.Alert[`${s}IconColor`]}:{color:t.palette[s].main}}})),...Object.entries(t.palette).filter(([,s])=>s.main&&s.light).map(([s])=>({props:{colorSeverity:s,variant:"outlined"},style:{color:t.vars?t.vars.palette.Alert[`${s}Color`]:a(t.palette[s].light,.6),border:`1px solid ${(t.vars||t).palette[s].light}`,[`& .${xe.icon}`]:t.vars?{color:t.vars.palette.Alert[`${s}IconColor`]}:{color:t.palette[s].main}}})),...Object.entries(t.palette).filter(([,s])=>s.main&&s.dark).map(([s])=>({props:{colorSeverity:s,variant:"filled"},style:O({fontWeight:t.typography.fontWeightMedium},t.vars?{color:t.vars.palette.Alert[`${s}FilledColor`],backgroundColor:t.vars.palette.Alert[`${s}FilledBg`]}:{backgroundColor:t.palette.mode==="dark"?t.palette[s].dark:t.palette[s].main,color:t.palette.getContrastText(t.palette[s].main)})}))]})}),Ht=ee("div",{name:"MuiAlert",slot:"Icon",overridesResolver:(t,a)=>a.icon})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),Ft=ee("div",{name:"MuiAlert",slot:"Message",overridesResolver:(t,a)=>a.message})({padding:"8px 0",minWidth:0,overflow:"auto"}),be=ee("div",{name:"MuiAlert",slot:"Action",overridesResolver:(t,a)=>a.action})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),Se={success:I.jsx(Nt,{fontSize:"inherit"}),warning:I.jsx(Bt,{fontSize:"inherit"}),error:I.jsx(qt,{fontSize:"inherit"}),info:I.jsx(Tt,{fontSize:"inherit"})},Et=f.forwardRef(function(a,l){const s=Ue({props:a,name:"MuiAlert"}),{action:m,children:c,className:n,closeText:u="Close",color:g,components:R={},componentsProps:K={},icon:v,iconMapping:r=Se,onClose:y,role:p="alert",severity:x="success",slotProps:i={},slots:h={},variant:P="standard"}=s,D=Ge(s,Wt),S=O({},s,{color:g,severity:x,variant:P,colorSeverity:g||x}),C=Ut(S),M={slots:O({closeButton:R.CloseButton,closeIcon:R.CloseIcon},h),slotProps:O({},K,i)},[L,_]=ye("closeButton",{elementType:de,externalForwardedProps:M,ownerState:S}),[te,N]=ye("closeIcon",{elementType:wt,externalForwardedProps:M,ownerState:S});return I.jsxs(Gt,O({role:p,elevation:0,ownerState:S,className:He(C.root,n),ref:l},D,{children:[v!==!1?I.jsx(Ht,{ownerState:S,className:C.icon,children:v||r[x]||Se[x]}):null,I.jsx(Ft,{ownerState:S,className:C.message,children:c}),m!=null?I.jsx(be,{ownerState:S,className:C.action,children:m}):null,m==null&&y?I.jsx(be,{ownerState:S,className:C.action,children:I.jsx(L,O({size:"small","aria-label":u,title:u,color:"inherit",onClick:y},_,{children:I.jsx(te,O({fontSize:"small"},N))}))}):null]}))});var T={},Ce;function Vt(){if(Ce)return T;Ce=1;var t=V();Object.defineProperty(T,"__esModule",{value:!0}),T.default=void 0;var a=t(Q()),l=Z(),s=(0,a.default)((0,l.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"}),"Replay");return T.default=s,T}var Qt=Vt();const Zt=J(Qt),Jt=E(I.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"}),"DoNotDisturb"),Xt=t=>"roll"+(Math.floor(Math.max(t,0)/3)+1);function ce({relic:t,onClick:a,onEdit:l,onDelete:s,onLockToggle:m,setLocation:c,mainStatAssumptionLevel:n=0,extraButtons:u,excluded:g=!1}){const{t:R}=q("relic"),{t:K}=q(["relics_gen","statKey_gen"]),{lock:v,slotKey:r,setKey:y,rarity:p,level:x,mainStatKey:i,substats:h,location:P=""}=t,D=Math.max(Math.min(n,p*3),x),S=Ve.find(C=>i.startsWith(C));return e(f.Suspense,{fallback:e(Y,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:d(z,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[d(b,{className:`grad-${p}star`,sx:{position:"relative",width:"100%"},children:[!a&&!!m&&e(de,{color:"primary",onClick:m,sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:v?e(Rt,{}):e(kt,{})}),g&&e(Qe,{color:"primary",fontSize:"large",sx:{position:"absolute",right:3,bottom:3,zIndex:2},children:e(Jt,{})}),d(b,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[d(b,{component:"div",sx:{display:"flex",alignItems:"center",gap:.4,mb:1},children:[e(Ze,{size:"small",label:e("strong",{children:`+${x}`}),color:Xt(x)}),e(A,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1.5},children:e("strong",{children:y&&e(bt,{setKey:y})||"Relic Set"})})]}),d(A,{color:"text.secondary",variant:"body2",sx:{display:"flex",gap:.5,alignItems:"center"},children:[e(le,{iconProps:{fontSize:"inherit"},slotKey:r}),K(`relics_gen:${r}`)]}),d(A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e(ae,{statKey:i,iconProps:{sx:{color:`${S}.main`}}}),e("span",{children:K(`statKey_gen:${i}`)})]}),e(A,{variant:"h5",children:e("strong",{children:d(Je,{color:D!==x?"warning":void 0,children:[Ke(p,i,x),F(i)]})})}),e(vt,{stars:p,colored:!0})]}),e(b,{sx:{height:"100%",position:"absolute",right:0,top:0},children:e(b,{component:me?me:"img",alt:"Relic Piece Image",src:yt(y,r),sx:{width:"auto",height:"90%",float:"right",marginBottom:"5%",marginTop:"5%",marginRight:"10%"}})})]}),d(ue,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:[h.map(C=>C.key&&e(Yt,{substat:C},C.key)),e(b,{flexGrow:1}),e(A,{color:"success.main"})]}),d(b,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[e(b,{sx:{flexGrow:1},children:c?e($e,{locKey:P,setLocKey:c}):e(It,{location:P})}),d(b,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[!!l&&e(ge,{title:e(A,{children:R("edit")}),placement:"top",arrow:!0,children:e(j,{color:"info",size:"small",onClick:l,children:e(Mt,{})})}),!!s&&e(ge,{title:v?R("cantDeleteLock"):"",placement:"top",children:e("span",{children:e(j,{color:"error",size:"small",onClick:s,disabled:v,sx:{top:"1px"},children:e(At,{})})})}),u]})]})]})})}function Yt({substat:t}){const{key:a,value:l}=t;if(!l||!a)return null;const s=se(l,a).toFixed(Xe(a));return d(A,{sx:{display:"flex",alignItems:"center"},children:[e(oe,{statKey:a}),d("span",{children:["+",s,F(a)]})]})}var W={},Re;function er(){if(Re)return W;Re=1;var t=V();Object.defineProperty(W,"__esModule",{value:!0}),W.default=void 0;var a=t(Q()),l=Z(),s=(0,a.default)((0,l.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight");return W.default=s,W}var tr=er();const rr=J(tr);var U={},ke;function sr(){if(ke)return U;ke=1;var t=V();Object.defineProperty(U,"__esModule",{value:!0}),U.default=void 0;var a=t(Q()),l=Z(),s=(0,a.default)((0,l.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"}),"Lock");return U.default=s,U}var ar=sr();const or=J(ar);var G={},Ie;function nr(){if(Ie)return G;Ie=1;var t=V();Object.defineProperty(G,"__esModule",{value:!0}),G.default=void 0;var a=t(Q()),l=Z(),s=(0,a.default)((0,l.jsx)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm0 12H6V10h12v10z"}),"LockOpen");return G.default=s,G}var lr=nr();const ir=J(lr);var H={},Me;function cr(){if(Me)return H;Me=1;var t=V();Object.defineProperty(H,"__esModule",{value:!0}),H.default=void 0;var a=t(Q()),l=Z(),s=(0,a.default)((0,l.jsx)("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");return H.default=s,H}var dr=cr();const ur=J(dr);function pr({index:t,relic:a,setSubstat:l}){const{t:s}=q("relic"),{mainStatKey:m="",rarity:c=5}=a??{},{key:n="",value:u=0,rolls:g=[],efficiency:R=0}=(a==null?void 0:a.substats[t])??{},K=g.length;let v="",r=[],y=0;if(a){const i=a.rarity,{numUpgrades:h,high:P}=Ye[i];y=h+P-3-K,r=n?et(n,i):[]}const p=7-r.length;y<0&&(v=v||s("editor.substat.error.noOverRoll",{value:y+K}));const x=f.useMemo(()=>n?[{value:0},...tt(c,n).map(i=>({value:i}))]:[{value:0}],[n,c]);return d(z,{bgt:"light",children:[e(b,{sx:{display:"flex"},children:d(Le,{size:"small",sx:{width:"100%",display:"flex"},children:[d(ze,{startIcon:n?e(ae,{statKey:n}):void 0,title:n?e(oe,{statKey:n,showPercent:!0,disableIcon:!0}):s("editor.substat.substatFormat",{value:t+1}),disabled:!a,color:n?"success":"primary",sx:{whiteSpace:"nowrap"},children:[n&&e(ne,{onClick:()=>l(t,{key:"",value:0}),children:s("editor.substat.noSubstat")}),rt.filter(i=>m!==i).map(i=>d(ne,{selected:n===i,disabled:n===i,onClick:()=>l(t,{key:i,value:0}),children:[e(Pe,{children:e(ae,{statKey:i})}),e(Kt,{children:e(oe,{statKey:i,showPercent:!0,disableIcon:!0})})]},i))]}),e(st,{sx:{flexBasis:30,flexGrow:1},children:e(at,{float:F(n)==="%",placeholder:s("editor.substat.selectSub"),value:n?ve(se(u,n),n):void 0,onChange:i=>{let h=i??0;F(n)==="%"&&(h=h/100),l(t,{key:n,value:h})},disabled:!n,error:!!v,sx:{px:1},inputProps:{sx:{textAlign:"right"}}})}),!!r.length&&e(ot,{children:s("editor.substat.nextRolls")})]})}),e(b,{px:2,children:e(hr,{value:ve(se(u,n),n),marks:x,setValue:i=>{let h=i??0;F(n)==="%"&&(h=h/100),l(t,{key:n,value:h})},disabled:!n})}),e(b,{sx:{px:1,pb:1},children:v?e(nt,{color:"error",children:s("ui:error")}):d(w,{container:!0,children:[e(w,{item:!0,flexGrow:1,children:!!g.length&&[...g].sort().map((i,h)=>e(A,{component:"span",color:`roll${je(p+r.indexOf(i),1,6)}.main`,sx:{ml:1},children:i},`${h}.${i}`))}),e(w,{item:!0,xs:"auto",flexShrink:1,children:e(A,{children:d(gt,{t:s,i18nKey:"editor.substat.eff",color:"text.secondary",children:["Efficiency: ",R]})})})]})})]})}function hr({value:t,setValue:a,marks:l,disabled:s=!1}){var n,u;const[m,c]=f.useState(t);return f.useEffect(()=>c(t),[t]),e(St,{value:m,step:.1,disabled:s,min:((n=l[1])==null?void 0:n.value)??0,max:((u=l[l.length-1])==null?void 0:u.value)??0,onChange:(g,R)=>c(R),onChangeCommitted:(g,R)=>a(R),valueLabelDisplay:"auto"})}function fr(t,a){const s=(()=>{switch(a.type){case"reset":return;case"substat":{const{index:m,substat:c}=a,n=[...t.substats],u=c.key?n.findIndex(g=>g.key===c.key):-1;if(u===-1||u===m)n[m]={...c};else{const g=n[m];n[m]={...n[u]},n[u]={...g}}return{...t,substats:n}}case"overwrite":return a.relic;case"update":return{...t,...a.relic}}})();return s&&lt(s,!0,!1)}const we={rarity:[5,4,3,2],setEffects:{}};function mr({relicIdToEdit:t="new",cancelEdit:a,fixedSlotKey:l,allowEmpty:s=!1,disableSet:m=!1}){const{t:c}=q("relic"),{t:n}=q(["relics_gen","statKey_gen"]),{database:u}=De(),[g,R]=_e();f.useEffect(()=>u.relics.followAny(R),[u,R]);const[K,v]=f.useState(!1);f.useEffect(()=>{t==="new"&&(v(!0),y({type:"reset"}));const o=t&&g&&u.relics.get(t);o&&(v(!0),y({type:"overwrite",relic:it(o)}))},[t,u,g]);const[r,y]=f.useReducer(fr,void 0),{relic:p,errors:x}=f.useMemo(()=>r?ct(r,t):{relic:void 0,errors:[]},[r,t]),{prev:i,prevEditType:h}=f.useMemo(()=>{const o=g&&t&&u.relics.get(t);if(o)return{prev:o,prevEditType:"edit"};if(r===void 0)return{prev:void 0,prevEditType:""};const{duplicated:k,upgraded:$}=g&&u.relics.findDups(r);return{prev:k[0]??$[0],prevEditType:k.length!==0?"duplicate":"upgrade"}},[r,t,u,g]),P=!["new",""].includes(t)&&!!(r!=null&&r.location)||!!l||!!t&&t!=="new",{rarity:D=5,level:S=0}=r??{},C=f.useMemo(()=>(r==null?void 0:r.slotKey)??l??"head",[l,r]),M=r?we:void 0,L=f.useCallback(o=>{const k=o.setKey?we:M;function $(B,fe,qe){return B&&fe.includes(B)?B:qe??fe[0]}o.setKey&&(o.rarity=$(r==null?void 0:r.rarity,k.rarity,Math.max(...k.rarity)),o.slotKey=$(r==null?void 0:r.slotKey,["head","hands"])),o.rarity&&(o.level=(r==null?void 0:r.level)??0),o.level&&(o.level=je(o.level,0,3*(o.rarity??r.rarity))),o.slotKey&&(o.mainStatKey=$(r==null?void 0:r.mainStatKey,dt[o.slotKey])),o.mainStatKey&&(o.substats=[0,1,2,3].map(B=>r&&r.substats[B].key!==o.mainStatKey?r.substats[B]:{key:"",value:0})),y({type:"update",relic:o})},[r,M,y]),_=f.useCallback(()=>{a==null||a(),y({type:"reset"})},[a,y]),te=f.useCallback((o,k)=>y({type:"substat",index:o,substat:k}),[]),N=!x.length,pe=f.useCallback(o=>{if(!t&&r&&!window.confirm(c("editor.clearPrompt"))){o==null||o.preventDefault();return}v(!1),_()},[c,t,r,v,_]),Oe=ut(),Ne=pt(Oe.breakpoints.up("md")),he=t!=="new"&&t||(i==null?void 0:i.id),Be=()=>window.confirm(c("editor.clearPrompt"));return e(f.Suspense,{fallback:!1,children:e(ht,{open:K,onClose:pe,children:d(z,{bgt:"dark",children:[e(zt,{title:"Relic Editor",action:e(de,{onClick:pe,children:e(Lt,{})})}),d(ue,{sx:{display:"flex",flexDirection:"column",gap:1},children:[d(w,{container:!0,spacing:1,columns:{xs:1,md:2},children:[d(w,{item:!0,xs:1,display:"flex",flexDirection:"column",gap:1,children:[d(b,{sx:{display:"flex",gap:1},children:[e(Ct,{disabled:m,size:"small",relicSetKey:(r==null?void 0:r.setKey)??"",setRelicSetKey:o=>L({setKey:o}),sx:{flexGrow:1},label:r!=null&&r.setKey?"":c("editor.unknownSetName")}),e(jt,{rarity:r?D:void 0,onRarityChange:o=>L({rarity:o}),filter:o=>{var k,$;return!!(($=(k=M==null?void 0:M.rarity)==null?void 0:k.includes)!=null&&$.call(k,o))},disabled:!M})]}),d(b,{component:"div",display:"flex",children:[e(xt,{label:"Level",variant:"filled",sx:{flexShrink:1,flexGrow:1,mr:1,my:0},margin:"dense",size:"small",value:S,disabled:!M,onChange:o=>{const k=parseInt(o.target.value)||0;L({level:k})}}),d(Le,{children:[e(j,{onClick:()=>L({level:S-1}),disabled:!M||S===0,children:"-"}),D?[...Array(D+1).keys()].map(o=>3*o).map(o=>e(j,{onClick:()=>L({level:o}),disabled:!M||S===o,children:o},o)):null,e(j,{onClick:()=>L({level:S+1}),disabled:!M||S===D*3,children:"+"})]})]}),d(b,{component:"div",display:"flex",children:[e(ze,{startIcon:r!=null&&r.slotKey?e(le,{slotKey:r.slotKey}):void 0,title:r?n(r.slotKey):c("slot"),value:C,disabled:P||!M,color:r?"success":"primary",children:ft.map(o=>d(ne,{selected:C===o,disabled:C===o,onClick:()=>L({slotKey:o}),children:[e(Pe,{children:e(le,{slotKey:o})}),n(o)]},o))}),e(z,{bgt:"light",sx:{p:1,ml:1,flexGrow:1},children:e(f.Suspense,{fallback:e(Y,{width:"60%"}),children:e(A,{color:"text.secondary",children:n(`relics_gen:${C}`)})})})]}),d(b,{component:"div",display:"flex",gap:1,children:[e(Dt,{slotKey:C,statKey:r==null?void 0:r.mainStatKey,setStatKey:o=>L({mainStatKey:o}),defText:c("mainStat"),dropdownButtonProps:{disabled:!M,color:r?"success":"primary"}}),e(z,{bgt:"light",sx:{p:1,flexGrow:1},children:e(A,{color:"text.secondary",children:r?Ke(D,r.mainStatKey,S):c("mainStat")})}),e(j,{onClick:()=>L({lock:!(r!=null&&r.lock)}),color:r!=null&&r.lock?"success":"primary",disabled:!r,children:r!=null&&r.lock?e(or,{}):e(ir,{})})]}),e($e,{locKey:(p==null?void 0:p.location)??"",setLocKey:o=>L({location:o})})]}),e(w,{item:!0,xs:1,display:"flex",flexDirection:"column",gap:1,children:[0,1,2,3].map(o=>e(pr,{index:o,relic:p,setSubstat:te},o))})]}),i&&d(w,{container:!0,sx:{justifyContent:"space-around"},spacing:1,children:[e(w,{item:!0,xs:12,md:5.5,lg:4,children:d(z,{bgt:"light",children:[e(A,{sx:{textAlign:"center"},py:1,variant:"h6",color:"text.secondary",children:c(h!=="edit"?h==="duplicate"?"editor.dupeRelic":"editor.updateRelic":"editor.beforeEdit")}),e(ce,{relic:i})]})}),Ne&&e(w,{item:!0,md:1,display:"flex",alignItems:"center",justifyContent:"center",children:e(z,{bgt:"light",sx:{display:"flex"},children:e(rr,{sx:{fontSize:40}})})}),e(w,{item:!0,xs:12,md:5.5,lg:4,children:d(z,{bgt:"light",children:[e(A,{sx:{textAlign:"center"},py:1,variant:"h6",color:"text.secondary",children:c("editor.preview")}),p&&e(ce,{relic:p})]})})]}),!N&&e(Et,{variant:"filled",severity:"error",children:x.map((o,k)=>e("div",{children:o},k))}),d(b,{display:"flex",gap:2,children:[h==="edit"?e(j,{startIcon:e(ie,{}),onClick:()=>{r&&u.relics.set(i.id,r),s||(v(!1),a()),_()},disabled:!r||!N,color:"primary",children:c("editor.btnSave")}):e(j,{startIcon:e(ie,{}),onClick:()=>{u.relics.new(r),s||(v(!1),a()),_()},disabled:!r||!N,color:h==="duplicate"?"warning":"primary",children:c("editor.btnAdd")}),s&&e(j,{startIcon:e(Zt,{}),disabled:!r,onClick:()=>{Be()&&_()},color:"error",children:c("editor.btnClear")}),i&&h!=="edit"&&e(j,{startIcon:e(ur,{}),onClick:()=>{r&&u.relics.set(i.id,r),_(),s||v(!1)},disabled:!r||!N,color:"success",children:c("editor.btnUpdate")}),!!he&&e(j,{startIcon:e(_t,{}),onClick:()=>{window.confirm(c("editor.confirmDelete"))&&(u.relics.remove(he),_(),s||v(!1))},disabled:!r||!N,color:"error",children:c("editor.delete")})]})]})]})})})}const Ae={xs:1,sm:2,md:3,lg:3,xl:4},gr={xs:10,sm:12,md:24,lg:24,xl:24};function vr({onAdd:t,onEdit:a}){const{t:l}=q("relic"),{database:s}=De(),[m,c]=_e();f.useEffect(()=>s.relics.followAny(c),[s,c]);const{relicIds:n,totalRelicsNum:u}=f.useMemo(()=>{const p=s.relics.values,x=p.length,i=p.map(h=>h.id);return m&&{relicIds:i,totalRelicsNum:x}},[s,m]),g=Pt(),R=n.length!==u?`${n.length}/${u}`:u,{numShow:K,setTriggerElement:v}=$t(gr[g],n.length),r=f.useMemo(()=>n.slice(0,K),[n,K]),y={numShowing:r.length,totalShowing:R};return d(mt,{children:[e(z,{bgt:"dark",children:e(ue,{children:e(b,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:d(A,{color:"text.secondary",children:["Showing ",e("b",{children:y.numShowing})," out of"," ",y.totalShowing," Items"]})})})}),e(w,{container:!0,columns:Ae,spacing:1,children:e(w,{item:!0,xs:!0,children:e(j,{fullWidth:!0,onClick:t,color:"info",startIcon:e(ie,{}),children:l("addNew")})})}),d(f.Suspense,{fallback:e(Y,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[e(w,{container:!0,columns:Ae,spacing:1,children:r.map(p=>e(w,{item:!0,xs:1,children:e(ce,{relic:s.relics.get(p),onEdit:()=>a==null?void 0:a(p),onDelete:()=>s.relics.remove(p),setLocation:x=>s.relics.set(p,{location:x}),onLockToggle:()=>s.relics.set(p,({lock:x})=>({lock:!x}))})},p))}),n.length!==r.length&&e(Y,{ref:p=>{p&&v(p)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function Kr(){const[t,a]=f.useState("");return d(b,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(mr,{relicIdToEdit:t,cancelEdit:()=>a(""),allowEmpty:!0}),e(vr,{onAdd:()=>a("new"),onEdit:a})]})}export{Kr as default};
