import{a5 as N,c as T,j as z,n as I,r as m,a6 as R,a7 as V,p as e,q as l,B as f,I as W,T as v,a8 as E,x as M,y as w,z as P,A as L,a9 as _,V as j,aa as $,a1 as F,ab as G,ac as U,a4 as H}from"./index-DnAv-7RK.js";import{P as q}from"./UploadCard-CzSOF1_m.js";import{C as K,u as D,G as k}from"./ReadOnlyTextArea-DVwpqF0A.js";import{g as O,L as Q,u as J}from"./LightConeTrans-DPs1rs6-.js";import{L as X}from"./LightConeEditorCard-HxlWa3SE.js";import{D as B}from"./BusinessCenter-B5qsniHW.js";import{a as Y,l as Z,b as ee,u as te}from"./StatDisplay-BJxppHd-.js";import{u as ne,a as oe}from"./useMediaQueryUp-BGgz3742.js";import{L as ae,a as ie,b as se,E as re,A as le}from"./Add-CO76ycZM.js";import{L as ce}from"./LocationAutocomplete-DlvIsFCn.js";import"./CardHeader-CdnJdEuz.js";function he(t,s,c,h=[]){return(n,r)=>{for(const p of t){let g=0;const a=c[p],o=a(n),i=a(r);if(typeof o=="string"&&typeof i=="string"?g=o.localeCompare(i):g=i-o,g!==0)return h.includes(p)?g:1*g}return 0}}const de=["level","name","rarity"];function pe(){return{level:t=>t.level*(t.ascension+1),name:t=>`lightConeNames_gen:${t.key}`,rarity:t=>N.lightCone[t.key].rarity}}const ge={name:["name"],level:["level","rarity","name"],rarity:["rarity","level","name"]},me=T(z.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),ue=T(z.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function fe({lightCone:t,onClick:s,onEdit:c,onDelete:h,onLockToggle:n,canEquip:r=!1,setLocation:p,extraButtons:g}){const{t:a}=I(["lightCone","lightCones_gen","common_gen"]),{key:o,level:i,ascension:x,superimpose:u,location:C="",lock:y}=t,S=m.useMemo(()=>R(V(o,i,x,u)),[x,o,i,u]),d=O(o);return e(m.Suspense,{fallback:e(L,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:l(P,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[l(f,{className:`grad-${d.rarity}star`,sx:{position:"relative",width:"100%"},children:[!s&&!!n&&e(W,{color:"primary",onClick:n,sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:y?e(ae,{}):e(ie,{})}),l(f,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[l(f,{component:"div",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e(q,{iconProps:{fontSize:"inherit"},pathKey:d.path}),e(v,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1},children:e("strong",{children:e(Q,{lcKey:o})})})]}),l(v,{component:"span",variant:"h5",children:[a("common_gen:lv")," ",i]}),l(v,{component:"span",variant:"h5",color:"text.secondary",children:["/",E[x]]}),l(v,{variant:"h6",children:[a("lightCones_gen:superimpose")," ",u]}),e(Y,{stars:d.rarity,colored:!0})]}),e(f,{sx:{height:"100%",position:"absolute",right:0,top:0},children:e(f,{component:"img",alt:"Light Cone Image",src:Z(o,"icon"),sx:{width:"auto",height:"90%",float:"right",marginBottom:"5%",marginTop:"5%",marginRight:"5%"}})})]}),e(K,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:["hp","atk","def"].map(b=>e(xe,{calc:S,stat:b},b))}),l(f,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[e(f,{sx:{flexGrow:1},children:r&&p?e(ce,{locKey:C,setLocKey:p,getOptionDisabled:b=>!b.key,disableClearable:!0}):e(se,{location:C})}),l(f,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[!!c&&e(M,{title:e(v,{children:a("edit")}),placement:"top",arrow:!0,children:e(w,{color:"info",size:"small",onClick:c,children:e(re,{})})}),!!h&&e(M,{title:y?a("cantDeleteLock"):"",placement:"top",children:e("span",{children:e(w,{color:"error",size:"small",onClick:h,disabled:!!C||y,sx:{top:"1px"},children:e(B,{})})})}),g]})]})]})})}function xe({calc:t,stat:s}){return l(v,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(ee,{statKey:s}),e("span",{children:t.compute(_.base[s].with("sheet","lightCone")).val.toFixed()})]},s)}function Ce({lightConeIdToEdit:t="",cancelEdit:s}){const{t:c}=I(["lightCone","common"]),{database:h}=j(),n=J(t==="new"?void 0:t),[r,p]=m.useState(void 0);D(n)!==n&&n&&p(structuredClone(n)),D(t)!==t&&t==="new"&&p({level:1,ascension:0,superimpose:1});const g=m.useCallback(u=>{p(C=>({...C,...u}))},[]),a=m.useCallback(()=>{s(),p(void 0)},[s]),o=m.useCallback(u=>{if(r!=null&&r.key&&!window.confirm(c("editor.clearPrompt"))){u==null||u.preventDefault();return}a()},[c,r,a]),i=m.useMemo(()=>$(r),[r]),x=m.useMemo(()=>l(f,{display:"flex",gap:2,children:[e(w,{startIcon:e(me,{}),onClick:()=>{i&&h.lightCones.new(i),a()},disabled:!i,color:"primary",children:c("editor.btnAdd")}),i&&n&&e(w,{startIcon:e(ue,{}),onClick:()=>{i&&h.lightCones.set(n.id,i),a()},disabled:!i,color:"success",children:c("editor.btnUpdate")}),!!(n!=null&&n.id)&&e(w,{startIcon:e(B,{}),onClick:()=>{window.confirm(c("editor.confirmDelete"))&&(h.lightCones.remove(n.id),a())},disabled:!(n!=null&&n.id),color:"error",sx:{top:"2px"},children:c("common:delete")})]}),[a,h,n,c,i]);return e(m.Suspense,{fallback:!1,children:r&&e(F,{open:!!r,onClose:o,children:e(X,{onClose:o,lightCone:r,setLightCone:g,footer:x})})})}const A={xs:1,sm:2,md:3,lg:3,xl:4},ye={xs:10,sm:12,md:24,lg:24,xl:24};function ve({onAdd:t,onEdit:s}){const{t:c}=I("lightCone"),{database:h}=j(),n=()=>({sortType:de[0],ascending:!1,rarity:[...U],path:[...G]}),{sortType:r,ascending:p}=n(),g=te(h.lightCones),a=g.length,o=m.useMemo(()=>[...g].sort(he(ge[r]??[],p,pe())).map(d=>d.id),[g,r,p]),i=ne(),x=o.length!==a?`${o.length}/${a}`:`${a}`,{numShow:u,setTriggerElement:C}=oe(ye[i],o.length),y=m.useMemo(()=>o.slice(0,u),[o,u]),S={numShowing:y.length,total:x};return l(H,{children:[e(P,{bgt:"dark",children:e(K,{children:e(f,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:l(v,{color:"text.secondary",children:["Showing ",e("b",{children:S.numShowing})," out of"," ",S.total," Items"]})})})}),e(k,{container:!0,columns:A,spacing:1,children:e(k,{item:!0,xs:!0,children:e(w,{fullWidth:!0,onClick:t,color:"info",startIcon:e(le,{}),children:c("addNew")})})}),l(m.Suspense,{fallback:e(L,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:[e(k,{container:!0,columns:A,spacing:1,children:y.map(d=>e(k,{item:!0,xs:1,children:e(fe,{lightCone:h.lightCones.get(d),onEdit:()=>s==null?void 0:s(d),onDelete:()=>h.lightCones.remove(d),setLocation:b=>h.lightCones.set(d,{location:b}),canEquip:!0})},d))}),o.length!==y.length&&e(L,{ref:d=>{d&&C(d)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function Pe(){const[t,s]=m.useState("");return l(f,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(Ce,{lightConeIdToEdit:t,cancelEdit:()=>s("")}),e(ve,{onAdd:()=>s("new"),onEdit:s})]})}export{Pe as default};
