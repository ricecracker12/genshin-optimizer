import{c as w,j as k,i as F,k as Q,l as X,m as Y,n as q,q as a,p as e,T as l,aJ as Z,z as I,W as ee,r,a_ as te,y as x,C as ae,B as S,a2 as ne}from"./index-Dq5QCR03.js";import{a as P,T as h,U as re}from"./UploadCard-DEI_tbXX.js";import{u as oe}from"./useBoolState-CObbOG6l.js";import{C as f,G as c}from"./Grid-ztHRm0lQ.js";import{D as se}from"./Delete-C8k77nS1.js";const le=w(k.jsx("path",{d:"M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"}),"Download"),ce=w(k.jsx("path",{d:"M9 3 5 6.99h3V14h2V6.99h3L9 3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99h-3z"}),"ImportExport"),ie=w(k.jsx("path",{d:"M5 20h14v-2H5v2zm0-10h4v6h6v-6h4l-7-7-7 7z"}),"Upload");var g={},O;function de(){if(O)return g;O=1;var o=F();Object.defineProperty(g,"__esModule",{value:!0}),g.default=void 0;var i=o(Q()),d=X(),C=(0,i.default)((0,d.jsx)("path",{d:"M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"}),"ContentPaste");return g.default=C,g}var ue=de();const pe=Y(ue);function he(){const{t:o}=q("page_settings");return a(I,{bgt:"light",children:[e(f,{sx:{py:1},children:e(l,{variant:"subtitle1",children:o("DatabaseCard.title")})}),e(P,{}),e(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:e(c,{container:!0,spacing:2,columns:{xs:1,md:2},children:Z(0,3).map(i=>e(c,{item:!0,xs:1,children:e(me,{index:i})},i))})})]})}function me({index:o}){const{databases:i,database:d,setDatabase:C}=ee(),t=i[o],[{name:s,lastEdit:E},j]=r.useState(t.dbMeta.get());r.useEffect(()=>t.dbMeta.follow((m,v)=>j(v)),[t]),r.useEffect(()=>j(t.dbMeta.get()),[t]);const u=d===t,[K,L,B]=oe(),{t:n}=q("page_settings"),_=t.chars.keys.length,T=t.relics.keys.length,M=t.lightCones.keys.length,R=t.teams.keys.length,W=t.builds.keys.length,b=!!(_||T||M||R||W),V=r.useCallback(()=>navigator.clipboard.writeText(JSON.stringify(t.exportSROD())).then(()=>alert("Copied database to clipboard.")).catch(console.error),[t]),$=r.useCallback(()=>{window.confirm(`Are you sure you want to delete "${s}"?`)&&(t.clear(),t.toExtraLocalDB())},[t,s]),H=r.useCallback(()=>{const v=new Date().toISOString().split(".")[0].replace("T","_").replaceAll(":","-"),U=JSON.stringify(t.exportSROD()),G=`${s.trim().replaceAll(" ","_")}_${v}.json`,A="application/json;charset=utf-8",p=document.createElement("a");p.download=G,p.href=`data:${A},${encodeURIComponent(U)}`,p.target="_blank",document.body.appendChild(p),p.click(),document.body.removeChild(p)},[t,s]),J=r.useCallback(()=>{u||(d.toExtraLocalDB(),t.swapStorage(d),C(o,t))},[o,C,d,u,t]),[y,z]=r.useState(s);r.useEffect(()=>z(s),[s]);const D=r.useCallback(()=>{t.dbMeta.set({name:y}),t.toExtraLocalDB()},[y,t]),N=r.useCallback(m=>m.key==="Enter"&&D(),[D]);return a(I,{sx:{height:"100%",boxShadow:u?"0px 0px 0px 2px green inset":void 0},children:[a(f,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[e(te,{value:y,sx:{borderRadius:1,px:1,flexGrow:1},onChange:m=>z(m.target.value),onBlur:D,onKeyDown:N}),!u&&e(x,{startIcon:e(ce,{}),onClick:J,color:"warning",children:n("DatabaseCard.button.swap")}),e(ae,{color:u?"success":"secondary",sx:{alignSelf:"center"},label:u?n("DatabaseCard.currentDB"):`${n("DatabaseCard.title")} ${t.dbIndex}`})]}),e(P,{}),e(f,{children:a(S,{display:"flex",gap:2,children:[a(S,{flexGrow:1,children:[a(l,{noWrap:!0,children:[e(h,{t:n,i18nKey:"count.chars"})," ",e("strong",{children:_})]}),a(l,{noWrap:!0,children:[e(h,{t:n,i18nKey:"count.relics"})," ",e("strong",{children:T})]}),a(l,{noWrap:!0,children:[e(h,{t:n,i18nKey:"count.lightCones"})," ",e("strong",{children:M})]}),a(l,{noWrap:!0,children:[e(h,{t:n,i18nKey:"count.teams"})," ",e("strong",{children:R})]}),a(l,{noWrap:!0,children:[e(h,{t:n,i18nKey:"count.builds"})," ",e("strong",{children:W})]})]}),a(S,{children:[a(c,{container:!0,spacing:1,columns:{xs:2},children:[e(c,{item:!0,xs:1,children:e(x,{fullWidth:!0,disabled:!b,color:"info",onClick:V,startIcon:e(pe,{}),children:e(h,{t:n,i18nKey:"DatabaseCard.button.copy"})})}),a(c,{item:!0,xs:1,children:[e(ne,{open:K,onClose:B,children:e(re,{index:o,onReplace:B})}),e(x,{fullWidth:!0,component:"span",color:"info",startIcon:e(ie,{}),onClick:L,children:n("DatabaseCard.button.upload")})]}),e(c,{item:!0,xs:1,children:e(x,{fullWidth:!0,disabled:!b,onClick:H,startIcon:e(le,{}),children:n("DatabaseCard.button.download")})}),e(c,{item:!0,xs:1,children:e(x,{fullWidth:!0,disabled:!b,color:"error",onClick:$,startIcon:e(se,{}),children:n("DatabaseCard.button.delete")})})]}),!!E&&e(l,{noWrap:!0,align:"center",style:{paddingTop:"1.5em"},children:e("strong",{children:new Date(E).toLocaleString()})})]})]})})]})}function ye(){return e(I,{sx:{my:1},children:e(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:e(he,{})})})}export{ye as default};
