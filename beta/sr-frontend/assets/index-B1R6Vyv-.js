import{a5 as R,c as N,j as E,n as D,r as h,a6 as F,a7 as U,p as e,q as d,B as f,I as _,T as y,a8 as $,N as M,x as T,y as v,z,A as I,a9 as G,W as j,aa as V,a2 as H,X as q,ab as O,ac as Q,a4 as X}from"./index-DiaH1NYg.js";import{P as J}from"./UploadCard-CxXXPbAh.js";import{g as Y,L as Z,u as ee}from"./LightConeTrans-ulShdazp.js";import{L as te}from"./LightConeEditorCard-DQ2tKKGl.js";import{D as K}from"./BusinessCenter-Bvfx8EjL.js";import{u as ne,a as oe}from"./useInfScroll-D5m25SlW.js";import{L as ae,a as ie,b as se,E as re,A as le}from"./Add-tdDiB5zo.js";import{a as ce,l as he,b as de}from"./StatDisplay-BZosCiqp.js";import{L as pe}from"./LocationAutocomplete-BS3VSakB.js";import{C as P,G as S}from"./Grid-C60ACQe4.js";import"./CardHeader-Byk1gng3.js";function ge(n,i,p,s=[]){return(t,l)=>{for(const g of n){let m=0;const r=p[g],a=r(t),o=r(l);if(typeof a=="string"&&typeof o=="string"?m=a.localeCompare(o):m=o-a,m!==0)return s.includes(g)?m:1*m}return 0}}const me=["level","name","rarity"];function ue(){return{level:n=>n.level*(n.ascension+1),name:n=>`lightConeNames_gen:${n.key}`,rarity:n=>R.lightCone[n.key].rarity}}const fe={name:["name"],level:["level","rarity","name"],rarity:["rarity","level","name"]},xe=N(E.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),Ce=N(E.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function ye({lightCone:n,onClick:i,onEdit:p,onDelete:s,onLockToggle:t,canEquip:l=!1,setLocation:g,extraButtons:m}){const{t:r}=D(["lightCone","lightCones_gen","common_gen"]),{key:a,level:o,ascension:C,superimpose:u,location:x="",lock:w}=n,L=h.useMemo(()=>F(U(a,o,C,u)),[C,a,o,u]),b=Y(a);return e(h.Suspense,{fallback:e(I,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:d(z,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[d(f,{className:`grad-${b.rarity}star`,sx:{position:"relative",width:"100%"},children:[!i&&!!t&&e(_,{color:"primary",onClick:t,sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:w?e(ae,{}):e(ie,{})}),d(f,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[d(f,{component:"div",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e(J,{iconProps:{fontSize:"inherit"},pathKey:b.path}),e(y,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1},children:e("strong",{children:e(Z,{lcKey:a})})})]}),d(y,{component:"span",variant:"h5",children:[r("common_gen:lv")," ",o]}),d(y,{component:"span",variant:"h5",color:"text.secondary",children:["/",$[C]]}),d(y,{variant:"h6",children:[r("lightCones_gen:superimpose")," ",u]}),e(ce,{stars:b.rarity,colored:!0})]}),e(f,{sx:{height:"100%",position:"absolute",right:0,top:0},children:e(f,{component:M?M:"img",alt:"Light Cone Image",src:he(a,"icon"),sx:{width:"auto",height:"90%",float:"right",marginBottom:"5%",marginTop:"5%",marginRight:"5%"}})})]}),e(P,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:["hp","atk","def"].map(c=>e(be,{calc:L,stat:c},c))}),d(f,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[e(f,{sx:{flexGrow:1},children:l&&g?e(pe,{locKey:x,setLocKey:g,getOptionDisabled:c=>!c.key,disableClearable:!0}):e(se,{location:x})}),d(f,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[!!p&&e(T,{title:e(y,{children:r("edit")}),placement:"top",arrow:!0,children:e(v,{color:"info",size:"small",onClick:p,children:e(re,{})})}),!!s&&e(T,{title:w?r("cantDeleteLock"):"",placement:"top",children:e("span",{children:e(v,{color:"error",size:"small",onClick:s,disabled:!!x||w,sx:{top:"1px"},children:e(K,{})})})}),m]})]})]})})}function be({calc:n,stat:i}){return d(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(de,{statKey:i}),e("span",{children:n.compute(G.base[i].with("sheet","lightCone")).val.toFixed()})]},i)}function ve({lightConeIdToEdit:n="",cancelEdit:i}){const{t:p}=D(["lightCone","common"]),{database:s}=j(),t=ee(n),[l,g]=h.useState(void 0);h.useEffect(()=>{t&&g(structuredClone(t))},[t]),h.useEffect(()=>{n==="new"&&g({level:1,ascension:0,superimpose:1})},[n]);const m=h.useCallback(u=>{g(x=>({...x,...u}))},[]),r=h.useCallback(()=>{i(),g(void 0)},[i]),a=h.useCallback(u=>{if(l!=null&&l.key&&!window.confirm(p("editor.clearPrompt"))){u==null||u.preventDefault();return}r()},[p,l,r]),o=h.useMemo(()=>V(l),[l]),C=h.useMemo(()=>d(f,{display:"flex",gap:2,children:[e(v,{startIcon:e(xe,{}),onClick:()=>{o&&s.lightCones.new(o),r()},disabled:!o,color:"primary",children:p("editor.btnAdd")}),o&&t&&e(v,{startIcon:e(Ce,{}),onClick:()=>{o&&s.lightCones.set(t.id,o),r()},disabled:!o,color:"success",children:p("editor.btnUpdate")}),!!(t!=null&&t.id)&&e(v,{startIcon:e(K,{}),onClick:()=>{window.confirm(p("editor.confirmDelete"))&&(s.lightCones.remove(t.id),r())},disabled:!(t!=null&&t.id),color:"error",sx:{top:"2px"},children:p("common:delete")})]}),[r,s,t,p,o]);return e(h.Suspense,{fallback:!1,children:l&&e(H,{open:!!l,onClose:a,children:e(te,{onClose:a,lightCone:l,setLightCone:m,footer:C})})})}const A={xs:1,sm:2,md:3,lg:3,xl:4},we={xs:10,sm:12,md:24,lg:24,xl:24};function Le({onAdd:n,onEdit:i}){const{t:p}=D("lightCone"),{database:s}=j(),[t,l]=q(),g=()=>({sortType:me[0],ascending:!1,rarity:[...Q],path:[...O]}),{sortType:m,ascending:r}=g();h.useEffect(()=>s.lightCones.followAny(l),[s,l]);const{lightConeIds:a,totalLightConeNum:o}=h.useMemo(()=>{const c=s.lightCones.values,k=c.length,B=c.sort(ge(fe[m]??[],r,ue())).map(W=>W.id);return t&&{lightConeIds:B,totalLightConeNum:k}},[s,t,m,r]),C=ne(),u=a.length!==o?`${a.length}/${o}`:`${o}`,{numShow:x,setTriggerElement:w}=oe(we[C],a.length),L=h.useMemo(()=>a.slice(0,x),[a,x]),b={numShowing:L.length,total:u};return d(X,{children:[e(z,{bgt:"dark",children:e(P,{children:e(f,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:d(y,{color:"text.secondary",children:["Showing ",e("b",{children:b.numShowing})," out of"," ",b.total," Items"]})})})}),e(S,{container:!0,columns:A,spacing:1,children:e(S,{item:!0,xs:!0,children:e(v,{fullWidth:!0,onClick:n,color:"info",startIcon:e(le,{}),children:p("addNew")})})}),d(h.Suspense,{fallback:e(I,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:[e(S,{container:!0,columns:A,spacing:1,children:L.map(c=>e(S,{item:!0,xs:1,children:e(ye,{lightCone:s.lightCones.get(c),onEdit:()=>i==null?void 0:i(c),onDelete:()=>s.lightCones.remove(c),setLocation:k=>s.lightCones.set(c,{location:k}),canEquip:!0})},c))}),a.length!==L.length&&e(I,{ref:c=>{c&&w(c)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function Ke(){const[n,i]=h.useState("");return d(f,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(ve,{lightConeIdToEdit:n,cancelEdit:()=>i("")}),e(Le,{onAdd:()=>i("new"),onEdit:i})]})}export{Ke as default};
